<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">

  <title>The Garden Gate</title>

  <!-- Images of classic tile designs used in Skud Pai Sho are originally from the Lotus Gambit rules community at http://lotusgambit.pbworks.com/w/page/45592429/Home -->

  <link href="style/main.css" rel="stylesheet" type="text/css">

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">

  <!-- <link href="favicon.ico" rel="shortcut icon"> -->
  <!-- <link href="meta/apple-touch-icon.png" rel="apple-touch-icon"> -->
  <link href="meta/apple-touch-startup-image-640x1096.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)"
    rel="apple-touch-startup-image">
  <!-- iPhone 5+ -->
  <link href="meta/apple-touch-startup-image-640x920.png" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)"
    rel="apple-touch-startup-image">
  <!-- iPhone, retina -->
  <meta content="yes" name="apple-mobile-web-app-capable">
  <meta content="black" name="apple-mobile-web-app-status-bar-style">
  <meta content="True" name="HandheldFriendly">
  <meta content="320" name="MobileOptimized">

  <meta name="apple-itunes-app" content="app-id=1302567785">

  <script src="https://use.fontawesome.com/8d1446c26f.js"></script>

  <!-- Global site tag (gtag.js) - Google AdWords: 972849224 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-972849224"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());
    gtag('config', 'AW-972849224');
  </script>

</head>

<body ontouchstart="">
  <!-- Sidenav -->
  <div id="mySidenav" class="sidenav">
    <div class="sidenavContent">
      <div class="closebtn" onclick="closeNav();">&nbsp;&times;</div>
      <h1>The Garden Gate</h1>
      <hr />
      <div class='sidenavSectionHeader'>Play</div>
      <div class='sidenavEntry sidenavLink skipBonus' onclick='accountHeaderClicked();'>
        <i class="fa fa-user" aria-hidden="true"></i> View my games
        <span id='myGamesNumberMyTurn'></span>
      </div>
      <div class='sidenavEntry sidenavLink skipBonus' onclick='viewGameSeeksClicked();'>
        <i class="fa fa-plug" aria-hidden="true"></i> Join a game
      </div>
      <div class='sidenavEntry sidenavLink skipBonus' onclick='newGameClicked();'>
        <i class="fa fa-plus-circle" aria-hidden="true"></i> New game
      </div>
      <div class='sidenavEntry sidenavLink skipBonus' onclick='viewTournamentsClicked();'>
        <i class="fa fa-trophy" aria-hidden="true"></i> Tournaments
      </div>
      <div class='gone'>
        <hr />
        <div class='sidenavSectionHeader'>New Game</div>
        <div id="sidenavNewGameSection"></div>
      </div>
      <hr />
      <div class='sidenavSectionHeader'>Current Game</div>
      <div class='sidenavEntry sidenavLink skipBonus' onclick='toggleReplayControls();'>Toggle replay controls</div>
      <div class='sidenavEntry sidenavLink skipBonus' onclick='sandboxFromMove();'>Sandbox this game</div>
      <div class='sidenavEntry sidenavLink skipBonus' onclick='showGameReplayLink();'>Get game link</div>
      <div class='sidenavEntry sidenavLink skipBonus' onclick='showGameNotationModal();'>Show game notation</div>
      <div class='sidenavEntry sidenavLink skipBonus' onclick='quitOnlineGameClicked();'>Quit online game</div>
      <div class='sidenavEntry sidenavLink skipBonus' onclick='closeGame();'>Close this game</div>
      <hr />
      <div class='sidenavSectionHeader'>About</div>
      <div class='sidenavEntry sidenavLink skipBonus' onclick='aboutClicked();'>About
        <em>The Garden Gate</em>
      </div>
      <div class='sidenavEntry sidenavLink skipBonus' onclick='showWelcomeTutorial();'>Show welcome screens</div>
      <div class='sidenavEntry sidenavLink skipBonus' onclick='openShop();'>Buy Pai Sho sets</div>
      <div class='sidenavEntry'>
        <a href='https://www.patreon.com/SkudPaiSho' target='_blank' class='sidenavLink'>Support on Patreon</a>
      </div>
      <div class='sidenavEntry'>
        <a href='https://discord.gg/dStDZx7' target='_blank' class='sidenavLink'>Join Discord Server</a>
      </div>
      <div class='sidenavEntry'>
        <a href='https://forum.skudpaisho.com/' target='_blank' class='sidenavLink'>The Garden Gate Forum</a>
      </div>

      <hr />
      <div class='sidenavSectionHeader'>
        <div onClick='promptAddOption()'>Other</div>
      </div>
      <div class='sidenavEntry sidenavLink skipBonus' onclick='toggleSoundOn();'>Toggle Sound On/Off</div>
      <div class='sidenavEntry sidenavLink skipBonus' onclick='toggleDarkMode();'>Toggle Dark Mode</div>
      <div class='sidenavEntry sidenavLink skipBonus' onclick='location.reload(true);'>Reload website</div>

      <div>&nbsp;</div><div>&nbsp;</div><div>&nbsp;</div>
      <!--  -->
      <div id="onlinePlayTest"></div>
    </div>
  </div>
  <!-- End Sidenav -->

  <div class="header">
    <div class="sidenavMenuButton">
      <span style="cursor:pointer; vertical-align: top;" onclick="openNav();">
        <h1>
          <span class="stretchText sidenavMenuButtonText" id='sidenavMenuButton'>&#8801;</span>
        </h1>
      </span>
    </div>
    <div class="headerLeft">
      <h1>&nbsp;</h1>
    </div>
    <div class="headerLeft" style="cursor:pointer;" onclick="openNav();">
      <h1 id='siteHeading'>The Garden Gate</h1>
    </div>
    <div class="headerRightContainer">
      <span class="headerRight clickableText" onclick='accountHeaderClicked();'>
        <i class="fa fa-user" aria-hidden="true"></i>
        <span id='accountHeaderLinkText'>Sign In</span>
      </span>
      <div class="headerRight">&nbsp;|&nbsp;</div>
      <span class="headerRight clickableText" onclick='newGameClicked();'>
        <i class="fa fa-plus-circle" aria-hidden="true"></i> New</span>
      <div class="headerRight">&nbsp;|&nbsp;</div>
      <span class="headerRight clickableText" onclick='viewGameSeeksClicked();'>
        <i class="fa fa-plug" aria-hidden="true"></i> Join Game</span>
      <div class="headerRight">&nbsp;|&nbsp;</div>
      <span class="headerRight clickableText" onclick='openShop();'>
        <i class="fa fa-shopping-cart" aria-hidden="true"></i>
      </span>
    </div>
  </div>

  <div id='mainWrapper'>

    <div class="game-container-wrapper">

      <div id="game-container" class="game-container"></div>

      <!-- <div class="notation-container" id="notation-container">
        <div class="notationText gone" id="notationText">
        </div>
        <div class="notationInput gone">
          <input type="text" id="notationInput" />
          <input type="button" onclick="inputNow()" value="Enter" />
        </div>
      </div> -->

      <!-- <div id="board-container" class="board-container"> -->
      <!-- <div class='svgContainerContainer'>
          <div class="svgContainer">
            <div class="bg-svg">
              <div class="pointContainer"></div>
            </div>
          </div>
        </div> -->
      <!-- </div> -->
      <!-- <div id="tilePileContainer" class="tilePileContainer">
        <div id='response'></div>
        <div class="gameMessage"></div>
        <div id="hostTilesContainer" class="hostTilesContainer"></div>
        <div id="guestTilesContainer" class="guestTilesContainer"></div>
        <div class="gameMessage2"></div>
      </div> -->
      <div class="helpContainer" id="help">
        <div class="tab">
          <button class="tablinks" onclick="openTab(event, 'helpTextTab')" id="defaultOpenTab">Help</button>
          <button id='globalChatTabHeader' class="tablinks" onclick="openTab(event, 'globalChatTab');">Global Chat</button>
          <button id='chatTab' class="tablinks" onclick="openTab(event, 'gameChatTab'); dismissChatAlert();">Game Chat</button>
        </div>

        <div id='helpTextTab' class="tabcontent">
          <div id='helpTextContent'>
          </div>
        </div>
        <div id="globalChatTab" class="tabcontent">
          <div id="globalChatMessagesDisplay" class="chatMessagesDisplay"></div>
          <div id="globalChatMessageInputContainer" class="chatMessageInputContainer">
            <!-- <textarea id="globalChatMessageInput" class="chatMessageInput"></textarea>
            <span id="sendGlobalChatMessageButton" class="button" onclick='sendGlobalChat();'>Send</span> -->
          </div>
        </div>
        <div id="gameChatTab" class="tabcontent" onclick='dismissChatAlert();'>
          <div id="chatMessagesHeader" class="chatMessagesHeader"><em>Game Chat messages may be viewed by other players. Abide by the Discord server #rules to be allowed to use Game Chat. Thank you!</em><hr /></div>
          <div id="chatMessagesDisplay" class="chatMessagesDisplay"></div>
          <div id="chatMessageInputContainer" class="chatMessageInputContainer">
            <textarea id="chatMessageInput" class="chatMessageInput"></textarea>
            <span id="sendChatMessageButton" class="button" onclick='sendChat();'>Send</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="footer"></div>

  <div id="replayControls" class="gone">
    <div id='gameLogText' class='gameLogText'></div>
    <div class="center">
      <span class='replayButton' onclick="rewindAllMoves()">
        <i class="fa fa-fast-backward" aria-hidden="true"></i>
      </span>
      <span class='replayButton' onclick="playPrevMove()">
        <i class="fa fa-step-backward" aria-hidden="true"></i>
      </span>
      <span class='replayButton playPauseButton' onclick="playPause()">
        <i class="fa fa-play" aria-hidden="true"></i>
      </span>
      <span class='replayButton' onclick="playNextMove(true); pauseRun();">
        <i class="fa fa-step-forward" aria-hidden="true"></i>
      </span>
      <span class='replayButton' onclick="playAllMoves()">
        <i class="fa fa-fast-forward" aria-hidden="true"></i>
      </span>
    </div>
    <span class="replayControlsCloseButton" onClick='toggleReplayControls()'>&nbsp;&times;
        <!-- <i class="fa fa-times" aria-hidden="true"></i> -->
      </span>
  </div>

  <!-- Modal -->
  <!-- The Modal -->
  <div id="myMainModal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
      <span class="myMainModalClose">&nbsp;&times;
        <!-- <i class="fa fa-times" aria-hidden="true"></i> -->
      </span>
      <div id='modalHeading'>&nbsp;</div>
      <div id='modalMessage'>&nbsp;</div>
    </div>

  </div>
  <!-- End Modal -->

  <!-- Modal content containers -->
  <div id='loginModalContentContainer' style='display:none;'>
    <!-- Login modal -->
    To sign up or log in, enter your username and email, then enter the 4-digit code sent to you to sign into The
    Garden Gate.
    <div style='text-align: center;'>
      <table style='margin:auto;'>
        <tr>
          <td style='text-align:right'>Username:</td>
          <td>
            <input id='usernameInput' type='text' name='usernameInput' />
          </td>
        </tr>
        <tr>
          <td style='text-align:right'>Email:</td>
          <td>
            <input id='userEmailInput' type='email' name='userEmailInput' />
          </td>
        </tr>
      </table>
      <div>
        <button type='button' onclick='sendVerificationCodeClicked();'>Send verification code</button>
        <br />
        <div id='verificationCodeSendResponse'>&nbsp;</div>
      </div>
      <br />
      <table style='margin:auto;'>
        <tr>
          <td style='text-align:right'>Code:</td>
          <td>
            <input id='verificationCodeInput' type='text' name='verificationCodeInput' disabled />
          </td>
        </tr>
      </table>
      <div>
        <button id='verifyCodeBtn' type='button' onclick='verifyCodeClicked();'>Verify code</button>
      </div>
    </div>
  </div>
  <!--  -->

  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-85118304-1', 'auto');
    ga('send', 'pageview');
  </script>

  <!-- jquery cloud reference -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>  


  <!-- <script type="text/javascript" src="js/jquery.min.js"></script> -->
    <script src="js/0_lz-string.min.js"></script> 

  <!-- Compressed -->
  <script>

//var LZString=function(){function e(e,t){if(!n[e]){n[e]={};for(var o=0;o<e.length;o++)n[e][e.charAt(o)]=o}return n[e][t]}var t=String.fromCharCode,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",n={},a={compressToBase64:function(e){if(null==e)return"";var t=a._compress(e,6,(function(e){return o.charAt(e)}));switch(t.length%4){default:case 0:return t;case 1:return t+"===";case 2:return t+"==";case 3:return t+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:a._decompress(t.length,32,(function(i){return e(o,t.charAt(i))}))},compressToUTF16:function(e){return null==e?"":a._compress(e,15,(function(e){return t(e+32)}))+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:a._decompress(e.length,16384,(function(t){return e.charCodeAt(t)-32}))},compressToUint8Array:function(e){for(var t=a.compress(e),o=new Uint8Array(2*t.length),i=0,n=t.length;n>i;i++){var r=t.charCodeAt(i);o[2*i]=r>>>8,o[2*i+1]=r%256}return o},decompressFromUint8Array:function(e){if(null==e)return a.decompress(e);for(var o=new Array(e.length/2),i=0,n=o.length;n>i;i++)o[i]=256*e[2*i]+e[2*i+1];var r=[];return o.forEach((function(e){r.push(t(e))})),a.decompress(r.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":a._compress(e,6,(function(e){return i.charAt(e)}))},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),a._decompress(t.length,32,(function(o){return e(i,t.charAt(o))})))},compress:function(e){return a._compress(e,16,(function(e){return t(e)}))},_compress:function(e,t,o){if(null==e)return"";var i,n,a,r={},l={},s="",h="",d="",u=2,p=3,c=2,g=[],m=0,T=0;for(a=0;a<e.length;a+=1)if(s=e.charAt(a),Object.prototype.hasOwnProperty.call(r,s)||(r[s]=p++,l[s]=!0),h=d+s,Object.prototype.hasOwnProperty.call(r,h))d=h;else{if(Object.prototype.hasOwnProperty.call(l,d)){if(d.charCodeAt(0)<256){for(i=0;c>i;i++)m<<=1,T==t-1?(T=0,g.push(o(m)),m=0):T++;for(n=d.charCodeAt(0),i=0;8>i;i++)m=m<<1|1&n,T==t-1?(T=0,g.push(o(m)),m=0):T++,n>>=1}else{for(n=1,i=0;c>i;i++)m=m<<1|n,T==t-1?(T=0,g.push(o(m)),m=0):T++,n=0;for(n=d.charCodeAt(0),i=0;16>i;i++)m=m<<1|1&n,T==t-1?(T=0,g.push(o(m)),m=0):T++,n>>=1}0==--u&&(u=Math.pow(2,c),c++),delete l[d]}else for(n=r[d],i=0;c>i;i++)m=m<<1|1&n,T==t-1?(T=0,g.push(o(m)),m=0):T++,n>>=1;0==--u&&(u=Math.pow(2,c),c++),r[h]=p++,d=String(s)}if(""!==d){if(Object.prototype.hasOwnProperty.call(l,d)){if(d.charCodeAt(0)<256){for(i=0;c>i;i++)m<<=1,T==t-1?(T=0,g.push(o(m)),m=0):T++;for(n=d.charCodeAt(0),i=0;8>i;i++)m=m<<1|1&n,T==t-1?(T=0,g.push(o(m)),m=0):T++,n>>=1}else{for(n=1,i=0;c>i;i++)m=m<<1|n,T==t-1?(T=0,g.push(o(m)),m=0):T++,n=0;for(n=d.charCodeAt(0),i=0;16>i;i++)m=m<<1|1&n,T==t-1?(T=0,g.push(o(m)),m=0):T++,n>>=1}0==--u&&(u=Math.pow(2,c),c++),delete l[d]}else for(n=r[d],i=0;c>i;i++)m=m<<1|1&n,T==t-1?(T=0,g.push(o(m)),m=0):T++,n>>=1;0==--u&&(u=Math.pow(2,c),c++)}for(n=2,i=0;c>i;i++)m=m<<1|1&n,T==t-1?(T=0,g.push(o(m)),m=0):T++,n>>=1;for(;;){if(m<<=1,T==t-1){g.push(o(m));break}T++}return g.join("")},decompress:function(e){return null==e?"":""==e?null:a._decompress(e.length,32768,(function(t){return e.charCodeAt(t)}))},_decompress:function(e,o,i){var n,a,r,l,s,h,d,u=[],p=4,c=4,g=3,m="",T=[],y={val:i(0),position:o,index:1};for(n=0;3>n;n+=1)u[n]=n;for(r=0,s=Math.pow(2,2),h=1;h!=s;)l=y.val&y.position,y.position>>=1,0==y.position&&(y.position=o,y.val=i(y.index++)),r|=(l>0?1:0)*h,h<<=1;switch(r){case 0:for(r=0,s=Math.pow(2,8),h=1;h!=s;)l=y.val&y.position,y.position>>=1,0==y.position&&(y.position=o,y.val=i(y.index++)),r|=(l>0?1:0)*h,h<<=1;d=t(r);break;case 1:for(r=0,s=Math.pow(2,16),h=1;h!=s;)l=y.val&y.position,y.position>>=1,0==y.position&&(y.position=o,y.val=i(y.index++)),r|=(l>0?1:0)*h,h<<=1;d=t(r);break;case 2:return""}for(u[3]=d,a=d,T.push(d);;){if(y.index>e)return"";for(r=0,s=Math.pow(2,g),h=1;h!=s;)l=y.val&y.position,y.position>>=1,0==y.position&&(y.position=o,y.val=i(y.index++)),r|=(l>0?1:0)*h,h<<=1;switch(d=r){case 0:for(r=0,s=Math.pow(2,8),h=1;h!=s;)l=y.val&y.position,y.position>>=1,0==y.position&&(y.position=o,y.val=i(y.index++)),r|=(l>0?1:0)*h,h<<=1;u[c++]=t(r),d=c-1,p--;break;case 1:for(r=0,s=Math.pow(2,16),h=1;h!=s;)l=y.val&y.position,y.position>>=1,0==y.position&&(y.position=o,y.val=i(y.index++)),r|=(l>0?1:0)*h,h<<=1;u[c++]=t(r),d=c-1,p--;break;case 2:return T.join("")}if(0==p&&(p=Math.pow(2,g),g++),u[d])m=u[d];else{if(d!==c)return null;m=a+a.charAt(0)}T.push(m),u[c++]=a+m.charAt(0),a=m,0==--p&&(p=Math.pow(2,g),g++)}}};return a}();"function"==typeof define&&define.amd?define((function(){return LZString})):"undefined"!=typeof module&&null!=module&&(module.exports=LZString);var sin45=cos45=Math.sin(Math.PI/4);function createDivWithClass(e){var t=document.createElement("div");return t.classList.add(e),t}function createDivWithId(e){var t=document.createElement("div");return t.id=e,t}function removeChildren(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function createBoardPointDiv(e){var t=document.createElement("div");t.classList.add("point");var o=new RowAndColumn(e.row,e.col).notationPointString;return t.setAttribute("name",o),t.setAttribute("title","("+o+")"),t}function setupPaiShoBoard(e,t,o,i){var n=!1;document.querySelector(".vagabondBoardRotate")&&(n=!0),removeChildren(e);var a=createDivWithClass("pointContainer"),r=createDivWithClass("board-container"),l=createDivWithClass("svgContainer"),s=createDivWithClass("svgContainerContainer"),h=createDivWithClass("bg-svg");n&&l.classList.add("vagabondBoardRotate"),h.appendChild(a),l.appendChild(h),s.appendChild(l),r.appendChild(s);var d=createDivWithId("response"),u=createDivWithClass("gameMessage"),p=createDivWithClass("hostTilesContainer");p.id="hostTilesContainer";var c=createDivWithClass("guestTilesContainer");c.id="guestTilesContainer";var g=createDivWithClass("tilePileContainer");g.classList.add("PaiSho");var m=createDivWithClass("gameMessage2");p.innerHTML=t,c.innerHTML=o,g.appendChild(d),g.appendChild(u),g.appendChild(p),g.appendChild(c),g.appendChild(m),e.appendChild(r),e.appendChild(g);return i?setTimeout((function(){l.classList.add("vagabondBoardRotate")}),100):setTimeout((function(){l.classList.remove("vagabondBoardRotate")}),100),{boardContainer:a,hostTilesContainer:p,guestTilesContainer:c}}function getSkudTilesSrcPath(){return"images/SkudPaiSho/"+skudTilesKey+"/"}function isSamePoint(e,t,o){return e.rowAndColumn.col===t&&e.rowAndColumn.row===o}function DummyAppCaller(){}function IOSCaller(){}window.mobilecheck=function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t},window.mobileAndTabletcheck=function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t},DummyAppCaller.prototype.setCountOfGamesWhereUserTurn=function(e){},DummyAppCaller.prototype.alertAppLoaded=function(){},IOSCaller.prototype.setCountOfGamesWhereUserTurn=function(e){webkit.messageHandlers.callbackHandler.postMessage('{"countOfGamesWhereUserTurn":"'+e+'"}')},IOSCaller.prototype.alertAppLoaded=function(){webkit.messageHandlers.callbackHandler.postMessage('{"appLoaded":"true"}')};var Base64Binary={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(e){var t=e.length/4*3,o=new ArrayBuffer(t);return this.decode(e,o),o},decode:function(e,t){var o,i,n,a,r,l,s,h=this._keyStr.indexOf(e.charAt(e.length-1)),d=this._keyStr.indexOf(e.charAt(e.length-2)),u=e.length/4*3;64==h&&u--,64==d&&u--;var p=0,c=0;for(o=t?new Uint8Array(t):new Uint8Array(u),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),p=0;p<u;p+=3)i=this._keyStr.indexOf(e.charAt(c++))<<2|(r=this._keyStr.indexOf(e.charAt(c++)))>>4,n=(15&r)<<4|(l=this._keyStr.indexOf(e.charAt(c++)))>>2,a=(3&l)<<6|(s=this._keyStr.indexOf(e.charAt(c++))),o[p]=i,64!=l&&(o[p+1]=n),64!=s&&(o[p+2]=a);return o}},GUEST="GUEST",HOST="HOST",PLANTING="Planting",ARRANGING="Arranging",DEPLOY="Deploy",MOVE="Move",TEAM_SELECTION="Team Selection",INITIAL_SETUP="Initial Setup",DRAW_OFFER="~~",DRAW_REFUSE="=/=",DRAW_ACCEPT="==";function RowAndColumn(e,t){this.row=e,this.col=t;var o=t-8,i=8-e;this.notationPointString=o+","+i}function NotationPoint(e){this.pointText=e;var t=this.pointText.split(",");this.x=parseInt(t[0]),this.y=parseInt(t[1]);var o=this.x+8,i=Math.abs(this.y-8);this.rowAndColumn=new RowAndColumn(i,o)}RowAndColumn.prototype.samesies=function(e){return this.row===e.row&&this.col===e.col},RowAndColumn.prototype.getNotationPoint=function(){return new NotationPoint(this.notationPointString)},NotationPoint.prototype.samesies=function(e){return this.x===e.x&&this.y===e.y},NotationPoint.prototype.toArr=function(){return[this.x,this.y]};var newKnotweedRules=!0,simpleCanonRules=!1,newSpecialFlowerRules=!1,newGatesRule=!0,newWheelRule=!0,newOrchidClashRule=!1,newOrchidVulnerableRule=!1,newOrchidCaptureRule=!1,simpleSpecialFlowerRule=!1,specialFlowerBonusRule=!1,rocksUnwheelable=!0,lotusNoCapture=!0,simpleRocks=!1,simplest=!1,lessBonus=!1,superHarmonies=!1,completeHarmony=!1,superRocks=!1,boatOnlyMoves=!1,sameStart=!0,oneGrowingFlower=!1,limitedGatesRule=!0,specialFlowerLimitedRule=!1,skudTilesKey="standard",paiShoBoardKey="default",debugOn=!1,trifleOn=!1,ios=!1,runningOnAndroid=!1,onlinePlayEnabled=!1;function shouldRedirectIfNotHttps(){return!ios}function debug(e){if(debugOn){if(ios||"ios"===QueryString.appType)try{webkit.messageHandlers.callbackHandler.postMessage("{debugMessage:"+e+"}")}catch(e){console.log("error")}console.log(e)}}function debugStackTrace(){debugOn&&console.trace()}function masterDebug(e){console.log(e)}shouldRedirectIfNotHttps()&&window.location.href.includes("http://")&&window.location.replace(window.location.href.replace("http://","https://"));var BASIC_FLOWER="Basic Flower",ACCENT_TILE="Accent Tile",SPECIAL_FLOWER="Special Flower",ROCK="Rock",WHEEL="Wheel",KNOTWEED="Knotweed",BOAT="Boat",POND="Pond",BAMBOO="Bamboo",LION_TURTLE="Lion Turtle",WHITE_LOTUS="White Lotus",ORCHID="Orchid";function arrayIncludesAll(e,t){for(var o=0;o<t.length;o++)if(!e.includes(t[o]))return!1;return!0}function arrayIncludesOneOf(e,t){var o=!1;return t&&t.length&&t.forEach((function(t){if(e.includes(t))return o=!0,!0})),o}function copyArray(e){for(var t=[],o=0;o<e.length;o++)e[o]instanceof Array?t.push(copyArray(e[o])):e[o].getCopy?t.push(e[o].getCopy()):t.push(e[o]);return t}function shuffleArray(e){var t=0,o=0,i=null;for(t=e.length-1;t>0;t-=1)o=Math.floor(Math.random()*(t+1)),i=e[t],e[t]=e[o],e[o]=i}function removeRandomFromArray(e){if(e&&e.length){var t=Math.floor(Math.random()*e.length);return e.splice(t,1)[0]}}function peekRandomFromArray(e){if(e&&e.length)return e[Math.floor(Math.random()*e.length)]}String.prototype.includes||(String.prototype.includes=function(e,t){"use strict";return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&-1!==this.indexOf(e,t)}),Array.prototype.includes||(Array.prototype.includes=function(e){"use strict";if(null==this)throw new TypeError("Array.prototype.includes called on null or undefined");var t=Object(this),o=parseInt(t.length,10)||0;if(0===o)return!1;var i,n,a=parseInt(arguments[1],10)||0;for(a>=0?i=a:(i=o+a)<0&&(i=0);i<o;){if(e===(n=t[i])||e!=e&&n!=n)return!0;i++}return!1}),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.substr(t,e.length)===e}),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var o=this.toString();("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>o.length)&&(t=o.length),t-=e.length;var i=o.lastIndexOf(e,t);return-1!==i&&i===t}),Array.prototype.equals&&console.warn("Overriding existing Array.prototype.equals. Possible causes: New API defines the method, there's a framework conflict or you've got double inclusions in your code."),Array.prototype.equals=function(e){if(!e)return!1;if(this.length!=e.length)return!1;for(var t=0,o=this.length;t<o;t++)if(this[t]instanceof Array&&e[t]instanceof Array){if(!this[t].equals(e[t]))return!1}else if(this[t]!=e[t])return!1;return!0},Object.defineProperty(Array.prototype,"equals",{enumerable:!1});var OPTION_DOUBLE_TILES="Double Tiles",OPTION_INSANE_TILES="Insane Tiles",OPTION_ALL_ACCENT_TILES="All Accent Tiles",OPTION_DOUBLE_ACCENT_TILES="Double (8) Accent Tiles",OPTION_ANCIENT_OASIS_EXPANSION="Ancient Oasis Expansion",OPTION_INFORMAL_START="Informal Start",NO_HARMONY_VISUAL_AIDS="No Harmony Visual Aids",OPTION_FULL_TILES="Full tile set",CLASSIC_RULES="Classic Rules",FULL_POINTS_SCORING="Full points scoring",FOUR_SIDED_BOARD="Board size: 4 per side",SHORTER_GAME="Shorter game",SIX_SIDED_BOARD="Board size: 6 per side",EIGHT_SIDED_BOARD="Board size: 8 per side",FIVE_SIDED_BOARD="Board size: 5 per side",OPTION_ATTACKERS_MOVE_FIRST="Host plays as attackers",KING_MOVES_LIKE_PAWNS="King moves like pawns",MORE_ATTACKERS="More Attackers!",FORMAL_WIN_CONDITION="Formal win condition",ORIGINAL_BOARD_SETUP="Original Board Setup",RELEASE_CAPTIVE_TILES="Release Captive Tiles",BONUS_MOVEMENT_5="Bonus Movement With Captive (5)",BONUS_MOVEMENT_BASED_ON_NUM_CAPTIVES="Bonus Movement (+1) Per Captive";function gameOptionEnabled(e){return ggOptions.includes(e)}function LocalStorage(){this.localEmailKey="localUserEmail";var e=this.localStorageSupported();this.storage=e?window.localStorage:window.fakeStorage,debug(this.getUserEmail())}function LocalSoundStorageManager(){this.soundOffKey="soundOff",this.storage=window.localStorage}function OnlinePlayEngine(){}window.fakeStorage={_data:{},setItem:function(e,t){return this._data[e]=String(t)},getItem:function(e){return this._data.hasOwnProperty(e)?this._data[e]:void 0},removeItem:function(e){return delete this._data[e]},clear:function(){return this._data={}}},LocalStorage.prototype.localStorageSupported=function(){var e=window.localStorage;try{return e.setItem("testPaiSho","1"),e.removeItem("testPaiSho"),!0}catch(e){return!1}},LocalStorage.prototype.getUserEmail=function(){return this.storage.getItem(this.localEmailKey)},LocalStorage.prototype.setUserEmail=function(e){this.storage.setItem(this.localEmailKey,e)},LocalSoundStorageManager.prototype.clearGameState=function(){this.storage.removeItem(this.gameStateKey)},LocalSoundStorageManager.prototype.setSoundFile=function(e,t){try{this.storage.setItem(this.getSoundFileKey(e),t)}catch(e){}},LocalSoundStorageManager.prototype.getSoundFile=function(e){return this.storage.getItem(this.getSoundFileKey(e))},LocalSoundStorageManager.prototype.getSoundFileKey=function(e){return this.fileValueKey+e},LocalSoundStorageManager.prototype.setSoundOff=function(){this.storage.setItem(this.soundOffKey,"true")},LocalSoundStorageManager.prototype.setSoundOn=function(){this.storage.setItem(this.soundOffKey,"false")},LocalSoundStorageManager.prototype.getSoundOff=function(){return"true"===this.storage.getItem(this.soundOffKey)},OnlinePlayEngine.prototype.testOnlinePlay=function(){this.getGameTypeDesc(1,emptyCallback)},OnlinePlayEngine.callCallback=function(e,t,o){"success"===t?o(e.trim()):callFailed()},OnlinePlayEngine.prototype.isUserInfoAvailable=function(e,t,o){$.get("isUserInfoAvailable.php?u="+e+"&e="+t,(function(e,t){"success"===t&&o(e.trim())}))},OnlinePlayEngine.prototype.userInfoExists=function(e,t,o){$.get("userInfoExists.php?u="+e+"&e="+t,(function(e,t){"success"===t&&o(e.trim())}))},OnlinePlayEngine.prototype.verifyLogin=function(e,t,o,i,n){$.post("verifyLogin.php",{userId:e,username:t,userEmail:o,deviceId:i},(function(e,t){"success"===t&&n(e.trim())}))},OnlinePlayEngine.prototype.sendVerificationCode=function(e,t,o){$.post("sendVerificationCode.php",{username:e,toEmail:t,isWeb:1},(function(e,t){o(e.trim())}))},OnlinePlayEngine.prototype.getVerificationCode=function(e){$.get("getVerificationCode.php",(function(t,o){"success"===o&&e(t.trim())}))},OnlinePlayEngine.prototype.createUser=function(e,t,o){$.post("createUser.php",{u:e,e:t},(function(e,t){"success"===t&&o(e.trim())}))},OnlinePlayEngine.prototype.createDeviceIdForUser=function(e,t){$.post("createDeviceIdForUser.php",{u:e},(function(e,o){"success"===o&&t(e.trim())}))},OnlinePlayEngine.prototype.logOnlineStatus=function(e,t){$.post("logOnlineStatus.php",{userId:e.userId,username:e.username,userEmail:e.userEmail,deviceId:e.deviceId},(function(e,o){"success"===o&&t(e.trim())}))},OnlinePlayEngine.prototype.createGame=function(e,t,o,i,n,a){$.post("createGame.php",{t:e,q:t,userId:n.userId,username:n.username,userEmail:n.userEmail,deviceId:n.deviceId,options:o,isPrivateIndicator:i,isWeb:1},(function(e,t){"success"===t&&a(e.trim())}))},OnlinePlayEngine.prototype.joinGameSeek=function(e,t,o){$.post("joinGameSeek.php",{gameId:e,userId:t.userId,username:t.username,userEmail:t.userEmail,deviceId:t.deviceId,isWeb:1},(function(e,t){"success"===t&&o(e.trim())}))},OnlinePlayEngine.prototype.getGameSeeks=function(e){$.get("getGameSeeks.php",(function(t,o){"success"===o?e(t.trim()):callFailed()}))},OnlinePlayEngine.prototype.getCurrentGameSeeksHostedByUser=function(e,t,o){$.get("getCurrentGameSeeksHostedByUser.php?userId="+e+"&gameTypeId="+t,(function(e,t){"success"===t&&o(e.trim())}))},OnlinePlayEngine.prototype.getCurrentGamesForUserNew=function(e,t){$.post("getCurrentGamesForUserNew.php",{userId:e.userId,username:e.username,userEmail:e.userEmail,deviceId:e.deviceId},(function(e,o){"success"===o?t(e.trim()):callFailed()}))},OnlinePlayEngine.prototype.getPastGamesForUserNew=function(e,t){$.post("getPastGamesForUserNew.php",{userId:e.userId,username:e.username,userEmail:e.userEmail,deviceId:e.deviceId},(function(e,o){"success"===o&&t(e.trim())}))},OnlinePlayEngine.prototype.getPreviouslyActiveGameId=function(e,t,o,i){$.post("getPreviouslyActiveGameId.php",{userId:e.userId,username:e.username,userEmail:e.userEmail,deviceId:e.deviceId,gameId:t,opponentUsername:o},(function(e,t){"success"===t&&i(e.trim())}))},OnlinePlayEngine.prototype.getGameInfo=function(e,t,o){$.get("getGameInfo.php?userId="+e+"&gameId="+t+"&isWeb=1",(function(e,t){"success"===t&&o(e.trim())}))},OnlinePlayEngine.prototype.getCountOfGamesWhereUserTurn=function(e,t){$.get("getCountOfGamesWhereUserTurn.php?userId="+e,(function(e,o){"success"===o&&t(e.trim())}))},OnlinePlayEngine.prototype.getGameNotation=function(e,t){$.get("getGameNotation.php?q="+e,(function(e,o){"success"===o&&t(e.trim())}))},OnlinePlayEngine.prototype.checkIfUserOnline=function(e,t){$.get("checkIfUserOnline.php?u="+e,(function(e,o){"success"===o&&t(e.trim())}))},OnlinePlayEngine.prototype.submitMove=function(e,t,o,i,n){$.post("updateGameNotation.php",{id:e,t:t,userId:o.userId,username:o.username,userEmail:o.userEmail,deviceId:o.deviceId,gameTypeName:i},(function(e,t){"success"===t&&n(e.trim())}))},OnlinePlayEngine.prototype.updateGameWinInfo=function(e,t,o,i,n){$.post("updateGameWinInfo.php",{gameId:e,winnerUsername:t,resultTypeCode:o,userId:i.userId,username:i.username,userEmail:i.userEmail,deviceId:i.deviceId},(function(e,t){"success"===t&&n(e.trim())}))},OnlinePlayEngine.prototype.updateGameWinInfoAsTie=function(e,t,o,i){$.post("updateGameWinInfoAsTie.php",{gameId:e,resultTypeCode:t,userId:o.userId,username:o.username,userEmail:o.userEmail,deviceId:o.deviceId},(function(e,t){"success"===t&&i(e.trim())}))},OnlinePlayEngine.prototype.getGameTypeDesc=function(e,t){$.get("getGameTypeDesc.php?q="+e,(function(e,o){"success"===o&&(debug(e.trim()),t(e.trim()))}))},OnlinePlayEngine.prototype.sendChat=function(e,t,o,i){$.post("sendChatMessage.php",{gameId:e,userId:t.userId,username:t.username,userEmail:t.userEmail,deviceId:t.deviceId,chatMessage:o},(function(e,t){"success"===t&&i(e.trim())}))},OnlinePlayEngine.prototype.getNewChatMessages=function(e,t,o){$.get("getNewChatMessages.php?g="+e+"&t="+encodeURIComponent(t),(function(e,t){"success"===t&&o(e.trim())}))},OnlinePlayEngine.prototype.getInitialGlobalChatMessages=function(e){$.get("getInitialGlobalChatMessages.php?",(function(t,o){"success"===o&&e(t.trim())}))},OnlinePlayEngine.prototype.notifyUser=function(e,t,o){$.post("notifyUser.php",{userId:e.userId,username:e.username,userEmail:e.userEmail,deviceId:e.deviceId,userToNotify:t},(function(e,t){"success"===t&&(debug(e.trim()),o(e.trim()))}))},OnlinePlayEngine.prototype.getEmailNotificationsSetting=function(e,t){$.get("getEmailNotificationsSetting.php?userId="+e,(function(e,o){"success"===o&&t(e.trim())}))},OnlinePlayEngine.prototype.updateEmailNotificationsSetting=function(e,t,o){$.post("updateEmailNotificationsSetting.php",{userId:e,value:t},(function(e,t){"success"===t&&(debug(e.trim()),o(e.trim()))}))},OnlinePlayEngine.prototype.addUserPreferenceValue=function(e,t,o,i){$.post("addUserPreferenceValue.php",{userId:e.userId,username:e.username,userEmail:e.userEmail,deviceId:e.deviceId,prefTypeId:t,value:o},(function(e,t){"success"===t&&(debug(e.trim()),i(e.trim()))}))},OnlinePlayEngine.prototype.getCurrentTournaments=function(e,t){$.get("getCurrentTournaments.php?u="+e.userId,(function(e,o){OnlinePlayEngine.callCallback(e,o,t)}))},OnlinePlayEngine.prototype.getTournamentInfo=function(e,t){$.get("getTournamentInfo.php?t="+e,(function(e,o){OnlinePlayEngine.callCallback(e,o,t)}))},OnlinePlayEngine.prototype.getManageTournamentsInfo=function(e,t){$.post("getManageTournamentsInfo.php",{userId:e.userId,username:e.username,userEmail:e.userEmail,deviceId:e.deviceId},(function(e,o){OnlinePlayEngine.callCallback(e,o,t)}))},OnlinePlayEngine.prototype.getManageTournamentInfo=function(e,t,o){$.post("getManageTournamentInfo.php",{userId:e.userId,username:e.username,userEmail:e.userEmail,deviceId:e.deviceId,tournamentId:t},(function(e,t){OnlinePlayEngine.callCallback(e,t,o)}))},OnlinePlayEngine.prototype.submitTournamentSignup=function(e,t,o){$.post("submitTournamentSignup.php",{userId:e.userId,username:e.username,userEmail:e.userEmail,deviceId:e.deviceId,tournamentId:t},(function(e,t){OnlinePlayEngine.callCallback(e,t,o)}))},OnlinePlayEngine.prototype.createTournament=function(e,t,o,i,n){$.post("createTournament.php",{userId:e.userId,username:e.username,userEmail:e.userEmail,deviceId:e.deviceId,name:t,forumUrl:o,details:i},(function(e,t){OnlinePlayEngine.callCallback(e,t,n)}))},OnlinePlayEngine.prototype.createNewRound=function(e,t,o,i,n){$.post("createNewRound.php",{userId:e.userId,username:e.username,userEmail:e.userEmail,deviceId:e.deviceId,tournamentId:t,roundName:o,roundDetails:i},(function(e,t){OnlinePlayEngine.callCallback(e,t,n)}))},OnlinePlayEngine.prototype.changeTournamentPlayerStatus=function(e,t,o,i,n){$.post("tournamentManagementFunctions.php",{function:"changeTournamentPlayerStatus",userId:e.userId,username:e.username,userEmail:e.userEmail,deviceId:e.deviceId,tournamentId:t,usernameToChange:o,newTournamentPlayerStatusId:i},(function(e,t){OnlinePlayEngine.callCallback(e,t,n)}))},OnlinePlayEngine.prototype.changeTournamentStatus=function(e,t,o,i){$.post("tournamentManagementFunctions.php",{function:"changeTournamentStatus",userId:e.userId,username:e.username,userEmail:e.userEmail,deviceId:e.deviceId,tournamentId:t,newTournamentStatusId:o},(function(e,t){OnlinePlayEngine.callCallback(e,t,i)}))},OnlinePlayEngine.prototype.createTournamentRoundMatch=function(e,t,o,i,n,a,r){$.post("createTournamentRoundMatch.php",{userId:e.userId,username:e.username,userEmail:e.userEmail,deviceId:e.deviceId,roundId:t,gameTypeId:o,hostUsername:i,guestUsername:n,options:a},(function(e,t){OnlinePlayEngine.callCallback(e,t,r)}))};var gameController,QueryString=function(){var e={},t=window.location.search.substring(1);t.length>0&&!t.includes("appType=")&&(t=LZString.decompressFromEncodedURIComponent(t));var o=t.split("&");t.includes("&amp;")&&(o=t.split("&amp;"));for(var i=0;i<o.length;i++){var n=o[i].split(/=(.+)/);if(void 0===e[n[0]])e[n[0]]=decodeURIComponent(n[1]);else if("string"==typeof e[n[0]]){var a=[e[n[0]],decodeURIComponent(n[1])];e[n[0]]=a}else e[n[0]].push(decodeURIComponent(n[1]))}return e}(),localEmailKey="localUserEmail",tileDesignTypeKey="tileDesignTypeKey",tileDesignTypeValues={hlowenew:"Modern Tiles",hlowemono:"Modern Monochrome Tiles",vescucci:"Vescucci Tiles",standard:"Pai Sho Project Tiles",pixelsho:"Pixel Sho v1 Tiles",pixelsho2:"Pixel Sho v2 Tiles",xiangqi:"Xiangqi Style",water:"Water themed Vescucci Tiles",vescuccicolored:"Vescucci Colored",vescuccicolored2:"Vescucci Colored 2",earth:"Earth themed Vescucci Tiles"},paiShoBoardDesignTypeKey="paiShoBoardDesignTypeKey",paiShoBoardDesignTypeValues={default:"Default",mayfair:"Mayfair Filter",skudShop:"The Garden Gate Shop",vescucci:"Vescucci Style",xiangqi:"Xiangqi-Style Tile Colors",pixelsho:"Pixel-Sho",remix:"Remix",water:"Water by Monk_Gyatso",earth:"Earth by BoomerangGuy",fire:"Fire by BoomerangGuy",air:"Air by Monk_Gyatso",nick:"Nick style by BoomerangGuy",nickoffset:"Nick offset-lines",owl:"Order of the White Lotus by Geebung",metal:"Metal Bender style by ohreaganoe",whitethread:"White Thread by tree",avatarstate:"Avatar State by el craken",blowtorch:"Blowtorch by ProfPetruescu",checkeredtraining:"Checkered Training Board by Aba"},paiShoBoardDesignDropdownId="PaiShoBoardDesignSelect";function buildDropdownDiv(e,t,o,i,n){var a=document.createElement("div"),r=document.createElement("select");r.id=e;var l=document.createElement("label");return l.for=e,l.innerText=t,Object.keys(o).forEach((function(e,t){var n=document.createElement("option");n.value=e,n.innerText=o[e],e===i&&(n.selected=!0),r.appendChild(n)})),r.onchange=n,a.appendChild(l),a.appendChild(r),a}function buildPaiShoBoardDesignDropdownDiv(){return buildDropdownDiv(paiShoBoardDesignDropdownId,"Pai Sho Board Design:",paiShoBoardDesignTypeValues,localStorage.getItem(paiShoBoardDesignTypeKey),(function(){setPaiShoBoardOption(this.value)}))}function buildPaiShoSettingsDiv(){var e=document.createElement("div"),t=document.createElement("h4");return t.innerText="Pai Sho Game Preferences:",e.appendChild(t),e.appendChild(buildPaiShoBoardDesignDropdownDiv()),e.appendChild(document.createElement("br")),e}var url,defaultHelpMessageText,defaultEmailMessageText,localStorage,hostEmail,guestEmail,activeAi,activeAi2,sandboxUrl,appCaller,gameWatchIntervalValue,currentGameOpponentUsername,tempUserId,logOnlineStatusIntervalValue,userTurnCountInterval,soundManager,vagabondTileDesignTypeKey="vagabondTileDesignTypeKey",usernameKey="usernameKey",userEmailKey="userEmailKey",userIdKey="userIdKey",deviceIdKey="deviceIdKey",deviceTokenKey="deviceTokenKey",welcomeTutorialDismissedKey="welcomeTutorialDismissedKey",BRAND_NEW="Brand New",MOVE_DONE="Move Done",WAITING_FOR_ENDPOINT="Waiting for endpoint",READY_FOR_BONUS="READY_FOR_BONUS",WAITING_FOR_BONUS_ENDPOINT="WAITING_FOR_BONUS_ENDPOINT",WAITING_FOR_BOAT_BONUS_POINT="WAITING_FOR_BOAT_BONUS_POINT",HOST_SELECT_ACCENTS="HOST_SELECT_ACCENTS",localPlayerRole=HOST,metadata=new Object,replayIntervalLength=2100,pieceAnimationLength=1e3,piecePlaceAnimation=1,onlinePlayEngine=new OnlinePlayEngine,gameId=-1,lastKnownGameNotation="",currentGameData=new Object,currentMoveIndex=0,isInReplay=!1,interval=0,emailBeingVerified="",usernameBeingVerified="",codeToVerify=0,myGamesList=[],gameSeekList=[],userOnlineIcon="<span title='Online' style='color:#35ac19;'><i class='fa fa-user-circle-o' aria-hidden='true'></i></span>",userOfflineIcon="<span title='Offline' style='color:gray;'><i class='fa fa-user-circle-o' aria-hidden='true'></i></span>",gameContainerDiv=document.getElementById("game-container");function usernameIsOneOf(e){if(e&&e.length)for(var t=0;t<e.length;t++)if(getUsername()===e[t])return!0;return!1}function showReplayControls(){window.navigator.onLine&&document.getElementById("replayControls").classList.remove("gone")}function toggleReplayControls(){var e=document.getElementById("replayControls");e.classList.contains("gone")?e.classList.remove("gone"):e.classList.add("gone")}function setTileContainers(){document.getElementById("hostTilesContainer").innerHTML=gameController.getHostTilesContainerDivs(),document.getElementById("guestTilesContainer").innerHTML=gameController.getGuestTilesContainerDivs()}window.requestAnimationFrame((function(){if(onlinePlayEnabled=!0,localStorage=(new LocalStorage).storage,soundManager=new SoundManager,!localStorage.getItem("data-theme")){var e="dark";localStorage.getItem("darkMode")&&(e="true"===localStorage.getItem("darkMode")?"dark":"light",localStorage.removeItem("darkMode")),localStorage.setItem("data-theme",e)}if(applyDataTheme(),defaultEmailMessageText=document.querySelector(".footer").innerHTML,QueryString.gameType){if(clearOptions(),QueryString.gameOptions)for(var t=parseGameOptions(QueryString.gameOptions),o=0;o<t.length;o++)addOption(t[o]);setGameController(parseInt(QueryString.gameType),!0),gameController.setGameNotation(QueryString.game),gameController.gameNotation.moves.length>1&&showReplayControls()}else closeGame();localStorage.getItem(tileDesignTypeKey)?localStorage.getItem(tileDesignTypeKey)===tileDesignTypeValues.hlowe?setSkudTilesOption("hlowenew"):setSkudTilesOption(localStorage.getItem(tileDesignTypeKey)):setSkudTilesOption("hlowenew"),localStorage.getItem(paiShoBoardDesignTypeKey)?setPaiShoBoardOption(localStorage.getItem(paiShoBoardDesignTypeKey)):setPaiShoBoardOption("mayfair"),url=window.location.href.split("?")[0],sandboxUrl=url,url.includes("calebhugo.com")&&(url="https://skudpaisho.com/"),!url.startsWith("file")||ios||runningOnAndroid||(onlinePlayEnabled=!1),(ios||runningOnAndroid||"ios"===QueryString.appType||"android"===QueryString.appType)&&(sandboxUrl=url="https://skudpaisho.com/"),hostEmail=QueryString.host,guestEmail=QueryString.guest,appCaller=new DummyAppCaller,"ios"===QueryString.appType&&(appCaller=new IOSCaller);var i=localStorage.getItem(localEmailKey);userIsLoggedIn()||(i=null,localStorage.removeItem(localEmailKey)),hostEmail&&hostEmail!=i&&guestEmail&&guestEmail!=i?localPlayerRole=null:(localPlayerRole=getCurrentPlayer(),i?localPlayerRole===HOST?hostEmail=i:localPlayerRole===GUEST&&(guestEmail=i):localPlayerRole===HOST?hostEmail=null:localPlayerRole===GUEST&&(guestEmail=null)),updateFooter(),clearMessage(),rerunAll(),setAccountHeaderLinkText(),setSidenavNewGameSection(),onlinePlayEnabled&&(onlinePlayEngine.testOnlinePlay(emptyCallback),gameId>0&&startWatchingGameRealTime()),resetGlobalChats(),initialVerifyLogin(),document.getElementById("defaultOpenTab").click(),debugOn||QueryString.game||"true"===localStorage.getItem(welcomeTutorialDismissedKey)&&userIsLoggedIn()||showWelcomeTutorial(),QueryString.watchGame&&jumpToGame(QueryString.watchGame),QueryString.joinPrivateGame&&(jumpToGame(QueryString.joinPrivateGame),askToJoinPrivateGame(QueryString.joinPrivateGame,QueryString.hostUserName))}));var initialVerifyLoginCallback=function(e){"Results exist"===e?(startLoggingOnlineStatus(),startWatchingNumberOfGamesWhereUserTurn(),appCaller.alertAppLoaded()):(getUsername()&&showModal("Signed Out","Sorry you were unexpectedly signed out :( <br /><br />Please sign in again to keep playing."),forgetCurrentGameInfo(),forgetOnlinePlayInfo())};function initialVerifyLogin(){onlinePlayEnabled&&onlinePlayEngine.verifyLogin(getUserId(),getUsername(),getUserEmail(),getDeviceId(),initialVerifyLoginCallback)}var verifyLoginCallback=function(e){"Results exist"===e||(getUsername()&&showModal("Signed Out","Sorry you were unexpectedly signed out :( <br /><br />Please sign in again to keep playing."),forgetCurrentGameInfo(),forgetOnlinePlayInfo())};function verifyLogin(){onlinePlayEnabled&&onlinePlayEngine.verifyLogin(getUserId(),getUsername(),getUserEmail(),getDeviceId(),verifyLoginCallback)}var previousCountOfGamesWhereUserTurn=0;function setAccountHeaderLinkText(e){var t="Sign In",o="";userIsLoggedIn()&&onlinePlayEnabled&&(t="My Games",document.title="The Garden Gate",parseInt(e)&&(t+=o=" ("+e+")",document.title="("+e+") The Garden Gate")),document.getElementById("accountHeaderLinkText").innerText=t,document.getElementById("myGamesNumberMyTurn").innerText=o,e>previousCountOfGamesWhereUserTurn&&notifyThisMessage("The Garden Gate: It's your turn!"),previousCountOfGamesWhereUserTurn=e}var getGameNotationCallback=function(e){gameWatchIntervalValue&&e!==lastKnownGameNotation&&(gameController.setGameNotation(decodeURIComponent(e)),rerunAll(!0),lastKnownGameNotation=e,showReplayControls())};function usernameEquals(e){return getUsername()&&e.toLowerCase()===getUsername().toLowerCase()}function setResponseText(e){var t=document.getElementById("response");t&&(t.innerHTML=e)}function updateCurrentGameTitle(e){if(currentGameData.guestUsername&&currentGameData.hostUsername){var t=userOfflineIcon;e&&(t=userOnlineIcon);var o=getCurrentPlayer(),i="";i=o!==HOST||gameController.theGame.getWinner()?"<span>":"<span class='currentPlayerUsername'>",usernameEquals(currentGameData.guestUsername)&&(i+=t),i+=currentGameData.hostUsername,i+="</span>";var n="";n=o!==GUEST||gameController.theGame.getWinner()?"<span>":"<span class='currentPlayerUsername'>",usernameEquals(currentGameData.hostUsername)&&(n+=t),n+=currentGameData.guestUsername;var a="<span>";a+=i,a+=" vs. ",a+=n+="</span>",setResponseText(a+="</span>")}else setResponseText(" ")}var lastChatTimestamp="1970-01-01 00:00:00",checkIfUserOnlineCallback=function(e){updateCurrentGameTitle(e)},getNewChatMessagesCallback=function(e){if(""!=e){var t=e.split("\n");chatMessageList=[];var o="";for(var i in t){var n=t[i].split("|||"),a={timestamp:n[0],username:n[1],message:n[2]};chatMessageList.push(a),lastChatTimestamp=a.timestamp}var r=!1;for(var i in chatMessageList){o+="<div class='chatMessage'><em>"+getTimestampString((a=chatMessageList[i]).timestamp)+"</em> <strong>"+a.username+":</strong> "+a.message.replace(/&amp;/g,"&")+"</div>",r=!usernameEquals(a.username)}r&&document.getElementById("chatTab").classList.add("alertTab");var l=document.getElementById("chatMessagesDisplay"),s=l.scrollHeight-l.clientHeight<=l.scrollTop+1,h=document.createElement("div");h.innerHTML=o,l.appendChild(h),s&&(l.scrollTop=l.scrollHeight-l.clientHeight)}};function getTimestampString(e){var t=new Date(e),o=t.toString();return o=o.substring(0,o.indexOf("GMT"))+"GMT-0400 (Eastern Daylight Time)",(t=new Date(o)).toLocaleString()}function gameWatchPulse(){onlinePlayEngine.getGameNotation(gameId,getGameNotationCallback),onlinePlayEngine.checkIfUserOnline(currentGameOpponentUsername,checkIfUserOnlineCallback),onlinePlayEngine.getNewChatMessages(gameId,lastChatTimestamp,getNewChatMessagesCallback)}function clearGameWatchInterval(){gameWatchIntervalValue&&(clearInterval(gameWatchIntervalValue),gameWatchIntervalValue=null,debug("Interval cleared..."))}var REAL_TIME_GAME_WATCH_INTERVAL=3e3;function startWatchingGameRealTime(){debug("Starting to watch game"),document.getElementById("chatMessagesDisplay").innerHTML="",lastChatTimestamp="1970-01-01 00:00:00",gameWatchPulse(),clearGameWatchInterval(),gameWatchIntervalValue=setInterval((function(){gameWatchPulse()}),REAL_TIME_GAME_WATCH_INTERVAL)}function setPaiShoBoardOption(e){var t=paiShoBoardKey+"Board";gameContainerDiv.classList.remove(t),localStorage.setItem(paiShoBoardDesignTypeKey,e);var o=(paiShoBoardKey=e)+"Board";gameContainerDiv.classList.add(o),clearMessage()}function setSkudTilesOption(e){gameContainerDiv.classList.remove(skudTilesKey),localStorage.setItem(tileDesignTypeKey,e),skudTilesKey=e,gameContainerDiv.classList.add(skudTilesKey),gameController.callActuate(),clearMessage()}function getSelectedTileDesignTypeDisplayName(){return tileDesignTypeValues[localStorage.getItem(tileDesignTypeKey)]}function getSelectedBoardDesignTypeDisplayName(){return paiShoBoardDesignTypeValues[localStorage.getItem(paiShoBoardDesignTypeKey)]}function promptEmail(){loginClicked()}function updateFooter(){}function gamePlayersMessage(){if(!hostEmail&&!guestEmail)return"";var e="";return hostEmail&&(e+="HOST: "+hostEmail+"<br />"),guestEmail&&(e+="GUEST: "+guestEmail+"<br />"),e+="<br />"}function showSignOutModal(){showModal("Really sign out?","<br /><div class='clickableText' onclick='signOut(true);'>Yes, sign out</div><br /><div class='clickableText' onclick='signOut(false);'>Cancel</div>")}function signOut(e){closeModal(),e?((hostEmail=getUserEmail())&&(hostEmail=null),(guestUsername=getUserEmail())&&(guestEmail=null),document.title="The Garden Gate",localStorage.removeItem(localEmailKey),forgetOnlinePlayInfo(),updateFooter(),clearMessage(),setAccountHeaderLinkText()):updateFooter()}function rewindAllMoves(){pauseRun(),gameController.resetGameManager(),gameController.resetNotationBuilder(),currentMoveIndex=0,refreshMessage()}function playNextMove(e,t){return currentMoveIndex>=gameController.gameNotation.moves.length?(isInReplay=!1,refreshMessage(),!1):(isInReplay=!0,e&&soundManager.nextMoveSoundsAreEnabled()&&soundManager.playSound(SoundManager.sounds.tileLand),gameController.theGame.runNotationMove(gameController.gameNotation.moves[currentMoveIndex],e,t),++currentMoveIndex>=gameController.gameNotation.moves.length&&(isInReplay=!1),e&&refreshMessage(),!0)}function playPrevMove(){isInReplay=!0,pauseRun();var e=currentMoveIndex-1;for(gameController.resetGameManager(),gameController.resetNotationBuilder(),currentMoveIndex=0;currentMoveIndex<e;)playNextMove();soundManager.prevMoveSoundsAreEnabled()&&soundManager.playSound(SoundManager.sounds.tileLand),refreshMessage()}function playAllMoves(e){for(pauseRun(),currentMoveIndex>=gameController.gameNotation.moves.length-1&&playPrevMove();currentMoveIndex<gameController.gameNotation.moves.length-1;)playNextMove(!1);playNextMove(!0,e)}function playPause(){0!==gameController.gameNotation.moves.length&&(0===interval?(document.querySelector(".playPauseButton").innerHTML="<i class='fa fa-pause' aria-hidden='true'></i>",playNextMove(!0)?interval=setInterval((function(){playNextMove(!0)||pauseRun()}),replayIntervalLength):(rewindAllMoves(),playPause())):pauseRun())}function pauseRun(){clearInterval(interval),interval=0,document.querySelector(".playPauseButton").innerHTML="<i class='fa fa-play' aria-hidden='true'></i>"}function getAdditionalMessage(){var e="";return myTurn()&&!userIsLoggedIn()&&(e=" (You) "+e),e+=gameController.getAdditionalMessage(),gameController.theGame.getWinner()?e+=" <strong>"+gameController.theGame.getWinner()+gameController.theGame.getWinReason()+"</strong>":gameController.gameHasEndedInDraw&&gameController.gameHasEndedInDraw()&&(e+="Game has ended in a draw."),"<br />"===e&&(e=""),e}function getGameMessageElement(){var e=document.querySelector(".gameMessage"),t=document.querySelector(".gameMessage2");return gameController.showGameMessageUnderneath?(e.innerHTML="",t):(t&&(t.innerHTML=""),e)}function refreshMessage(){var e="";playingOnlineGame()||(e+="Current Player: "+getCurrentPlayer()+"<br />"),e+=getAdditionalMessage(),getGameMessageElement().innerHTML=e,(playingOnlineGame()&&iAmPlayerInCurrentOnlineGame()&&!myTurn()||gameController.isSolitaire())&&showResetMoveMessage()}function rerunAll(e,t){gameController.resetGameManager(),gameController.resetNotationBuilder(),currentMoveIndex=0,playAllMoves(t),e&&soundManager.rerunAllSoundsAreEnabled()&&soundManager.playSound(SoundManager.sounds.tileLand),refreshMessage()}forgetOnlinePlayInfo=function(){localStorage.removeItem(deviceIdKey),localStorage.removeItem(userIdKey),localStorage.removeItem(usernameKey),localStorage.removeItem(userEmailKey),clearLogOnlineStatusInterval()};var finalizeMove=function(e,t){if(rerunAll(!0,e),playingOnlineGame())linkShortenCallback("",t);else{var o="";hostEmail&&(o+="host="+hostEmail+"&"),guestEmail&&(o+="guest="+guestEmail+"&"),o+="game="+gameController.gameNotation.notationTextForUrl(),ggOptions.length>0&&(o+="&gameOptions="+JSON.stringify(ggOptions)),o=LZString.compressToEncodedURIComponent(o),linkShortenCallback(o=url+"?"+o,t)}};function showSubmitMoveForm(e){}function getNoUserEmailMessage(){return"<span class='skipBonus' onclick='loginClicked(); finalizeMove();'>Sign in</span> to play games with others online. <br />"}function playingOnlineGame(){return onlinePlayEnabled&&gameId>0}function linkShortenCallback(e,t){debug(e);var o=gameController.getAiList(),i="";if(1!=currentMoveIndex||haveBothEmails())haveBothEmails()?(metadata.tournamentName||playingOnlineGame()||(i+='Or, copy and share this <a href="'+e+'">link</a> with your opponent.'),playingOnlineGame()||showSubmitMoveForm(e)):activeAi&&getCurrentPlayer()===activeAi.player||activeAi2&&getCurrentPlayer()===activeAi2.player?i+="<em>THINKING...</em>":activeAi&&activeAi.getMessage&&(i+=activeAi.getMessage());else if(playingOnlineGame()||1!==currentGameData.gameTypeId&&currentGameData.gameTypeId||t||userIsLoggedIn()||(i=getNoUserEmailMessage()+"<br />"),o.length>0){for(var n=0;n<o.length;n++)i+="<span class='skipBonus' onclick='setAiIndex("+n+");'>Play "+o[n].getName()+"</span>";o.length>1&&(i+="<span class='skipBonus' onclick='goai();'>AI vs AI</span>"),i+="<br />"}if(gameController.theGame.getWinner()){var a;if(i+="<br /><strong>"+gameController.theGame.getWinner()+gameController.theGame.getWinReason()+"</strong>",playingOnlineGame())gameController.theGame.getWinner()===HOST?a=currentGameData.hostUsername:gameController.theGame.getWinner()===GUEST&&(a=currentGameData.guestUsername),a?onlinePlayEngine.updateGameWinInfo(gameId,a,gameController.theGame.getWinResultTypeCode(),getLoginToken(),emptyCallback):onlinePlayEngine.updateGameWinInfoAsTie(gameId,gameController.theGame.getWinResultTypeCode(),getLoginToken(),emptyCallback);gameController.isSolitaire&&(i+=getResetMoveText())}else gameController.gameHasEndedInDraw&&gameController.gameHasEndedInDraw()?(playingOnlineGame()&&onlinePlayEngine.updateGameWinInfoAsTie(gameId,gameController.theGame.getWinResultTypeCode(),getLoginToken(),emptyCallback),i+="Game has ended in a draw.",gameController.isSolitaire&&(i+=getResetMoveText())):(playingOnlineGame()||(i+="Current Player: "+getCurrentPlayer()+"<br />"),i+=gameController.getAdditionalMessage()+getResetMoveText());getGameMessageElement().innerHTML=i,(activeAi&&getCurrentPlayer()===activeAi.player||activeAi2&&getCurrentPlayer()===activeAi2.player)&&playAiTurn()}function haveBothEmails(){return hostEmail&&guestEmail&&haveUserEmail()}function getUserEmail(){return localStorage.getItem(userEmailKey)}function getCurrentPlayerEmail(){var e;return getCurrentPlayer()===HOST?e=hostEmail:getCurrentPlayer()===GUEST&&(e=guestEmail),e}function getOpponentPlayerEmail(){var e;return getCurrentPlayer()===HOST?e=guestEmail:getCurrentPlayer()===GUEST&&(e=hostEmail),e}function getEmailBody(e){var t="I just made move #"+gameController.gameNotation.getLastMoveNumber()+" in a game of Pai Sho! Click here to open our game: "+e;return t+="[BR][BR]---- Full Details: ----[BR]Move: "+gameController.gameNotation.getLastMoveText()+"[BR][BR]Game Notation: [BR]"+gameController.gameNotation.getNotationForEmail()}function getCurrentPlayer(){return gameController.getCurrentPlayer()}function getCurrentPlayerForReal(){return gameController.getCurrentPlayer()}function getResetMoveText(){return"<br /><span class='skipBonus' onclick='resetMove();'>Undo move</span>"}function showResetMoveMessage(){getGameMessageElement().innerHTML+=getResetMoveText()}function resetMove(){gameController.resetMove(),rerunAll()}function myTurn(){var e=localStorage.getItem(localEmailKey);return!(e&&e.includes("@")&&e.includes("."))||(getCurrentPlayer()===HOST?!hostEmail||localStorage.getItem(localEmailKey)===hostEmail||currentGameData.hostUsername&&usernameEquals(currentGameData.hostUsername):!guestEmail||localStorage.getItem(localEmailKey)===guestEmail||currentGameData.guestUsername&&usernameEquals(currentGameData.guestUsername))}function myTurnForReal(){var e=localStorage.getItem(localEmailKey);return!(e&&e.includes("@")&&e.includes("."))||(getCurrentPlayerForReal()===HOST?localStorage.getItem(localEmailKey)===hostEmail:localStorage.getItem(localEmailKey)===guestEmail)}var createGameCallback=function(e){finalizeMove(),lastKnownGameNotation=gameController.gameNotation.notationTextForUrl(),gameController.isSolitaire()&&completeJoinGameSeek({gameId:e}),showModal("Game Created!","You just created a game. Anyone can join it by clicking on Join Game. You can even join your own game if you'd like.<br /><br />If anyone joins this game, it will show up in your list of games when you click My Games.")},createPrivateGameCallback=function(e){finalizeMove(),lastKnownGameNotation=gameController.gameNotation.notationTextForUrl(),gameController.isSolitaire()&&completeJoinGameSeek({gameId:e}),showModal("Game Created!","You just created a private game. Send <a href='"+createInviteLinkUrl(e)+"' target='_blank'>this invite link</a> to a friend so they can join. <br /><br />When a player joins this game, it will show up in your list of games when you click My Games.",!0)};function createInviteLinkUrl(e){return linkUrl=LZString.compressToEncodedURIComponent("joinPrivateGame="+e+"&hostUserName="+getUsername()),linkUrl=sandboxUrl+"?"+linkUrl,linkUrl}function askToJoinPrivateGame(e,t){var o="Do you want to join this game hosted by "+t+"?";o+="<br /><br />",o+="<div class='clickableText' onclick='closeModal(); yesJoinPrivateGame("+e+");'>Yes - join game</div>",showModal("Join Private Game?",o+="<br /><div class='clickableText' onclick='closeModal();'>No - cancel</div>",!0)}function yesJoinPrivateGame(e){completeJoinGameSeek({gameId:e})}var submitMoveData={},submitMoveCallback=function(){debug("Inside submitMoveCallback"),lastKnownGameNotation=gameController.gameNotation.notationTextForUrl(),finalizeMove(submitMoveData.moveAnimationBeginStep),startWatchingNumberOfGamesWhereUserTurn()};function clearMessage(){var e=document.getElementById("helpTextContent");defaultHelpMessageText=gameController.getDefaultHelpMessageText(),e.innerHTML=defaultHelpMessageText;var t=getTournamentText()+e.innerHTML;if(e.innerHTML=t,gameController.getAdditionalHelpTabDiv){var o=gameController.getAdditionalHelpTabDiv();e.appendChild(o)}gameController.isPaiShoGame&&e.appendChild(buildPaiShoSettingsDiv())}function haveUserEmail(){var e=localStorage.getItem(localEmailKey);return e&&e.includes("@")&&e.includes(".")}function unplayedTileClicked(e){gameController.unplayedTileClicked(e)}function pointClicked(e){gameController.pointClicked(e)}function displayReturnedMessage(e){var t=e.heading,o=e.message;t?o.length>1?setMessage(toHeading(t)+toBullets(o)):setMessage(toHeading(t)+toMessage(o)):o.length>1?setMessage(toBullets(o)):setMessage(toMessage(o))}function showTileMessage(e){displayReturnedMessage(gameController.getTileMessage(e))}function showPointMessage(e){var t=gameController.getPointMessage(e);t&&displayReturnedMessage(t)}function setMessage(e){e===document.getElementById("helpTextContent").innerHTML?clearMessage():document.getElementById("helpTextContent").innerHTML=getTournamentText()+e}function getAltTilesOptionText(){return"<p><span class='skipBonus' onclick='toggleTileDesigns();'>Click here</span> to switch between classic, modern, and Vescucci tile designs for Skud Pai Sho.<br />Currently selected: "+getSelectedTileDesignTypeDisplayName()+"</p>"}function getAltVagabondTilesOptionText(){return"<p><span class='skipBonus' onclick='toggleVagabondTileDesigns();'>Click here</span> to switch between standard and modern tile designs for Vagabond Pai Sho.</p>"}function getTournamentText(){return metadata.tournamentMatchNotes?metadata.tournamentName+"<br />"+metadata.tournamentMatchNotes+"<br />":""}function toHeading(e){return"<h4>"+e+"</h4>"}function toMessage(e){var t="";return 1===e.length?e[0]:(e.length>1&&e.forEach((function(e){t+="<p>"+e+"</p>"})),t)}function toBullets(e){var t="<ul>";return e.forEach((function(e){t+="<li>"+e+"</li>"})),t+="</ul>"}function getNeutralPointMessage(){return"<ul>","<li>This point is Neutral, so any tile can land here.</li>","<li>If a tile that is on a point touches a Neutral area of the board, that point is considered Neutral.</li>","</ul>","<h4>Neutral Point</h4><ul><li>This point is Neutral, so any tile can land here.</li><li>If a tile that is on a point touches a Neutral area of the board, that point is considered Neutral.</li></ul>"}function getRedPointMessage(){return"<p>This point is Red, so Basic White Flower Tiles are not allowed to land here.</p>","<h4>Red Point</h4><p>This point is Red, so Basic White Flower Tiles are not allowed to land here.</p>"}function getWhitePointMessage(){return"<p>This point is White, so Basic Red Flower Tiles are not allowed to land here.</p>","<h4>White Point</h4><p>This point is White, so Basic Red Flower Tiles are not allowed to land here.</p>"}function getRedWhitePointMessage(){return"<p>This point is both Red and White, so any tile is allowed to land here.</p>","<h4>Red/White Point</h4><p>This point is both Red and White, so any tile is allowed to land here.</p>"}function getGatePointMessage(){return"<p>This point is a Gate. When Flower Tiles are played, they are <em>Planted</em> in an open Gate.</p>","<p>Tiles in a Gate are considered <em>Growing</em>, and when they have moved out of the Gate, they are considered <em>Blooming</em>.</p>","<h4>Gate</h4><p>This point is a Gate. When Flower Tiles are played, they are <em>Planted</em> in an open Gate.</p><p>Tiles in a Gate are considered <em>Growing</em>, and when they have moved out of the Gate, they are considered <em>Blooming</em>.</p>"}function sandboxitize(){for(var e=gameController.getNewGameNotation(),t=0;t<currentMoveIndex;t++)e.addMove(gameController.gameNotation.moves[t]);setGameController(currentGameData.gameTypeId,!0),userIsLoggedIn()&&(currentGameData.hostUsername=getUsername(),currentGameData.guestUsername=getUsername()),gameController.setGameNotation(e.notationTextForUrl()),rerunAll(),showReplayControls()}function getLink(e){for(var t=gameController.getNewGameNotation(),o=0;o<currentMoveIndex;o++)t.addMove(gameController.gameNotation.moves[o]);var i="";return currentGameData&&currentGameData.gameTypeId&&(i+="gameType="+currentGameData.gameTypeId+"&"),e&&getUserEmail()&&(i+="host="+getUserEmail()+"&",i+="guest="+getUserEmail()+"&"),i+="game="+t.notationTextForUrl(),i=LZString.compressToEncodedURIComponent(i),i=sandboxUrl+"?"+i,console.log(i),i}function setAiIndex(e){playingOnlineGame()&&forgetCurrentGameInfo();var t=gameController.getAiList();activeAi?(activeAi2=t[e]).setPlayer(getCurrentPlayer()):(activeAi=t[e]).setPlayer(getCurrentPlayer()),gameController.startAiGame(finalizeMove)}function clearAiPlayers(){activeAi=null,activeAi2=null}function playAiTurn(){playingOnlineGame()?clearAiPlayers():gameController.playAiTurn(finalizeMove)}function sandboxFromMove(){sandboxitize()}function openLink(e){ios||"ios"===QueryString.appType?webkit.messageHandlers.callbackHandler.postMessage('{"linkUrl":"'+e+'"}'):window.open(e)}function callFailed(){showModal("","Unable to load.")}function showModal(e,t,o){closeNav();var i=document.getElementById("myMainModal"),n=document.getElementsByClassName("myMainModalClose")[0];document.getElementById("modalHeading").innerHTML=e,document.getElementById("modalMessage").innerHTML=t,i.style.display="block",n.onclick=function(){closeModal()},tutorialInProgress&&(o=!0),window.onclick=function(e){e.target!=i||o||closeModal()}}function closeModal(){document.getElementById("myMainModal").style.display="none",tutorialInProgress=!1}function callSubmitMove(e){submitMoveData={moveAnimationBeginStep:e},onlinePlayEngine.submitMove(gameId,encodeURIComponent(gameController.gameNotation.notationTextForUrl()),getLoginToken(),getGameTypeEntryFromId(currentGameData.gameTypeId).desc,submitMoveCallback)}var sendVerificationCodeCallback=function(e){var t;e.includes("has been sent")?(t="Verification code sent to "+emailBeingVerified+". Be sure to check your spam or junk mail for the email.",t+="<br />Didn't get the email? Check your spam again. If it isn't there, try a different email address. Some email services reject the verification email."):t="Failed to send verification code, please try again. Join the Discord for help, or try another email address.",document.getElementById("verificationCodeSendResponse").innerHTML=t},isUserInfoAvailableCallback=function(e){e&&e.length>0?showModal("Sign In","Username or email unavailable.<br /><br /><span class='skipBonus' onclick='loginClicked();'>Back</span>"):(debug("Checkpoint"),document.getElementById("verificationCodeInput").disabled=!1,document.getElementById("verificationCodeSendResponse").innerHTML="Sending code... <i class='fa fa-circle-o-notch fa-spin fa-fw'></i>",onlinePlayEngine.sendVerificationCode(usernameBeingVerified,emailBeingVerified,sendVerificationCodeCallback))},userInfoExistsCallback=function(e){e&&parseInt(e.trim())>0?(tempUserId=e.trim(),isUserInfoAvailableCallback()):onlinePlayEngine.isUserInfoAvailable(usernameBeingVerified,emailBeingVerified,isUserInfoAvailableCallback)};function sendVerificationCodeClicked(){emailBeingVerified=document.getElementById("userEmailInput").value.trim().toLowerCase(),usernameBeingVerified=document.getElementById("usernameInput").value.trim(),emailBeingVerified.includes("@")&&emailBeingVerified.includes(".")&&usernameBeingVerified.match(/^([A-Za-z0-9_]){3,25}$/g)?onlinePlayEngine.userInfoExists(usernameBeingVerified,emailBeingVerified,userInfoExistsCallback):showModal("Sign In","Invalid username or email. Your username cannot be too short or too long, and cannot contain spaces. <br /><br /><span class='skipBonus' onclick='loginClicked();'>Back</span>")}function verifyCodeClicked(){usernameBeingVerified&&""!=usernameBeingVerified.trim()&&emailBeingVerified&&""!=emailBeingVerified.trim()&&(codeToVerify=document.getElementById("verificationCodeInput").value)&&""!=codeToVerify.trim()&&onlinePlayEngine.getVerificationCode(verifyCodeCallback)}var createDeviceIdCallback=function(e){closeModal(),localStorage.setItem(deviceIdKey,parseInt(e)),localStorage.setItem(userIdKey,parseInt(tempUserId)),localStorage.setItem(usernameKey,usernameBeingVerified),localStorage.setItem(userEmailKey,emailBeingVerified),localStorage.setItem(localEmailKey,emailBeingVerified),localPlayerRole===HOST?hostEmail=emailBeingVerified:localPlayerRole===GUEST&&(guestEmail=emailBeingVerified),emailBeingVerified="",usernameBeingVerified="",tempUserId=null,codeToVerify=0,updateFooter(),clearMessage(),setAccountHeaderLinkText(),initialVerifyLogin(),showModal("<i class='fa fa-check' aria-hidden='true'></i> Email Verified","Hi, "+getUsername()+"! Your email has been successfully verified and you are now signed in.")},createUserCallback=function(e){tempUserId=e,onlinePlayEngine.createDeviceIdForUser(tempUserId,createDeviceIdCallback)},verifyCodeCallback=function(e){codeToVerify===e?tempUserId&&tempUserId>0?createUserCallback(tempUserId):onlinePlayEngine.createUser(usernameBeingVerified,emailBeingVerified,createUserCallback):(closeModal(),emailBeingVerified="",usernameBeingVerified="",tempUserId=null,codeToVerify=0,showModal("Validation Failed","Validation failed. Please try again."))};function getUserId(){return localStorage.getItem(userIdKey)}function getUsername(){return localStorage.getItem(usernameKey)}function getDeviceId(){return localStorage.getItem(deviceIdKey)}function userIsLoggedIn(){return getUserId()&&getUsername()&&getUserEmail()&&getDeviceId()}function forgetCurrentGameInfo(){clearAiPlayers(),gameWatchIntervalValue&&(clearInterval(gameWatchIntervalValue),gameWatchIntervalValue=null),gameId=-1,lastKnownGameNotation="",gameWatchIntervalValue&&(clearInterval(gameWatchIntervalValue),gameWatchIntervalValue=null),currentGameOpponentUsername=null,currentGameData=new Object,currentMoveIndex=0,pauseRun(),hostEmail=getUserEmail(),guestEmail=null,updateFooter(),document.getElementById("chatMessagesDisplay").innerHTML="",updateCurrentGameTitle()}var GameType={SkudPaiSho:{id:1,desc:"Skud Pai Sho",rulesUrl:"https://skudpaisho.com/site/games/skud-pai-sho/",gameOptions:[OPTION_INFORMAL_START,OPTION_DOUBLE_ACCENT_TILES,OPTION_ANCIENT_OASIS_EXPANSION,NO_HARMONY_VISUAL_AIDS]},VagabondPaiSho:{id:2,desc:"Vagabond Pai Sho",rulesUrl:"https://skudpaisho.com/site/games/vagabond-pai-sho/",gameOptions:[OPTION_DOUBLE_TILES]},CapturePaiSho:{id:3,desc:"Capture Pai Sho",rulesUrl:"https://skudpaisho.com/site/games/capture-pai-sho/",gameOptions:[]},StreetPaiSho:{id:5,desc:"Street Pai Sho",rulesUrl:"https://skudpaisho.com/site/games/street-pai-sho/",gameOptions:[FORMAL_WIN_CONDITION,ORIGINAL_BOARD_SETUP,RELEASE_CAPTIVE_TILES,BONUS_MOVEMENT_5,BONUS_MOVEMENT_BASED_ON_NUM_CAPTIVES]},SolitairePaiSho:{id:4,desc:"Solitaire Pai Sho",rulesUrl:"https://skudpaisho.com/site/games/solitaire-pai-sho/",gameOptions:[OPTION_DOUBLE_TILES,OPTION_INSANE_TILES]},CoopSolitaire:{id:6,desc:"Cooperative Solitaire",rulesUrl:"https://skudpaisho.com/site/games/cooperative-solitaire-pai-sho/",gameOptions:[OPTION_DOUBLE_TILES,OPTION_INSANE_TILES]},OvergrowthPaiSho:{id:8,desc:"Overgrowth Pai Sho",rulesUrl:"https://skudpaisho.com/site/games/overgrowth-pai-sho/",gameOptions:[OPTION_FULL_TILES,FULL_POINTS_SCORING]},Blooms:{id:9,desc:"Blooms",rulesUrl:"https://www.nickbentley.games/blooms-rules/",gameOptions:[SHORTER_GAME,FOUR_SIDED_BOARD,SIX_SIDED_BOARD]},Trifle:{id:10,desc:"Pai and Sho's Trifle",rulesUrl:"https://skudpaisho.com/site/games/pai-shos-trifle/",gameOptions:[]},Hexentafl:{id:11,desc:"heXentafl",rulesUrl:"https://nxsgame.wordpress.com/2019/09/26/hexentafl/",gameOptions:[OPTION_ATTACKERS_MOVE_FIRST,FIVE_SIDED_BOARD,KING_MOVES_LIKE_PAWNS],secretGameOptions:[MORE_ATTACKERS]},PaiJo:{id:12,desc:"Modern Pai Sho (PaiJo)",rulesUrl:"http://paisho.pbworks.com/w/page/102793894/Modern%20Pai%20Sho",gameOptions:[],secretGameOptions:[]}};function getGameControllerForGameType(e){var t,o=window.mobileAndTabletcheck();switch(e){case GameType.SkudPaiSho.id:t=new SkudPaiShoController(gameContainerDiv,o);break;case GameType.VagabondPaiSho.id:t=new VagabondController(gameContainerDiv,o);break;case GameType.SolitairePaiSho.id:t=new SolitaireController(gameContainerDiv,o);break;case GameType.CapturePaiSho.id:t=new CaptureController(gameContainerDiv,o);break;case GameType.StreetPaiSho.id:t=new StreetController(gameContainerDiv,o);break;case GameType.CoopSolitaire.id:t=new CoopSolitaireController(gameContainerDiv,o);break;case GameType.OvergrowthPaiSho.id:t=new OvergrowthController(gameContainerDiv,o);break;case GameType.Blooms.id:t=new BloomsController(gameContainerDiv,o);break;case GameType.Trifle.id:trifleOn||TrifleController.userIsTrifleDeveloper()?t=new TrifleController(gameContainerDiv,o):closeGame();break;case GameType.Hexentafl.id:t=new HexentaflController(gameContainerDiv,o);break;case GameType.PaiJo.id:t=new PaiJoController(gameContainerDiv,o);break;default:debug("Game Controller unavailable.")}return t}function setGameController(e,t){setGameLogText("");var o=!0;return gameController&&gameController.cleanup(),t||clearOptions(),forgetCurrentGameInfo(),(gameController=getGameControllerForGameType(e))||(gameController=getGameControllerForGameType(GameType.VagabondPaiSho.id),debug("Defaulting to use Vagabond Pai Sho."),showModal("Cannot Load Game","This game is unavailable. Try Vagabond Pai Sho instead :)<br /><br />To know why the selected game is unavailable, ask in The Garden Gate Discord. Perhaps you have selected a new game that is coming soon!"),o=!1),gameController.completeSetup&&gameController.completeSetup(),isInReplay=!1,currentGameData.gameTypeId=e,defaultHelpMessageText=null,clearMessage(),refreshMessage(),o}var jumpToGameCallback=function(e){if(e){populateMyGamesList(e);var t=myGamesList[0];if(clearOptions(),t.gameOptions)for(var o=0;o<t.gameOptions.length;o++)addOption(t.gameOptions[o]);if(!setGameController(t.gameTypeId,!0))return;var i,n=usernameEquals(t.hostUsername)||usernameEquals(t.guestUsername);gameId=t.gameId,currentGameOpponentUsername=null,n&&(i=usernameEquals(t.hostUsername)?t.guestUsername:t.hostUsername,currentGameOpponentUsername=i),currentGameData.hostUsername=t.hostUsername,currentGameData.guestUsername=t.guestUsername,hostEmail=t.hostUsername,guestEmail=t.guestUsername,startWatchingGameRealTime(),updateFooter()}};function jumpToGame(e){onlinePlayEnabled&&(clearGameWatchInterval(),onlinePlayEngine.getGameInfo(getUserId(),e,jumpToGameCallback))}function populateMyGamesList(e){var t=e.split("\n");for(var o in myGamesList=[],t){var i=t[o].split("|||"),n={gameId:parseInt(i[0]),gameTypeId:parseInt(i[1]),gameTypeDesc:i[2],hostUsername:i[3],hostOnline:parseInt(i[4]),guestUsername:i[5],guestOnline:parseInt(i[6]),isUserTurn:parseInt(i[7]),gameOptions:parseGameOptions(i[8]),winnerUsername:i[9],resultId:parseInt(i[10])};myGamesList.push(n)}}function getLoginToken(){return{userId:getUserId(),username:getUsername(),userEmail:getUserEmail(),deviceId:getDeviceId()}}var showPastGamesCallback=function(e){var t="No completed games.";if(e){t="";var o=showAllCompletedGamesInList,i=0;populateMyGamesList(e);var n="";for(var a in myGamesList){var r=myGamesList[a];if(8!==r.resultId){r.gameTypeDesc!==n&&(""!==n&&(t+="<br />"),t+="<div class='modalContentHeading'>"+(n=r.gameTypeDesc)+"</div>");var l=parseInt(r.gameId),s=(usernameEquals(r.hostUsername)?r.guestUsername:r.hostUsername,r.hostUsername);if(s+=" vs. ",t+="<div class='clickableText' onclick='jumpToGame("+l+"); closeModal();'>"+(s+=r.guestUsername)+"</div>",i++,!o&&i>20)break}}}o||(t+="<br /><div class='clickableText' onclick='showAllCompletedGames();'>Show all</div>"),showModal("Completed Games",t)},showAllCompletedGamesInList=!1;function showPastGamesClicked(){closeModal(),showAllCompletedGamesInList=!1,onlinePlayEngine.getPastGamesForUserNew(getLoginToken(),showPastGamesCallback)}function showAllCompletedGames(){closeModal(),showAllCompletedGamesInList=!0,onlinePlayEngine.getPastGamesForUserNew(getLoginToken(),showPastGamesCallback)}var showMyGamesCallback=function(e){var t="No active games.";if(e){t="",populateMyGamesList(e);var o="";for(var i in myGamesList){var n=myGamesList[i];n.gameTypeDesc!==o&&(""!==o&&(t+="<br />"),t+="<div class='modalContentHeading'>"+(o=n.gameTypeDesc)+"</div>");var a=parseInt(n.gameId),r=usernameEquals(n.hostUsername),l=usernameEquals(n.guestUsername),s="";r||(n.hostOnline?s+=userOnlineIcon:s+=userOfflineIcon),s+=n.hostUsername,s+=" vs. ",l||(n.guestOnline?s+=userOnlineIcon:s+=userOfflineIcon),s+=n.guestUsername,n.isUserTurn&&(s+=" (Your turn)"),t+="<div class='clickableText' onclick='jumpToGame("+a+"); closeModal();'>"+s+"</div>";for(var h=0;h<n.gameOptions.length;h++)t+="<div>&nbsp;&bull;&nbsp;<em>Game Option: "+n.gameOptions[h]+"</em></div>"}}t+="<br /><br /><div class='clickableText' onclick='showPastGamesClicked();'>Show completed games</div>",showModal("Active Games",t+="<br /><br /><div>You are currently signed in as "+getUsername()+". <span class='skipBonus' onclick='showSignOutModal();'>Click here to sign out.</span></div>")};function showMyGames(){showModal("Active Games",getLoadingModalText()),onlinePlayEngine.getCurrentGamesForUserNew(getLoginToken(),showMyGamesCallback)}var emptyCallback=function(e){};function emailNotificationsCheckboxClicked(){var e="N";document.getElementById("emailNotificationsCheckbox").checked&&(e="Y"),onlinePlayEngine.updateEmailNotificationsSetting(getUserId(),e,emptyCallback)}var getEmailNotificationsSettingCallback=function(e){document.getElementById("emailNotificationsCheckbox").checked=e&&e.startsWith("Y")};function showAccountSettings(){showModal("Settings","Note: Email notifications are not working right now. Maybe in the future they will be back.<br /><div><input id='emailNotificationsCheckbox' type='checkbox' onclick='emailNotificationsCheckboxClicked();'>Email Notifications</div>"),onlinePlayEngine.getEmailNotificationsSetting(getUserId(),getEmailNotificationsSettingCallback)}function showCurrentlyOfflineModal(){window.navigator.onLine||showModal("Currently Offline","Currently offline, please try again when connected to the Internet. <br /><br /><span class='skipBonus' onclick='closeModal();'>OK</span>")}function accountHeaderClicked(){window.navigator.onLine?userIsLoggedIn()&&onlinePlayEnabled?showMyGames():loginClicked():showCurrentlyOfflineModal(),requestNotificationPermission()}function loginClicked(){var e=document.getElementById("loginModalContentContainer").innerHTML;userIsLoggedIn()&&(e+="<div><br /><br />You are currently signed in as "+getUsername()+"</div>"),showModal("Sign In",e)}var completeJoinGameSeekCallback=function(e){e&&(jumpToGame(selectedGameSeek.gameId),closeModal())};function completeJoinGameSeek(e){selectedGameSeek=e,onlinePlayEngine.joinGameSeek(e.gameId,getLoginToken(),completeJoinGameSeekCallback)}var selectedGameSeek,getCurrentGamesForUserNewCallback=function(e){var t=selectedGameSeek;if(e){populateMyGamesList(e);var o=!1;for(var i in myGamesList){var n=myGamesList[i];(usernameEquals(n.hostUsername)?n.guestUsername:n.hostUsername)===t.hostUsername&&t.gameTypeId===n.gameTypeId&&(o=!0)}o?(closeModal(),showModal("Cannot Join Game","You are already playing a game against that user, so you will have to finish that game first.")):completeJoinGameSeek(t)}else completeJoinGameSeek(t)};function getGameTypeEntryFromId(e){var t=null;return Object.keys(GameType).forEach((function(o,i){if(GameType[o].id===e)return t=GameType[o],GameType[o]})),t}function gameTypeIdSupported(e){var t=!1;return Object.keys(GameType).forEach((function(o,i){if(GameType[o].id===e)return t=!0,!0})),t}function acceptGameSeekClicked(e){var t;for(var o in gameSeekList)gameSeekList[o].gameId===e&&(t=gameSeekList[o]);t&&gameTypeIdSupported(t.gameTypeId)&&gameOptionsSupportedForGameSeek(t)?(selectedGameSeek=t,onlinePlayEngine.getCurrentGamesForUserNew(getLoginToken(),getCurrentGamesForUserNewCallback)):showModal("Cannot Join Game","This game is using new features that your version of The Garden Gate does not support.")}function tryRealTimeClicked(){onlinePlayEnabled=!0,setAccountHeaderLinkText(),initialVerifyLogin(),rerunAll(),closeModal()}function gameOptionsSupportedForGameSeek(e){var t=!1;return Object.keys(GameType).forEach((function(o,i){var n=GameType[o];if(n.id===e.gameTypeId&&n.gameOptions){var a=n.gameOptions;return n.secretGameOptions&&(a=a.concat(n.secretGameOptions)),t=arrayIncludesAll(a,e.gameOptions)}})),t}var getGameSeeksCallback=function(e){var t="No games available to join. You should start one!";if(e){t="";var o=e.split("\n");for(var i in gameSeekList=[],o){var n=o[i].split("|||"),a={gameId:parseInt(n[0]),gameTypeId:parseInt(n[1]),gameTypeDesc:n[2],hostId:n[3],hostUsername:n[4],hostOnline:parseInt(n[5]),gameOptions:parseGameOptions(n[6])};gameSeekList.push(a)}var r="";for(var i in gameSeekList){if((a=gameSeekList[i]).gameTypeId!==GameType.Trifle.id||a.gameTypeId===GameType.Trifle.id&&TrifleController.userIsTrifleDeveloper()){var l=userOfflineIcon;a.hostOnline&&(l=userOnlineIcon),a.gameTypeDesc!==r&&(""!==r&&(t+="<br />"),t+="<div class='modalContentHeading'>"+(r=a.gameTypeDesc)+"</div>"),t+="<div><div class='clickableText gameSeekEntry' onclick='acceptGameSeekClicked("+parseInt(a.gameId)+");'>Host: "+l+a.hostUsername+"</div>";for(var s=0;s<a.gameOptions.length;s++)t+="<div>&nbsp;&bull;&nbsp;<em>Game Option: "+a.gameOptions[s]+"</em></div>";t+="</div>"}}}showModal("Join a game",t)};function htmlDecode(e){var t=document.createElement("div");return t.innerHTML=e,0===t.childNodes.length?"":t.childNodes[0].nodeValue}function parseGameOptions(e){try{var t=htmlDecode(e);return JSON.parse(t)}catch(e){return[]}}function viewGameSeeksClicked(){window.navigator.onLine?onlinePlayEnabled&&userIsLoggedIn()?(showModal("Join a game",getLoadingModalText()),onlinePlayEngine.getGameSeeks(getGameSeeksCallback)):showModal("Join a game",onlinePlayEnabled?"<span class='skipBonus' onclick='loginClicked();'>Sign in</span> to play real-time games with others online. When you are signed in, this is where you can join games against other players.":"Online play is disabled right now. Maybe you are offline. Try again later!"):showCurrentlyOfflineModal()}var tempGameTypeId,yesCreateGame=function(e){onlinePlayEngine.createGame(e,gameController.gameNotation.notationTextForUrl(),JSON.stringify(ggOptions),"",getLoginToken(),createGameCallback)},yesCreatePrivateGame=function(e){onlinePlayEngine.createGame(e,gameController.gameNotation.notationTextForUrl(),JSON.stringify(ggOptions),"Y",getLoginToken(),createPrivateGameCallback)},getCurrentGameSeeksHostedByUserCallback=function(e){var t=tempGameTypeId;if(e){finalizeMove();o="";userIsLoggedIn()?(o="<div>You already have a public game waiting for an opponent. Do you want to create a private game for others to join?</div>",o+="<br /><div class='clickableText' onclick='closeModal(); yesCreatePrivateGame("+t+");'>Yes - create a private game with a friend</div>",showModal("Create game?",o+="<br /><div class='clickableText' onclick='closeModal(); finalizeMove();'>No - local game only</div>")):(o="You are not signed in. ",showModal("Game Not Created",o+="<br /><br />You can still play the game locally, but it will not be saved online."))}else if(gameController.isSolitaire())yesCreateGame(t);else{var o="<div>Do you want to create a game for others to join?</div>";o+="<br /><div class='clickableText' onclick='closeModal(); yesCreateGame("+t+");'>Yes - create game</div>",o+="<br /><div class='clickableText' onclick='closeModal(); yesCreatePrivateGame("+t+");'>Yes - create a private game with a friend</div>",showModal("Create game?",o+="<br /><div class='clickableText' onclick='closeModal(); finalizeMove();'>No - local game only</div>")}};function createGameIfThatIsOk(e){tempGameTypeId=e,playingOnlineGame()?callSubmitMove():userIsLoggedIn()&&window.navigator.onLine?onlinePlayEngine.getCurrentGameSeeksHostedByUser(getUserId(),e,getCurrentGameSeeksHostedByUserCallback):finalizeMove()}function handleNewGlobalChatMessages(e){var t=e.split("\n");chatMessageList=[];var o="";for(var i in t){var n=t[i].split("|||"),a={timestamp:n[0],username:n[1],message:n[2]};chatMessageList.push(a),lastGlobalChatTimestamp=a.timestamp}for(var i in chatMessageList){o+="<div class='chatMessage'><strong>"+(a=chatMessageList[i]).username+":</strong> "+a.message.replace(/&amp;/g,"&")+"</div>"}var r=document.getElementById("globalChatMessagesDisplay"),l=r.scrollHeight-r.clientHeight<=r.scrollTop+1,s=document.createElement("div");s.innerHTML=o,r.appendChild(s),l&&(r.scrollTop=r.scrollHeight-r.clientHeight)}var getNewGlobalChatsCallback=function(e){""!=e&&handleNewGlobalChatMessages(e)},lastGlobalChatTimestamp="1970-01-01 00:00:00";function fetchGlobalChats(){onlinePlayEngine.getNewChatMessages(0,lastGlobalChatTimestamp,getNewGlobalChatsCallback)}var getInitialGlobalChatsCallback=function(e){""!=e&&handleNewGlobalChatMessages(e)};function resetGlobalChats(){document.getElementById("globalChatMessagesDisplay").innerHTML="<strong>SkudPaiSho: </strong> Hi everybody! To chat with everyone, ask questions, or get help, join The Garden Gate <a href='https://discord.gg/dStDZx7' target='_blank'>Discord server</a>.<hr />"}function fetchInitialGlobalChats(){resetGlobalChats(),onlinePlayEngine.getInitialGlobalChatMessages(getInitialGlobalChatsCallback)}function logOnlineStatusPulse(){onlinePlayEngine.logOnlineStatus(getLoginToken(),emptyCallback),verifyLogin()}var LOG_ONLINE_STATUS_INTERVAL=5e3;function startLoggingOnlineStatus(){onlinePlayEngine.logOnlineStatus(getLoginToken(),emptyCallback),clearLogOnlineStatusInterval(),logOnlineStatusIntervalValue=setInterval((function(){logOnlineStatusPulse()}),LOG_ONLINE_STATUS_INTERVAL)}function clearLogOnlineStatusInterval(){logOnlineStatusIntervalValue&&(clearInterval(logOnlineStatusIntervalValue),logOnlineStatusIntervalValue=null)}function setSidenavNewGameSection(){var e="";Object.keys(GameType).forEach((function(t,o){e+=getSidenavNewGameEntryForGameType(GameType[t])})),document.getElementById("sidenavNewGameSection").innerHTML=e}function randomIntFromInterval(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function closeGame(){setGameController(trifleOn?GameType.Trifle.id:randomIntFromInterval(1,2))}function getSidenavNewGameEntryForGameType(e){return"<div class='sidenavEntry'><span class='sidenavLink skipBonus' onclick='setGameController("+e.id+"); closeModal();'>"+e.desc+"</span><span>&nbsp;-&nbsp;<i class='fa fa-book' aria-hidden='true'></i>&nbsp;</span><a href='"+e.rulesUrl+"' target='_blank' class='newGameRulesLink sidenavLink'>Rules</a></div>"}function getNewGameEntryForGameType(e){return trifleOn||e!==GameType.Trifle||e===GameType.Trifle&&TrifleController.userIsTrifleDeveloper()?"<div class='newGameEntry'><span class='clickableText' onclick='setGameController("+e.id+"); closeModal();'>"+e.desc+"</span><span>&nbsp;-&nbsp;<i class='fa fa-book' aria-hidden='true'></i>&nbsp;</span><a href='"+e.rulesUrl+"' target='_blank' class='newGameRulesLink'>Rules</a></div>":""}function newGameClicked(){var e="";Object.keys(GameType).forEach((function(t,o){e+=getNewGameEntryForGameType(GameType[t])})),showModal("New Game",e)}var getCountOfGamesWhereUserTurnCallback=function(e){setAccountHeaderLinkText(e),appCaller.setCountOfGamesWhereUserTurn(e)};function loadNumberOfGamesWhereUserTurn(){onlinePlayEnabled&&userIsLoggedIn()&&onlinePlayEngine.getCountOfGamesWhereUserTurn(getUserId(),getCountOfGamesWhereUserTurnCallback)}var USER_TURN_GAME_WATCH_INTERVAL=6e3;function startWatchingNumberOfGamesWhereUserTurn(){loadNumberOfGamesWhereUserTurn(),userTurnCountInterval&&(clearInterval(userTurnCountInterval),userTurnCountInterval=null),userTurnCountInterval=setInterval((function(){loadNumberOfGamesWhereUserTurn()}),USER_TURN_GAME_WATCH_INTERVAL)}var sendChatCallback=function(e){document.getElementById("sendChatMessageButton").innerHTML="Send",document.getElementById("chatMessageInput").value=""},sendChat=function(){var e=htmlEscape(document.getElementById("chatMessageInput").value).trim();(e=e.replace(/\n/g," "))&&(document.getElementById("sendChatMessageButton").innerHTML="<i class='fa fa-circle-o-notch fa-spin fa-fw'>",onlinePlayEngine.sendChat(gameId,getLoginToken(),e,sendChatCallback))};document.getElementById("chatMessageInput").onkeypress=function(e){13==(e.keyCode?e.keyCode:e.which)&&sendChat()};var sendGlobalChatCallback=function(e){document.getElementById("sendGlobalChatMessageButton").innerHTML="Send",document.getElementById("globalChatMessageInput").value=""},sendGlobalChat=function(){var e=htmlEscape(document.getElementById("globalChatMessageInput").value).trim();(e=e.replace(/\n/g," "))&&(document.getElementById("sendGlobalChatMessageButton").innerHTML="<i class='fa fa-circle-o-notch fa-spin fa-fw'>",onlinePlayEngine.sendChat(0,getLoginToken(),e,sendGlobalChatCallback))};function htmlEscape(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function openTab(e,t){var o,i,n;for(i=document.getElementsByClassName("tabcontent"),o=0;o<i.length;o++)i[o].style.display="none";for(n=document.getElementsByClassName("tablinks"),o=0;o<n.length;o++)n[o].classList.remove("active");document.getElementById(t).style.display="block",e.currentTarget.classList.add("active")}function showGameNotationModal(){var e="";e+="<div class='coordinatesNotation'>",e+=gameController.gameNotation.getNotationForEmail().replace(/\[BR\]/g,"<br />"),showModal("Game Notation",e+="</div><br />")}function showGameReplayLink(){for(var e=gameController.getNewGameNotation(),t=0;t<currentMoveIndex;t++)e.addMove(gameController.gameNotation.moves[t]);var o="";currentGameData&&currentGameData.gameTypeId&&(o+="gameType="+currentGameData.gameTypeId+"&"),o+="host="+currentGameData.hostUsername+"&",o+="guest="+currentGameData.guestUsername+"&",o+="game="+e.notationTextForUrl(),ggOptions.length>0&&(o+="&gameOptions="+JSON.stringify(ggOptions)),o=LZString.compressToEncodedURIComponent(o),debug("GameReplayLinkUrl: "+(o=sandboxUrl+"?"+o));var i='Here is the <a href="'+o+"\" target='_blank'>game replay link</a> to the current point in the game.";playingOnlineGame()&&(i+="<br /><br />",i+='Here is the <a href="'+buildSpectateUrl()+"\" target='_blank'>spectate link</a> others can use to watch the game live and participate in the Game Chat."),showModal("Game Links",i)}function buildSpectateUrl(){if(gameId>0)return linkUrl=LZString.compressToEncodedURIComponent("watchGame="+gameId),linkUrl=sandboxUrl+"?"+linkUrl,linkUrl}function showPrivacyPolicy(){showModal("Privacy Policy","<ul><li>All online games (and associated chat conversations) are recorded and may be available to view by others.</li><li>Usernames will be shown publicly to other players and anyone viewing game replays.</li><li>Email addresses will never be purposefully shared with other players.</li></ul>")}function dismissChatAlert(){document.getElementById("chatTab").classList.remove("alertTab")}function goai(){gameController.getAiList().length>1&&(setAiIndex(0),setTimeout((function(){setAiIndex(1)}),2e3))}function openNav(){window.onclick=function(e){e.target!==document.getElementById("mySidenav")&&e.target!==document.getElementById("sidenavMenuButton")&&e.target!==document.getElementById("siteHeading")&&closeNav()},document.getElementById("mySidenav").classList.add("sideNavOpen")}function closeNav(){document.getElementById("mySidenav").classList.remove("sideNavOpen")}function aboutClicked(){showModal("About","<div><em>The Garden Gate</em> is a place to play various fan-made <em>Pai Sho</em> games and other games, too. A Pai Sho game is a game played on a board for the fictional game of Pai Sho as seen in Avatar: The Last Airbender. <a href='https://skudpaisho.com/site/' target='_blank'>Learn more</a>.</div><hr /><div> Modern Skud Pai Sho tile designs by Hector Lowe<br /> ©2017 | Used with permission<br /> <a href='http://hector-lowe.com/' target='_blank'>www.hector-lowe.com</a> </div> <div class='license'><a rel='license' href='http://creativecommons.org/licenses/by-nc/3.0/us/'><img alt='Creative Commons License' style='border-width:0' src='https://i.creativecommons.org/l/by-nc/3.0/us/88x31.png' /></a>&nbsp;All other content of this work is licensed under a <a rel='license' href='http://creativecommons.org/licenses/by-nc/3.0/us/'>Creative Commons Attribution-NonCommercial 3.0 United States License</a>.</div> <br /> <div><span class='skipBonus' onclick='showPrivacyPolicy();'>Privacy policy</span></div>")}function getOnlineGameOpponentUsername(){var e="";return playingOnlineGame()&&(usernameEquals(currentGameData.hostUsername)?e=currentGameData.guestUsername:usernameEquals(currentGameData.guestUsername)&&(e=currentGameData.hostUsername)),e}function quitOnlineGameCallback(){currentGameData?setGameController(currentGameData.gameTypeId):closeGame()}function iAmPlayerInCurrentOnlineGame(){return usernameEquals(currentGameData.hostUsername)||usernameEquals(currentGameData.guestUsername)}function quitOnlineGame(){gameController.guestNeverMoved&&gameController.guestNeverMoved(),iAmPlayerInCurrentOnlineGame()&&onlinePlayEngine.updateGameWinInfoAsTie(gameId,8,getLoginToken(),quitOnlineGameCallback)}function quitOnlineGameClicked(){var e="";playingOnlineGame()&&iAmPlayerInCurrentOnlineGame()&&!gameController.theGame.getWinner()?(e="<div>Are you sure you want to quit and end this online game? The game will end and will NOT appear in your Completed Games list.</div>",e+="<br /><div class='clickableText' onclick='closeModal(); quitOnlineGame();'>Yes - quit current game</div>",e+="<br /><div class='clickableText' onclick='closeModal();'>No - cancel</div>"):e="When playing an unfinished online game, this is where you can quit or leave a game if you wish to do so.",showModal("Quit Current Online Game",e)}var tutorialInProgress=!1;function showWelcomeTutorial(){tutorialInProgress=!0,showModal("The Garden Gate","<div id='tutorialContent'></div>"),setTimeout((function(){runTutorial()}),400)}function runTutorial(){var e=document.getElementById("tutorialContent"),t=document.createElement("div"),o=document.createTextNode("Who knocks at the Garden Gate?");t.appendChild(o),t.classList.add("tutContentMessage"),t.classList.add("tutContentFadeIn"),e.appendChild(t),setTimeout((function(){var o=document.createElement("div"),i=document.createTextNode("One who has eaten the fruit...");o.appendChild(i),o.classList.add("tutContentMessage"),o.classList.add("tutContentFadeIn"),e.appendChild(o),t.classList.remove("tutContentFadeIn"),t.classList.add("tutContentFadeOut"),setTimeout((function(){var i=document.createElement("div"),n=document.createTextNode("... and tasted its mysteries.");i.appendChild(n),i.classList.add("tutContentMessage"),i.classList.add("tutContentFadeIn"),e.appendChild(i),setTimeout((function(){o.classList.remove("tutContentFadeIn"),o.classList.add("tutContentFadeOut"),i.classList.remove("tutContentFadeIn"),i.classList.add("tutContentFadeOut"),setTimeout((function(){t.classList.add("gone"),o.classList.add("gone"),i.classList.add("gone"),continueTutorial()}),2e3)}),2e3)}),1400)}),3e3)}function continueTutorial(){var e=document.getElementById("tutorialContent");if(e){var t=document.createElement("div");t.innerHTML="<p>Welcome to <em>The Garden Gate</em>, a place to play a variety of Pai Sho games and more against other players online.</p>",t.innerHTML+="<p>You can sign in (or sign up) by entering your username and verifying your email address.</p>",t.innerHTML+="<p>Use options in the side menu (select the <strong class='stretchText'>&nbsp;&#8801&nbsp;</strong> at the top left) to create a new game, join games set up by other players, or to view any of your games that are in progress. You can have any number of online games in progress at once.</p>",t.innerHTML+="<p>Also in the side menu you can find links to the rules for all of the games you can play here.</p>",userIsLoggedIn()||(t.innerHTML+="<p><span class='skipBonus' onclick='loginClicked();'>Sign in</span> now to get started.</p>"),t.classList.add("tutContentFadeIn"),e.appendChild(t),localStorage.setItem(welcomeTutorialDismissedKey,"true")}tutorialInProgress=!1}function iOSShake(){if(playingOnlineGame()&&!myTurn()&&!gameController.theGame.getWinner()||!playingOnlineGame()){"<br /><div class='clickableText' onclick='closeModal();'>Cancel</div>",showModal("Undo move?","<br /><div class='clickableText' onclick='resetMove(); closeModal();'>Yes, undo move</div><br /><div class='clickableText' onclick='closeModal();'>Cancel</div>")}}function saveDeviceTokenIfNeeded(){var e=localStorage.getItem(deviceTokenKey);(ios||"ios"===QueryString.appType)&&e&&userIsLoggedIn()&&onlinePlayEngine.addUserPreferenceValue(getLoginToken(),3,e,emptyCallback)}function setDeviceToken(e){localStorage.setItem(deviceTokenKey,e),saveDeviceTokenIfNeeded()}function openShop(){openLink("https://skudpaisho.com/site/buying-pai-sho/")}var ggOptions=[];function addOption(e){ggOptions.push(e)}function clearOptions(){ggOptions=[]}function addOptionFromInput(){addGameOption(document.getElementById("optionAddInput").value),closeModal()}function promptAddOption(){var e="";if(usernameIsOneOf(["SkudPaiSho"])){if(e="<br /><input type='text' id='optionAddInput' name='optionAddInput' />",e+="<br /><div class='clickableText' onclick='addOptionFromInput()'>Add</div>",ggOptions.length>0){e+="<br />";for(var t=0;t<ggOptions.length;t++)e+="<div>",e+=ggOptions[t],e+="</div>";e+="<br /><div class='clickableText' onclick='clearOptions()'>Clear Options</div>"}showModal("Secrets",e)}}function addGameOption(e){addOption(e),setGameController(gameController.getGameTypeId(),!0)}function getGameOptionsMessageHtml(e){for(var t="<br /><br />",o=0;o<e.length;o++)gameOptionEnabled(e[o])||(!gameController.optionOkToShow||gameController.optionOkToShow&&gameController.optionOkToShow(e[o]))&&(t+="<span class='skipBonus' onclick='addGameOption(\""+e[o]+"\");'>&bull;&nbsp;Add game option: "+e[o]+"</span><br />");return t}function showBadMoveModal(){showModal("Uh Oh","A move went wrong somewhere. If you see this each time you look at this game, then this game may be corrupt due to players not both using latest updates. The app is not be compatible with new features.<br /><br />Please let your opponent know that you saw this message. You may want to quit this game and try again.")}var tournamentToManage=0;function getLoadingModalText(){return"Loading&nbsp;<i class='fa fa-circle-o-notch fa-spin fa-fw'></i>&nbsp;"}function showPastTournamentsClicked(){for(var e=document.getElementsByClassName("completeTournament"),t=0;t<e.length;t++)e[t].classList.remove("gone")}var showTournamentsCallback=function(e){var t="No current tournaments.";if(e){t="";var o={},i=[],n=!1,a=!1;try{i=(o=JSON.parse(e)).tournamentList,n=o.isTournamentManager}catch(e){debug("Error parsing tournament data"),closeModal(),showModal("Tournaments","Error getting tournament data.")}debug(i);var r=!0,l="";for(var s in i){var h=i[s];"Canceled"!==h.status&&(h.status!==l?("Completed"===(l=h.status)&&(t+="<div class='completeTournament gone'>"),r?r=!1:t+="<br />",t+="<div class='modalContentHeading'>"+l+"</div>","Completed"===l&&(a=!0)):"Completed"===l&&(t+="<div class='completeTournament gone'>"),t+="<div class='clickableText' onclick='viewTournamentInfo("+h.id+");'>"+h.name+"</div>","Completed"===l&&(t+="</div>"))}a&&(t+="<br /><br /><div class='clickableText' onclick='showPastTournamentsClicked();'>Show completed tournaments</div>"),n&&(t+="<br /><br /><div class='clickableText' onclick='manageTournamentsClicked();'>Manage Tournaments</div>")}showModal("Tournaments",t)};function viewTournamentsClicked(){showModal("Tournaments",getLoadingModalText()),onlinePlayEngine.getCurrentTournaments(getLoginToken(),showTournamentsCallback)}function signUpForTournament(e,t){var o="<div class='modalContentHeading'>Tournament: "+t+"</div>";o+="<br /><div>Sign up to participate in this tournament?</div>",o+="<br /><span class='clickableText' onclick='submitTournamentSignup("+e+");'>Yes - Sign up!</span>",showModal("Tournament Sign Up",o+="<br /><br /><span class='clickableText' onclick='viewTournamentInfo("+e+");'>Cancel</span>")}var showTournamentInfoCallback=function(e){var t="No tournament info found.",o="Tournament Details";if(e){t="";var i={};try{i=JSON.parse(e)}catch(e){debug("Error parsing tournament info"),closeModal(),showModal("Tournaments","Error getting tournament info.")}debug(i),o=i.name,t+="<div class='modalContentHeading'>"+i.status+" Tournament</div>",i.details&&(t+="<br />",t+=i.details),i.forumUrl&&(t+="<br /><br />",t+="<a href='"+i.forumUrl+"' target='_blank' class='clickableText'>Full details <i class='fa fa-external-link'></i></a>");var n=!1;if(i.currentPlayers.length>0){t+="<br /><br /><div class='modalContentHeading'>Players currently signed up:</div>";for(var a=0;a<i.currentPlayers.length;a++)t+="<br />"+i.currentPlayers[a].username,i.currentPlayers[a].username===getUsername()&&(n=!0)}if(t+="<br />",i.rounds&&i.rounds.length>0)for(a=0;a<i.rounds.length;a++){var r=i.rounds[a];t+="<br /><div>"+htmlEscape(r.name)+"</div>";for(var l=!1,s=0;s<i.games.length;s++){var h=i.games[s];h.roundId===r.id&&(t+="<div class='clickableText' onclick='matchGameClicked("+h.gameId+")'>"+htmlEscape(h.gameType)+": ",!h.gameWinnerUsername&&h.lastPlayedUsername&&h.lastPlayedUsername!==h.hostUsername&&(t+="<em>"),h.gameWinnerUsername&&h.gameWinnerUsername===h.hostUsername&&(t+="["),t+=h.hostUsername,h.gameWinnerUsername&&h.gameWinnerUsername===h.hostUsername&&(t+="]"),!h.gameWinnerUsername&&h.lastPlayedUsername&&h.lastPlayedUsername!==h.hostUsername&&(t+="</em>"),t+=" vs ",!h.gameWinnerUsername&&h.lastPlayedUsername&&h.lastPlayedUsername!==h.guestUsername&&(t+="<em>"),h.gameWinnerUsername&&h.gameWinnerUsername===h.guestUsername&&(t+="["),t+=h.guestUsername,h.gameWinnerUsername&&h.gameWinnerUsername===h.guestUsername&&(t+="]"),!h.gameWinnerUsername&&h.lastPlayedUsername&&h.lastPlayedUsername!==h.guestUsername&&(t+="</em>"),t+="</div>",l=!0)}l||(t+="<div><em>No games</em></div>")}else t+="<br /><em>No rounds</em>";userIsLoggedIn()&&i.signupAvailable&&!n?t+="<br /><br /><div class='clickableText' onclick='signUpForTournament("+i.id+',"'+htmlEscape(i.name)+"\");'>Sign up for tournament</div>":userIsLoggedIn()||(t+="<br /><br />Sign in and start playing to participate in tournaments.")}showModal(o,t)};function viewTournamentInfo(e){showModal("Tournament Details",getLoadingModalText()),onlinePlayEngine.getTournamentInfo(e,showTournamentInfoCallback)}function submitCreateTournament(){var e=htmlEscape(document.getElementById("createTournamentName").value),t=htmlEscape(document.getElementById("createTournamentForumUrl").value),o=htmlEscape(document.getElementById("createTournamentDetails").value);onlinePlayEngine.createTournament(getLoginToken(),e,t,o,manageTournamentsClicked)}function createNewTournamentClicked(){showModal("Create Tournament","<div>Please create a thread in the Tournaments section of the forum with details about your tournament. Put the url of your tournament thread in the Forum URL field. <br /><br />Put a short summary in the Details field that will help players understand what kind of tournament this will be.</div><br /><div>Name:<br /><input type='text' id='createTournamentName' /></div><br /><div>Forum URL:<br /><input type='text' id='createTournamentForumUrl' /></div><br /><div>1-line Summary:<br /><textarea id='createTournamentDetails'></textarea></div><br /><div class='clickableText' onclick='submitCreateTournament();'>Create Tournament</div><br /><div class='clickableText' onclick='manageTournamentsClicked();'>Cancel</div>")}var goToManageTournamentCallback=function(e){manageTournamentClicked(tournamentToManage)};function createNewRound(e){var t=document.getElementById("newRoundName").value;onlinePlayEngine.createNewRound(getLoginToken(),e,t,"",goToManageTournamentCallback)}function changeTournamentPlayerStatus(e,t,o){onlinePlayEngine.changeTournamentPlayerStatus(getLoginToken(),e,t,o,goToManageTournamentCallback)}var manageTournamentActionData={};function roundClicked(e,t){manageTournamentActionData.newMatchData.roundId=e,manageTournamentActionData.newMatchData.roundName=t,roundDisplay=document.getElementById("newTournamentMatchRound"),roundDisplay&&(roundDisplay.innerText=t)}function playerNameClicked(e,t){var o;manageTournamentActionData.newMatchData.hostId>0&&(!manageTournamentActionData.newMatchData.guestId||manageTournamentActionData.newMatchData.guestId<=0)?(manageTournamentActionData.newMatchData.guestId=e,manageTournamentActionData.newMatchData.guestUsername=t,o=document.getElementById("newTournamentMatchGuest")):(manageTournamentActionData.newMatchData.hostId=e,manageTournamentActionData.newMatchData.hostUsername=t,o=document.getElementById("newTournamentMatchHost"),manageTournamentActionData.newMatchData.guestId=0,manageTournamentActionData.newMatchData.guestUsername=null,document.getElementById("newTournamentMatchGuest").innerText=""),o&&(o.innerText=t)}function createNewTournamentMatch(){var e=manageTournamentActionData.newMatchData.roundId,t=currentGameData.gameTypeId,o=manageTournamentActionData.newMatchData.hostUsername,i=manageTournamentActionData.newMatchData.guestUsername,n=JSON.stringify(ggOptions);onlinePlayEngine.createTournamentRoundMatch(getLoginToken(),e,t,o,i,n,goToManageTournamentCallback)}function matchGameClicked(e){jumpToGame(e),closeModal()}function changeTournamentStatus(e,t){onlinePlayEngine.changeTournamentStatus(getLoginToken(),e,t,goToManageTournamentCallback)}var showManageTournamentCallback=function(e){var t="No tournment info found.";if(e){t="";var o={};try{o=JSON.parse(e)}catch(e){debug("Error parsing info"),closeModal(),showModal("Manage Tournament","Error getting tournament info.")}manageTournamentActionData.newMatchData={},debug(e),debug(o),t+="<div class='modalContentHeading'>"+o.name+"</div>",t+="<div>"+o.details+"</div>",t+="<br /><div>Status: "+o.status+"</div>";var i=2,n="Begin Tournament";if(2===o.statusId?(i=3,n="Complete Tournament"):3===o.statusId?(i=4,n="Cancel Tournament"):4===o.statusId&&(i=1,n="Restore Tournament to Upcoming"),t+="<div class='clickableText' onclick='changeTournamentStatus("+o.id+","+i+")'>"+n+"</div>",o.rounds&&o.rounds.length>0)for(var a=0;a<o.rounds.length;a++){var r=o.rounds[a],l=htmlEscape(r.name);t+="<br /><div class='clickableText' onclick='roundClicked("+r.id+',"'+l+"\")'>"+l+"</div>";for(var s=0;s<o.games.length;s++){var h=o.games[s];h.roundId===r.id&&(t+="<div class='clickableText' onclick='matchGameClicked("+h.gameId+")'>"+htmlEscape(h.gameType)+":"+h.hostUsername+" vs "+h.guestUsername+"</div>")}}else t+="<br /><em>No rounds</em>";if(t+="<br /><div class='modalContentHeading'>New Round</div>",t+="<div>Name:<br /><input type='text' id='newRoundName' /></div>",t+="<div class='clickableText' onclick='createNewRound("+o.id+");'>Create Round</div>",o.players&&o.players.length>1){var d=0,u="";for(a=0;a<o.players.length;a++){var p=o.players[a];p.statusId!==d&&(t+="<br /><div>&nbsp;&nbsp;"+p.status+"</div>",1===(d=p.statusId)||5===d?(u="approve",changeStatusIdTo=2):2===d?(u="eliminate",changeStatusIdTo=3):(u="disqualify",changeStatusIdTo=5)),playerUsername=htmlEscape(p.username),t+="<div><span",5!==d&&(t+=" class='clickableText' onclick=playerNameClicked("+p.userId+',"'+playerUsername+'")'),t+=">"+playerUsername+"</span>&nbsp;(<span class='clickableText' onclick='changeTournamentPlayerStatus("+o.id+',"'+playerUsername+'",'+changeStatusIdTo+")'>"+u+"</span>)</div>"}}t+="<br /><div class='modalContentHeading'>New Match</div>",t+="To create a new match, click the Round and players to apply.<br />Game will share the same type and options as the game you currently have open.",t+="<br /><em>Round:</em> <span id='newTournamentMatchRound'></span>",t+="<br /><em>Host:</em> <span id='newTournamentMatchHost'></span>",t+="<br /><em>Guest:</em> <span id='newTournamentMatchGuest'></span>",t+="<br /><em>Game:</em> "+htmlEscape(getGameTypeEntryFromId(currentGameData.gameTypeId).desc),t+="<br /><em>Options:</em> "+JSON.stringify(ggOptions),t+="<div class='clickableText' onclick='createNewTournamentMatch();'>Create Match</div>",t+="<br /><br />"}showModal("Manage Tournament",t)};function manageTournamentClicked(e){showModal("Manage Tournament",getLoadingModalText()),tournamentToManage=e,onlinePlayEngine.getManageTournamentInfo(getLoginToken(),e,showManageTournamentCallback)}var showManageTournamentsCallback=function(e){var t="No tournament info found.";if(e){t="";var o={};try{o=JSON.parse(e)}catch(e){debug("Error parsing info"),closeModal(),showModal("Manage Tournaments","Error getting tournament info.")}if(debug(o),t+="<div class='modalContentHeading'>Your Tournaments</div>",o.tournaments&&o.tournaments.length>0)for(var i=0;i<o.tournaments.length;i++){var n=o.tournaments[i];t+="<div class='clickableText' onclick='manageTournamentClicked("+n.id+");'>"+n.name+"</div>"}else t+="<em>None</em>";t+="<br /><br />",t+="<div class='clickableText' onclick='createNewTournamentClicked();'>Create new tournament</div>"}showModal("Manage Tournaments",t)};function manageTournamentsClicked(){showModal("Manage Tournaments",getLoadingModalText()),onlinePlayEngine.getManageTournamentsInfo(getLoginToken(),showManageTournamentsCallback)}var signingUpForTournamentId=0,submitTournamentSignupCallback=function(e){viewTournamentInfo(signingUpForTournamentId)};function submitTournamentSignup(e){showModal("Tournament Signup",getLoadingModalText()),signingUpForTournamentId=e,onlinePlayEngine.submitTournamentSignup(getLoginToken(),e,submitTournamentSignupCallback)}function toggleDarkMode(){var e=localStorage.getItem("data-theme")||"dark";localStorage.setItem("data-theme","dark"===e?"light":"dark"),applyDataTheme()}function applyDataTheme(){var e=localStorage.getItem("data-theme")||"dark";document.body.setAttribute("data-theme",e)}function getUserGamePrefKeyName(e){return"GameType"+gameController.getGameTypeId()+e}function getUserGamePreference(e){if(gameController&&gameController.getGameTypeId){debug(gameController.getGameTypeId());var t=getUserGamePrefKeyName(e);return localStorage.getItem(t)}debug("whops")}function setUserGamePreference(e,t){if(gameController&&gameController.getGameTypeId){var o=getUserGamePrefKeyName(e);localStorage.setItem(o,t)}}function setGameLogText(e){var t="";e&&(t=e),document.getElementById("gameLogText").innerText=t}function requestNotificationPermission(){"denied"!==Notification.permission&&Notification.requestPermission().then((function(e){"granted"===e&&debug("Notifications granted")}))}function notifyMe(){notifyThisMessage("It's your turn, bub")}function notifyThisMessage(e){if(!document.hasFocus()&&"granted"===Notification.permission)new Notification(e)}function toggleSoundOn(){soundManager.toggleSoundOn()}function SoundManager(){this.isUnlocked=!1,this.storageManager=new LocalSoundStorageManager,this.audioArray=new Array;for(var e=0;e<=12;e++)this.audioArray[e]=document.createElement("audio");this.lastIndex=0,"undefined"!=typeof webkitAudioContext?this.context=new webkitAudioContext:"undefined"!=typeof AudioContext&&(this.context=new AudioContext),this.context&&(this.regNode=this.context.createGain(),this.regNode.connect(this.context.destination),this.regNode.gain.value=.4,this.strNode=this.context.createGain(),this.strNode.connect(this.context.destination),this.strNode.gain.value=1),this.soundPath="https://skudpaisho.com/sounds/"}function SkudAIv1(){this.scoreDepth=1,this.greatScoreThreshold=new Map,this.greatScoreThreshold.set(2,9),this.greatScoreThreshold.set(1,18),this.greatScoreThreshold.set(0,16)}function BloomsActuator(e,t,o,i){this.gameContainer=e,this.isMobile=t,removeChildren(e);var n=createDivWithClass("bloomsBoard");gameOptionEnabled(SIX_SIDED_BOARD)?n.classList.add("blooms6perSide"):gameOptionEnabled(EIGHT_SIDED_BOARD)&&n.classList.add("blooms8perSide");var a=createDivWithClass("hostTilesContainer"),r=createDivWithClass("guestTilesContainer"),l=createDivWithClass("board-container");l.appendChild(n);var s=createDivWithId("response"),h=createDivWithClass("gameMessage"),d=createDivWithClass("tilePileContainer"),u=createDivWithClass("gameMessage2");o=o,i=i;a.innerHTML=o,r.innerHTML=i,d.appendChild(s),d.appendChild(h),d.appendChild(a),d.appendChild(r),d.appendChild(u),e.appendChild(l),e.appendChild(d);var p={boardContainer:n,hostTilesContainer:a,guestTilesContainer:r};this.boardContainer=p.boardContainer,this.hostTilesContainer=p.hostTilesContainer,this.guestTilesContainer=p.guestTilesContainer}function BloomsBoard(){this.edgeLength=5,gameOptionEnabled(FOUR_SIDED_BOARD)?this.edgeLength=4:gameOptionEnabled(SIX_SIDED_BOARD)?this.edgeLength=6:gameOptionEnabled(EIGHT_SIDED_BOARD)&&(this.edgeLength=8),this.scoreTracks=[],this.blooms=[],this.cells=this.brandNew()}function BloomsBoardPoint(){this.types=[],this.row=-1,this.col=-1,this.notationRowNum=-1,this.notationRowString="",this.notationColNum=-1,this.notationColString=""}function BloomsController(e,t){this.additionalTilePileClass=t?"":"desktop",this.actuator=new BloomsActuator(e,t,this.getHostTilesContainerDivs(),this.getGuestTilesContainerDivs()),this.resetGameManager(),this.resetNotationBuilder(),this.resetGameNotation()}function BloomsGameManager(e,t,o){this.isCopy=o,this.actuator=e,this.hostScore=0,this.guestScore=0,this.setup(t)}function BloomsNotationMove(e){this.fullMoveText=e,this.analyzeMove()}function BloomsNotationBuilder(){this.piece1,this.deployPoint1,this.piece2,this.deployPoint2,this.status=BRAND_NEW,this.selectedPiece}function BloomsGameNotation(){this.notationText="",this.moves=[]}function CaptureActuator(e,t){this.gameContainer=e,this.mobile=t;var o=setupPaiShoBoard(this.gameContainer,CaptureController.getHostTilesContainerDivs(),CaptureController.getGuestTilesContainerDivs(),!1);this.boardContainer=o.boardContainer,this.hostTilesContainer=o.hostTilesContainer,this.guestTilesContainer=o.guestTilesContainer}function CaptureBoard(){this.size=new RowAndColumn(17,17),this.cells=this.brandNew(),this.winners=[],this.hlPlayed=!1,this.glPlayed=!1}document.onkeyup=function(e){debug(e.which||e.keyCode),e.ctrlKey&&e.altKey&&67==(e.which||e.keyCode)?closeGame():e.ctrlKey&&e.altKey&&83==(e.which||e.keyCode)?sandboxFromMove():e.ctrlKey&&e.altKey&&82==(e.which||e.keyCode)?toggleReplayControls():e.ctrlKey&&e.altKey&&39==(e.which||e.keyCode)?playNextMove(!0):e.ctrlKey&&e.altKey&&37==(e.which||e.keyCode)?playPrevMove(!0):e.ctrlKey&&e.altKey&&191==(e.which||e.keyCode)&&playAllMoves()},window.addEventListener("touchstart",(function(){soundManager.makeNoNoise()}),!1),SoundManager.sounds={tileLand:["tileLand2","tileLand3","tileLand4","tileLand5"]},SoundManager.prototype.playFileData=function(e){this.context?this.playFileDataWebAudio(e):this.playFileDataHtml5(e)},SoundManager.prototype.playSound=function(e){if(!this.storageManager.getSoundOff()){var t=e;Array.isArray(e)&&(t=peekRandomFromArray(e));var o=this.storageManager.getSoundFile(t);if(o)this.playFileData(o);else{var i=this,n=this.soundPath+t+".txt",a=new XMLHttpRequest;a.onreadystatechange=function(){4==a.readyState&&200==a.status&&(o=a.responseText,i.playFileData(o),i.storageManager.setSoundFile(t,o))},a.open("GET",n,!0),a.send()}}},SoundManager.prototype.playFileDataWebAudio=function(e){var t=this,o=Base64Binary.decodeArrayBuffer(e);this.context.decodeAudioData(o,(function(e){var o=t.context.createBufferSource();o.buffer=e,o.connect(t.regNode),o.start(0)}),(function(e){alert("err(decodeAudioData): "+e)}))},SoundManager.prototype.playFileDataHtml5=function(e){this.lastIndex=(this.lastIndex+1)%12,this.audioArray[this.lastIndex].setAttribute("src","data:audio/mpeg;base64,"+e),this.audioArray[this.lastIndex].volume=.7,this.audioArray[this.lastIndex].play()},SoundManager.prototype.makeNoNoise=function(){if(!this.unlocked&&this.context){var e=this.context.createBuffer(1,1,22050),t=this.context.createBufferSource();t.buffer=e,t.connect(this.context.destination),t.start(0);var o=this;setTimeout((function(){t.playbackState!==t.PLAYING_STATE&&t.playbackState!==t.FINISHED_STATE||(o.isUnlocked=!0)}),0)}},SoundManager.prototype.nextMoveSoundsAreEnabled=function(){return!this.storageManager.getSoundOff()},SoundManager.prototype.prevMoveSoundsAreEnabled=function(){return!this.storageManager.getSoundOff()},SoundManager.prototype.rerunAllSoundsAreEnabled=function(){return!this.storageManager.getSoundOff()},SoundManager.prototype.toggleSoundOn=function(){this.storageManager.getSoundOff()?this.storageManager.setSoundOn():this.storageManager.setSoundOff()},SkudAIv1.prototype.getName=function(){return"Skud Pai Sho automatic opponent"},SkudAIv1.prototype.getMessage=function(){return"Playing against the computer can help you learn how the game works. You should be able to beat the computer easily once you understand the game."},SkudAIv1.prototype.setPlayer=function(e){this.player=e},SkudAIv1.prototype.getMove=function(e,t){this.moveNum=t;var o,i=this.getPossibleMoves(e,this.player),n=new Map;for(t=0;t<i.length;t++){var a=i[t],r=this.getMoveScore(e,a,this.scoreDepth);if(r.get(this.scoreDepth)>9999)return a;Math.random()>.1&&this.scoreIsGood(r,n,this.scoreDepth)&&(o=a,n=r)}if(o)return this.ensurePlant(o,e,this.player),o;var l=Math.floor(Math.random()*i.length);return i.splice(l,1)[0]},SkudAIv1.prototype.scoreIsGood=function(e,t,o){return o<=0?(debug("SCORE IS GOOD"),!0):(e.get(o)>t.get(o)||!t.get(o))&&this.scoreIsGood(e,t,o-1)},SkudAIv1.prototype.getMoveScore=function(e,t,o){debug("Depth: "+o);var i=e.getCopy();i.runNotationMove(t);var n=new Map;return n.set(o,this.calculateScore(e,i)),n>99999?n:n.get(o)>this.greatScoreThreshold.get(o)?this.getHighestScore(e,i,n,o):n},SkudAIv1.prototype.getHighestScore=function(e,t,o,i){if(i<=0)return o;for(var n=t.getCopy(),a=this.getPossibleMoves(n,this.player),r=0;r<a.length;r++){var l=this.getMoveScore(n,a[r],i-1);l.get(i-1)>o&&o.set(i-1,l.get(i-1))}return o[1]>0&&debug("highScore: "+o),o},SkudAIv1.prototype.calculateScore=function(e,t){var o=0;if(t.board.winners.includes(this.player)||e.board.winners.includes(this.player))return 9999999;var i=this.getOpponent(),n=this.getNumHarmoniesForPlayer(e,this.player),a=this.getNumHarmoniesForPlayer(t,this.player);a>n?o+=20:a<n&&(o-=20),n=this.getNumHamoniesCrossingCenter(e,this.player),(a=this.getNumHamoniesCrossingCenter(t,this.player))>n?o+=50:a<n&&(o-=20),n=this.getNumHarmoniesForPlayer(e,i);a=this.getNumHarmoniesForPlayer(t,i);a<n?o+=3:a>n&&(o-=7),n=this.getNumTilesInGardensForPlayer(e,this.player);a=this.getNumTilesInGardensForPlayer(t,this.player);a>n?o+=10:a<n&&(o-=10),n=this.getNumTilesOnBoardForPlayer(e,i);a=this.getNumTilesOnBoardForPlayer(t,i);a<n&&(o+=8);var r=this.getSurroundness(t,this.player);return r>(n=this.getSurroundness(e,this.player))&&(o+=r),r>3&&((n=this.getLongestHarmonyRingLength(e,this.player))<5?(a=this.getLongestHarmonyRingLength(t,this.player))>n?o+=5:a<n&&(o-=2):o+=5),n=this.getNumTilesOnBoardForPlayer(e,this.player),(a=this.getNumTilesOnBoardForPlayer(t,this.player))>n&&(o+=5),o},SkudAIv1.prototype.getPossibleMoves=function(e,t){var o=[];return 0===this.moveNum?this.addAccentSelectionMoves(o,e,t):(this.addPlantMoves(o,e,t),this.addArrangeMoves(o,e,t)),o},SkudAIv1.prototype.addAccentSelectionMoves=function(e,t){for(var o=this.getTilePile(t,this.player),i=[],n=0;n<o.length;n++)o[n].type===ACCENT_TILE&&i.push(o[n]);var a=[],r=4;simpleCanonRules&&(r=2);for(n=0;n<r;n++){var l=Math.floor(Math.random()*i.length),s=i.splice(l,1)[0];a.push(s.code)}var h=new SkudPaiShoNotationMove("0"+this.player.charAt(0)+"."+a.join());e.push(h)},SkudAIv1.prototype.addPlantMoves=function(e,t,o){if(this.isOpenGate(t))for(var i=this.getTilePile(t,o),n=0;n<i.length;n++){var a=i[n];if(a.type===BASIC_FLOWER){var r=2*this.moveNum;t.revealOpenGates(o,a,r,!0);for(var l=this.getPossibleMovePoints(t),s=0;s<l.length;s++){notationBuilder=new SkudPaiShoNotationBuilder,notationBuilder.moveType=PLANTING,notationBuilder.plantedFlowerType=a.code,notationBuilder.status=WAITING_FOR_ENDPOINT;var h=l[s];notationBuilder.endPoint=new NotationPoint(this.getNotation(h));var d=notationBuilder.getNotationMove(this.moveNum,o);t.hidePossibleMovePoints(!0);for(var u=!1,p=0;p<e.length;p++)e[p].equals(d)&&(u=!0);u||e.push(d)}}}},SkudAIv1.prototype.addArrangeMoves=function(e,t,o){for(var i=this.getStartPoints(t,o),n=0;n<i.length;n++){var a=i[n];t.revealPossibleMovePoints(a,!0);for(var r=this.getPossibleMovePoints(t),l=0;l<r.length;l++){notationBuilder.status=WAITING_FOR_ENDPOINT,notationBuilder.moveType=ARRANGING,notationBuilder.startPoint=new NotationPoint(this.getNotation(a));var s=r[l];notationBuilder.endPoint=new NotationPoint(this.getNotation(s));var h=notationBuilder.getNotationMove(this.moveNum,o);t.hidePossibleMovePoints(!0);for(var d=!1,u=0;u<e.length;u++)e[u].equals(h)&&(d=!0);d||e.push(h)}}},SkudAIv1.prototype.getCurrentPlayerForGame=function(e,t){if(t.moves.length<=1)return 0===t.moves.length?HOST:GUEST;if(t.moves.length<=2)return GUEST;var o=t.moves[t.moves.length-1].player;return o===HOST?GUEST:o===GUEST?HOST:void 0},SkudAIv1.prototype.getNotation=function(e){return new RowAndColumn(e.row,e.col).notationPointString},SkudAIv1.prototype.getStartPoints=function(e,t){for(var o=[],i=0;i<e.board.cells.length;i++)for(var n=0;n<e.board.cells[i].length;n++){var a=e.board.cells[i][n];!a.hasTile()||a.tile.ownerName!==t||a.tile.type===ACCENT_TILE||a.tile.drained||a.tile.trapped||o.push(e.board.cells[i][n])}return o},SkudAIv1.prototype.getPossibleMovePoints=function(e){for(var t=[],o=0;o<e.board.cells.length;o++)for(var i=0;i<e.board.cells[o].length;i++)e.board.cells[o][i].isType(POSSIBLE_MOVE)&&t.push(e.board.cells[o][i]);return t},SkudAIv1.prototype.getBasicFlowerTileCode=function(e){for(var t=this.getTilePile(e),o=0;o<t.length;o++)if(t[o].type===BASIC_FLOWER)return t[o].code},SkudAIv1.prototype.tileContainsBasicFlower=function(e){for(var t=0;t<e.length;t++)if(e[t].type===BASIC_FLOWER)return!0;return!1},SkudAIv1.prototype.getTilePile=function(e,t){var o=e.tileManager.hostTiles;return t===GUEST&&(o=e.tileManager.guestTiles),o},SkudAIv1.prototype.isOpenGate=function(e){for(var t=e.board.cells,o=0;o<t.length;o++)for(var i=0;i<t[o].length;i++)if(t[o][i].isOpenGate())return!0},SkudAIv1.prototype.getOpponent=function(){return this.player===GUEST?HOST:GUEST},SkudAIv1.prototype.getNumHarmoniesForPlayer=function(e,t){return e.board.harmonyManager.numHarmoniesForPlayer(t)},SkudAIv1.prototype.getNumTilesInGardensForPlayer=function(e,t){return e.board.numTilesInGardensForPlayer(t)},SkudAIv1.prototype.getNumTilesOnBoardForPlayer=function(e,t){return e.board.numTilesOnBoardForPlayer(t)},SkudAIv1.prototype.getSurroundness=function(e,t){return e.board.getSurroundness(t)},SkudAIv1.prototype.getLongestHarmonyRingLength=function(e,t){return e.board.harmonyManager.ringLengthForPlayer(t)},SkudAIv1.prototype.getNumHamoniesCrossingCenter=function(e,t){return e.board.harmonyManager.getNumCrossingCenterForPlayer(t)},SkudAIv1.prototype.ensurePlant=function(e,t,o){if(e.moveType===ARRANGING&&!e.bonusTileCode&&t.board.playerHasNoGrowingFlowers(this.player)){var i=[];this.addPlantMoves(i,t,o);var n=Math.floor(Math.random()*i.length),a=i.splice(n,1)[0];if(a){e.bonusTileCode=a.plantedFlowerType,t.revealOpenGates(o,null,5,!0);var r=this.getPossibleMovePoints(t);n=Math.floor(Math.random()*r.length);var l=r.splice(n,1)[0];e.bonusEndPoint="("+this.getNotation(l)+")",e.fullMoveText+="+"+e.bonusTileCode+e.bonusEndPoint}}},BloomsActuator.prototype.actuate=function(e){var t=this;window.requestAnimationFrame((function(){t.htmlify(e)}))},BloomsActuator.prototype.htmlify=function(e){removeChildren(this.boardContainer);var t=this,o=0;if(e.cells[-1]){var i=t.buildRowDiv(1);e.cells[-1].forEach((function(e){e&&t.addBoardPoint(i,e)})),t.boardContainer.appendChild(i)}e.cells.forEach((function(e){var i=t.buildRowDiv(o);o++,e.forEach((function(e){e&&t.addBoardPoint(i,e)})),t.boardContainer.appendChild(i)}))},BloomsActuator.prototype.buildRowDiv=function(e){var t=createDivWithClass("hexRow");return e%2==1&&t.classList.add("hexRowIndented"),t},BloomsActuator.prototype.addBoardPoint=function(e,t){var o=document.createElement("div");if(t.types.includes(BloomsBoardPoint.Types.normal)){var i=t.getNotationPointString();o.setAttribute("name",i),o.setAttribute("title",i)}var n=document.createElement("span");if(o.appendChild(n),this.isMobile?o.classList.add("mobile"):o.classList.add("desktop"),t.types.includes(BloomsBoardPoint.Types.nonPlayable))o.classList.add("hexagonNoShow");else{if(o.classList.add("hexagon"),t.types.includes(BloomsBoardPoint.Types.normal))if(this.isMobile)o.setAttribute("onclick","gameController.pointClicked(this,"+t.bloomId+"); showPointMessage(this);");else{o.setAttribute("onclick","pointClicked(this);"),o.setAttribute("onmouseover","showPointMessage(this); gameController.revealBloom("+t.bloomId+");");var a="clearMessage()";t.hasTile()&&(a+=";gameController.clearRevealedBloomId("+t.bloomId+")"),a+=";",o.setAttribute("onmouseout",a)}t.hasTile()&&(o.classList.add("blooms"+t.tile),t.showRevealEffect&&o.classList.add("bloomsRevealEffect"))}var r=gameController.theGame.board.scoreNeededToWin,l=gameController.theGame.hostScore,s=r-gameController.theGame.guestScore;l>r&&(l=r),s<0&&(s=0);var h=l.toString(),d=s.toString();t.types.includes(BloomsBoardPoint.Types.scoreTrack)&&(o.classList.add("hexagonScore"),h===t.scoreTrackString&&o.classList.add("hexScoreHost"),d===t.scoreTrackString&&o.classList.add("hexScoreGuest")),e.appendChild(o)},BloomsBoard.prototype.brandNew=function(){var e=[],t=2*this.edgeLength-1;gameOptionEnabled(SHORTER_GAME)||(a=(t-1-(n=this.edgeLength+1))/2+1,e[-1]=this.newRow(a,!1,n,!0));for(var o=0;o<t;o++){var i=o,n=this.edgeLength+i;i>=this.edgeLength&&(n=t-i-1+this.edgeLength);var a=(t-n)/2;i%2==1&&(a=(t-1-n)/2),a++,e[o]=this.newRow(a,!0,n)}if(!gameOptionEnabled(SHORTER_GAME)){a=(t-(n=t-(i=o)-1+this.edgeLength))/2;i%2==1&&(a=(t-1-n)/2),a++,e[o]=this.newRow(a,!0,n,!1,!0)}for(i=0;i<e.length;i++)for(var r=Math.floor(this.edgeLength/2)+1,l=this.edgeLength-r-Math.floor(i/2),s=!0,h=0;h<e[i].length;h++){if((u=e[i][h]).row=i,u.col=h,u.setNotationRow(t-i),u.setNotationCol(l+h),BloomsBoardPoint.notationPointStringMap[u.getNotationPointString()]={row:i,col:h},u.types.includes(BloomsBoardPoint.Types.scoreTrack)){var d=0;s?(s=!1,d=gameOptionEnabled(SHORTER_GAME)?t-i-1:t-i):d=gameOptionEnabled(SHORTER_GAME)?t+i:t+i+this.edgeLength+2,this.scoreNeededToWin=d,u.scoreTrackString=d.toString(),this.scoreTracks[u.scoreTrackString]=u}}d=t+1;if(!gameOptionEnabled(SHORTER_GAME)&&e[-1])for(h=0;h<e[-1].length;h++){var u;(u=e[-1][h]).types.includes(BloomsBoardPoint.Types.scoreTrack)&&(u.scoreTrackString=d.toString(),this.scoreTracks[u.scoreTrackString]=u,d++)}return e},BloomsBoard.prototype.getScoreTrackPoint=function(){var e=new BloomsBoardPoint;return e.addType(BloomsBoardPoint.Types.scoreTrack),e},BloomsBoard.prototype.newRow=function(e,t,o,i,n){var a=[],r=0,l=new BloomsBoardPoint;l.addType(BloomsBoardPoint.Types.nonPlayable),t&&e--;for(var s=0;s<e;s++)a[r]=l,r++;for(t&&(a[r]=this.getScoreTrackPoint(),r++),s=0;s<o;s++)n?a[r]=l:i?a[r]=this.getScoreTrackPoint():(a[r]=new BloomsBoardPoint,a[r].addType(BloomsBoardPoint.Types.normal)),r++;return t&&(a[r]=this.getScoreTrackPoint(),r++),a},BloomsBoard.prototype.placeTile=function(e,t){this.putTileOnPoint(e,t)},BloomsBoard.prototype.putTileOnPoint=function(e,t){var o=BloomsBoardPoint.notationPointStringMap[t];point=this.cells[o.row][o.col],point.putTile(e),this.analyzeBlooms()},BloomsBoard.prototype.analyzeBlooms=function(){this.blooms=[],this.knownBloomPoints=[];for(var e=0;e<this.cells.length;e++)for(var t=0;t<this.cells[e].length;t++){var o=this.cells[e][t];if(o.hasTile()){if(!this.knownBloomPoints.includes(o.getNotationPointString())){var i=[];i.push(o),o.bloomId=this.blooms.length,this.knownBloomPoints.push(o.getNotationPointString()),this.collectAdjacentPointsInBloom(o,i),this.blooms.push(i)}}else o.bloomId=null}debug("# of Blooms: "+this.blooms.length)},BloomsBoard.prototype.collectAdjacentPointsInBloom=function(e,t){for(var o=this.getAdjacentPoints(e),i=0;i<o.length;i++){var n=o[i];!this.knownBloomPoints.includes(n.getNotationPointString())&&n.hasTile()&&n.tile===e.tile&&(t.push(n),n.bloomId=e.bloomId,this.knownBloomPoints.push(n.getNotationPointString()),this.collectAdjacentPointsInBloom(n,t))}},BloomsBoard.prototype.getAdjacentPoints=function(e){var t=e.notationRowNum,o=e.notationColNum,i=[],n=new BloomsBoardPoint;n.setNotationRow(t+1),n.setNotationCol(o),i.push(n.getNotationPointString()),(n=new BloomsBoardPoint).setNotationRow(t+1),n.setNotationCol(o+1),i.push(n.getNotationPointString()),(n=new BloomsBoardPoint).setNotationRow(t),n.setNotationCol(o-1),i.push(n.getNotationPointString()),(n=new BloomsBoardPoint).setNotationRow(t),n.setNotationCol(o+1),i.push(n.getNotationPointString()),(n=new BloomsBoardPoint).setNotationRow(t-1),n.setNotationCol(o-1),i.push(n.getNotationPointString()),(n=new BloomsBoardPoint).setNotationRow(t-1),n.setNotationCol(o),i.push(n.getNotationPointString());for(var a=[],r=0;r<i.length;r++){var l=BloomsBoardPoint.notationPointStringMap[i[r]];l&&this.rowAndColIsValid(l)&&a.push(this.cells[l.row][l.col])}return a},BloomsBoard.prototype.rowAndColIsValid=function(e){return e.row<this.cells.length&&e.row>=0&&e.col<this.cells[e.row].length&&e.col>=0},BloomsBoard.prototype.hasEmptyAdjacentPoint=function(e){for(var t=this.getAdjacentPoints(e),o=0;o<t.length;o++){var i=t[o];if(i.types.includes(BloomsBoardPoint.Types.normal)&&!i.hasTile())return!0}return!1},BloomsBoard.prototype.captureFencedBloomsBelongingToPlayer=function(e){for(var t=[],o=0;o<this.blooms.length;o++){if((s=this.blooms[o])[0].tile.startsWith(getPlayerCodeFromName(e))){for(var i=s[0].bloomId,n=!1,a=0;a<s.length;a++){var r=s[a];if(this.hasEmptyAdjacentPoint(r)){n=!0;break}}n||(t.push(i),debug("Fenced Bloom found belonging to player: "+e))}}var l=0;for(o=0;o<t.length;o++)for(var s=this.blooms[t[o]],h=0;h<s.length;h++){(r=s[h]).tile=null,l++}return debug("Captured "+l+" tiles!"),l},BloomsBoard.prototype.clearRevealedBloom=function(){for(var e=0;e<this.cells.length;e++)for(var t=0;t<this.cells[e].length;t++){this.cells[e][t].showRevealEffect=!1}},BloomsBoard.prototype.markBloomRevealed=function(e){var t=this.blooms[e];if(t)for(var o=0;o<t.length;o++)t[o].showRevealEffect=!0},BloomsBoard.prototype.getRandomOpenPoint=function(){for(var e=[],t=0;t<this.cells.length;t++)for(var o=0;o<this.cells[t].length;o++){var i=this.cells[t][o];i.types.includes(BloomsBoardPoint.Types.normal)&&!i.hasTile()&&e.push(i)}return e[Math.floor(Math.random()*e.length)]},BloomsBoardPoint.Types={nonPlayable:"Non-Playable",scoreTrack:"Score Track",normal:"Normal"},BloomsBoardPoint.prototype.addType=function(e){this.types.includes(e)||this.types.push(e)},BloomsBoardPoint.prototype.getNotationPointString=function(){return this.notationColString+this.notationRowString},BloomsBoardPoint.prototype.setNotationRow=function(e){this.notationRowNum=e,this.notationRowString=e.toString()},BloomsBoardPoint.prototype.setNotationCol=function(e){this.notationColNum=e,this.notationColString=String.fromCharCode(96+e)},BloomsBoardPoint.prototype.putTile=function(e){this.tile=e},BloomsBoardPoint.prototype.hasTile=function(){return this.tile},BloomsBoardPoint.notationPointStringMap={},BloomsController.prototype.getGameTypeId=function(){return GameType.Blooms.id},BloomsController.prototype.completeSetup=function(){},BloomsController.prototype.resetGameManager=function(){this.theGame=new BloomsGameManager(this.actuator)},BloomsController.prototype.resetNotationBuilder=function(){this.notationBuilder=new BloomsNotationBuilder},BloomsController.prototype.resetGameNotation=function(){this.gameNotation=this.getNewGameNotation()},BloomsController.prototype.getNewGameNotation=function(){return new BloomsGameNotation},BloomsController.prototype.getHostTilesContainerDivs=function(){return"<div class='bloomsTileContainer'><div class='hexagon bloomsTilePileTile bloomsH1 "+this.additionalTilePileClass+"' name='H1' onclick='gameController.unplayedTileClicked(this)'><span></span></div><div class='hexagon bloomsTilePileTile bloomsH2 "+this.additionalTilePileClass+"' name='H2' onclick='gameController.unplayedTileClicked(this)'><span></span></div></div>"},BloomsController.prototype.getGuestTilesContainerDivs=function(){return"<div class='bloomsTileContainer'><div class='hexagon bloomsTilePileTile bloomsG1 "+this.additionalTilePileClass+"' name='G1' onclick='gameController.unplayedTileClicked(this)'><span></span></div><div class='hexagon bloomsTilePileTile bloomsG2 "+this.additionalTilePileClass+"' name='G2' onclick='gameController.unplayedTileClicked(this)'><span></span></div></div>"},BloomsController.prototype.callActuate=function(){this.theGame.actuate()},BloomsController.prototype.resetMove=function(){this.notationBuilder.piece1&&this.notationBuilder.deployPoint1||this.gameNotation.removeLastMove(),this.clearSelectedTileEffects(),this.restoreTilePileContainerDivs(),rerunAll()},BloomsController.prototype.getDefaultHelpMessageText=function(){return"<h4>Blooms</h4><p><em>A game by <a href='https://www.nickbentley.games/blooms-rules/' target='_blank'>Nick Bentley</a>.</em> Blooms is a territory game that's a bit like the classical game Go, but shorter, easier to learn, and more colorful.</p><h4>Definitions</h4><p><em><strong>Bloom:</strong></em> A <em>bloom</em> is an entire group of connected stones on the board of the same color. A single stone (unconnected to others of the same color) is also a bloom.</p><p><em><strong>Fenced:</strong></em> A bloom is <em>fenced</em> when there are no empty spaces adjacent to any of the bloom's stones.</p><h4>Gameplay</h4><ol><li>Each player owns 2 colors of stones. To start, the Host places 1 stone of either of his or her colors on any empty space.</li><li>From then on, starting with the Guest, the players take turns. On your turn, you must place 1 or 2 stones onto any empty spaces. If you place 2, they must be different colors. Then, all fenced enemy blooms are captured.</li><li>The first player to have captured the set target number of stones and advancing your score-keeping stone all the way around the scoring track, wins.</li></ol><p>Read the official rules and more about the game <a href='https://www.nickbentley.games/blooms-rules/' target='_blank'>here</a>.</p>"},BloomsController.prototype.getAdditionalMessage=function(){var e="";return 0===this.gameNotation.moves.length&&(e+="To begin a game, the Host places one stone.",e+=getGameOptionsMessageHtml(GameType.Blooms.gameOptions)),this.notationBuilder.selectedPiece&&(e+="<br />Place second stone or <span class='clickableText' onclick='gameController.skipSecondPiece();'>skip</span>",e+=getResetMoveText()),e},BloomsController.prototype.unplayedTileClicked=function(e){if(this.clearSelectedTileEffects(),this.notationBuilder.selectedPiece=null,!this.theGame.hasEnded()&&myTurn()){var t=e.getAttribute("name"),o=t.charAt(0),i=GUEST;o===hostPlayerCode&&(i=HOST),i===getCurrentPlayer()&&t!==this.notationBuilder.piece1&&(this.notationBuilder.selectedPiece=t,e.classList.add("bloomsSelectedTile"),this.selectedTilePileContainerDiv=e)}},BloomsController.prototype.pointClicked=function(e,t){var o=e.getAttribute("name");if(this.theGame.pointIsOpen(o)){if(this.actuator.isMobile&&(e.classList.add("hexagonHover"),setTimeout((function(){e.classList.remove("hexagonHover")}),400)),this.theGame.hasEnded())return;if(!myTurn())return;if(currentMoveIndex!==this.gameNotation.moves.length)return void debug("Can only interact if all moves are played.");if(!this.notationBuilder.selectedPiece)return;this.clearSelectedTileEffects();o=e.getAttribute("name");if(this.theGame.pointIsOpen(o))if(this.notationBuilder.setDeployPoint(o),e.classList.add("blooms"+this.notationBuilder.selectedPiece),this.notationBuilder.moveComplete()||0===this.gameNotation.moves.length)this.completeMove();else{this.selectedTilePileContainerDiv&&this.selectedTilePileContainerDiv.classList.add("hexagonNoShow");var i=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.theGame.runNotationMove(i,!0,!0),refreshMessage()}this.notationBuilder.selectedPiece=null}else this.actuator.isMobile&&this.revealBloom(t)},BloomsController.prototype.getTileMessage=function(e){},BloomsController.prototype.getPointMessage=function(e){},BloomsController.prototype.playAiTurn=function(e){this.theGame.getWinner()||activeAi&&this.playRandomMove()},BloomsController.prototype.startAiGame=function(e){this.playAiTurn(e)},BloomsController.prototype.getAiList=function(){return[new BloomsRandomAIv1]},BloomsController.prototype.getCurrentPlayer=function(){return this.gameNotation.moves.length%2==0?HOST:GUEST},BloomsController.prototype.cleanup=function(){},BloomsController.prototype.isSolitaire=function(){return!1},BloomsController.prototype.setGameNotation=function(e){this.gameNotation.setNotationText(e)},BloomsController.prototype.clearSelectedTileEffects=function(){for(var e=document.getElementsByClassName("bloomsTilePileTile"),t=0;t<e.length;t++)e[t].classList.remove("bloomsSelectedTile")},BloomsController.prototype.restoreTilePileContainerDivs=function(){for(var e=document.getElementsByClassName("bloomsTilePileTile"),t=0;t<e.length;t++)e[t].classList.remove("hexagonNoShow")},BloomsController.prototype.revealBloom=function(e){this.revealBloomInBoardState(e)&&this.actuateToRevealBloom()},BloomsController.prototype.revealBloomInBoardState=function(e){var t=this.revealedBloomId;this.revealedBloomId=e;var o=t!==e&&e>=0;return t>=0&&this.theGame.board.clearRevealedBloom(),e>=0&&this.theGame.board.markBloomRevealed(e),o||this.actuator.isMobile},BloomsController.prototype.actuateToRevealBloom=function(){if(this.callActuate(),this.actuator.isMobile){var e=this;setTimeout((function(){e.clearRevealedBloom()}),400)}},BloomsController.prototype.clearRevealedBloomId=function(e){e>=0&&e===this.revealedBloomId&&this.clearRevealedBloom()},BloomsController.prototype.clearRevealedBloom=function(){this.revealedBloomId=-1,this.theGame.board.clearRevealedBloom(),this.callActuate()},BloomsController.prototype.skipSecondPiece=function(){this.completeMove()},BloomsController.prototype.completeMove=function(){this.restoreTilePileContainerDivs();var e=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.theGame.runNotationMove(e),this.gameNotation.addMove(e),onlinePlayEnabled&&1===this.gameNotation.moves.length?createGameIfThatIsOk(this.getGameTypeId()):playingOnlineGame()?callSubmitMove():finalizeMove()},BloomsController.prototype.playRandomMove=function(){if(myTurn()){var e=this.getCurrentPlayer(),t=document.getElementsByName("H1")[0],o=document.getElementsByName("H2")[0];e===GUEST&&(t=document.getElementsByName("G1")[0],o=document.getElementsByName("G2")[0]),t.click();var i=this.theGame.board.getRandomOpenPoint(),n=i.getNotationPointString(),a=document.getElementsByName(n)[0];a.click(),o.click(),n=(i=this.theGame.board.getRandomOpenPoint()).getNotationPointString(),(a=document.getElementsByName(n)[0]).click()}},BloomsController.prototype.playABunchOfRandomMoves=function(e){for(var t=0;t<e;t++)this.playRandomMove()},BloomsController.prototype.optionOkToShow=function(e){return e===FOUR_SIDED_BOARD?!gameOptionEnabled(SIX_SIDED_BOARD):e!==SIX_SIDED_BOARD||!gameOptionEnabled(FOUR_SIDED_BOARD)},BloomsGameManager.prototype.setup=function(e){this.board=new BloomsBoard,e||this.actuate()},BloomsGameManager.prototype.actuate=function(){this.isCopy||this.actuator.actuate(this.board)},BloomsGameManager.prototype.runNotationMove=function(e,t,o){debug("Running Move: "+e.fullMoveText),e.piece1&&e.deployPoint1&&this.board.placeTile(e.piece1,e.deployPoint1),e.piece2&&e.deployPoint2&&this.board.placeTile(e.piece2,e.deployPoint2);var i=0;o||(i=this.board.captureFencedBloomsBelongingToPlayer(getOpponentName(e.player))),i>0&&(e.player===HOST?this.hostScore+=i:e.player===GUEST&&(this.guestScore+=i)),t&&this.actuate()},BloomsGameManager.prototype.hasEnded=function(){return this.getWinResultTypeCode()>0},BloomsGameManager.prototype.getWinner=function(){return this.hostScore>=this.board.scoreNeededToWin?HOST:this.guestScore>=this.board.scoreNeededToWin?GUEST:void 0},BloomsGameManager.prototype.getWinReason=function(){return" won the game with a score of "+(this.hostScore>this.guestScore?this.hostScore:this.guestScore)},BloomsGameManager.prototype.getWinResultTypeCode=function(){if(this.getWinner())return 1},BloomsGameManager.prototype.getCopy=function(){var e=new BloomsGameManager(this.actuator,!0,!0);return e.board=this.board.getCopy(),e},BloomsGameManager.prototype.pointIsOpen=function(e){var t=BloomsBoardPoint.notationPointStringMap[e];return t&&!this.board.cells[t.row][t.col].hasTile()&&this.board.cells[t.row][t.col].types.includes(BloomsBoardPoint.Types.normal)},BloomsNotationMove.prototype.analyzeMove=function(){this.valid=!0;var e=(o=this.fullMoveText.split("."))[0];this.moveNum=parseInt(e.slice(0,-1)),this.playerCode=e.charAt(e.length-1),"G"===this.playerCode?this.player=GUEST:"H"===this.playerCode&&(this.player=HOST);var t=o[1];if(t){var o=t.split(",");this.piece1=o[0].substring(0,2),this.deployPoint1=o[0].substring(2),o[1]&&(this.piece2=o[1].substring(0,2),this.deployPoint2=o[1].substring(2))}},BloomsNotationMove.prototype.isValidNotation=function(){return this.piece1!==this.piece2},BloomsNotationMove.prototype.equals=function(e){return this.fullMoveText===e.fullMoveText},BloomsNotationBuilder.prototype.getNotationMove=function(e,t){var o=e+t.charAt(0)+".";return this.piece1&&this.deployPoint1&&(o+=this.piece1+this.deployPoint1,this.piece2&&this.deployPoint2&&(o+=","+this.piece2+this.deployPoint2)),new BloomsNotationMove(o)},BloomsNotationBuilder.prototype.setDeployPoint=function(e){this.selectedPiece&&(this.piece1?(this.piece2=this.selectedPiece,this.deployPoint2=e):(this.piece1=this.selectedPiece,this.deployPoint1=e))},BloomsNotationBuilder.prototype.moveComplete=function(){return this.piece1&&this.deployPoint1&&this.piece2&&this.deployPoint2},BloomsGameNotation.prototype.setNotationText=function(e){this.notationText=e,this.loadMoves()},BloomsGameNotation.prototype.addNotationLine=function(e){this.notationText+=";"+e.trim(),this.loadMoves()},BloomsGameNotation.prototype.addMove=function(e){this.notationText?this.notationText+=";"+e.fullMoveText:this.notationText=e.fullMoveText,this.loadMoves()},BloomsGameNotation.prototype.removeLastMove=function(){this.notationText=this.notationText.substring(0,this.notationText.lastIndexOf(";")),this.loadMoves()},BloomsGameNotation.prototype.getPlayerMoveNum=function(){var e=0,t=this.moves[this.moves.length-1];return t&&(e=t.moveNum,t.player===GUEST&&e++),e},BloomsGameNotation.prototype.getNotationMoveFromBuilder=function(e){var t=0,o=HOST,i=this.moves[this.moves.length-1];return i&&(t=i.moveNum,i.player===GUEST?t++:o=GUEST),e.getNotationMove(t,o)},BloomsGameNotation.prototype.loadMoves=function(){this.moves=[];var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t=this,o=GUEST;e.forEach((function(e){var i=new BloomsNotationMove(e);i.isValidNotation()&&i.player!==o?(t.moves.push(i),o=i.player):debug("the player check is broken?")}))},BloomsGameNotation.prototype.getNotationHtml=function(){var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t="";return e.forEach((function(e){t+=e+"<br />"})),t},BloomsGameNotation.prototype.notationTextForUrl=function(){return this.notationText},BloomsGameNotation.prototype.getNotationForEmail=function(){var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t="";return e.forEach((function(e){t+=e+"[BR]"})),t},BloomsGameNotation.prototype.getLastMoveText=function(){return this.moves[this.moves.length-1].fullMoveText},BloomsGameNotation.prototype.getLastMoveNumber=function(){return this.moves[this.moves.length-1].moveNum},CaptureActuator.prototype.actuate=function(e,t){var o=this;window.requestAnimationFrame((function(){o.htmlify(e,t)}))},CaptureActuator.prototype.htmlify=function(e,t){this.clearContainer(this.boardContainer);var o=this;e.cells.forEach((function(e){e.forEach((function(e){e&&o.addBoardPoint(e)}))}));var i=new CaptureTileManager;i.hostTiles.forEach((function(e){o.clearTileContainer(e)})),i.guestTiles.forEach((function(e){o.clearTileContainer(e)})),t.hostTiles.forEach((function(e){o.addTile(e,this.hostTilesContainer)})),t.guestTiles.forEach((function(e){o.addTile(e,this.guestTilesContainer)}))},CaptureActuator.prototype.clearContainer=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},CaptureActuator.prototype.clearTileContainer=function(e){for(var t=document.querySelector("."+e.getImageName());t.firstChild;)t.removeChild(t.firstChild)},CaptureActuator.prototype.addTile=function(e,t){var o=document.querySelector("."+e.getImageName()),i=document.createElement("div");i.classList.add("point"),i.classList.add("hasTile"),e.selectedFromPile&&(i.classList.add("selectedFromPile"),i.classList.add("drained"));var n=document.createElement("img");n.src="capture/images/"+e.getImageName()+".png",i.appendChild(n),i.setAttribute("name",e.getImageName()),i.setAttribute("id",e.id),this.mobile?i.setAttribute("onclick","unplayedTileClicked(this); showTileMessage(this);"):(i.setAttribute("onclick","unplayedTileClicked(this);"),i.setAttribute("onmouseover","showTileMessage(this);"),i.setAttribute("onmouseout","clearMessage();")),o.appendChild(i)},CaptureActuator.prototype.addBoardPoint=function(e){var t=createBoardPointDiv(e);if(e.isType(NON_PLAYABLE)||(t.classList.add("activePoint"),e.isType(POSSIBLE_MOVE)&&t.classList.add("possibleMove"),this.mobile?t.setAttribute("ontouchstart","pointClicked(this); showPointMessage(this);"):(t.setAttribute("onclick","pointClicked(this);"),t.setAttribute("onmouseover","showPointMessage(this); gameController.showCaptureHelpOnHover(this);"),t.setAttribute("onmouseout","clearMessage();"))),e.hasTile()){t.classList.add("hasTile");var o=document.createElement("img");o.src="capture/images/"+e.tile.getImageName()+".png",e.tile.captureHelpFlag&&t.classList.add("GUESTharmony"),e.tile.capturedByHelpFlag&&t.classList.add("HOSTharmony"),t.appendChild(o)}if(this.boardContainer.appendChild(t),e.betweenHarmony&&16===e.col){var i=document.createElement("div");i.classList.add("clear"),this.boardContainer.appendChild(i)}},CaptureActuator.prototype.printBoard=function(e){debug("");var t=0;e.cells.forEach((function(e){var o=t+"\t: ";e.forEach((function(e){var t=e.getConsoleDisplay();t.length<3&&(o+=" "),o+=t,t.length<2&&(o+=" ")})),debug(o),t++})),debug("")},CaptureBoard.prototype.brandNew=function(){var e=[];e[0]=this.newRow(9,[CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.gate(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral()]),e[1]=this.newRow(11,[CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.redWhiteNeutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral()]),e[2]=this.newRow(13,[CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.whiteNeutral(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.redNeutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral()]),e[3]=this.newRow(15,[CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.whiteNeutral(),CaptureBoardPoint.white(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.red(),CaptureBoardPoint.redNeutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral()]),e[4]=this.newRow(17,[CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.whiteNeutral(),CaptureBoardPoint.white(),CaptureBoardPoint.white(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.red(),CaptureBoardPoint.red(),CaptureBoardPoint.redNeutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral()]),e[5]=this.newRow(17,[CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.whiteNeutral(),CaptureBoardPoint.white(),CaptureBoardPoint.white(),CaptureBoardPoint.white(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.red(),CaptureBoardPoint.red(),CaptureBoardPoint.red(),CaptureBoardPoint.redNeutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral()]),e[6]=this.newRow(17,[CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.whiteNeutral(),CaptureBoardPoint.white(),CaptureBoardPoint.white(),CaptureBoardPoint.white(),CaptureBoardPoint.white(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.red(),CaptureBoardPoint.red(),CaptureBoardPoint.red(),CaptureBoardPoint.red(),CaptureBoardPoint.redNeutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral()]),e[7]=this.newRow(17,[CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.whiteNeutral(),CaptureBoardPoint.white(),CaptureBoardPoint.white(),CaptureBoardPoint.white(),CaptureBoardPoint.white(),CaptureBoardPoint.white(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.red(),CaptureBoardPoint.red(),CaptureBoardPoint.red(),CaptureBoardPoint.red(),CaptureBoardPoint.red(),CaptureBoardPoint.redNeutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral()]),e[8]=this.newRow(17,[CaptureBoardPoint.gate(),CaptureBoardPoint.redWhiteNeutral(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.redWhiteNeutral(),CaptureBoardPoint.gate()]),e[9]=this.newRow(17,[CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.redNeutral(),CaptureBoardPoint.red(),CaptureBoardPoint.red(),CaptureBoardPoint.red(),CaptureBoardPoint.red(),CaptureBoardPoint.red(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.white(),CaptureBoardPoint.white(),CaptureBoardPoint.white(),CaptureBoardPoint.white(),CaptureBoardPoint.white(),CaptureBoardPoint.whiteNeutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral()]),e[10]=this.newRow(17,[CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.redNeutral(),CaptureBoardPoint.red(),CaptureBoardPoint.red(),CaptureBoardPoint.red(),CaptureBoardPoint.red(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.white(),CaptureBoardPoint.white(),CaptureBoardPoint.white(),CaptureBoardPoint.white(),CaptureBoardPoint.whiteNeutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral()]),e[11]=this.newRow(17,[CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.redNeutral(),CaptureBoardPoint.red(),CaptureBoardPoint.red(),CaptureBoardPoint.red(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.white(),CaptureBoardPoint.white(),CaptureBoardPoint.white(),CaptureBoardPoint.whiteNeutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral()]),e[12]=this.newRow(17,[CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.redNeutral(),CaptureBoardPoint.red(),CaptureBoardPoint.red(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.white(),CaptureBoardPoint.white(),CaptureBoardPoint.whiteNeutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral()]),e[13]=this.newRow(15,[CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.redNeutral(),CaptureBoardPoint.red(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.white(),CaptureBoardPoint.whiteNeutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral()]),e[14]=this.newRow(13,[CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.redNeutral(),CaptureBoardPoint.redWhite(),CaptureBoardPoint.whiteNeutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral()]),e[15]=this.newRow(11,[CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.redWhiteNeutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral()]),e[16]=this.newRow(9,[CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.gate(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral(),CaptureBoardPoint.neutral()]);for(var t=0;t<e.length;t++)for(var o=0;o<e[t].length;o++)e[t][o].row=t,e[t][o].col=o;return e},CaptureBoard.prototype.newRow=function(e,t){var o=[],i=(this.size.row-e)/2,n=new CaptureBoardPoint;n.addType(NON_PLAYABLE);for(var a=0;a<this.size.row;a++)o[a]=a<i?n:a<i+e&&t?t[a-i]:n;return o},CaptureBoard.prototype.placeTile=function(e,t,o){this.putTileOnPoint(e,t),this.setPointFlags()},CaptureBoard.prototype.putTileOnPoint=function(e,t){var o=t.rowAndColumn;(o=this.cells[o.row][o.col]).putTile(e)},CaptureBoard.prototype.getSurroundingRowAndCols=function(e){for(var t=[],o=e.row-1;o<=e.row+1;o++)for(var i=e.col-1;i<=e.col+1;i++){if((o!==e.row||i!==e.col)&&o>=0&&i>=0&&o<17&&i<17)this.cells[o][i].isType(NON_PLAYABLE)||t.push(new RowAndColumn(o,i))}return t},CaptureBoard.prototype.getAdjacentRowAndCols=function(e){var t=[];return e.row>0&&t.push(this.cells[e.row-1][e.col]),e.row<16&&t.push(this.cells[e.row+1][e.col]),e.col>0&&t.push(this.cells[e.row][e.col-1]),e.col<16&&t.push(this.cells[e.row][e.col+1]),t},CaptureBoard.prototype.pointIsOpenGate=function(e){var t=e.rowAndColumn;return(t=this.cells[t.row][t.col]).isOpenGate()},CaptureBoard.prototype.getInitialTilePlacementPoints=function(e){for(var t=[],o=0;o<12;o++){var i=-2+o,n=2;o>9?n+=2:o>4&&(n+=1),10===o?i=-1:11===o?i=1:o>4&&(i-=5),e===GUEST&&(n*=-1);var a=new NotationPoint(i+","+n);t.push(a)}return t},CaptureBoard.prototype.placeInitialTiles=function(e,t){for(var o=this.getInitialTilePlacementPoints(e),i=0;i<12;i++)this.placeTile(t[i],o[i])},CaptureBoard.prototype.moveTile=function(e,t,o){var i=t.rowAndColumn,n=o.rowAndColumn;if(i.row<0||i.row>16||n.row<0||n.row>16)return debug("That point does not exist. So it's not gonna happen."),!1;var a=this.cells[i.row][i.col],r=this.cells[n.row][n.col];if(!this.canMoveTileToPoint(e,a,r))return debug("Bad move bears"),showBadMoveModal(),!1;var l,s=a.removeTile();return s||debug("Error: No tile to move!"),r.hasTile()&&(l=r.removeTile()),r.putTile(s),this.setPointFlags(),l},CaptureBoard.prototype.setPointFlags=function(){for(var e=0;e<this.cells.length;e++)for(var t=0;t<this.cells[e].length;t++){var o=this.cells[e][t];o.hasTile()&&(o.tile.blocked=!1,o.tile.protected=!1)}},CaptureBoard.prototype.canCapture=function(e,t){var o=e.tile,i=t.tile;return o.canCapture(i)},CaptureBoard.prototype.canMoveTileToPoint=function(e,t,o){if(!t.hasTile())return!1;if(t.tile.ownerName!==e)return!1;var i=!1;if(o.hasTile()&&(i=this.canCapture(t,o)),o.hasTile()&&!i)return!1;if(this.canJump(t,o))return!0;var n=t.tile.getMoveDistance();return!(Math.abs(t.row-o.row)+Math.abs(t.col-o.col)>2*n)&&!!this.verifyAbleToReach(t,o,n)},CaptureBoard.prototype.pointsHaveFriendlyTiles=function(e,t){return e.hasTile()&&t.hasTile()&&e.tile.ownerCode===t.tile.ownerCode},CaptureBoard.prototype.canJump=function(e,t){var o=e.row,i=t.row,n=e.col,a=t.col;if(n===a&&2===Math.abs(o-i)||o===i&&2===Math.abs(n-a)||1===Math.abs(e.row-t.row)&&1===Math.abs(e.col-t.col)){if(i>o){if(this.pointsHaveFriendlyTiles(e,this.cells[o+1][n]))return!0}else if(i<o&&this.pointsHaveFriendlyTiles(e,this.cells[o-1][n]))return!0;if(a>n){if(this.pointsHaveFriendlyTiles(e,this.cells[o][n+1]))return!0}else if(a<n&&this.pointsHaveFriendlyTiles(e,this.cells[o][n-1]))return!0}else if(2===Math.abs(e.row-t.row)&&2===Math.abs(e.col-t.col))if(i>o&&a>n&&this.onUpLeftDiagonal(e)){if(this.pointsHaveFriendlyTiles(e,this.cells[o+1][n+1]))return!0}else if(i<o&&a>n&&this.onUpRightDiagonal(e)){if(this.pointsHaveFriendlyTiles(e,this.cells[o-1][n+1]))return!0}else if(i>o&&a<n&&this.onUpRightDiagonal(e)){if(this.pointsHaveFriendlyTiles(e,this.cells[o+1][n-1]))return!0}else if(i<o&&a<n&&this.onUpLeftDiagonal(e)&&this.pointsHaveFriendlyTiles(e,this.cells[o-1][n-1]))return!0;return!1},CaptureBoard.prototype.verifyAbleToReach=function(e,t,o){return this.pathFound(e,t,o)},CaptureBoard.prototype.pathFound=function(e,t,o){if(!e||!t)return!1;if(e.isType(NON_PLAYABLE)||t.isType(NON_PLAYABLE))return!1;if(e.row===t.row&&e.col===t.col)return!0;if(o<=0)return!1;var i=Math.abs(e.row-t.row)+Math.abs(e.col-t.col);if(1===i)return!0;if(2===i&&this.diagonallyAdjacent(e,t))return!0;var n=e.row-1;if(this.ableToReachCheck(n,e.col,t,o))return!0;if(n=e.row+1,this.ableToReachCheck(n,e.col,t,o))return!0;var a=e.col-1;if(this.ableToReachCheck(e.row,a,t,o))return!0;if(a=e.col+1,this.ableToReachCheck(e.row,a,t,o))return!0;if(this.onUpRightDiagonal(e)){if(n=e.row-1,a=e.col+1,this.ableToReachCheck(n,a,t,o))return!0;if(n=e.row+1,a=e.col-1,this.ableToReachCheck(n,a,t,o))return!0}if(this.onUpLeftDiagonal(e)){if(n=e.row-1,a=e.col-1,this.ableToReachCheck(n,a,t,o))return!0;if(n=e.row+1,a=e.col+1,this.ableToReachCheck(n,a,t,o))return!0}},CaptureBoard.prototype.ableToReachCheck=function(e,t,o,i){if(t>=0&&t<17&&e>=0&&e<17){var n=this.cells[e][t];if(!n.hasTile()&&this.pathFound(n,o,i-1))return!0}return!1},CaptureBoard.prototype.onUpRightDiagonal=function(e){var t=new RowAndColumn(e.row,e.col).getNotationPoint(),o=t.x,i=t.y;return o-i==7||o-i==-7},CaptureBoard.prototype.onUpLeftDiagonal=function(e){var t=new RowAndColumn(e.row,e.col).getNotationPoint(),o=t.x,i=t.y;return o+i===7||o+i===-7},CaptureBoard.prototype.diagonallyAdjacent=function(e,t){return this.onUpRightDiagonal(e)&&this.onUpRightDiagonal(t)||this.onUpLeftDiagonal(e)&&this.onUpLeftDiagonal(t)},CaptureBoard.prototype.setPossibleMovePoints=function(e){if(e.hasTile())for(var t=e.tile.ownerName,o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++)this.canMoveTileToPoint(t,e,this.cells[o][i])&&this.cells[o][i].addType(POSSIBLE_MOVE)},CaptureBoard.prototype.removePossibleMovePoints=function(){this.cells.forEach((function(e){e.forEach((function(e){e.removeType(POSSIBLE_MOVE)}))}))},CaptureBoard.prototype.getFireLilyPoint=function(e){for(var t=0;t<this.cells.length;t++)for(var o=0;o<this.cells[t].length;o++){var i=this.cells[t][o];if(i.hasTile()&&i.tile.ownerName===e&&"F"===i.tile.code)return i}},CaptureBoard.prototype.setDeployPointsPossibleMoves=function(e,t){if("D"!==t)for(i=0;i<this.cells.length;i++)for(n=0;n<this.cells[i].length;n++){(a=this.cells[i][n]).hasTile()||("S"===t?a.isType(GATE)&&a.addType(POSSIBLE_MOVE):a.isType(GATE)||a.addType(POSSIBLE_MOVE))}else{var o=this.getFireLilyPoint(e);if(!o)return void debug("No Fire Lily");for(var i=0;i<this.cells.length;i++)for(var n=0;n<this.cells[i].length;n++){var a;(a=this.cells[i][n]).hasTile()||Math.abs(o.row-a.row)+Math.abs(o.col-a.col)<=5&&a.addType(POSSIBLE_MOVE)}}},CaptureBoard.prototype.setGuestGateOpen=function(){this.cells[16][8].isOpenGate()&&this.cells[16][8].addType(POSSIBLE_MOVE)},CaptureBoard.prototype.revealPossiblePlacementPoints=function(e){var t=this;this.cells.forEach((function(o){o.forEach((function(o){var i=!1;(e.accentType===ROCK&&t.canPlaceRock(o)||e.accentType===WHEEL&&t.canPlaceWheel(o)||e.accentType===KNOTWEED&&t.canPlaceKnotweed(o)||e.accentType===BOAT&&t.canPlaceBoat(o,e))&&(i=!0),i&&o.addType(POSSIBLE_MOVE)}))}))},CaptureBoard.prototype.getPlayerTilesOnBoard=function(e){var t=[];return this.cells.forEach((function(o){o.forEach((function(o){o.hasTile()&&o.tile.ownerName===e&&t.push(o.tile)}))})),t},CaptureBoard.prototype.playerCanStillCapture=function(e,t){var o=!1;return e.forEach((function(e){t.forEach((function(t){e.canCapture(t)&&(o=!0)}))})),o},CaptureBoard.prototype.getTilesPlayerCanCapture=function(e,t){var o=[];return e.forEach((function(e){t.forEach((function(t){!o.includes(t)&&e.canCapture(t)&&o.push(t)}))})),o},CaptureBoard.prototype.checkForEndOfGame=function(){if(!(this.winners.length>0)){var e=this.getPlayerTilesOnBoard(HOST),t=this.getPlayerTilesOnBoard(GUEST);if(0===e.length)this.winners.push(GUEST);else if(0===t.length)this.winners.push(HOST);else{var o=!this.playerCanStillCapture(e,t),i=!this.playerCanStillCapture(t,e);if(o&&i)e.length>=t.length&&this.winners.push(HOST),t.length>=e.length&&this.winners.push(GUEST);else{var n=this.getTilesPlayerCanCapture(e,t),a=this.getTilesPlayerCanCapture(t,e),r=e.length-a.length,l=t.length-n.length;r>t.length&&this.winners.push(HOST),l>e.length&&this.winners.push(GUEST)}}}},CaptureBoard.prototype.flagPointsTileCanCapture=function(e){var t=[];return this.cells.forEach((function(o){o.forEach((function(o){o.hasTile()&&e.canCapture(o.tile)&&!o.tile.captureHelpFlag&&(o.tile.captureHelpFlag=!0,t.push(o.tile.id))}))})),t},CaptureBoard.prototype.flagPointsTileCapturedBy=function(e){var t=[];return this.cells.forEach((function(o){o.forEach((function(o){o.hasTile()&&o.tile.canCapture(e)&&!o.tile.capturedByHelpFlag&&(o.tile.capturedByHelpFlag=!0,t.push(o.tile.id))}))})),t},CaptureBoard.prototype.clearCaptureHelp=function(){var e=[],t=[];return this.cells.forEach((function(o){o.forEach((function(o){o.hasTile()&&o.tile.captureHelpFlag&&(o.tile.captureHelpFlag=!1,e.push(o.tile.id)),o.hasTile()&&o.tile.capturedByHelpFlag&&(o.tile.capturedByHelpFlag=!1,t.push(o.tile.id))}))})),{unflaggedCaptureTiles:e,unflaggedCapturedByTiles:t}};var NON_PLAYABLE="Non-Playable",NEUTRAL="Neutral",RED="Red",WHITE="White",GATE="Gate",POSSIBLE_MOVE="Possible Move",OPEN_GATE="OPEN GATE",thinDot="·",thickDot="•",whiteDot="◦",gateDot="⟡";function CaptureBoardPoint(){this.types=[],this.row=-1,this.col=-1}function CaptureController(e,t){this.actuator=new CaptureActuator(e,t),this.resetGameManager(),this.resetNotationBuilder(),this.resetGameNotation(),this.hostAccentTiles=[],this.guestAccentTiles=[],this.isPaiShoGame=!0}function CaptureGameManager(e,t,o){this.isCopy=o,this.actuator=e,this.tileManager=new CaptureTileManager,this.setup(t)}function CaptureNotationMove(e){this.fullMoveText=e,this.analyzeMove()}function CaptureNotationBuilder(){this.moveType,this.tileType,this.endPoint,this.startPoint,this.status=BRAND_NEW}function CaptureGameNotation(){this.notationText="",this.moves=[]}function CaptureTile(e,t){this.code=e,this.ownerCode=t,"G"===this.ownerCode?this.ownerName=GUEST:"H"===this.ownerCode?this.ownerName=HOST:debug("INCORRECT OWNER CODE"),this.id=tileId++,this.selectedFromPile=!1}function CaptureTileManager(){this.hostTiles=this.loadTileSet("H"),this.guestTiles=this.loadTileSet("G")}function CoopSolitaireActuator(e,t){this.gameContainer=e,this.mobile=t;var o=setupPaiShoBoard(this.gameContainer,CoopSolitaireController.getHostTilesContainerDivs(),CoopSolitaireController.getGuestTilesContainerDivs(),!1);this.boardContainer=o.boardContainer,this.hostTilesContainer=o.hostTilesContainer,this.guestTilesContainer=o.guestTilesContainer}function CoopSolitaireBoard(){this.size=new RowAndColumn(17,17),this.cells=this.brandNew(),this.harmonyManager=new CoopSolitaireHarmonyManager,this.rockRowAndCols=[],this.playedWhiteLotusTiles=[],this.winners=[]}function CoopSolitaireBoardPoint(){this.types=[],this.row=-1,this.col=-1}function CoopSolitaireController(e,t){this.actuator=new CoopSolitaireActuator(e,t),this.showGameMessageUnderneath=!0,this.resetGameNotation(),this.resetGameManager(),this.resetNotationBuilder(),this.drawnTile=null,this.lastDrawnTile=null,this.drawRandomTile(),this.isPaiShoGame=!0}function CoopSolitaireGameManager(e,t,o){this.isCopy=o,this.actuator=e,this.tileManager=new CoopSolitaireTileManager,this.setup(t),this.endGameWinners=[]}function CoopSolitaireNotationMove(e){this.fullMoveText=e,this.analyzeMove()}function CoopSolitaireNotationBuilder(){this.moveType,this.plantedFlowerType,this.endPoint,this.startPoint,this.bonusTileCode,this.bonusEndPoint,this.boatBonusPoint,this.status=BRAND_NEW}function CoopSolitaireGameNotation(){this.notationText="",this.moves=[]}function CoopSolitaireHarmony(e,t,o,i){this.tile1=e,this.tile1Pos=t,this.tile2=o,this.tile2Pos=i,this.tile1.type!==ACCENT_TILE?(this.ownerCode=this.tile1.ownerCode,this.ownerName=this.tile1.ownerName):this.tile2.type!==ACCENT_TILE?(this.ownerCode=this.tile2.ownerCode,this.ownerName=this.tile2.ownerName):debug("ERROR: HARMONY REQUIRES A BASIC FLOWER TILE")}function CoopSolitaireHarmonyManager(){this.harmonies=[],this.clashes=[]}function CoopSolitaireTile(e,t){this.code=e,this.ownerCode=t,"G"===this.ownerCode?(this.ownerName=GUEST,this.opponentName=HOST):"H"===this.ownerCode?(this.ownerName=HOST,this.opponentName=GUEST):debug("INCORRECT OWNER CODE"),this.id=tileId++,this.drained=!1,this.selectedFromPile=!1,2===this.code.length&&(this.code.includes("R")||this.code.includes("W"))?(this.type=BASIC_FLOWER,this.basicColorCode=this.code.charAt(0),this.basicValue=this.code.charAt(1),"R"===this.basicColorCode?this.basicColorName=RED:"W"===this.basicColorCode&&(this.basicColorName=WHITE)):"L"===this.code||"O"===this.code?(this.type=SPECIAL_FLOWER,this.setSpecialFlowerInfo()):"R"===this.code||"W"===this.code||"K"===this.code||"B"===this.code?(this.type=ACCENT_TILE,this.setAccentInfo()):debug("Error: Unknown tile type")}function CoopSolitaireTileManager(e){this.playerCode="H",this.tiles=e?this.loadOneOfEach(this.playerCode):this.loadTileSet(this.playerCode)}function HexentaflActuator(e,t,o,i){this.gameContainer=e,this.isMobile=t,removeChildren(e);var n=createDivWithClass("hexentaflBoard");gameOptionEnabled(FIVE_SIDED_BOARD)&&n.classList.add("hexentafl5perSide");var a=createDivWithClass("hexentaflBoardRotate");n.appendChild(a);var r=createDivWithClass("hostTilesContainer"),l=createDivWithClass("guestTilesContainer"),s=createDivWithClass("board-container");s.appendChild(n);var h=createDivWithId("response"),d=createDivWithClass("gameMessage"),u=createDivWithClass("tilePileContainer"),p=createDivWithClass("gameMessage2");o=o,i=i;r.innerHTML=o,l.innerHTML=i,u.appendChild(h),u.appendChild(d),u.appendChild(r),u.appendChild(l),u.appendChild(p),e.appendChild(s),e.appendChild(u);var c={boardContainer:a,hostTilesContainer:r,guestTilesContainer:l};this.boardContainer=c.boardContainer,this.hostTilesContainer=c.hostTilesContainer,this.guestTilesContainer=c.guestTilesContainer}CaptureBoardPoint.prototype.addType=function(e){this.types.includes(e)||this.types.push(e)},CaptureBoardPoint.prototype.removeType=function(e){for(var t=0;t<this.types.length;t++)this.types[t]===e&&this.types.splice(t,1)},CaptureBoardPoint.prototype.putTile=function(e){this.tile=e},CaptureBoardPoint.prototype.hasTile=function(){return!!this.tile},CaptureBoardPoint.prototype.isType=function(e){return this.types.includes(e)},CaptureBoardPoint.prototype.isOpenGate=function(){return!this.hasTile()&&this.types.includes(GATE)},CaptureBoardPoint.prototype.removeTile=function(){var e=this.tile;return this.tile=null,e},CaptureBoardPoint.prototype.drainTile=function(){this.tile&&this.tile.drain()},CaptureBoardPoint.prototype.restoreTile=function(){this.tile&&this.tile.restore()},CaptureBoardPoint.prototype.canHoldTile=function(e,t){return!this.isType(NON_PLAYABLE)&&(!(!t&&this.hasTile())&&(e.type===BASIC_FLOWER?!(!this.isType(NEUTRAL)&&!this.isType(e.basicColorName))&&!this.isType(GATE):e.type===SPECIAL_FLOWER||e.type===ACCENT_TILE))},CaptureBoardPoint.prototype.betweenPlayerHarmony=function(e){return e===GUEST?this.betweenHarmonyGuest:e===HOST&&this.betweenHarmonyHost},CaptureBoardPoint.prototype.getCopy=function(){for(var e=new BoardPoint,t=0;t<this.types.length;t++)e.types.push(this.types[t]);return e.row=this.row,e.col=this.col,this.hasTile()&&(e.tile=this.tile.getCopy()),e},CaptureBoardPoint.neutral=function(){var e=new CaptureBoardPoint;return e.addType(NEUTRAL),e},CaptureBoardPoint.gate=function(){var e=new CaptureBoardPoint;return e.addType(GATE),e},CaptureBoardPoint.red=function(){var e=new CaptureBoardPoint;return e.addType(RED),e},CaptureBoardPoint.white=function(){var e=new CaptureBoardPoint;return e.addType(WHITE),e},CaptureBoardPoint.redWhite=function(){var e=new CaptureBoardPoint;return e.addType(RED),e.addType(WHITE),e},CaptureBoardPoint.redWhiteNeutral=function(){var e=new CaptureBoardPoint;return e.addType(RED),e.addType(WHITE),e.addType(NEUTRAL),e},CaptureBoardPoint.redNeutral=function(){var e=new CaptureBoardPoint;return e.addType(RED),e.addType(NEUTRAL),e},CaptureBoardPoint.whiteNeutral=function(){var e=new CaptureBoardPoint;return e.addType(WHITE),e.addType(NEUTRAL),e},CaptureController.prototype.completeSetup=function(){this.addSetupForPlayerCode("H"),this.addSetupForPlayerCode("G"),rerunAll(),this.callActuate()},CaptureController.prototype.addSetupForPlayerCode=function(e){var t=this.theGame.tileManager.loadTileSet(e);shuffleArray(t);var o="0"+e+".";t.forEach((function(e){o+=e.code})),debug(o);var i=new CaptureNotationMove(o);this.theGame.runNotationMove(i),this.gameNotation.addMove(i)},CaptureController.prototype.resetGameManager=function(){this.theGame=new CaptureGameManager(this.actuator)},CaptureController.prototype.resetNotationBuilder=function(){this.notationBuilder=new CaptureNotationBuilder},CaptureController.prototype.resetGameNotation=function(){this.gameNotation=this.getNewGameNotation()},CaptureController.prototype.getNewGameNotation=function(){return new CaptureGameNotation},CaptureController.getHostTilesContainerDivs=function(){return'<div class="HA"></div> <div class="HV"></div> <div class="HB"></div> <div class="HP"></div> <div class="HF"></div> <div class="HU"></div> <br class="clear" /> <div class="HK"></div> <div class="HL"></div> <div class="HD"></div> <div class="HM"></div> <div class="HT"></div> <div class="HO"></div>'},CaptureController.getGuestTilesContainerDivs=function(){return'<div class="GA"></div> <div class="GV"></div> <div class="GB"></div> <div class="GP"></div> <div class="GF"></div> <div class="GU"></div> <br class="clear" /> <div class="GK"></div> <div class="GL"></div> <div class="GD"></div> <div class="GM"></div> <div class="GT"></div> <div class="GO"></div>'},CaptureController.prototype.callActuate=function(){this.theGame.actuate()},CaptureController.prototype.resetMove=function(){this.notationBuilder.status===BRAND_NEW&&this.gameNotation.removeLastMove(),rerunAll()},CaptureController.prototype.getDefaultHelpMessageText=function(){return"<h4>Capture Pai Sho</h4>"+this.getCommonHelpMessageChunk()},CaptureController.prototype.endGameNow=function(){onlinePlayEngine.updateGameWinInfoAsTie(gameId,gameController.theGame.getWinResultTypeCode(),getLoginToken())},CaptureController.prototype.getAdditionalMessage=function(){var e="";return 0===this.gameNotation.moves.length&&(onlinePlayEnabled&&gameId<0&&userIsLoggedIn()?e+="<strong>Real-time gameplay is enabled!</strong> Click <em>Join Game</em> above to join another player's game. Or, you can start a game that other players can join by making a move. <br />":e+="Sign in to enable real-time gameplay. Or, start playing a local game by making a move."),e},CaptureController.prototype.unplayedTileClicked=function(e){},CaptureController.prototype.clearCaptureHelpAndActuateIfNeeded=function(){var e=this.clearCaptureHelp();(e.unflaggedCaptureTiles.length>0||e.unflaggedCapturedByTiles.length>0)&&this.callActuate()},CaptureController.prototype.pointClicked=function(e){if(this.clearCaptureHelpAndActuateIfNeeded(),!(this.theGame.board.winners.length>0))if(currentMoveIndex===this.gameNotation.moves.length){var t=new NotationPoint(e.getAttribute("name")).rowAndColumn,o=this.theGame.board.cells[t.row][t.col];if(this.notationBuilder.status===BRAND_NEW)if(o.hasTile()){if(this.flagCaptureHelp(o),this.flagCapturedByHelp(o),o.tile.ownerName!==getCurrentPlayer()||!myTurn())return debug("That's not your tile!"),void this.callActuate();this.notationBuilder.status=WAITING_FOR_ENDPOINT,this.notationBuilder.moveType=MOVE,this.notationBuilder.startPoint=new NotationPoint(e.getAttribute("name")),this.theGame.revealPossibleMovePoints(o)}else this.clearCaptureHelpAndActuateIfNeeded();else if(this.notationBuilder.status===WAITING_FOR_ENDPOINT)if(o.isType(POSSIBLE_MOVE)){this.theGame.hidePossibleMovePoints(),this.notationBuilder.endPoint=new NotationPoint(e.getAttribute("name"));var i=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.theGame.runNotationMove(i),this.gameNotation.addMove(i),onlinePlayEnabled&&3===this.gameNotation.moves.length?createGameIfThatIsOk(GameType.CapturePaiSho.id):playingOnlineGame()?callSubmitMove():finalizeMove()}else this.theGame.hidePossibleMovePoints(),this.resetNotationBuilder()}else debug("Can only interact if all moves are played.")},CaptureController.prototype.getCommonHelpMessageChunk=function(){return this.getCaptureCycleImageTag()+"<p>Each tile captures the next three tiles in the Capture Cycle (going clockwise). <a href='https://skudpaisho.com/site/games/capture-pai-sho/' target='_blank'>View the rules</a> to learn about how tiles move and jump on the board and more.</p><p><em>Capture Pai Sho is created and designed by <a href='https://redallure.deviantart.com/art/What-you-get-502701647' target='_blank'>Tom Ford</a>.</em></p>"},CaptureController.prototype.getCaptureCycleImageTag=function(){return"<img src='capture/images/CaptureCycle.png' style='width:100%;' />"},CaptureController.prototype.getTheMessage=function(e,t){var o=[],i=e.code,n=t+"'s "+CaptureTile.getTileName(i);return o.push(this.getCommonHelpMessageChunk()),{heading:n,message:o}},CaptureController.prototype.getTileMessage=function(e){var t=e.getAttribute("name"),o=(parseInt(e.getAttribute("id")),new CaptureTile(t.substring(1),t.charAt(0))),i=HOST;return t.startsWith("G")&&(i=GUEST),this.getTheMessage(o,i)},CaptureController.prototype.getPointMessage=function(e){var t=new NotationPoint(e.getAttribute("name")).rowAndColumn,o=this.theGame.board.cells[t.row][t.col];return o.hasTile()?this.getTheMessage(o.tile,o.tile.ownerName):null},CaptureController.prototype.playAiTurn=function(e){},CaptureController.prototype.startAiGame=function(e){},CaptureController.prototype.getAiList=function(){return[]},CaptureController.prototype.getCurrentPlayer=function(){return this.gameNotation.moves.length%2==0?HOST:GUEST},CaptureController.prototype.cleanup=function(){},CaptureController.prototype.isSolitaire=function(){return!1},CaptureController.prototype.setGameNotation=function(e){this.gameNotation.setNotationText(e)},CaptureController.prototype.flagCaptureHelp=function(e){if(e.hasTile()){var t=e.tile;return this.theGame.board.flagPointsTileCanCapture(t)}return[]},CaptureController.prototype.flagCapturedByHelp=function(e){if(e.hasTile()){var t=e.tile;return this.theGame.board.flagPointsTileCapturedBy(t)}return[]},CaptureController.prototype.clearCaptureHelp=function(){return this.theGame.board.clearCaptureHelp()},CaptureController.prototype.showCaptureHelpOnHover=function(e){if(this.notationBuilder.status===BRAND_NEW){var t=this.clearCaptureHelp(),o=new NotationPoint(e.getAttribute("name")).rowAndColumn,i=this.theGame.board.cells[o.row][o.col],n=[],a=[];i.hasTile()&&(n=this.flagCaptureHelp(i),a=this.flagCapturedByHelp(i)),0===t.unflaggedCaptureTiles.length&&0===t.unflaggedCapturedByTiles.length&&0===n.length&&0===a.length||t.unflaggedCaptureTiles.equals(n)&&t.unflaggedCapturedByTiles.equals(a)||this.callActuate()}},CaptureGameManager.prototype.setup=function(e){this.board=new CaptureBoard,e||this.actuate()},CaptureGameManager.prototype.actuate=function(){this.isCopy||this.actuator.actuate(this.board,this.tileManager)},CaptureGameManager.prototype.drawRandomTile=function(){return this.tileManager.drawRandomTile()},CaptureGameManager.prototype.runNotationMove=function(e,t){if(debug("Running Move: "+e.fullMoveText),e.moveType===MOVE){var o=this.board.moveTile(e.player,e.startPoint,e.endPoint);o&&(this.tileManager.putTileBack(o),this.board.checkForEndOfGame())}else if(INITIAL_SETUP){var i=[],n=this;e.initialTileCodeList.forEach((function(t){var o=n.tileManager.grabTile(e.player,t);i.push(o)})),this.board.placeInitialTiles(e.player,i)}t&&this.actuate()},CaptureGameManager.prototype.revealPossibleMovePoints=function(e,t){e.hasTile()&&(this.board.setPossibleMovePoints(e),t||this.actuate())},CaptureGameManager.prototype.hidePossibleMovePoints=function(e){this.board.removePossibleMovePoints(),this.tileManager.removeSelectedTileFlags(),e||this.actuate()},CaptureGameManager.prototype.revealDeployPoints=function(e,t,o){this.board.setDeployPointsPossibleMoves(e,t),o||this.actuate()},CaptureGameManager.prototype.revealPossiblePlacementPoints=function(e){this.board.revealPossiblePlacementPoints(e),this.actuate()},CaptureGameManager.prototype.getWinner=function(){return 1===this.board.winners.length?this.board.winners[0]:this.board.winners.length>1?"BOTH players":void 0},CaptureGameManager.prototype.getWinReason=function(){return" has more tiles remaining and won the game!"},CaptureGameManager.prototype.getWinResultTypeCode=function(){return 1===this.board.winners.length?7:4},CaptureGameManager.prototype.getCopy=function(){var e=new CaptureGameManager(this.actuator,!0,!0);return e.board=this.board.getCopy(),e.tileManager=this.tileManager.getCopy(),e},CaptureNotationMove.prototype.analyzeMove=function(){this.valid=!0;var e=(n=this.fullMoveText.split("."))[0];this.moveNum=parseInt(e.slice(0,-1)),this.playerCode=e.charAt(e.length-1),"G"===this.playerCode?this.player=GUEST:"H"===this.playerCode&&(this.player=HOST);var t=n[1];if(t){var o=t.charAt(0);if(this.moveType="("===o?MOVE:INITIAL_SETUP,this.moveType===INITIAL_SETUP){12!==t.length&&(this.valid=!1),this.initialTileCodeList=[];for(var i=0;i<12;i++)this.initialTileCodeList.push(t.charAt(i))}else if(this.moveType===MOVE){var n=t.substring(t.indexOf("(")+1).split(")-(");this.startPoint=new NotationPoint(n[0]),this.endPoint=new NotationPoint(n[1].substring(0,n[1].indexOf(")")))}}},CaptureNotationMove.prototype.isValidNotation=function(){return this.valid},CaptureNotationMove.prototype.equals=function(e){return this.fullMoveText===e.fullMoveText},CaptureNotationBuilder.prototype.getNotationMove=function(e,t){var o=e+t.charAt(0)+".";return this.moveType===MOVE?o+="("+this.startPoint.pointText+")-("+this.endPoint.pointText+")":this.moveType===DEPLOY&&(o+=this.tileType+"("+this.endPoint.pointText+")"),new CaptureNotationMove(o)},CaptureGameNotation.prototype.setNotationText=function(e){this.notationText=e,this.loadMoves()},CaptureGameNotation.prototype.addNotationLine=function(e){this.notationText+=";"+e.trim(),this.loadMoves()},CaptureGameNotation.prototype.addMove=function(e){this.notationText?this.notationText+=";"+e.fullMoveText:this.notationText=e.fullMoveText,this.loadMoves()},CaptureGameNotation.prototype.removeLastMove=function(){this.notationText=this.notationText.substring(0,this.notationText.lastIndexOf(";")),this.loadMoves()},CaptureGameNotation.prototype.getPlayerMoveNum=function(){var e=0,t=this.moves[this.moves.length-1];return t&&(e=t.moveNum,t.player===GUEST&&e++),e},CaptureGameNotation.prototype.getNotationMoveFromBuilder=function(e){var t=0,o=HOST,i=this.moves[this.moves.length-1];return i&&(t=i.moveNum,i.player===GUEST?t++:o=GUEST),e.getNotationMove(t,o)},CaptureGameNotation.prototype.loadMoves=function(){this.moves=[];var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t=this,o=GUEST;e.forEach((function(e){var i=new CaptureNotationMove(e);i.isValidNotation()&&i.player!==o?(t.moves.push(i),o=i.player):debug("the player check is broken?")}))},CaptureGameNotation.prototype.getNotationHtml=function(){var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t="";return e.forEach((function(e){t+=e+"<br />"})),t},CaptureGameNotation.prototype.notationTextForUrl=function(){return this.notationText},CaptureGameNotation.prototype.getNotationForEmail=function(){var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t="";return e.forEach((function(e){t+=e+"[BR]"})),t},CaptureGameNotation.prototype.getLastMoveText=function(){return this.moves[this.moves.length-1].fullMoveText},CaptureGameNotation.prototype.getLastMoveNumber=function(){return this.moves[this.moves.length-1].moveNum},CaptureTile.prototype.getImageName=function(){return this.ownerCode+""+this.code},CaptureTile.prototype.getMoveDistance=function(){return 3},CaptureTile.prototype.getName=function(){return CaptureTile.getTileName(this.code)},CaptureTile.prototype.canCapture=function(e){if(e.ownerCode!==this.ownerCode){var t=["A","V","B","P","F","U","K","L","D","M","T","O"],o=t.indexOf(this.code),i=t.indexOf(e.code);return o>i&&(i+=t.length),i!==o&&i-o<=3}return!1},CaptureTile.prototype.getCopy=function(){return new CaptureTile(this.code,this.ownerCode)},CaptureTile.getTileName=function(e){var t="";return"A"===e?t="Dai Li Agent":"V"===e?t="Vaatu":"B"===e?t="Flying Boar":"P"===e?t="Piandao":"F"===e?t="Spirit Oasis Fish":"U"===e?t="Unagi":"K"===e?t="Kyoshi Warrior":"L"===e?t="Lotus":"D"===e?t="Dragon":"M"===e?t="Air Monk":"T"===e?t="Tree of Time":"O"===e&&(t="Owl Spirit"),t},CaptureTileManager.prototype.loadTileSet=function(e){var t=[];return t.push(new CaptureTile("A",e)),t.push(new CaptureTile("V",e)),t.push(new CaptureTile("B",e)),t.push(new CaptureTile("P",e)),t.push(new CaptureTile("F",e)),t.push(new CaptureTile("U",e)),t.push(new CaptureTile("K",e)),t.push(new CaptureTile("L",e)),t.push(new CaptureTile("D",e)),t.push(new CaptureTile("M",e)),t.push(new CaptureTile("T",e)),t.push(new CaptureTile("O",e)),t},CaptureTileManager.prototype.drawRandomTile=function(){if(this.tiles.length>0){var e=this.tiles[Math.floor(Math.random()*this.tiles.length)];return this.peekTile(this.playerCode,e.code)}},CaptureTileManager.prototype.grabTile=function(e,t){var o,i=this.hostTiles;e===GUEST&&(i=this.guestTiles);for(var n=0;n<i.length;n++)if(i[n].code===t){newTileArr=i.splice(n,1),o=newTileArr[0];break}return o||debug("NONE OF THAT TILE FOUND"),o},CaptureTileManager.prototype.peekTile=function(e,t,o){var i,n=this.hostTiles;if(e===GUEST&&(n=this.guestTiles),o)for(var a=0;a<n.length;a++)if(n[a].id===o)return n[a];for(a=0;a<n.length;a++)if(n[a].code===t){i=n[a];break}return i||debug("NONE OF THAT TILE FOUND"),i},CaptureTileManager.prototype.removeSelectedTileFlags=function(){this.hostTiles.forEach((function(e){e.selectedFromPile=!1})),this.guestTiles.forEach((function(e){e.selectedFromPile=!1}))},CaptureTileManager.prototype.unselectTiles=function(e){var t=this.hostTiles;e===GUEST&&(t=this.guestTiles),t.forEach((function(e){e.selectedFromPile=!1}))},CaptureTileManager.prototype.putTileBack=function(e){var t=e.ownerName,o=this.hostTiles;t===GUEST&&(o=this.guestTiles),o.push(e)},CaptureTileManager.prototype.getCopy=function(){return new CaptureTileManager},CoopSolitaireActuator.prototype.actuate=function(e,t,o){var i=this;window.requestAnimationFrame((function(){i.htmlify(e,t,o)}))},CoopSolitaireActuator.prototype.htmlify=function(e,t,o){this.clearContainer(this.boardContainer);var i=this;e.cells.forEach((function(e){e.forEach((function(e){e&&i.addBoardPoint(e)}))})),new SolitaireTileManager(!0).tiles.forEach((function(e){i.clearTileContainer(e)})),!t.getWinner()&&o&&this.addTile(o)},CoopSolitaireActuator.prototype.clearContainer=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},CoopSolitaireActuator.prototype.clearTileContainer=function(e){for(var t=document.querySelector("."+e.getImageName());t.firstChild;)t.removeChild(t.firstChild)},CoopSolitaireActuator.prototype.addTile=function(e,t){var o=document.querySelector("."+e.getImageName()),i=document.createElement("div");i.classList.add("point"),i.classList.add("hasTile"),e.selectedFromPile&&(i.classList.add("selectedFromPile"),i.classList.add("drained"));var n=document.createElement("img"),a=getSkudTilesSrcPath();n.src=a+e.getImageName()+".png",i.appendChild(n),i.setAttribute("name",e.getImageName()),i.setAttribute("id",e.id),this.mobile?i.setAttribute("onclick","unplayedTileClicked(this); showTileMessage(this);"):(i.setAttribute("onclick","unplayedTileClicked(this);"),i.setAttribute("onmouseover","showTileMessage(this);"),i.setAttribute("onmouseout","clearMessage();")),o.appendChild(i)},CoopSolitaireActuator.prototype.addBoardPoint=function(e){var t=createBoardPointDiv(e);if(e.isType(NON_PLAYABLE)||(t.classList.add("activePoint"),e.isType(POSSIBLE_MOVE)?t.classList.add("possibleMove"):e.betweenHarmony&&(t.classList.add("betweenHarmony"),e.betweenHarmonyHost&&t.classList.add("bhHost"),e.betweenHarmonyGuest&&t.classList.add("bhGuest")),this.mobile?t.setAttribute("onclick","pointClicked(this); showPointMessage(this);"):(t.setAttribute("onclick","pointClicked(this);"),t.setAttribute("onmouseover","showPointMessage(this);"),t.setAttribute("onmouseout","clearMessage();"))),e.hasTile()){t.classList.add("hasTile");var o=document.createElement("img"),i=getSkudTilesSrcPath();o.src=i+e.tile.getImageName()+".png",e.tile.inHarmony&&t.classList.add(e.tile.ownerName+"harmony"),e.tile.inClash&&t.classList.add(e.tile.opponentName+"harmony"),(e.tile.drained||e.tile.trapped)&&t.classList.add("drained"),t.appendChild(o)}if(this.boardContainer.appendChild(t),e.betweenHarmony&&16===e.col){var n=document.createElement("div");n.classList.add("clear"),this.boardContainer.appendChild(n)}},CoopSolitaireActuator.prototype.printBoard=function(e){debug("");var t=0;e.cells.forEach((function(e){var o=t+"\t: ";e.forEach((function(e){var t=e.getConsoleDisplay();t.length<3&&(o+=" "),o+=t,t.length<2&&(o+=" ")})),debug(o),t++})),debug("")},CoopSolitaireBoard.prototype.brandNew=function(){var e=[];e[0]=this.newRow(9,[CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.gate(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral()]),e[1]=this.newRow(11,[CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.redWhiteNeutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral()]),e[2]=this.newRow(13,[CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.whiteNeutral(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.redNeutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral()]),e[3]=this.newRow(15,[CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.whiteNeutral(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.redNeutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral()]),e[4]=this.newRow(17,[CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.whiteNeutral(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.redNeutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral()]),e[5]=this.newRow(17,[CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.whiteNeutral(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.redNeutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral()]),e[6]=this.newRow(17,[CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.whiteNeutral(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.redNeutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral()]),e[7]=this.newRow(17,[CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.whiteNeutral(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.redNeutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral()]),e[8]=this.newRow(17,[CoopSolitaireBoardPoint.gate(),CoopSolitaireBoardPoint.redWhiteNeutral(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.redWhiteNeutral(),CoopSolitaireBoardPoint.gate()]),e[9]=this.newRow(17,[CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.redNeutral(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.whiteNeutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral()]),e[10]=this.newRow(17,[CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.redNeutral(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.whiteNeutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral()]),e[11]=this.newRow(17,[CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.redNeutral(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.whiteNeutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral()]),e[12]=this.newRow(17,[CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.redNeutral(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.whiteNeutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral()]),e[13]=this.newRow(15,[CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.redNeutral(),CoopSolitaireBoardPoint.red(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.white(),CoopSolitaireBoardPoint.whiteNeutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral()]),e[14]=this.newRow(13,[CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.redNeutral(),CoopSolitaireBoardPoint.redWhite(),CoopSolitaireBoardPoint.whiteNeutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral()]),e[15]=this.newRow(11,[CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.redWhiteNeutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral()]),e[16]=this.newRow(9,[CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.gate(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral(),CoopSolitaireBoardPoint.neutral()]);for(var t=0;t<e.length;t++)for(var o=0;o<e[t].length;o++)e[t][o].row=t,e[t][o].col=o;return e},CoopSolitaireBoard.prototype.newRow=function(e,t){var o=[],i=(this.size.row-e)/2,n=new CoopSolitaireBoardPoint;n.addType(NON_PLAYABLE);for(var a=0;a<this.size.row;a++)o[a]=a<i?n:a<i+e&&t?t[a-i]:n;return o},CoopSolitaireBoard.prototype.placeTile=function(e,t,o){this.putTileOnPoint(e,t),e.specialFlowerType===WHITE_LOTUS&&this.playedWhiteLotusTiles.push(e),this.analyzeHarmonies()},CoopSolitaireBoard.prototype.putTileOnPoint=function(e,t){var o=t.rowAndColumn;(o=this.cells[o.row][o.col]).putTile(e)},CoopSolitaireBoard.prototype.canPlaceRock=function(e){return!e.hasTile()&&!e.isType(GATE)},CoopSolitaireBoard.prototype.placeRock=function(e,t){var o=t.rowAndColumn,i=this.cells[o.row][o.col];if(!this.canPlaceRock(i))return!1;i.isType(GATE)||(i.putTile(e),this.rockRowAndCols.push(o))},CoopSolitaireBoard.prototype.canPlaceWheel=function(e){if(e.hasTile())return!1;if(e.isType(GATE))return!1;for(var t=this.getSurroundingRowAndCols(e),o=0;o<t.length;o++){var i=this.cells[t[o].row][t[o].col];if(i.isType(GATE)&&!newWheelRule)return!1;if(!newKnotweedRules&&i.hasTile()&&(i.tile.drained||i.tile.accentType===KNOTWEED))return!1;if(newWheelRule&&i.isType(GATE)&&i.hasTile())return!1;if((rocksUnwheelable||simplest)&&i.hasTile()&&i.tile.accentType===ROCK)return!1;if(superRocks&&i.hasTile())for(var n=this.getSurroundingRowAndCols(i),a=0;a<n.length;a++){var r=this.cells[n[a].row][n[a].col];if(r.hasTile()&&r.tile.accentType===ROCK)return!1}if(i.hasTile()){var l=this.getClockwiseRowCol(e,t[o]);if(!this.isValidRowCol(l))return!1;var s=this.cells[l.row][l.col];if(!s.canHoldTile(i.tile,!0))return!1;if(s.isType(GATE))return!1}}var h=this.getCopy(),d=new NotationPoint(new RowAndColumn(e.row,e.col).notationPointString);return h.placeWheel(new SolitaireTile("W","G"),d,!0),!h.moveCreatesDisharmony(e,e)},CoopSolitaireBoard.prototype.isValidRowCol=function(e){return e.row>=0&&e.col>=0&&e.row<=16&&e.col<=16},CoopSolitaireBoard.prototype.placeWheel=function(e,t,o){var i=t.rowAndColumn,n=this.cells[i.row][i.col],a=this.getSurroundingRowAndCols(i);if(!o&&!this.canPlaceWheel(n))return!1;n.putTile(e);for(var r=[],l=0;l<a.length;l++){e=this.cells[a[l].row][a[l].col].removeTile();var s=this.getClockwiseRowCol(i,a[l]);this.isValidRowCol(s)&&r.push([e,s])}var h=this;r.forEach((function(e){h.cells[e[1].row][e[1].col].putTile(e[0])})),this.refreshRockRowAndCols()},CoopSolitaireBoard.prototype.canPlaceKnotweed=function(e){if(e.hasTile())return!1;if(e.isType(GATE))return!1;if(!newKnotweedRules)for(var t=this.getSurroundingRowAndCols(e),o=0;o<t.length;o++){if(this.cells[t[o].row][t[o].col].isType(GATE))return!1}return!0},CoopSolitaireBoard.prototype.placeKnotweed=function(e,t){var o=t.rowAndColumn,i=this.cells[o.row][o.col],n=this.getSurroundingRowAndCols(o);if(!this.canPlaceKnotweed(i))return!1;i.putTile(e);for(var a=0;a<n.length;a++){this.cells[n[a].row][n[a].col].drainTile()}},CoopSolitaireBoard.prototype.canPlaceBoat=function(e,t){if(!e.hasTile())return!1;if(e.isType(GATE))return!1;if(e.tile.type===ACCENT_TILE&&!boatOnlyMoves)if(e.tile.accentType===KNOTWEED||simplest||rocksUnwheelable){var o=this.getCopy(),i=new NotationPoint(new RowAndColumn(e.row,e.col).notationPointString);if(o.placeBoat(new SolitaireTile("B","G"),i,e,!0),o.moveCreatesDisharmony(e,e))return!1}else{if(rocksUnwheelable&&e.tile.accentType!==ROCK)return!1;if(!rocksUnwheelable)return!1}return!0},CoopSolitaireBoard.prototype.placeBoat=function(e,t,o,i){var n=t.rowAndColumn,a=this.cells[n.row][n.col];if(!i&&!this.canPlaceBoat(a,e))return!1;if(a.tile.type!==ACCENT_TILE||boatOnlyMoves){var r=o.rowAndColumn,l=this.cells[r.row][r.col];if(!l.canHoldTile(a.tile))return debug("Boat cannot move that tile there!"),!1;l.putTile(a.removeTile()),a.putTile(e)}else{a.removeTile();for(var s=this.getSurroundingRowAndCols(n),h=0;h<s.length;h++){this.cells[s[h].row][s[h].col].restoreTile()}rocksUnwheelable&&this.refreshRockRowAndCols()}},CoopSolitaireBoard.prototype.getClockwiseRowCol=function(e,t){return t.row<e.row&&t.col<=e.col?new RowAndColumn(t.row,t.col+1):t.col>e.col&&t.row<=e.row?new RowAndColumn(t.row+1,t.col):t.row>e.row&&t.col>=e.col?new RowAndColumn(t.row,t.col-1):t.col<e.col&&t.row>=e.row?new RowAndColumn(t.row-1,t.col):void debug("ERROR CLOCKWISE CALCULATING")},CoopSolitaireBoard.prototype.getSurroundingRowAndCols=function(e){for(var t=[],o=e.row-1;o<=e.row+1;o++)for(var i=e.col-1;i<=e.col+1;i++){if((o!==e.row||i!==e.col)&&o>=0&&i>=0&&o<17&&i<17)this.cells[o][i].isType(NON_PLAYABLE)||t.push(new RowAndColumn(o,i))}return t},CoopSolitaireBoard.prototype.refreshRockRowAndCols=function(){this.rockRowAndCols=[];var e=this;this.cells.forEach((function(t){t.forEach((function(t){t.hasTile()&&t.tile.accentType===ROCK&&e.rockRowAndCols.push(t)}))}))},CoopSolitaireBoard.prototype.pointIsOpenGate=function(e){var t=e.rowAndColumn;return(t=this.cells[t.row][t.col]).isOpenGate()},CoopSolitaireBoard.prototype.moveTile=function(e,t,o){var i=t.rowAndColumn,n=o.rowAndColumn;if(i.row<0||i.row>16||n.row<0||n.row>16)return debug("That point does not exist. So it's not gonna happen."),!1;var a=this.cells[i.row][i.col],r=this.cells[n.row][n.col];if(!this.canMoveTileToPoint(e,a,r))return debug("Bad move bears"),showBadMoveModal(),!1;var l=a.removeTile();return l||debug("Error: No tile to move!"),r.putTile(l)?(debug("Error moving tile. It probably didn't get moved."),!1):(this.flagAllTrappedAndDrainedTiles(),this.hasNewHarmony(e,l,i,n))},CoopSolitaireBoard.prototype.flagAllTrappedAndDrainedTiles=function(){for(var e=0;e<this.cells.length;e++)for(var t=0;t<this.cells[e].length;t++){(o=this.cells[e][t]).hasTile()&&(o.tile.trapped=!1,newKnotweedRules&&(o.tile.drained=!1))}for(e=0;e<this.cells.length;e++)for(t=0;t<this.cells[e].length;t++){var o;(o=this.cells[e][t]).isType(GATE)||this.trapTilesSurroundingPointIfNeeded(o),newKnotweedRules&&this.drainTilesSurroundingPointIfNeeded(o)}},CoopSolitaireBoard.prototype.drainTilesSurroundingPointIfNeeded=function(e){if(newKnotweedRules&&e.hasTile()&&e.tile.accentType===KNOTWEED)for(var t=this.getSurroundingRowAndCols(e),o=0;o<t.length;o++){var i=this.cells[t[o].row][t[o].col];i.hasTile()&&(i.tile.drained=!0)}},CoopSolitaireBoard.prototype.trapTilesSurroundingPointIfNeeded=function(e){if(e.hasTile()&&e.tile.specialFlowerType===ORCHID)for(var t=e.tile.ownerName,o=this.getSurroundingRowAndCols(e),i=0;i<o.length;i++){var n=this.cells[o[i].row][o[i].col];n.hasTile()&&!n.isType(GATE)&&n.tile.ownerName!==t&&n.tile.type!==ACCENT_TILE&&(n.tile.trapped=!0)}},CoopSolitaireBoard.prototype.whiteLotusProtected=function(e){return!(!lotusNoCapture&&!simplest)||!!simpleSpecialFlowerRule},CoopSolitaireBoard.prototype.orchidCanCapture=function(e){if(simpleSpecialFlowerRule||simplest)return!1;var t=!1;return this.cells.forEach((function(o){o.forEach((function(o){o.hasTile()&&o.tile.specialFlowerType===WHITE_LOTUS&&o.tile.ownerName===e.ownerName&&!o.isType(GATE)&&(t=!0)}))})),t},CoopSolitaireBoard.prototype.orchidVulnerable=function(e){if(newOrchidVulnerableRule){var t=!1;return this.cells.forEach((function(o){o.forEach((function(o){o.hasTile()&&o.tile.specialFlowerType===WHITE_LOTUS&&o.tile.ownerName!==e.ownerName&&(t=!0)}))})),t}if(simpleSpecialFlowerRule)return!0;if(lotusNoCapture||simplest){t=!1;return this.cells.forEach((function(o){o.forEach((function(o){!o.isType(GATE)&&o.hasTile()&&o.tile.specialFlowerType===WHITE_LOTUS&&o.tile.ownerName===e.ownerName&&(t=!0)}))})),t}t=!1;return this.playedWhiteLotusTiles.forEach((function(o){o.ownerName===e.ownerName&&(t=!0)})),!!t||void 0},CoopSolitaireBoard.prototype.canCapture=function(e,t){var o=e.tile,i=t.tile;if(o.ownerName===i.ownerName)return!1;if(o.specialFlowerType===ORCHID&&i.type!==ACCENT_TILE&&this.orchidCanCapture(o))return!0;if(i.specialFlowerType===WHITE_LOTUS){if(this.whiteLotusProtected(i))return!1;if(o.type===BASIC_FLOWER)return!0}return!!o.clashesWith(i)||(!(i.specialFlowerType!==ORCHID||o.type===ACCENT_TILE||!this.orchidVulnerable(i))||void 0)},CoopSolitaireBoard.prototype.canMoveTileToPoint=function(e,t,o){if(!t.hasTile())return!1;if(t.tile.ownerName!==e)return!1;if(t.tile.trapped)return!1;if(!newKnotweedRules&&t.tile.drained)return!1;if(o.isType(GATE))return!1;var i=!1;if(o.hasTile()&&(i=this.canCapture(t,o)),o.hasTile()&&!i)return!1;if(!o.canHoldTile(t.tile,i))return!1;var n=t.tile.getMoveDistance();return!(Math.abs(t.row-o.row)+Math.abs(t.col-o.col)>n)&&(!!this.verifyAbleToReach(t,o,n)&&!this.moveCreatesDisharmony(t,o))},CoopSolitaireBoard.prototype.canTransportTileToPoint=function(e,t){return!!e.hasTile()&&(!t.isType(GATE)&&(!t.hasTile()&&(!!t.canHoldTile(e.tile)&&!this.moveCreatesDisharmony(e,t))))},CoopSolitaireBoard.prototype.moveCreatesDisharmony=function(e,t){var o=t.removeTile();t.putTile(e.removeTile());for(var i=!1,n=0;n<this.cells.length;n++)for(var a=0;a<this.cells[n].length;a++){var r=this.cells[n][a];if(r.hasTile()&&this.hasDisharmony(r)){i=!0;break}}return e.putTile(t.removeTile()),t.putTile(o),i},CoopSolitaireBoard.prototype.verifyAbleToReach=function(e,t,o){return this.pathFound(e,t,o)},CoopSolitaireBoard.prototype.pathFound=function(e,t,o){if(!e||!t)return!1;if(e.isType(NON_PLAYABLE)||t.isType(NON_PLAYABLE))return!1;if(e.row===t.row&&e.col===t.col)return!0;if(o<=0)return!1;if(1===Math.abs(e.row-t.row)+Math.abs(e.col-t.col))return!0;var i=e.row-1;if(i>=0&&(!(n=this.cells[i][e.col]).hasTile()&&this.pathFound(n,t,o-1)))return!0;if((i=e.row+1)<17&&(!(n=this.cells[i][e.col]).hasTile()&&this.pathFound(n,t,o-1)))return!0;var n,a=e.col-1;if(a>=0&&(!(n=this.cells[e.row][a]).hasTile()&&this.pathFound(n,t,o-1)))return!0;if((a=e.col+1)<17&&(!(n=this.cells[e.row][a]).hasTile()&&this.pathFound(n,t,o-1)))return!0},CoopSolitaireBoard.prototype.rowBlockedByRock=function(e){if(simpleRocks||simplest)return!1;var t=!1;return this.rockRowAndCols.forEach((function(o){o.row===e&&(t=!0)})),t},CoopSolitaireBoard.prototype.columnBlockedByRock=function(e){if(simpleRocks||simplest)return!1;var t=!1;return this.rockRowAndCols.forEach((function(o){o.col===e&&(t=!0)})),t},CoopSolitaireBoard.prototype.markSpacesBetweenHarmonies=function(){this.cells.forEach((function(e){e.forEach((function(e){e.betweenHarmony=!1,e.betweenHarmonyHost=!1,e.betweenHarmonyGuest=!1}))}));var e=this;this.harmonyManager.harmonies.forEach((function(t){if(t.tile1Pos.row===t.tile2Pos.row){var o=t.tile1Pos.row,i=t.tile1Pos.col,n=t.tile2Pos.col;t.tile2Pos.col<t.tile1Pos.col&&(i=t.tile2Pos.col,n=t.tile1Pos.col);for(var a=i+1;a<n;a++)e.cells[o][a].betweenHarmony=!0,e.cells[o][a].betweenHarmonyHost=!0}else if(t.tile2Pos.col==t.tile2Pos.col){a=t.tile1Pos.col;var r=t.tile1Pos.row,l=t.tile2Pos.row;t.tile2Pos.row<t.tile1Pos.row&&(r=t.tile2Pos.row,l=t.tile1Pos.row);for(o=r+1;o<l;o++)e.cells[o][a].betweenHarmony=!0,e.cells[o][a].betweenHarmonyHost=!0}})),this.harmonyManager.clashes.forEach((function(t){if(t.tile1Pos.row===t.tile2Pos.row){var o=t.tile1Pos.row,i=t.tile1Pos.col,n=t.tile2Pos.col;t.tile2Pos.col<t.tile1Pos.col&&(i=t.tile2Pos.col,n=t.tile1Pos.col);for(var a=i+1;a<n;a++)e.cells[o][a].betweenHarmony=!0,e.cells[o][a].betweenHarmonyGuest=!0}else if(t.tile2Pos.col==t.tile2Pos.col){a=t.tile1Pos.col;var r=t.tile1Pos.row,l=t.tile2Pos.row;t.tile2Pos.row<t.tile1Pos.row&&(r=t.tile2Pos.row,l=t.tile1Pos.row);for(o=r+1;o<l;o++)e.cells[o][a].betweenHarmony=!0,e.cells[o][a].betweenHarmonyGuest=!0}}))},CoopSolitaireBoard.prototype.analyzeHarmonies=function(){this.harmonyManager.clearList();for(var e=0;e<this.cells.length;e++)for(var t=0;t<this.cells[e].length;t++){var o=this.cells[e][t];if(o.hasTile()){var i=this.getTileHarmonies(o.tile,new RowAndColumn(e,t));this.harmonyManager.addHarmonies(i);var n=this.getTileClashes(o.tile,new RowAndColumn(e,t));this.harmonyManager.addClashes(n),o.tile.inHarmony=i.length>0,o.tile.inClash=n.length>0}}this.markSpacesBetweenHarmonies()},CoopSolitaireBoard.prototype.getTileHarmonies=function(e,t){var o=[];if(!this.rowBlockedByRock(t.row)){var i=this.getHarmonyLeft(e,t);i&&o.push(i);var n=this.getHarmonyRight(e,t);n&&o.push(n)}if(!this.columnBlockedByRock(t.col)){var a=this.getHarmonyUp(e,t);a&&o.push(a);var r=this.getHarmonyDown(e,t);r&&o.push(r)}return o},CoopSolitaireBoard.prototype.getHarmonyLeft=function(e,t){for(var o=t.col-1;o>=0&&!this.cells[t.row][o].hasTile();)o--;if(o>=0){var i=this.cells[t.row][o];if(e.formsHarmonyWith(i.tile))return new SolitaireHarmony(e,t,i.tile,new RowAndColumn(t.row,o))}},CoopSolitaireBoard.prototype.getHarmonyRight=function(e,t){for(var o=t.col+1;o<=16&&!this.cells[t.row][o].hasTile();)o++;if(o<=16){var i=this.cells[t.row][o];if(e.formsHarmonyWith(i.tile))return new SolitaireHarmony(e,t,i.tile,new RowAndColumn(t.row,o))}},CoopSolitaireBoard.prototype.getHarmonyUp=function(e,t){for(var o=t.row-1;o>=0&&!this.cells[o][t.col].hasTile();)o--;if(o>=0){var i=this.cells[o][t.col];if(e.formsHarmonyWith(i.tile))return new SolitaireHarmony(e,t,i.tile,new RowAndColumn(o,t.col))}},CoopSolitaireBoard.prototype.getHarmonyDown=function(e,t){for(var o=t.row+1;o<=16&&!this.cells[o][t.col].hasTile();)o++;if(o<=16){var i=this.cells[o][t.col];if(e.formsHarmonyWith(i.tile))return new SolitaireHarmony(e,t,i.tile,new RowAndColumn(o,t.col))}},CoopSolitaireBoard.prototype.getTileClashes=function(e,t){var o=[];if(!this.rowBlockedByRock(t.row)){var i=this.getClashLeft(e,t);i&&o.push(i);var n=this.getClashRight(e,t);n&&o.push(n)}if(!this.columnBlockedByRock(t.col)){var a=this.getClashUp(e,t);a&&o.push(a);var r=this.getClashDown(e,t);r&&o.push(r)}return o},CoopSolitaireBoard.prototype.getClashLeft=function(e,t){for(var o=t.col-1;o>=0&&!this.cells[t.row][o].hasTile();)o--;if(o>=0){var i=this.cells[t.row][o];if(e.clashesWith(i.tile))return new SolitaireHarmony(e,t,i.tile,new RowAndColumn(t.row,o))}},CoopSolitaireBoard.prototype.getClashRight=function(e,t){for(var o=t.col+1;o<=16&&!this.cells[t.row][o].hasTile();)o++;if(o<=16){var i=this.cells[t.row][o];if(e.clashesWith(i.tile))return new SolitaireHarmony(e,t,i.tile,new RowAndColumn(t.row,o))}},CoopSolitaireBoard.prototype.getClashUp=function(e,t){for(var o=t.row-1;o>=0&&!this.cells[o][t.col].hasTile();)o--;if(o>=0){var i=this.cells[o][t.col];if(e.clashesWith(i.tile))return new SolitaireHarmony(e,t,i.tile,new RowAndColumn(o,t.col))}},CoopSolitaireBoard.prototype.getClashDown=function(e,t){for(var o=t.row+1;o<=16&&!this.cells[o][t.col].hasTile();)o++;if(o<=16){var i=this.cells[o][t.col];if(e.clashesWith(i.tile))return new SolitaireHarmony(e,t,i.tile,new RowAndColumn(o,t.col))}},CoopSolitaireBoard.prototype.hasNewHarmony=function(e,t,o,i){var n=this.harmonyManager.harmonies;return this.analyzeHarmonies(),this.harmonyManager.hasNewHarmony(e,n)},CoopSolitaireBoard.prototype.hasDisharmony=function(e){var t=e.tile,o=!1;return this.hasDisharmonyLeft(t,e)&&(o=!0),this.hasDisharmonyRight(t,e)&&(o=!0),this.hasDisharmonyUp(t,e)&&(o=!0),this.hasDisharmonyDown(t,e)&&(o=!0),o},CoopSolitaireBoard.prototype.hasDisharmonyLeft=function(e,t){for(var o=t.col-1;o>=0&&!this.cells[t.row][o].hasTile();)o--;if(o>=0){var i=this.cells[t.row][o];if(e.clashesWith(i.tile))return!0}},CoopSolitaireBoard.prototype.hasDisharmonyRight=function(e,t){for(var o=t.col+1;o<=16&&!this.cells[t.row][o].hasTile();)o++;if(o<=16){var i=this.cells[t.row][o];if(e.clashesWith(i.tile))return!0}},CoopSolitaireBoard.prototype.hasDisharmonyUp=function(e,t){for(var o=t.row-1;o>=0&&!this.cells[o][t.col].hasTile();)o--;if(o>=0){var i=this.cells[o][t.col];if(e.clashesWith(i.tile))return!0}},CoopSolitaireBoard.prototype.hasDisharmonyDown=function(e,t){for(var o=t.row+1;o<=16&&!this.cells[o][t.col].hasTile();)o++;if(o<=16){var i=this.cells[o][t.col];if(e.clashesWith(i.tile))return!0}},CoopSolitaireBoard.prototype.setPossibleMovePoints=function(e){if(e.hasTile())for(var t=e.tile.ownerName,o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++)this.canMoveTileToPoint(t,e,this.cells[o][i])&&this.cells[o][i].addType(POSSIBLE_MOVE)},CoopSolitaireBoard.prototype.removePossibleMovePoints=function(){this.cells.forEach((function(e){e.forEach((function(e){e.removeType(POSSIBLE_MOVE)}))}))},CoopSolitaireBoard.prototype.setOpenGatePossibleMoves=function(e){for(var t=0;t<this.cells.length;t++)for(var o=0;o<this.cells[t].length;o++){this.cells[t][o].isOpenGate()&&this.cells[t][o].addType(POSSIBLE_MOVE)}},CoopSolitaireBoard.prototype.setAllPossiblePointsOpen=function(e,t){for(var o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++){var n=this.cells[o][i];if(n.canHoldTile(e)){var a=n.getCopy();a.putTile(e),t===HOST?this.hasDisharmony(a)||this.cells[o][i].addType(POSSIBLE_MOVE):t===GUEST&&!this.getTileHarmonies(a.tile,a).length>0&&this.cells[o][i].addType(POSSIBLE_MOVE)}}},CoopSolitaireBoard.prototype.setHarmonyOrClashPointsOpen=function(e,t){for(var o=!1,i=0;i<this.cells.length;i++)for(var n=0;n<this.cells[i].length;n++){var a=this.cells[i][n];if(a.canHoldTile(e)){var r=a.getCopy();r.putTile(e),t===HOST?!this.hasDisharmony(r)&&this.getTileHarmonies(r.tile,r).length>0&&(this.cells[i][n].addType(POSSIBLE_MOVE),o=!0):t===GUEST&&this.hasDisharmony(r)&&!this.getTileHarmonies(r.tile,r).length>0&&(this.cells[i][n].addType(POSSIBLE_MOVE),o=!0)}}return o},CoopSolitaireBoard.prototype.setSolitaireAccentPointsOpen=function(e){for(var t=0;t<this.cells.length;t++)for(var o=0;o<this.cells[t].length;o++){var i=this.cells[t][o],n=[];t>2&&n.push(this.cells[t-2][o]),t<14&&n.push(this.cells[t+2][o]),o>2&&n.push(this.cells[t][o-2]),o<14&&n.push(this.cells[t][o+2]);for(var a=!1,r=0;r<n.length;r++)n[r].isCompletelyWithinRedOrWhiteGarden()&&(a=!0);i.isType(RED)&&i.isType(WHITE)&&(a=!0),a&&i.canHoldTile(e)&&this.cells[t][o].addType(POSSIBLE_MOVE)}},CoopSolitaireBoard.prototype.playerControlsLessThanTwoGates=function(e){for(var t=0,o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++){var n=this.cells[o][i];n.isType(GATE)&&n.hasTile()&&n.tile.ownerName===e&&t++}return t<2},CoopSolitaireBoard.prototype.playerHasNoGrowingFlowers=function(e){for(var t=0;t<this.cells.length;t++)for(var o=0;o<this.cells[t].length;o++){var i=this.cells[t][o];if(i.isType(GATE)&&i.hasTile()&&i.tile.ownerName===e)return!1}return!0},CoopSolitaireBoard.prototype.revealSpecialFlowerPlacementPoints=function(e){var t,o=[],i=0,n=8;(t=this.cells[i][n]).hasTile()&&t.tile.ownerName===e&&(o.push(this.cells[i][n-1]),o.push(this.cells[i][n+1])),i=16,(t=this.cells[i][n]).hasTile()&&t.tile.ownerName===e&&(o.push(this.cells[i][n-1]),o.push(this.cells[i][n+1])),i=8,n=0,(t=this.cells[i][n]).hasTile()&&t.tile.ownerName===e&&(o.push(this.cells[i-1][n]),o.push(this.cells[i+1][n])),n=16,(t=this.cells[i][n]).hasTile()&&t.tile.ownerName===e&&(o.push(this.cells[i-1][n]),o.push(this.cells[i+1][n])),o.forEach((function(e){e.hasTile()||e.addType(POSSIBLE_MOVE)}))},CoopSolitaireBoard.prototype.setGuestGateOpen=function(){this.cells[16][8].isOpenGate()&&this.cells[16][8].addType(POSSIBLE_MOVE)},CoopSolitaireBoard.prototype.revealPossiblePlacementPoints=function(e){var t=this;this.cells.forEach((function(o){o.forEach((function(o){var i=!1;(e.accentType===ROCK&&t.canPlaceRock(o)||e.accentType===WHEEL&&t.canPlaceWheel(o)||e.accentType===KNOTWEED&&t.canPlaceKnotweed(o)||e.accentType===BOAT&&t.canPlaceBoat(o,e))&&(i=!0),i&&o.addType(POSSIBLE_MOVE)}))}))},CoopSolitaireBoard.prototype.revealBoatBonusPoints=function(e){if(e.hasTile()){var t=e.tile.ownerName;if(newKnotweedRules)for(var o=this.getSurroundingRowAndCols(e),i=0;i<o.length;i++){var n=this.cells[o[i].row][o[i].col];this.canTransportTileToPoint(e,n)&&n.addType(POSSIBLE_MOVE)}else for(var a=0;a<this.cells.length;a++)for(var r=0;r<this.cells[a].length;r++){n=this.cells[a][r];Math.abs(e.row-n.row)+Math.abs(e.col-n.col)===1&&this.canMoveTileToPoint(t,e,n)&&n.addType(POSSIBLE_MOVE)}}},CoopSolitaireBoard.prototype.getCopy=function(){for(var e=new CoopSolitaireBoard,t=0;t<this.cells.length;t++)for(var o=0;o<this.cells[t].length;o++)e.cells[t][o]=this.cells[t][o].getCopy();for(var i=0;i<this.playedWhiteLotusTiles.length;i++)e.playedWhiteLotusTiles.push(this.playedWhiteLotusTiles[i].getCopy());return e.refreshRockRowAndCols(),e.analyzeHarmonies(),e},CoopSolitaireBoard.prototype.numTilesInGardensForPlayer=function(e){for(var t=0,o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++){var n=this.cells[o][i];1===n.types.length&&n.hasTile()&&n.isType(n.tile.basicColorName)&&t++}return t},CoopSolitaireBoard.prototype.numTilesOnBoardForPlayer=function(e){for(var t=0,o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++){var n=this.cells[o][i];n.hasTile()&&n.tile.ownerName===e&&t++}return t},CoopSolitaireBoard.prototype.getSurroundness=function(e){for(var t=0,o=0,i=0,n=0,a=0,r=0,l=0,s=0,h=0;h<this.cells.length;h++)for(var d=0;d<this.cells[h].length;d++){var u=this.cells[h][d];u.hasTile()&&u.tile.ownerName===e&&(u.row>8&&(i++,n=1),u.row<8&&(t++,o=1),u.col<8&&(a++,r=1),u.col>8&&(l++,s=1))}var p=t;return i<p&&(p=i),a<p&&(p=a),l<p&&(p=l),0===p?o+n+r+s:4*p},CoopSolitaireBoardPoint.prototype.addType=function(e){this.types.includes(e)||this.types.push(e)},CoopSolitaireBoardPoint.prototype.removeType=function(e){for(var t=0;t<this.types.length;t++)this.types[t]===e&&this.types.splice(t,1)},CoopSolitaireBoardPoint.prototype.getConsoleDisplay=function(){if(this.tile)return this.tile.getConsoleDisplay();var e=thinDot;this.types.includes(NON_PLAYABLE)&&(e=" ");var t="";return this.types.includes(RED)&&(t="R",e=thickDot),this.types.includes(WHITE)&&(t+="W",e=whiteDot),this.types.includes(NEUTRAL)&&(t+="N"),this.types.includes(GATE)&&(t="G",e=gateDot),t.length>1&&(e="+"),e},CoopSolitaireBoardPoint.prototype.putTile=function(e){this.tile=e},CoopSolitaireBoardPoint.prototype.hasTile=function(){return!!this.tile},CoopSolitaireBoardPoint.prototype.isType=function(e){return this.types.includes(e)},CoopSolitaireBoardPoint.prototype.isOpenGate=function(){return!this.hasTile()&&this.types.includes(GATE)},CoopSolitaireBoardPoint.prototype.removeTile=function(){var e=this.tile;return this.tile=null,e},CoopSolitaireBoardPoint.prototype.drainTile=function(){this.tile&&this.tile.drain()},CoopSolitaireBoardPoint.prototype.restoreTile=function(){this.tile&&this.tile.restore()},CoopSolitaireBoardPoint.prototype.canHoldTile=function(e,t){return!this.isType(NON_PLAYABLE)&&(!(!t&&this.hasTile())&&(!!this.isType(GATE)||(e.type===BASIC_FLOWER?!(!this.isType(NEUTRAL)&&!this.isType(e.basicColorName)):e.type===SPECIAL_FLOWER||e.type===ACCENT_TILE)))},CoopSolitaireBoardPoint.prototype.isCompletelyWithinRedOrWhiteGarden=function(){return!this.isType(NEUTRAL)&&(this.isType(RED)&&!this.isType(WHITE)||this.isType(WHITE)&&!this.isType(RED))},CoopSolitaireBoardPoint.prototype.betweenPlayerHarmony=function(e){return e===GUEST?this.betweenHarmonyGuest:e===HOST&&this.betweenHarmonyHost},CoopSolitaireBoardPoint.prototype.getCopy=function(){for(var e=new CoopSolitaireBoardPoint,t=0;t<this.types.length;t++)e.types.push(this.types[t]);return e.row=this.row,e.col=this.col,this.hasTile()&&(e.tile=this.tile.getCopy()),e},CoopSolitaireBoardPoint.neutral=function(){var e=new CoopSolitaireBoardPoint;return e.addType(NEUTRAL),e},CoopSolitaireBoardPoint.gate=function(){var e=new CoopSolitaireBoardPoint;return e.addType(GATE),e},CoopSolitaireBoardPoint.red=function(){var e=new CoopSolitaireBoardPoint;return e.addType(RED),e},CoopSolitaireBoardPoint.white=function(){var e=new CoopSolitaireBoardPoint;return e.addType(WHITE),e},CoopSolitaireBoardPoint.redWhite=function(){var e=new CoopSolitaireBoardPoint;return e.addType(RED),e.addType(WHITE),e},CoopSolitaireBoardPoint.redWhiteNeutral=function(){var e=new CoopSolitaireBoardPoint;return e.addType(RED),e.addType(WHITE),e.addType(NEUTRAL),e},CoopSolitaireBoardPoint.redNeutral=function(){var e=new CoopSolitaireBoardPoint;return e.addType(RED),e.addType(NEUTRAL),e},CoopSolitaireBoardPoint.whiteNeutral=function(){var e=new CoopSolitaireBoardPoint;return e.addType(WHITE),e.addType(NEUTRAL),e},CoopSolitaireController.prototype.getGameTypeId=function(){return GameType.CoopSolitaire.id},CoopSolitaireController.prototype.completeSetup=function(){this.callActuate()},CoopSolitaireController.prototype.drawRandomTile=function(){this.lastDrawnTile=this.drawnTile,this.drawnTile=this.theGame.drawRandomTile()},CoopSolitaireController.prototype.resetGameManager=function(){this.theGame=new CoopSolitaireGameManager(this.actuator)},CoopSolitaireController.prototype.resetNotationBuilder=function(){this.notationBuilder=new CoopSolitaireNotationBuilder},CoopSolitaireController.prototype.resetGameNotation=function(){this.gameNotation=this.getNewGameNotation()},CoopSolitaireController.prototype.getNewGameNotation=function(){return new CoopSolitaireGameNotation},CoopSolitaireController.getHostTilesContainerDivs=function(){return'<div class="HR3 HR4 HR5 HW3 HW4 HW5 HR HW HK HB HL HO">'},CoopSolitaireController.getGuestTilesContainerDivs=function(){return"<div></div>"},CoopSolitaireController.prototype.callActuate=function(){this.drawnTile&&(this.theGame.tileManager.peekTile(HOST,this.drawnTile.code,this.drawnTile.id)||(this.drawnTile=null,this.lastDrawnTile=null,this.drawRandomTile()));this.theGame.actuate()},CoopSolitaireController.prototype.resetMove=function(){this.gameNotation.removeLastMove(),this.drawnTile&&(this.drawnTile.selectedFromPile=!1,this.theGame.tileManager.putTileBack(this.drawnTile)),this.drawnTile=this.lastDrawnTile,this.drawnTile.selectedFromPile=!1},CoopSolitaireController.prototype.getDefaultHelpMessageText=function(){return"<h4>Solitaire Pai Sho</h4> <p>Pai Sho is a game of harmony. The goal of Solitaire Pai Sho is to place Flower Tiles to create a balance of Harmony and Disharmony on the board.</p> <p>Each turn, you are given a tile that's been drawn for you to place on the board. When all the tiles have been played, the game ends and your score will be calculated.</p> <p><a href='https://skudpaisho.com/site/games/solitaire-pai-sho/'>View the resources page</a> for the rules.</p>"},CoopSolitaireController.prototype.getAdditionalMessage=function(){var e="";if(0===this.gameNotation.moves.length&&(e+=getGameOptionsMessageHtml(GameType.CoopSolitaire.gameOptions)),!this.theGame.getWinner()){var t=this.getCurrentPlayer(),o="Harmonies";t===HOST&&(o="Disharmonies"),e+="<br />The "+t+" is not allowed to form "+o+".",e+="<br /><strong>"+this.theGame.getWinReason()+"</strong>"}return e},CoopSolitaireController.prototype.unplayedTileClicked=function(e){if(myTurn())if(currentMoveIndex===this.gameNotation.moves.length){var t=e.getAttribute("name"),o=parseInt(e.getAttribute("id")),i=t.charAt(0),n=t.substring(1),a=GUEST;"H"===i&&(a=HOST);var r=this.theGame.tileManager.peekTile(a,n,o);this.notationBuilder.status===BRAND_NEW?(r.selectedFromPile=!0,this.drawnTile.selectedFromPile=!0,this.notationBuilder.moveType=PLANTING,this.notationBuilder.plantedFlowerType=n,this.notationBuilder.status=WAITING_FOR_ENDPOINT,this.theGame.setAllLegalPointsOpen(getCurrentPlayer(),r)):(this.theGame.hidePossibleMovePoints(),this.notationBuilder=new CoopSolitaireNotationBuilder)}else debug("Can only interact if all moves are played.")},CoopSolitaireController.prototype.pointClicked=function(e){if(currentMoveIndex===this.gameNotation.moves.length){var t=new NotationPoint(e.getAttribute("name")).rowAndColumn,o=this.theGame.board.cells[t.row][t.col];if(this.notationBuilder.status===BRAND_NEW){if(o.hasTile()){if(o.tile.ownerName!==getCurrentPlayer())return void debug("That's not your tile!");if(o.tile.type===ACCENT_TILE)return;if(o.tile.trapped)return;if(!newKnotweedRules&&o.tile.trapped)return}}else if(this.notationBuilder.status===WAITING_FOR_ENDPOINT)if(o.isType(POSSIBLE_MOVE)){this.theGame.hidePossibleMovePoints(),this.notationBuilder.endPoint=new NotationPoint(e.getAttribute("name"));var i=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.theGame.runNotationMove(i)||(this.gameNotation.addMove(i),this.drawRandomTile(),onlinePlayEnabled&&1===this.gameNotation.moves.length?createGameIfThatIsOk(GameType.CoopSolitaire.id):playingOnlineGame()?callSubmitMove():finalizeMove())}else this.theGame.hidePossibleMovePoints(),this.notationBuilder=new CoopSolitaireNotationBuilder}else debug("Can only interact if all moves are played.")},CoopSolitaireController.prototype.skipHarmonyBonus=function(){var e=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.gameNotation.addMove(e),onlinePlayEnabled&&1===this.gameNotation.moves.length?createGameIfThatIsOk(GameType.CoopSolitaire.id):playingOnlineGame()?callSubmitMove():finalizeMove()},CoopSolitaireController.prototype.addTileSummaryToMessageArr=function(e,t){if(t.length>1){var o=t.charAt(0),i=parseInt(t.charAt(1)),n=i-1,a=o;n<3&&(n=5,a="R"===o?"W":"R");var r=SolitaireTile.getTileName(a+n);a=o,(n=i+1)>5&&(n=3,a="R"===o?"W":"R");var l=SolitaireTile.getTileName(a+n);n=i,a="R"===o?"W":"R";var s=SolitaireTile.getTileName(a+n);e.push("Forms Harmony with "+r+", "+l+", and the Lotus"),e.push("Forms Disharmony with "+s+" and the Orchid")}else"R"===t?(heading="Accent Tile: Rock",simplest?e.push("The Rock disrupts Harmonies and cannot be moved by a Wheel."):rocksUnwheelable?simpleRocks?e.push("The Rock blocks Harmonies and cannot be moved by a Wheel."):e.push("The Rock cancels Harmonies on horizontal and vertical lines it lies on. A Rock cannot be moved by a Wheel."):e.push("The Rock cancels Harmonies on horizontal and vertical lines it lies on.")):"W"===t?(heading="Accent Tile: Wheel",rocksUnwheelable||simplest?e.push("The Wheel rotates all surrounding tiles one space clockwise but cannot move a Rock (cannot move tiles off the board or onto or off of a Gate)."):e.push("The Wheel rotates all surrounding tiles one space clockwise (cannot move tiles off the board or onto or off of a Gate).")):"K"===t?(heading="Accent Tile: Knotweed",newKnotweedRules?e.push("The Knotweed drains surrounding Flower Tiles so they are unable to form Harmony."):e.push("The Knotweed drains surrounding Basic Flower Tiles so they are unable to move or form Harmony.")):"B"===t?(heading="Accent Tile: Boat",simplest||rocksUnwheelable?e.push("The Boat moves a Flower Tile to a surrounding space or removes an Accent tile."):rocksUnwheelable?e.push("The Boat moves a Flower Tile to a surrounding space or removes a Rock or Knotweed tile."):e.push("The Boat moves a Flower Tile to a surrounding space or removes a Knotweed tile.")):"L"===t?(heading="Special Flower: White Lotus",e.push("Forms Harmony with all Flower Tiles")):"O"===t&&(heading="Special Flower: Orchid",e.push("Forms Disharmony will all Flower Tiles"))},CoopSolitaireController.prototype.getTileMessage=function(e){var t=e.getAttribute("name"),o=(parseInt(e.getAttribute("id")),new SolitaireTile(t.substring(1),t.charAt(0)),[]);t.startsWith("G");var i=t.substring(1),n=SolitaireTile.getTileName(i);return this.addTileSummaryToMessageArr(o,i),{heading:n,message:o}},CoopSolitaireController.prototype.getPointMessage=function(e){var t=new NotationPoint(e.getAttribute("name")).rowAndColumn,o=this.theGame.board.cells[t.row][t.col],i=[];if(o.hasTile()){i.push(toHeading(o.tile.getName())),this.addTileSummaryToMessageArr(i,o.tile.code);var n=this.theGame.board.harmonyManager.getHarmoniesWithThisTile(o.tile);if(n.length>0){var a=[];n.forEach((function(e){var t=e.getTileThatIsNotThisOne(o.tile);a.push(t.getName()+" to the "+e.getDirectionForTile(o.tile))})),i.push("<strong>Currently in Harmony with: </strong>"+toBullets(a))}if((n=this.theGame.board.harmonyManager.getClashesWithThisTile(o.tile)).length>0){a=[];n.forEach((function(e){var t=e.getTileThatIsNotThisOne(o.tile);a.push(t.getName()+" to the "+e.getDirectionForTile(o.tile))})),i.push("<strong>Currently in Disharmony with: </strong>"+toBullets(a))}}else o.isType(NEUTRAL)?i.push(getNeutralPointMessage()):o.isType(RED)&&o.isType(WHITE)?i.push(getRedWhitePointMessage()):o.isType(RED)?i.push(getRedPointMessage()):o.isType(WHITE)?i.push(getWhitePointMessage()):o.isType(GATE)&&i.push(getNeutralPointMessage());return{heading:null,message:i}},CoopSolitaireController.prototype.playAiTurn=function(e){},CoopSolitaireController.prototype.startAiGame=function(e){},CoopSolitaireController.prototype.getAiList=function(){return[]},CoopSolitaireController.prototype.getCurrentPlayer=function(){return this.gameNotation.moves.length%2==0?HOST:GUEST},CoopSolitaireController.prototype.cleanup=function(){},CoopSolitaireController.prototype.isSolitaire=function(){return!1},CoopSolitaireController.prototype.setGameNotation=function(e){this.drawnTile&&(this.drawnTile.selectedFromPile=!1,this.theGame.tileManager.putTileBack(this.drawnTile)),this.resetGameManager(),this.gameNotation.setNotationText(e),this.drawRandomTile(),this.theGame.actuate()},CoopSolitaireGameManager.prototype.setup=function(e){this.board=new CoopSolitaireBoard},CoopSolitaireGameManager.prototype.actuate=function(){this.isCopy||this.actuator.actuate(this.board,gameController.theGame,gameController.drawnTile)},CoopSolitaireGameManager.prototype.runNotationMove=function(e,t){debug("Running Move: "+e.fullMoveText);var o=!1;if(e.moveType===PLANTING){var i=this.tileManager.grabTile(e.player,e.plantedFlowerType);this.board.placeTile(i,e.endPoint)}else if(e.moveType===ARRANGING)if((o=this.board.moveTile(e.player,e.startPoint,e.endPoint))&&e.hasHarmonyBonus()){i=this.tileManager.grabTile(e.player,e.bonusTileCode);e.boatBonusPoint?this.board.placeTile(i,e.bonusEndPoint,e.boatBonusPoint):this.board.placeTile(i,e.bonusEndPoint)}else!o&&e.hasHarmonyBonus()&&(debug("BONUS NOT ALLOWED so I won't give it to you!"),!0);if(t&&this.actuate(),this.endGameWinners=[],0===this.board.winners.length){var n=this.tileManager.aPlayerIsOutOfTiles();n&&(debug("PLAYER OUT OF TILES: "+n),this.endGameWinners.push(HOST))}return o},CoopSolitaireGameManager.prototype.drawRandomTile=function(){return this.tileManager.drawRandomTile()},CoopSolitaireGameManager.prototype.revealPossibleMovePoints=function(e,t){e.hasTile()&&(this.board.setPossibleMovePoints(e),t||this.actuate())},CoopSolitaireGameManager.prototype.hidePossibleMovePoints=function(e){this.board.removePossibleMovePoints(),this.tileManager.removeSelectedTileFlags(),e||this.actuate()},CoopSolitaireGameManager.prototype.setAllLegalPointsOpen=function(e,t,o){t.type===ACCENT_TILE?this.board.setSolitaireAccentPointsOpen(t):this.board.setHarmonyOrClashPointsOpen(t,e)||this.board.setAllPossiblePointsOpen(t,e),o||this.actuate()},CoopSolitaireGameManager.prototype.playerCanBonusPlant=function(e){return!newGatesRule||(lessBonus?this.board.playerHasNoGrowingFlowers(e):newGatesRule?this.board.playerControlsLessThanTwoGates(e):void 0)},CoopSolitaireGameManager.prototype.revealSpecialFlowerPlacementPoints=function(e){newSpecialFlowerRules?(this.board.revealSpecialFlowerPlacementPoints(e),this.actuate()):this.revealOpenGates(e)},CoopSolitaireGameManager.prototype.revealPossiblePlacementPoints=function(e){this.board.revealPossiblePlacementPoints(e),this.actuate()},CoopSolitaireGameManager.prototype.revealBoatBonusPoints=function(e){this.board.revealBoatBonusPoints(e),this.actuate()},CoopSolitaireGameManager.prototype.playerHasNotPlayedEitherSpecialTile=function(e){return this.tileManager.playerHasBothSpecialTilesRemaining(e)},CoopSolitaireGameManager.prototype.getWinner=function(){if(1===this.endGameWinners.length)return this.endGameWinners[0]},CoopSolitaireGameManager.prototype.getWinReason=function(){return"<br />"+this.board.harmonyManager.getSolitaireGameSummaryText()},CoopSolitaireGameManager.prototype.getWinResultTypeCode=function(){if(1===this.endGameWinners.length)return 6},CoopSolitaireGameManager.prototype.getCopy=function(){var e=new CoopSolitaireGameManager(this.actuator,!0,!0);return e.board=this.board.getCopy(),e.tileManager=this.tileManager.getCopy(),e},CoopSolitaireNotationMove.prototype.analyzeMove=function(){this.valid=!0;var e=(n=this.fullMoveText.split("."))[0];this.moveNum=parseInt(e.slice(0,-1)),this.playerCode=e.charAt(e.length-1),"G"===this.playerCode?this.player=GUEST:"H"===this.playerCode&&(this.player=HOST);var t=n[1];if(t)if(0!==this.moveNum){var o=t.charAt(0);if(this.moveType=PLANTING,this.moveType===PLANTING){var i=t.charAt(1);this.plantedFlowerType=o,"("!==i&&(this.plantedFlowerType=this.plantedFlowerType+""+i),"("===t.charAt(2)||"("===t.charAt(1)||(debug("Failure to plant"),this.valid=!1),t.endsWith(")")?this.endPoint=new NotationPoint(t.substring(t.indexOf("(")+1,t.indexOf(")"))):this.valid=!1}if(this.moveType===ARRANGING){var n=t.substring(t.indexOf("(")+1).split(")-(");if(this.startPoint=new NotationPoint(n[0]),this.endPoint=new NotationPoint(n[1].substring(0,n[1].indexOf(")"))),n[1].includes("+")){var a=n[1].substring(n[1].indexOf("+")+1);this.bonusTileCode=a.substring(0,a.indexOf("(")),n.length>2?(this.bonusEndPoint=new NotationPoint(a.substring(a.indexOf("(")+1)),this.boatBonusPoint=new NotationPoint(n[2].substring(0,n[2].indexOf(")")))):this.bonusEndPoint=new NotationPoint(a.substring(a.indexOf("(")+1,a.indexOf(")")))}}}else this.accentTiles=t.split(",")},CoopSolitaireNotationMove.prototype.hasHarmonyBonus=function(){return void 0!==this.bonusTileCode},CoopSolitaireNotationMove.prototype.isValidNotation=function(){return this.valid},CoopSolitaireNotationMove.prototype.equals=function(e){return this.fullMoveText===e.fullMoveText},CoopSolitaireNotationBuilder.prototype.getFirstMoveForHost=function(e){var t=new CoopSolitaireNotationBuilder;return t.moveType=PLANTING,t.plantedFlowerType=Tile.getClashTileCode(e),(simpleCanonRules||sameStart)&&(t.plantedFlowerType=e),t.endPoint=new NotationPoint("0,8"),t},CoopSolitaireNotationBuilder.prototype.getNotationMove=function(e,t){var o=e+t.charAt(0)+".";return this.moveType===ARRANGING?(o+="("+this.startPoint.pointText+")-("+this.endPoint.pointText+")",this.bonusTileCode&&this.bonusEndPoint&&(o+="+"+this.bonusTileCode+"("+this.bonusEndPoint.pointText+")",this.boatBonusPoint&&(o+="-("+this.boatBonusPoint.pointText+")"))):this.moveType===PLANTING&&(o+=this.plantedFlowerType+"("+this.endPoint.pointText+")"),new CoopSolitaireNotationMove(o)},CoopSolitaireGameNotation.prototype.setNotationText=function(e){this.notationText=e,this.loadMoves()},CoopSolitaireGameNotation.prototype.addNotationLine=function(e){this.notationText+=";"+e.trim(),this.loadMoves()},CoopSolitaireGameNotation.prototype.addMove=function(e){this.notationText?this.notationText+=";"+e.fullMoveText:this.notationText=e.fullMoveText,this.loadMoves()},CoopSolitaireGameNotation.prototype.removeLastMove=function(){this.notationText=this.notationText.substring(0,this.notationText.lastIndexOf(";")),this.loadMoves()},CoopSolitaireGameNotation.prototype.getPlayerMoveNum=function(){var e=0,t=this.moves[this.moves.length-1];return t&&(e=t.moveNum,0===t.moveNum&&t.player===HOST?player=GUEST:0===t.moveNum&&t.player===GUEST?(e++,player=GUEST):t.player===HOST?e++:player=HOST),e},CoopSolitaireGameNotation.prototype.getNotationMoveFromBuilder=function(e){var t=1,o=GUEST,i=this.moves[this.moves.length-1];return i&&(t=i.moveNum,0===i.moveNum&&i.player===HOST?o=GUEST:0===i.moveNum&&i.player===GUEST?(t++,o=GUEST):i.player===HOST?t++:o=HOST),e.getNotationMove(t,o)},CoopSolitaireGameNotation.prototype.loadMoves=function(){this.moves=[];var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t=this,o=HOST;e.forEach((function(e){var i=new CoopSolitaireNotationMove(e);0===i.moveNum&&i.isValidNotation()?t.moves.push(i):i.isValidNotation()&&i.player!==o?(t.moves.push(i),o=i.player):debug("the player check is broken?")}))},CoopSolitaireGameNotation.prototype.getNotationHtml=function(){var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t="";return e.forEach((function(e){t+=e+"<br />"})),t},CoopSolitaireGameNotation.prototype.getNotationForEmail=function(){var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t="";return e.forEach((function(e){t+=e+"[BR]"})),t},CoopSolitaireGameNotation.prototype.notationTextForUrl=function(){return this.notationText},CoopSolitaireGameNotation.prototype.getLastMoveText=function(){return this.moves[this.moves.length-1].fullMoveText},CoopSolitaireGameNotation.prototype.getLastMoveNumber=function(){return this.moves[this.moves.length-1].moveNum},CoopSolitaireHarmony.prototype.equals=function(e){return!(this.ownerName!==e.ownerName||this.ownerCode!==e.ownerCode||this.tile1!==e.tile1&&this.tile1!==e.tile2||this.tile2!==e.tile1&&this.tile2!==e.tile2)},CoopSolitaireHarmony.prototype.notAnyOfThese=function(e){for(var t=0;t<e.length;t++)if(this.equals(e[t]))return!1;return!0},CoopSolitaireHarmony.prototype.containsTile=function(e){return this.tile1===e||this.tile2===e},CoopSolitaireHarmony.prototype.getTileThatIsNotThisOne=function(e){return this.tile1===e?this.tile2:this.tile2===e?this.tile1:void debug("BOTH TILES ARE NOT THAT ONE!")},CoopSolitaireHarmony.prototype.containsTilePos=function(e){return this.tile1Pos.samesies(e)||this.tile2Pos.samesies(e)},CoopSolitaireHarmony.prototype.getPosThatIsNotThisOne=function(e){return this.tile1Pos.samesies(e)?this.tile2Pos:this.tile2Pos.samesies(e)?this.tile1Pos:void debug("\tBOTH TILE POS ARE NOT THAT ONE!")},CoopSolitaireHarmony.prototype.getString=function(){return this.ownerName+" ("+this.tile1Pos.notationPointString+")-("+this.tile2Pos.notationPointString+")"},CoopSolitaireHarmony.prototype.getDirectionForTile=function(e){if(this.containsTile(e)){var t=this.tile1Pos,o=this.tile2Pos;return this.tile2.id===e.id&&(t=this.tile2Pos,o=this.tile1Pos),t.row===o.row?t.col<o.col?"East":"West":t.col===o.col?t.row>o.row?"North":"South":void 0}},CoopSolitaireHarmony.prototype.crossesCenter=function(){var e=this.tile1Pos.row,t=this.tile2Pos.row;if(this.tile1Pos.row<this.tile2Pos.row&&(e=this.tile2Pos.row,t=this.tile1Pos.row),e!==t)return e>8&&t<8;var o=this.tile1Pos.col,i=this.tile2Pos.col;return this.tile1Pos.col<this.tile2Pos.col&&(o=this.tile2Pos.col,i=this.tile1Pos.col),o!==i?o>8&&i<8:void 0},CoopSolitaireHarmonyManager.prototype.printHarmonies=function(){debug("All Harmonies:");for(var e=0;e<this.harmonies.length;e++)debug(this.harmonies[e].getString())},CoopSolitaireHarmonyManager.prototype.getHarmoniesWithThisTile=function(e){var t=[];return this.harmonies.forEach((function(o){o.containsTile(e)&&t.push(o)})),t},CoopSolitaireHarmonyManager.prototype.getClashesWithThisTile=function(e){var t=[];return this.clashes.forEach((function(o){o.containsTile(e)&&t.push(o)})),t},CoopSolitaireHarmonyManager.prototype.addHarmony=function(e){for(var t=!1,o=0;o<this.harmonies.length;o++)e.equals(this.harmonies[o])&&(t=!0);t||this.harmonies.push(e)},CoopSolitaireHarmonyManager.prototype.addHarmonies=function(e){if(e)for(var t=0;t<e.length;t++)this.addHarmony(e[t])},CoopSolitaireHarmonyManager.prototype.addClash=function(e){for(var t=!1,o=0;o<this.clashes.length;o++)e.equals(this.clashes[o])&&(t=!0);t||this.clashes.push(e)},CoopSolitaireHarmonyManager.prototype.addClashes=function(e){if(e)for(var t=0;t<e.length;t++)this.addClash(e[t])},CoopSolitaireHarmonyManager.prototype.clearList=function(){this.harmonies=[],this.clashes=[]},CoopSolitaireHarmonyManager.prototype.getSolitaireGameSummaryText=function(){var e=this.getPlayerWithMostHarmonies(),t=this.numHarmoniesForPlayer(e),o=this.numClashesForPlayer(e),i=t>o?o:t;return debug("Simple Score: "+i),t+" Harmonies <br />"+o+" Disharmonies <br />Simple Score: "+i+"<br /><br />"+(t=this.getHarmonyPointsForPlayer(e,this.harmonies))+" Harmony Points <br />"+(o=this.getHarmonyPointsForPlayer(e,this.clashes))+" Disharmony Points <br />Full Score: "+(t>o?o:t)},CoopSolitaireHarmonyManager.prototype.getHarmonyPointsForPlayer=function(e,t){for(var o=0,i=0;i<t.length;i++){var n=t[i];if(n.ownerName===e){var a=n.getDirectionForTile(n.tile1);"North"===a||"South"===a?o+=Math.abs(n.tile1Pos.row-n.tile2Pos.row)+1:"East"!==a&&"West"!==a||(o+=Math.abs(n.tile1Pos.col-n.tile2Pos.col)+1)}}return o},CoopSolitaireHarmonyManager.prototype.numHarmoniesForPlayer=function(e){for(var t=0,o=0;o<this.harmonies.length;o++)this.harmonies[o].ownerName===e&&t++;return t},CoopSolitaireHarmonyManager.prototype.numClashesForPlayer=function(e){for(var t=0,o=0;o<this.clashes.length;o++)this.clashes[o].ownerName===e&&t++;return t},CoopSolitaireHarmonyManager.prototype.getPlayerWithMostHarmonies=function(){var e=this.numHarmoniesForPlayer(HOST),t=this.numHarmoniesForPlayer(GUEST);return t>e?GUEST:HOST},CoopSolitaireHarmonyManager.prototype.getNumCrossingCenterForPlayer=function(e){for(var t=0,o=0;o<this.harmonies.length;o++)this.harmonies[o].ownerName===e&&this.harmonies[o].crossesCenter()&&t++;return t},CoopSolitaireHarmonyManager.prototype.ringLengthForPlayer=function(e){for(var t=this.getHarmonyChains(),o=0,i=0;i<t.length;i++){var n=t[i];if(n.pop().ownerName===e){n.length>o&&(o=n.length)}}return o},CoopSolitaireHarmonyManager.prototype.getPlayerWithLongestChain=function(){var e=this.ringLengthForPlayer(HOST),t=this.ringLengthForPlayer(GUEST);return t>e?GUEST:e>t?HOST:void 0},CoopSolitaireHarmonyManager.prototype.hasNewHarmony=function(e,t){for(var o=[],i=0;i<this.harmonies.length;i++)if(this.harmonies[i].ownerName===e){for(var n=!1,a=0;a<t.length;a++)this.harmonies[i].equals(t[a])&&(n=!0);n||o.push(this.harmonies[i])}return o.length>0},CoopSolitaireHarmonyManager.prototype.getHarmonyChains=function(){for(var e=this,t=[],o=0;o<this.harmonies.length;o++){var i=this.harmonies[o],n=[];n.push(i);var a=i.tile2,r=(i.tile2Pos,i.tile1),l=(i.tile1Pos,this.lookForRing(a,r,n));if(l[0]){var s=!1;t.forEach((function(t){e.ringsMatch(t,l[1])&&(s=!0)})),s||t.push(l[1])}}return t},CoopSolitaireHarmonyManager.prototype.harmonyRingExists=function(){var e=this,t=this.getHarmonyChains(),o=[];return t.forEach((function(t){debug(t);var i=e.verifyHarmonyRing(t);i&&o.push(i)})),o},CoopSolitaireHarmonyManager.prototype.ringContains345=function(e){for(var t=!1,o=!1,i=!1,n=0;n<e.length;n++){var a=e[n];"3"===a.tile1.basicValue&&(t=!0),"4"===a.tile1.basicValue&&(o=!0),"5"===a.tile1.basicValue&&(i=!0),"3"===a.tile2.basicValue&&(t=!0),"4"===a.tile2.basicValue&&(o=!0),"5"===a.tile2.basicValue&&(i=!0)}return t&&o&&i},CoopSolitaireHarmonyManager.prototype.verifyHarmonyRing=function(e){if(completeHarmony&&!this.ringContains345(e))return!1;var t=[],o=e.pop(),i=o.ownerName;t.push(new NotationPoint(o.tile1Pos.notationPointString).toArr()),t.push(new NotationPoint(o.tile2Pos.notationPointString).toArr());for(var n=o.tile2Pos,a=0;e.length>0&&a<400;){for(var r=0;r<e.length;r++)if((o=e[r]).containsTilePos(n)){var l=new NotationPoint((n=o.getPosThatIsNotThisOne(n)).notationPointString);l.samesies(new NotationPoint(t[0][0]+","+t[0][1]))||t.push(l.toArr()),e.splice(r,1)}a++}return a>390?(debug("THERE WAS A PROBLEM CONNECTING THE DOTS"),!1):!!this.isCenterInsideShape(t)&&i},CoopSolitaireHarmonyManager.prototype.isPointInsideShape=function(e,t){for(var o=e.x,i=e.y,n=!1,a=0,r=t.length-1;a<t.length;r=a++){var l=t[a][0],s=t[a][1],h=t[r][0],d=t[r][1];if(l===o&&h===o&&l*h)return!1;s>i!=d>i&&o<(h-l)*(i-s)/(d-s)+l&&(n=!n)}return n},CoopSolitaireHarmonyManager.prototype.isPointInsideShape_alternate=function(e,t){for(var o=[e.x,e.y],i=!1,n=-1,a=t.length,r=a-1;++n<a;r=n)(t[n][1]<=o[1]&&o[1]<t[r][1]||t[r][1]<=o[1]&&o[1]<t[n][1])&&o[0]<(t[r][0]-t[n][0])*(o[1]-t[n][1])/(t[r][1]-t[n][1])+t[n][0]&&(i=!i);return i},CoopSolitaireHarmonyManager.prototype.isCenterInsideShape=function(e){for(var t=!1,o=0,i=e.length-1;o<e.length;i=o++){var n=e[o][0],a=e[o][1],r=e[i][0],l=e[i][1];if(0===n&&0===r&&a*l<0||0===a&&0===l&&n*r<0)return debug("Crosses center, cannot count"),!1;if(0===n&&0===a||0===r&&0===l)return debug("On center point, cannot count"),!1;a>0!=l>0&&0<(r-n)*(0-a)/(l-a)+n&&(t=!t)}return t},CoopSolitaireHarmonyManager.prototype.ringsMatch=function(e,t){return e.length===t.length&&(e.forEach((function(e){var o=!1;if(t.forEach((function(t){e.equals(t)&&(o=!0)})),!o)return!1})),!0)},CoopSolitaireHarmonyManager.prototype.lookForRing=function(e,t,o){for(var i=0;i<this.harmonies.length;i++){var n=this.harmonies[i];if(n.containsTile(e)&&n.notAnyOfThese(o)){if(o.push(n),n.containsTile(t))return[!0,o];var a=n.getTileThatIsNotThisOne(e);return this.lookForRing(a,t,o)}}return[!1]},CoopSolitaireTile.prototype.setAccentInfo=function(){"R"===this.code?this.accentType=ROCK:"W"===this.code?this.accentType=WHEEL:"K"===this.code?this.accentType=KNOTWEED:"B"===this.code&&(this.accentType=BOAT)},CoopSolitaireTile.prototype.setSpecialFlowerInfo=function(){"L"===this.code?this.specialFlowerType=WHITE_LOTUS:"O"===this.code&&(this.specialFlowerType=ORCHID)},CoopSolitaireTile.prototype.getConsoleDisplay=function(){return this.drained?"*"+this.code:this.ownerCode+""+this.code},CoopSolitaireTile.prototype.getImageName=function(){return this.ownerCode+""+this.code},CoopSolitaireTile.prototype.formsHarmonyWith=function(e){return"L"===this.code&&"O"===e.code||"L"===e.code&&"O"===this.code||!(this.type!==BASIC_FLOWER&&"L"!==this.code||e.type!==BASIC_FLOWER&&"L"!==e.code)&&(!("L"===this.code&&e.type!==BASIC_FLOWER||"L"===e.code&&this.type!==BASIC_FLOWER)&&(!this.drained&&!e.drained&&("L"===this.code&&e.type!==ACCENT_TILE||"L"===e.code&&this.type!==ACCENT_TILE||e.ownerName===this.ownerName&&(this.basicColorCode===e.basicColorCode&&1===Math.abs(this.basicValue-e.basicValue)||(this.basicColorCode!==e.basicColorCode&&2===Math.abs(this.basicValue-e.basicValue)||(this.type!==e.type||(!(!superHarmonies||this.basicValue===e.basicValue)||void 0)))))))},CoopSolitaireTile.prototype.clashesWith=function(e){return this.type!==ACCENT_TILE&&e.type!==ACCENT_TILE&&(this.specialFlowerType===ORCHID||e.specialFlowerType===ORCHID||this.type===BASIC_FLOWER&&e.type===BASIC_FLOWER&&this.basicColorCode!==e.basicColorCode&&this.basicValue===e.basicValue)},CoopSolitaireTile.prototype.getMoveDistance=function(){return this.type===BASIC_FLOWER?parseInt(this.basicValue):"L"===this.code?2:"O"===this.code?6:0},CoopSolitaireTile.prototype.drain=function(){this.type===BASIC_FLOWER&&(this.drained=!0)},CoopSolitaireTile.prototype.restore=function(){this.drained=!1},CoopSolitaireTile.prototype.getName=function(){return CoopSolitaireTile.getTileName(this.code)},CoopSolitaireTile.prototype.getCopy=function(){return new CoopSolitaireTile(this.code,this.ownerCode)},CoopSolitaireTile.getTileName=function(e){var t="";if(e.length>1){var o=e.charAt(0),i=e.charAt(1);"R"===o?("3"===i?t="Rose":"4"===i?t="Chrysanthemum":"5"===i&&(t="Rhododendron"),t+=" (Red "+i+")"):"W"===o&&("3"===i?t="Jasmine":"4"===i?t="Lily":"5"===i&&(t="White Jade"),t+=" (White "+i+")")}else"R"===e?t="Rock":"W"===e?t="Wheel":"K"===e?t="Knotweed":"B"===e?t="Boat":"O"===e?t="Orchid":"L"===e&&(t="White Lotus");return t},CoopSolitaireTile.getClashTileCode=function(e){if(2===e.length){if(e.startsWith("R"))return"W"+e.charAt(1);if(e.startsWith("W"))return"R"+e.charAt(1)}},CoopSolitaireTileManager.prototype.loadTileSet=function(e){return this.loadSolitaireSet(e,!1,!0)},CoopSolitaireTileManager.prototype.loadSolitaireSet=function(e,t,o){var i=[],n=1;if(t&&(n=2),o)for(var a=0;a<2*n;a++)i.push(new SolitaireTile("R",e)),i.push(new SolitaireTile("W",e)),i.push(new SolitaireTile("K",e)),i.push(new SolitaireTile("B",e));for(a=0;a<3*n;a++)i.push(new SolitaireTile("R3",e)),i.push(new SolitaireTile("R4",e)),i.push(new SolitaireTile("R5",e)),i.push(new SolitaireTile("W3",e)),i.push(new SolitaireTile("W4",e)),i.push(new SolitaireTile("W5",e));for(a=0;a<1*n;a++)i.push(new SolitaireTile("L",e)),i.push(new SolitaireTile("O",e));return t&&i.push(new SolitaireTile("L",e)),i},CoopSolitaireTileManager.prototype.loadSkudSet=function(e){for(var t=[],o=0;o<2;o++)t.push(new SolitaireTile("R",e)),t.push(new SolitaireTile("W",e)),t.push(new SolitaireTile("K",e)),t.push(new SolitaireTile("B",e));t.forEach((function(e){e.selectedFromPile=!0}));for(o=0;o<3;o++)t.push(new SolitaireTile("R3",e)),t.push(new SolitaireTile("R4",e)),t.push(new SolitaireTile("R5",e)),t.push(new SolitaireTile("W3",e)),t.push(new SolitaireTile("W4",e)),t.push(new SolitaireTile("W5",e));return t.push(new SolitaireTile("L",e)),t.push(new SolitaireTile("O",e)),t},CoopSolitaireTileManager.prototype.loadSimpleCanonSet=function(e){for(var t=[],o=0;o<2;o++)t.push(new SolitaireTile("W",e));t.forEach((function(e){e.selectedFromPile=!0}));for(o=0;o<6;o++)t.push(new SolitaireTile("R3",e)),t.push(new SolitaireTile("W5",e));return t.push(new SolitaireTile("L",e)),t.push(new SolitaireTile("O",e)),t},CoopSolitaireTileManager.prototype.loadOneOfEach=function(e){var t=[],o=1;gameOptionEnabled(OPTION_DOUBLE_TILES)&&(o=2,t.push(new SolitaireTile("L",e))),gameOptionEnabled(OPTION_INSANE_TILES)&&(o=4);for(var i=0;i<o;i++)t.push(new SolitaireTile("R",e)),t.push(new SolitaireTile("W",e)),t.push(new SolitaireTile("K",e)),t.push(new SolitaireTile("B",e)),t.push(new SolitaireTile("R3",e)),t.push(new SolitaireTile("R4",e)),t.push(new SolitaireTile("R5",e)),t.push(new SolitaireTile("W3",e)),t.push(new SolitaireTile("W4",e)),t.push(new SolitaireTile("W5",e)),t.push(new SolitaireTile("L",e)),t.push(new SolitaireTile("O",e));return t},CoopSolitaireTileManager.prototype.drawRandomTile=function(){if(this.tiles.length>0){var e=this.tiles[Math.floor(Math.random()*this.tiles.length)];return this.peekTile(this.playerCode,e.code)}},CoopSolitaireTileManager.prototype.grabTile=function(e,t){for(var o,i=this.tiles,n=0;n<i.length;n++)if(i[n].code===t){newTileArr=i.splice(n,1),o=newTileArr[0];break}return o||debug("NONE OF THAT TILE FOUND"),o},CoopSolitaireTileManager.prototype.peekTile=function(e,t,o){var i,n=this.tiles;if(o)for(var a=0;a<n.length;a++)if(n[a].id===o)return n[a];for(a=0;a<n.length;a++)if(n[a].code===t){i=n[a];break}return i||debug("NONE OF THAT TILE FOUND"),i},CoopSolitaireTileManager.prototype.removeSelectedTileFlags=function(){this.tiles.forEach((function(e){e.selectedFromPile=!1})),this.tiles.forEach((function(e){e.selectedFromPile=!1}))},CoopSolitaireTileManager.prototype.unselectTiles=function(e){var t=this.tiles;e===GUEST&&(t=this.tiles),t.forEach((function(e){e.selectedFromPile=!1}))},CoopSolitaireTileManager.prototype.putTileBack=function(e){var t=e.ownerName,o=this.tiles;t===GUEST&&(o=this.tiles),o.push(e)},CoopSolitaireTileManager.prototype.aPlayerIsOutOfTiles=function(){var e=this.tiles.length>0;return!e||!e},CoopSolitaireTileManager.prototype.getPlayerWithMoreAccentTiles=function(){for(var e=0,t=0;t<this.tiles.length;t++)this.tiles[t].type===ACCENT_TILE&&e++;var o=0;for(t=0;t<this.tiles.length;t++)this.tiles[t].type===ACCENT_TILE&&o++;return e>o?HOST:o>e?GUEST:void 0},CoopSolitaireTileManager.prototype.playerHasBothSpecialTilesRemaining=function(e){var t=this.tiles;e===GUEST&&(t=this.tiles);var o=0;return t.forEach((function(e){e.type===SPECIAL_FLOWER&&o++})),o>1},CoopSolitaireTileManager.prototype.getCopy=function(){var e=new CoopSolitaireTileManager;return e.tiles=this.copyArr(this.tiles),e.tiles=this.copyArr(this.tiles),e},CoopSolitaireTileManager.prototype.copyArr=function(e){for(var t=[],o=0;o<e.length;o++)t.push(e[o].getCopy());return t},HexentaflActuator.prototype.actuate=function(e){var t=this;window.requestAnimationFrame((function(){t.htmlify(e)}))},HexentaflActuator.prototype.htmlify=function(e){removeChildren(this.boardContainer);var t=this,o=0;if(e.cells[-1]){var i=t.buildRowDiv(1);e.cells[-1].forEach((function(e){e&&t.addBoardPoint(i,e)})),t.boardContainer.appendChild(i)}e.cells.forEach((function(e){var i=t.buildRowDiv(o);o++,e.forEach((function(e){e&&t.addBoardPoint(i,e)})),t.boardContainer.appendChild(i)}))},HexentaflActuator.prototype.buildRowDiv=function(e){var t=createDivWithClass("hexRow");return e%2==1&&t.classList.add("hexRowIndented"),t},HexentaflActuator.prototype.addBoardPoint=function(e,t){var o=document.createElement("div");if(t.types.includes(HexentaflBoardPoint.Types.normal)){var i=t.getNotationPointString();o.setAttribute("name",i),o.setAttribute("title",i)}var n=document.createElement("span");if(o.appendChild(n),this.isMobile?o.classList.add("mobile"):o.classList.add("desktop"),t.types.includes(HexentaflBoardPoint.Types.nonPlayable))o.classList.add("hexagonNoShow");else{if(o.classList.add("hexagon"),t.types.includes(HexentaflBoardPoint.Types.normal)){if(this.isMobile)o.setAttribute("onclick","gameController.pointClicked(this); showPointMessage(this);");else{o.setAttribute("onclick","pointClicked(this);"),o.setAttribute("onmouseover","showPointMessage(this);");o.setAttribute("onmouseout","clearMessage();")}t.types.includes(POSSIBLE_MOVE)&&o.classList.add("possibleMove")}t.hasTile()?(o.classList.add("hexentafl"+t.tile),t.tile):(t.types.includes(HexentaflBoardPoint.Types.throne)&&o.classList.add("throne"),t.types.includes(HexentaflBoardPoint.Types.corner)&&o.classList.add("corner"))}var a=gameController.theGame.board.scoreNeededToWin,r=gameController.theGame.hostScore,l=a-gameController.theGame.guestScore;r>a&&(r=a),l<0&&(l=0);var s=r.toString(),h=l.toString();t.types.includes(HexentaflBoardPoint.Types.scoreTrack)&&(o.classList.add("hexagonScore"),s===t.scoreTrackString&&o.classList.add("hexScoreHost"),h===t.scoreTrackString&&o.classList.add("hexScoreGuest")),e.appendChild(o)};var HexentaflDirections={UP_RIGHT:1,DOWN_RIGHT:2,DOWN:3,UP:4,UP_LEFT:5,DOWN_LEFT:6};function HexentaflBoard(){this.edgeLength=4,gameOptionEnabled(FIVE_SIDED_BOARD)&&(this.edgeLength=5),this.cells=this.brandNew(),this.markSpecialBoardPoints()}function HexentaflBoardPoint(){this.types=[],this.row=-1,this.col=-1,this.notationRowNum=-1,this.notationRowString="",this.notationColNum=-1,this.notationColString=""}HexentaflBoard.prototype.markSpecialBoardPoints=function(){this.thronePoint=null,this.cornerPoints=[],4===this.edgeLength?(this.thronePoint="d4",this.cornerPoints.push("a1"),this.cornerPoints.push("d1"),this.cornerPoints.push("a4"),this.cornerPoints.push("g4"),this.cornerPoints.push("d7"),this.cornerPoints.push("g7")):5===this.edgeLength&&(this.thronePoint="e5",this.cornerPoints.push("a1"),this.cornerPoints.push("e1"),this.cornerPoints.push("a5"),this.cornerPoints.push("i5"),this.cornerPoints.push("e9"),this.cornerPoints.push("i9")),this.thronePoint&&this.getBoardPointFromNotationPoint(this.thronePoint).addType(HexentaflBoardPoint.Types.throne);for(var e=0;e<this.cornerPoints.length;e++)this.getBoardPointFromNotationPoint(this.cornerPoints[e]).addType(HexentaflBoardPoint.Types.corner)},HexentaflBoard.prototype.brandNew=function(){for(var e=[],t=2*this.edgeLength-1,o=0;o<t;o++){var i=o,n=this.edgeLength+i;i>=this.edgeLength&&(n=t-i-1+this.edgeLength);var a=(t-n)/2;i%2==1&&(a=(t-1-n)/2),e[o]=this.newRow(a,n)}for(i=0;i<e.length;i++)for(var r=Math.floor(this.edgeLength/2),l=this.edgeLength-r-Math.floor(i/2),s=0;s<e[i].length;s++){var h=e[i][s];h.row=i,h.col=s,h.setNotationRow(t-i),h.setNotationCol(l+s),HexentaflBoardPoint.notationPointStringMap[h.getNotationPointString()]={row:i,col:s}}return e},HexentaflBoard.prototype.newRow=function(e,t){var o=[],i=0,n=new HexentaflBoardPoint;n.addType(HexentaflBoardPoint.Types.nonPlayable);for(var a=0;a<e;a++)o[i]=n,i++;for(a=0;a<t;a++)o[i]=new HexentaflBoardPoint,o[i].addType(HexentaflBoardPoint.Types.normal),i++;return o},HexentaflBoard.prototype.putTileOnPoint=function(e,t){point=this.getBoardPointFromNotationPoint(t),point.putTile(e)},HexentaflBoard.prototype.getBoardPointFromNotationPoint=function(e){var t=HexentaflBoardPoint.notationPointStringMap[e];if(t)return point=this.cells[t.row][t.col],point},HexentaflBoard.prototype.moveTile=function(e,t){var o=this.getBoardPointFromNotationPoint(e),i=this.getBoardPointFromNotationPoint(t);if(o.types.includes(HexentaflBoardPoint.Types.normal)&&i.types.includes(HexentaflBoardPoint.Types.normal)&&o.hasTile()){var n=o.removeTile();i.putTile(n),this.captureOpponentPiecesSandwichedByMove(i),"K"===n&&(this.kingOnCorner=i.types.includes(HexentaflBoardPoint.Types.corner))}return n},HexentaflBoard.prototype.captureOpponentPiecesSandwichedByMove=function(e){for(var t=e.tile,o=this.getAdjacentPoints(e),i=0;i<o.length;i++){var n=o[i];if(n.hasTile()&&this.tilesAreEnemies(t,n.tile)){debug(e),debug(n);var a=this.getOtherPointsNeededForCapture(n,e);debug(a);for(var r=a.length>0,l=0;l<a.length;l++){var s=a[l];r=r&&s&&s.hasTile()&&!this.tilesAreEnemies(s.tile,t)}if(r)"K"===n.removeTile()&&(this.kingCaptured=!0)}}},HexentaflBoard.prototype.getOtherPointsNeededForCapture=function(e,t){var o=[],i=e.notationRowNum,n=e.notationColNum,a=t.notationRowNum,r=t.notationColNum,l=t.getNotationPointString();if(e.types.includes(HexentaflBoardPoint.Types.corner))for(var s=this.getAdjacentPoints(e),h=this.getAdjacentPoints(t),d=0;d<s.length;d++){var u=s[d];if(u.types.includes(HexentaflBoardPoint.Types.normal)){c1IsAdjacentOrEqual=!1;for(var p=0;p<h.length;p++)c1AdjPoint=h[p],u.getNotationPointString()!==c1AdjPoint.getNotationPointString()&&u.getNotationPointString()!==l||(c1IsAdjacentOrEqual=!0);c1IsAdjacentOrEqual||o.push(u)}}else if(e.types.includes(HexentaflBoardPoint.Types.throne)){if(e.types.includes(HexentaflBoardPoint.Types.throne)){var c=this.getAdjacentPoints(e,1)[0],g=this.getAdjacentPoints(e,2)[0],m=this.getAdjacentPoints(e,3)[0],T=this.getAdjacentPoints(e,4)[0],y=this.getAdjacentPoints(e,5)[0],f=this.getAdjacentPoints(e,6)[0];c.getNotationPointString()===l||m.getNotationPointString()===l||y.getNotationPointString()===l?(o.push(c),o.push(m),o.push(y)):g.getNotationPointString()!==l&&T.getNotationPointString()!==l&&f.getNotationPointString()!==l||(o.push(g),o.push(T),o.push(f)),o=o.filter((function(e,t,o){return e.getNotationPointString()!==l}))}}else{var P=i+(i-a),v=n+(n-r);if(P>0&&v>0){var S=new HexentaflBoardPoint;S.setNotationRow(P),S.setNotationCol(v);var w=S.getNotationPointString(),B=this.getBoardPointFromNotationPoint(w);this.rowAndColIsValid(B)&&o.push(this.getBoardPointFromNotationPoint(w))}}return o},HexentaflBoard.prototype.tilesAreEnemies=function(e,t){return("K"!==e&&"K"!==t||"D"!==e&&"D"!==t)&&e!==t},HexentaflBoard.prototype.setPossibleMovePoints=function(e){if(e.hasTile())for(var t=1;t<=6;t++)this.markEmptyAdjacentPointsAsPlayableInDirection(e.tile,e,t,this.decideMoveDistance(e.tile))},HexentaflBoard.prototype.decideMoveDistance=function(e){if("K"===e){if(!gameOptionEnabled(FIVE_SIDED_BOARD))return 1;if(!gameOptionEnabled(KING_MOVES_LIKE_PAWNS))return 2}return 2*this.edgeLength},HexentaflBoard.prototype.removePossibleMovePoints=function(){this.cells.forEach((function(e){e.forEach((function(e){e.removeType(POSSIBLE_MOVE)}))}))},HexentaflBoard.prototype.markEmptyAdjacentPointsAsPlayableInDirection=function(e,t,o,i){for(var n=this.getAdjacentPoints(t,o),a=0;a<n.length;a++){var r=n[a];!r.types.includes(HexentaflBoardPoint.Types.normal)||r.hasTile()||r.types.includes(POSSIBLE_MOVE)||(r.types.includes(HexentaflBoardPoint.Types.throne)&&"K"!==e||r.addType(POSSIBLE_MOVE),i>1&&this.markEmptyAdjacentPointsAsPlayableInDirection(e,r,o,i-1))}},HexentaflBoard.prototype.getAdjacentNotationPointsFromNotationPoint=function(e,t){var o=this.getBoardPointFromNotationPoint(e);return this.getAdjacentNotationPoints(o,t)},HexentaflBoard.prototype.getAdjacentNotationPoints=function(e,t){var o=e.notationRowNum,i=e.notationColNum,n=[],a=new HexentaflBoardPoint;return t!==HexentaflDirections.UP_RIGHT&&t||(a.setNotationRow(o+1),a.setNotationCol(i),n.push(a.getNotationPointString())),t!==HexentaflDirections.DOWN_RIGHT&&t||((a=new HexentaflBoardPoint).setNotationRow(o+1),a.setNotationCol(i+1),n.push(a.getNotationPointString())),t!==HexentaflDirections.DOWN&&t||((a=new HexentaflBoardPoint).setNotationRow(o),a.setNotationCol(i+1),n.push(a.getNotationPointString())),t!==HexentaflDirections.UP&&t||((a=new HexentaflBoardPoint).setNotationRow(o),a.setNotationCol(i-1),n.push(a.getNotationPointString())),t!==HexentaflDirections.UP_LEFT&&t||((a=new HexentaflBoardPoint).setNotationRow(o-1),a.setNotationCol(i-1),n.push(a.getNotationPointString())),t!==HexentaflDirections.DOWN_LEFT&&t||((a=new HexentaflBoardPoint).setNotationRow(o-1),a.setNotationCol(i),n.push(a.getNotationPointString())),n},HexentaflBoard.prototype.getAdjacentPoints=function(e,t){for(var o=this.getAdjacentNotationPoints(e,t),i=[],n=0;n<o.length;n++){var a=HexentaflBoardPoint.notationPointStringMap[o[n]];a&&this.rowAndColIsValid(a)&&i.push(this.cells[a.row][a.col])}return i},HexentaflBoard.prototype.getValidAdjacentPoints=function(e,t){for(var o=this.getAdjacentPoints(e,t),i=[],n=0;n<o.length;n++){var a=o[n];a.types.includes(HexentaflBoardPoint.Types.normal)&&i.push(a)}return i},HexentaflBoard.prototype.rowAndColIsValid=function(e){return e&&e.row<this.cells.length&&e.row>=0&&e.col<this.cells[e.row].length&&e.col>=0},HexentaflBoard.prototype.hasEmptyAdjacentPoint=function(e){for(var t=this.getAdjacentPoints(e),o=0;o<t.length;o++){var i=t[o];if(i.types.includes(HexentaflBoardPoint.Types.normal)&&!i.hasTile())return!0}return!1},HexentaflBoard.prototype.placeKing=function(e){this.putTileOnPoint("K",e)},HexentaflBoard.prototype.placeDefender=function(e){this.putTileOnPoint("D",e)},HexentaflBoard.prototype.placeAttacker=function(e){this.putTileOnPoint("A",e)},HexentaflBoardPoint.Types={nonPlayable:"Non-Playable",scoreTrack:"Score Track",normal:"Normal",throne:"Throne",corner:"Corner"},HexentaflBoardPoint.prototype.addType=function(e){this.types.includes(e)||this.types.push(e)},HexentaflBoardPoint.prototype.removeType=function(e){for(var t=0;t<this.types.length;t++)this.types[t]===e&&this.types.splice(t,1)},HexentaflBoardPoint.prototype.removeTile=function(){var e=this.tile;return this.tile=null,e},HexentaflBoardPoint.prototype.getNotationPointString=function(){return this.notationColString+this.notationRowString},HexentaflBoardPoint.prototype.setNotationRow=function(e){this.notationRowNum=e,this.notationRowString=e.toString()},HexentaflBoardPoint.prototype.setNotationCol=function(e){this.notationColNum=e,this.notationColString=String.fromCharCode(96+e)},HexentaflBoardPoint.prototype.putTile=function(e){this.tile=e},HexentaflBoardPoint.prototype.hasTile=function(){return this.tile},HexentaflBoardPoint.notationPointStringMap={};var HexentaflVars={};function HexentaflController(e,t){HexentaflVars={DEFENDERS_PLAYER:HOST,ATTACKERS_PLAYER:GUEST},gameOptionEnabled(OPTION_ATTACKERS_MOVE_FIRST)&&(HexentaflVars={ATTACKERS_PLAYER:HOST,DEFENDERS_PLAYER:GUEST}),this.additionalTilePileClass=t?"":"desktop",this.attackersBoardSetupCode=1,this.defendersBoardSetupCode=1,gameOptionEnabled(FIVE_SIDED_BOARD)&&(this.attackersBoardSetupCode=2,this.defendersBoardSetupCode=2),this.actuator=new HexentaflActuator(e,t,this.getHostTilesContainerDivs(),this.getGuestTilesContainerDivs()),this.resetGameManager(),this.resetNotationBuilder(),this.resetGameNotation()}function HexentaflGameManager(e,t,o){this.isCopy=o,this.actuator=e,this.hostScore=0,this.guestScore=0,this.setup(t)}function HexentaflNotationMove(e){this.fullMoveText=e,this.analyzeMove()}function HexentaflNotationBuilder(){this.isKingMove,this.startPoint,this.endPoint,this.status=BRAND_NEW}function HexentaflGameNotation(){this.notationText="",this.moves=[]}function OvergrowthActuator(e,t){this.gameContainer=e,this.mobile=t;var o=setupPaiShoBoard(this.gameContainer,OvergrowthController.getHostTilesContainerDivs(),OvergrowthController.getGuestTilesContainerDivs(),!1);this.boardContainer=o.boardContainer,this.hostTilesContainer=o.hostTilesContainer,this.guestTilesContainer=o.guestTilesContainer}function OvergrowthBoard(){this.size=new RowAndColumn(17,17),this.boardHelper=new PaiShoBoardHelper(OvergrowthBoardPoint,this.size),this.cells=this.brandNew(),this.harmonyManager=new OvergrowthHarmonyManager,this.rockRowAndCols=[],this.playedWhiteLotusTiles=[]}function OvergrowthBoardPoint(){this.types=[],this.row=-1,this.col=-1}function OvergrowthController(e,t){this.actuator=new OvergrowthActuator(e,t),this.showGameMessageUnderneath=!0,this.resetGameNotation(),this.resetGameManager(),this.resetNotationBuilder(),this.drawnTile=null,this.lastDrawnTile=null,this.drawRandomTile(),this.isPaiShoGame=!0}function OvergrowthGameManager(e,t,o){this.isCopy=o,this.actuator=e,this.tileManager=new OvergrowthTileManager,this.setup(t),this.endGameWinners=[]}function OvergrowthNotationMove(e){this.fullMoveText=e,this.analyzeMove()}function OvergrowthNotationBuilder(){this.moveType,this.plantedFlowerType,this.endPoint,this.startPoint,this.bonusTileCode,this.bonusEndPoint,this.boatBonusPoint,this.status=BRAND_NEW}function OvergrowthGameNotation(){this.notationText="",this.moves=[]}function OvergrowthHarmony(e,t,o,i){this.tile1=e,this.tile1Pos=t,this.tile2=o,this.tile2Pos=i,this.tile1.type!==ACCENT_TILE?(this.ownerCode=this.tile1.ownerCode,this.ownerName=this.tile1.ownerName):this.tile2.type!==ACCENT_TILE?(this.ownerCode=this.tile2.ownerCode,this.ownerName=this.tile2.ownerName):debug("ERROR: HARMONY REQUIRES A BASIC FLOWER TILE")}function OvergrowthHarmonyManager(){this.harmonies=[],this.clashes=[]}function OvergrowthTile(e,t){this.code=e,this.ownerCode=t,"G"===this.ownerCode?(this.ownerName=GUEST,this.opponentName=HOST):"H"===this.ownerCode?(this.ownerName=HOST,this.opponentName=GUEST):debug("INCORRECT OWNER CODE"),this.id=tileId++,this.drained=!1,this.selectedFromPile=!1,2===this.code.length&&(this.code.includes("R")||this.code.includes("W"))?(this.type=BASIC_FLOWER,this.basicColorCode=this.code.charAt(0),this.basicValue=this.code.charAt(1),"R"===this.basicColorCode?this.basicColorName=RED:"W"===this.basicColorCode&&(this.basicColorName=WHITE)):"L"===this.code||"O"===this.code?(this.type=SPECIAL_FLOWER,this.setSpecialFlowerInfo()):"R"===this.code||"W"===this.code||"K"===this.code||"B"===this.code?(this.type=ACCENT_TILE,this.setAccentInfo()):debug("Error: Unknown tile type")}function OvergrowthTileManager(e){e?(this.hostTiles=this.loadOneOfEach("H"),this.guestTiles=this.loadOneOfEach("G")):(this.hostTiles=this.loadTileSet("H"),this.guestTiles=this.loadTileSet("G"))}HexentaflController.prototype.getGameTypeId=function(){return GameType.Hexentafl.id},HexentaflController.prototype.completeSetup=function(){HOST===HexentaflVars.DEFENDERS_PLAYER?(this.addSetupForPlayerCode("D",this.defendersBoardSetupCode),this.addSetupForPlayerCode("A",this.attackersBoardSetupCode)):(this.addSetupForPlayerCode("A",this.attackersBoardSetupCode),this.addSetupForPlayerCode("D",this.defendersBoardSetupCode)),rerunAll(),this.callActuate()},HexentaflController.prototype.addSetupForPlayerCode=function(e,t){var o="0"+e+"."+t;debug(o);var i=new HexentaflNotationMove(o);this.gameNotation.addMove(i)},HexentaflController.prototype.resetGameManager=function(){this.theGame=new HexentaflGameManager(this.actuator)},HexentaflController.prototype.resetNotationBuilder=function(){this.notationBuilder=new HexentaflNotationBuilder},HexentaflController.prototype.resetGameNotation=function(){this.gameNotation=this.getNewGameNotation()},HexentaflController.prototype.getNewGameNotation=function(){return new HexentaflGameNotation},HexentaflController.prototype.getHostTilesContainerDivs=function(){return"<div></div>"},HexentaflController.prototype.getGuestTilesContainerDivs=function(){return"<div></div>"},HexentaflController.prototype.callActuate=function(){this.theGame.actuate()},HexentaflController.prototype.resetMove=function(){this.notationBuilder.status===BRAND_NEW&&this.gameNotation.removeLastMove(),rerunAll()},HexentaflController.prototype.getDefaultHelpMessageText=function(){return"<h4>heXentafl</h4><p><em>A Hnefatafl-inspired game played on a hex grid.</em></p><p>The Attackers begin in the corners and win by capturing the King.</p><p>The King and Defenders begin in the center and win by escorting the King to a corner space.</p><p>Read the rules and more about the game <a href='https://nxsgame.wordpress.com/2019/09/26/hexentafl/' target='_blank'>here</a>.</p>"},HexentaflController.prototype.getAdditionalMessage=function(){var e="";return this.gameNotation.moves.length<=2&&(e+=getGameOptionsMessageHtml(GameType.Hexentafl.gameOptions)),e},HexentaflController.prototype.unplayedTileClicked=function(e){},HexentaflController.prototype.pointClicked=function(e){if(!this.theGame.getWinner()&&myTurn())if(currentMoveIndex===this.gameNotation.moves.length){var t=e.getAttribute("name"),o=HexentaflBoardPoint.notationPointStringMap[t],i=this.theGame.board.cells[o.row][o.col];if(this.notationBuilder.status===BRAND_NEW){if(i.hasTile()){if(!this.tileBelongsToCurrentPlayer(i.tile)||!myTurn())return debug("That's not your tile!"),void this.callActuate();this.notationBuilder.status=WAITING_FOR_ENDPOINT,this.notationBuilder.moveType=MOVE,this.notationBuilder.startPoint=t,this.theGame.revealPossibleMovePoints(i)}}else if(this.notationBuilder.status===WAITING_FOR_ENDPOINT)if(i.types.includes(POSSIBLE_MOVE)){this.theGame.hidePossibleMovePoints(),this.notationBuilder.endPoint=t;var n=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.theGame.runNotationMove(n),this.gameNotation.addMove(n),onlinePlayEnabled&&3===this.gameNotation.moves.length?createGameIfThatIsOk(this.getGameTypeId()):playingOnlineGame()?callSubmitMove():finalizeMove()}else this.theGame.hidePossibleMovePoints(),this.resetNotationBuilder()}else debug("Can only interact if all moves are played.")},HexentaflController.prototype.tileBelongsToCurrentPlayer=function(e){return this.getCurrentPlayer()===HexentaflVars.DEFENDERS_PLAYER?"D"===e||"K"===e:"A"===e},HexentaflController.prototype.getTileMessage=function(e){},HexentaflController.prototype.getPointMessage=function(e){},HexentaflController.prototype.playAiTurn=function(e){},HexentaflController.prototype.startAiGame=function(e){},HexentaflController.prototype.getAiList=function(){return[]},HexentaflController.prototype.getCurrentPlayer=function(){return this.gameNotation.moves.length%2==0?HOST:GUEST},HexentaflController.prototype.cleanup=function(){},HexentaflController.prototype.isSolitaire=function(){return!1},HexentaflController.prototype.setGameNotation=function(e){this.gameNotation.setNotationText(e)},HexentaflController.prototype.optionOkToShow=function(e){return e!==KING_MOVES_LIKE_PAWNS||gameOptionEnabled(FIVE_SIDED_BOARD)},HexentaflGameManager.prototype.setup=function(e){this.board=new HexentaflBoard,e||this.actuate()},HexentaflGameManager.prototype.actuate=function(){this.isCopy||this.actuator.actuate(this.board)},HexentaflGameManager.prototype.runNotationMove=function(e,t){if(debug("Running Move: "+e.fullMoveText),e.moveType===INITIAL_SETUP){if("D"===e.playerCode){var o=[],i="";switch(e.boardSetupCode){case"1":i=this.board.thronePoint,o=(o=(o=this.board.getAdjacentNotationPointsFromNotationPoint(i,HexentaflDirections.UP)).concat(this.board.getAdjacentNotationPointsFromNotationPoint(i,HexentaflDirections.DOWN_LEFT))).concat(this.board.getAdjacentNotationPointsFromNotationPoint(i,HexentaflDirections.DOWN_RIGHT));break;case"2":i=this.board.thronePoint;o=this.board.getAdjacentNotationPointsFromNotationPoint(i);break;default:debug("Unknown board setup code for "+HexentaflVars.DEFENDERS_PLAYER)}this.board.placeKing(i);var n=this;o.forEach((function(e){n.board.placeDefender(e)}))}else if("A"===e.playerCode){var a=[];switch(e.boardSetupCode){case"1":a=this.board.cornerPoints,gameOptionEnabled(MORE_ATTACKERS)&&(a.push("f4"),a.push("d6"),a.push("b2"));break;case"2":a=this.board.cornerPoints;for(var r=[],l=0;l<a.length;l++){attackerPoint=a[l];for(var s=this.board.getAdjacentPoints(this.board.getBoardPointFromNotationPoint(attackerPoint)),h=0;h<s.length;h++)this.board.getValidAdjacentPoints(s[h]).length>=6&&r.push(s[h].getNotationPointString())}if(a=a.concat(r),gameOptionEnabled(MORE_ATTACKERS)){for(var d=["e8","h5","b2"],u=0;u<d.length;u++){var p=d[u],c=a.indexOf(p);c>=0&&a.splice(c,1)}a.push("h4"),a.push("i6"),a.push("b1"),a.push("a2"),a.push("d8"),a.push("f9")}break;default:debug("Unknown board setup code for "+HexentaflVars.ATTACKERS_PLAYER)}n=this;a.forEach((function(e){n.board.placeAttacker(e)}))}}else this.board.moveTile(e.startPoint,e.endPoint);t&&this.actuate()},HexentaflGameManager.prototype.revealPossibleMovePoints=function(e,t){e.hasTile()&&(this.board.setPossibleMovePoints(e),t||this.actuate())},HexentaflGameManager.prototype.hidePossibleMovePoints=function(e){this.board.removePossibleMovePoints(),e||this.actuate()},HexentaflGameManager.prototype.hasEnded=function(){return this.getWinResultTypeCode()>0},HexentaflGameManager.prototype.getWinner=function(){return this.board.kingCaptured?HexentaflVars.ATTACKERS_PLAYER:this.board.kingOnCorner?HexentaflVars.DEFENDERS_PLAYER:void 0},HexentaflGameManager.prototype.getWinReason=function(){return this.getWinner()===HexentaflVars.DEFENDERS_PLAYER?" wins! They escorted the King to safety!":this.getWinner()===HexentaflVars.ATTACKERS_PLAYER?" wins! They stormed the castle and captured the King!":void 0},HexentaflGameManager.prototype.getWinResultTypeCode=function(){if(this.getWinner())return 1},HexentaflGameManager.prototype.getCopy=function(){var e=new HexentaflGameManager(this.actuator,!0,!0);return e.board=this.board.getCopy(),e},HexentaflGameManager.prototype.pointIsOpen=function(e){var t=HexentaflBoardPoint.notationPointStringMap[e];return t&&!this.board.cells[t.row][t.col].hasTile()&&this.board.cells[t.row][t.col].types.includes(HexentaflBoardPoint.Types.normal)},HexentaflNotationMove.prototype.analyzeMove=function(){this.valid=!0;var e=(t=this.fullMoveText.split("."))[0];this.moveNum=parseInt(e.slice(0,-1)),this.playerCode=e.charAt(e.length-1),"A"===this.playerCode?this.player=HexentaflVars.ATTACKERS_PLAYER:"D"===this.playerCode&&(this.player=HexentaflVars.DEFENDERS_PLAYER);var t,o=t[1];o?o.includes("-")?(this.moveType=MOVE,"K"===(t=o.split("-"))[0].charAt(0)&&(this.isKingMove=!0,t[0]=t[0].substring(1)),this.startPoint=t[0],this.endPoint=t[1]):(this.moveType=INITIAL_SETUP,this.boardSetupCode=o):this.valid=!1},HexentaflNotationMove.prototype.isValidNotation=function(){return this.valid},HexentaflNotationMove.prototype.equals=function(e){return this.fullMoveText===e.fullMoveText},HexentaflNotationBuilder.prototype.getNotationMove=function(e,t){var o="A";t===HexentaflVars.DEFENDERS_PLAYER&&(o="D");var i=e+o+".";return this.isKingMove&&(i+="K"),this.startPoint&&this.endPoint&&(i+=this.startPoint+"-"+this.endPoint),new HexentaflNotationMove(i)},HexentaflNotationBuilder.prototype.moveComplete=function(){return this.startPoint&&this.endPoint},HexentaflGameNotation.prototype.setNotationText=function(e){this.notationText=e,this.loadMoves()},HexentaflGameNotation.prototype.addNotationLine=function(e){this.notationText+=";"+e.trim(),this.loadMoves()},HexentaflGameNotation.prototype.addMove=function(e){this.notationText?this.notationText+=";"+e.fullMoveText:this.notationText=e.fullMoveText,this.loadMoves()},HexentaflGameNotation.prototype.removeLastMove=function(){this.notationText=this.notationText.substring(0,this.notationText.lastIndexOf(";")),this.loadMoves()},HexentaflGameNotation.prototype.getPlayerMoveNum=function(){var e=0,t=this.moves[this.moves.length-1];return t&&(e=t.moveNum,t.player===GUEST&&e++),e},HexentaflGameNotation.prototype.getNotationMoveFromBuilder=function(e){var t=0,o=HOST,i=this.moves[this.moves.length-1];return i&&(t=i.moveNum,i.player===GUEST?t++:o=GUEST),e.getNotationMove(t,o)},HexentaflGameNotation.prototype.loadMoves=function(){this.moves=[];var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t=this,o=GUEST;new HexentaflNotationMove(e[0]).player===GUEST&&(newAttacker=HexentaflVars.DEFENDERS_PLAYER,newDefender=HexentaflVars.ATTACKERS_PLAYER,HexentaflVars={DEFENDERS_PLAYER:newDefender,ATTACKERS_PLAYER:newAttacker}),e.forEach((function(e){var i=new HexentaflNotationMove(e);i.isValidNotation()&&i.player!==o?(t.moves.push(i),o=i.player):debug("the player check is broken?")}))},HexentaflGameNotation.prototype.getNotationHtml=function(){var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t="";return e.forEach((function(e){t+=e+"<br />"})),t},HexentaflGameNotation.prototype.notationTextForUrl=function(){return this.notationText},HexentaflGameNotation.prototype.getNotationForEmail=function(){var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t="";return e.forEach((function(e){t+=e+"[BR]"})),t},HexentaflGameNotation.prototype.getLastMoveText=function(){return this.moves[this.moves.length-1].fullMoveText},HexentaflGameNotation.prototype.getLastMoveNumber=function(){return this.moves[this.moves.length-1].moveNum},OvergrowthActuator.prototype.actuate=function(e,t,o){var i=this;window.requestAnimationFrame((function(){i.htmlify(e,t,o)}))},OvergrowthActuator.prototype.htmlify=function(e,t,o){this.clearContainer(this.boardContainer);var i=this;e.cells.forEach((function(e){e.forEach((function(e){e&&i.addBoardPoint(e)}))}));var n=new OvergrowthTileManager(!0);n.hostTiles.forEach((function(e){i.clearTileContainer(e)})),n.guestTiles.forEach((function(e){i.clearTileContainer(e)})),!t.getWinner()&&o&&this.addTile(o)},OvergrowthActuator.prototype.clearContainer=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},OvergrowthActuator.prototype.clearTileContainer=function(e){for(var t=document.querySelector("."+e.getImageName());t.firstChild;)t.removeChild(t.firstChild)},OvergrowthActuator.prototype.addTile=function(e,t){var o=document.querySelector("."+e.getImageName()),i=document.createElement("div");i.classList.add("point"),i.classList.add("hasTile"),e.selectedFromPile&&(i.classList.add("selectedFromPile"),i.classList.add("drained"));var n=document.createElement("img"),a=getSkudTilesSrcPath();n.src=a+e.getImageName()+".png",i.appendChild(n),i.setAttribute("name",e.getImageName()),i.setAttribute("id",e.id),this.mobile?i.setAttribute("onclick","unplayedTileClicked(this); showTileMessage(this);"):(i.setAttribute("onclick","unplayedTileClicked(this);"),i.setAttribute("onmouseover","showTileMessage(this);"),i.setAttribute("onmouseout","clearMessage();")),o.appendChild(i)},OvergrowthActuator.prototype.addBoardPoint=function(e){var t=createBoardPointDiv(e);if(e.isType(NON_PLAYABLE)||(t.classList.add("activePoint"),e.isType(POSSIBLE_MOVE)?t.classList.add("possibleMove"):e.betweenHarmony&&(t.classList.add("betweenHarmony"),e.betweenHarmonyHost&&t.classList.add("bhHost"),e.betweenHarmonyGuest&&t.classList.add("bhGuest")),this.mobile?t.setAttribute("onclick","pointClicked(this); showPointMessage(this);"):(t.setAttribute("onclick","pointClicked(this);"),t.setAttribute("onmouseover","showPointMessage(this);"),t.setAttribute("onmouseout","clearMessage();"))),e.hasTile()){t.classList.add("hasTile");var o=document.createElement("img"),i=getSkudTilesSrcPath();o.src=i+e.tile.getImageName()+".png",e.tile.inHarmony&&t.classList.add(HOST+"harmony"),e.tile.inClash&&t.classList.add(GUEST+"harmony"),t.appendChild(o)}if(this.boardContainer.appendChild(t),e.betweenHarmony&&16===e.col){var n=document.createElement("div");n.classList.add("clear"),this.boardContainer.appendChild(n)}},OvergrowthActuator.prototype.printBoard=function(e){debug("");var t=0;e.cells.forEach((function(e){var o=t+"\t: ";e.forEach((function(e){var t=e.getConsoleDisplay();t.length<3&&(o+=" "),o+=t,t.length<2&&(o+=" ")})),debug(o),t++})),debug("")},OvergrowthBoard.prototype.brandNew=function(){return this.boardHelper.generateBoardCells()},OvergrowthBoard.prototype.placeTile=function(e,t){this.boardHelper.putTileOnPoint(e,t,this.cells),this.analyzeHarmonies()},OvergrowthBoard.prototype.markSpacesBetweenHarmonies=function(){this.cells.forEach((function(e){e.forEach((function(e){e.betweenHarmony=!1,e.betweenHarmonyHost=!1,e.betweenHarmonyGuest=!1}))}));var e=this;this.harmonyManager.harmonies.forEach((function(t){if(t.tile1Pos.row===t.tile2Pos.row){var o=t.tile1Pos.row,i=t.tile1Pos.col,n=t.tile2Pos.col;t.tile2Pos.col<t.tile1Pos.col&&(i=t.tile2Pos.col,n=t.tile1Pos.col);for(var a=i+1;a<n;a++)e.cells[o][a].betweenHarmony=!0,e.cells[o][a].betweenHarmonyHost=!0}else if(t.tile2Pos.col==t.tile2Pos.col){a=t.tile1Pos.col;var r=t.tile1Pos.row,l=t.tile2Pos.row;t.tile2Pos.row<t.tile1Pos.row&&(r=t.tile2Pos.row,l=t.tile1Pos.row);for(o=r+1;o<l;o++)e.cells[o][a].betweenHarmony=!0,e.cells[o][a].betweenHarmonyHost=!0}})),this.harmonyManager.clashes.forEach((function(t){if(t.tile1Pos.row===t.tile2Pos.row){var o=t.tile1Pos.row,i=t.tile1Pos.col,n=t.tile2Pos.col;t.tile2Pos.col<t.tile1Pos.col&&(i=t.tile2Pos.col,n=t.tile1Pos.col);for(var a=i+1;a<n;a++)e.cells[o][a].betweenHarmony=!0,e.cells[o][a].betweenHarmonyGuest=!0}else if(t.tile2Pos.col==t.tile2Pos.col){a=t.tile1Pos.col;var r=t.tile1Pos.row,l=t.tile2Pos.row;t.tile2Pos.row<t.tile1Pos.row&&(r=t.tile2Pos.row,l=t.tile1Pos.row);for(o=r+1;o<l;o++)e.cells[o][a].betweenHarmony=!0,e.cells[o][a].betweenHarmonyGuest=!0}}))},OvergrowthBoard.prototype.analyzeHarmonies=function(){this.harmonyManager.clearList();for(var e=0;e<this.cells.length;e++)for(var t=0;t<this.cells[e].length;t++){var o=this.cells[e][t];if(o.hasTile()){var i=this.getTileHarmonies(o.tile,new RowAndColumn(e,t));this.harmonyManager.addHarmonies(i);var n=this.getTileClashes(o.tile,new RowAndColumn(e,t));this.harmonyManager.addClashes(n),o.tile.inHarmony=i.length>0,o.tile.inClash=n.length>0}}this.markSpacesBetweenHarmonies()},OvergrowthBoard.prototype.getTileHarmonies=function(e,t){var o=[],i=this.getHarmonyLeft(e,t);i&&o.push(i);var n=this.getHarmonyRight(e,t);n&&o.push(n);var a=this.getHarmonyUp(e,t);a&&o.push(a);var r=this.getHarmonyDown(e,t);return r&&o.push(r),o},OvergrowthBoard.prototype.getHarmonyLeft=function(e,t){for(var o=t.col-1;o>=0&&!this.cells[t.row][o].hasTile();)o--;if(o>=0){var i=this.cells[t.row][o];if(e.formsHarmonyWith(i.tile))return new OvergrowthHarmony(e,t,i.tile,new RowAndColumn(t.row,o))}},OvergrowthBoard.prototype.getHarmonyRight=function(e,t){for(var o=t.col+1;o<=16&&!this.cells[t.row][o].hasTile();)o++;if(o<=16){var i=this.cells[t.row][o];if(e.formsHarmonyWith(i.tile))return new OvergrowthHarmony(e,t,i.tile,new RowAndColumn(t.row,o))}},OvergrowthBoard.prototype.getHarmonyUp=function(e,t){for(var o=t.row-1;o>=0&&!this.cells[o][t.col].hasTile();)o--;if(o>=0){var i=this.cells[o][t.col];if(e.formsHarmonyWith(i.tile))return new OvergrowthHarmony(e,t,i.tile,new RowAndColumn(o,t.col))}},OvergrowthBoard.prototype.getHarmonyDown=function(e,t){for(var o=t.row+1;o<=16&&!this.cells[o][t.col].hasTile();)o++;if(o<=16){var i=this.cells[o][t.col];if(e.formsHarmonyWith(i.tile))return new OvergrowthHarmony(e,t,i.tile,new RowAndColumn(o,t.col))}},OvergrowthBoard.prototype.getTileClashes=function(e,t){var o=[],i=this.getClashLeft(e,t);i&&o.push(i);var n=this.getClashRight(e,t);n&&o.push(n);var a=this.getClashUp(e,t);a&&o.push(a);var r=this.getClashDown(e,t);return r&&o.push(r),o},OvergrowthBoard.prototype.getClashLeft=function(e,t){for(var o=t.col-1;o>=0&&!this.cells[t.row][o].hasTile();)o--;if(o>=0){var i=this.cells[t.row][o];if(e.clashesWith(i.tile))return new OvergrowthHarmony(e,t,i.tile,new RowAndColumn(t.row,o))}},OvergrowthBoard.prototype.getClashRight=function(e,t){for(var o=t.col+1;o<=16&&!this.cells[t.row][o].hasTile();)o++;if(o<=16){var i=this.cells[t.row][o];if(e.clashesWith(i.tile))return new OvergrowthHarmony(e,t,i.tile,new RowAndColumn(t.row,o))}},OvergrowthBoard.prototype.getClashUp=function(e,t){for(var o=t.row-1;o>=0&&!this.cells[o][t.col].hasTile();)o--;if(o>=0){var i=this.cells[o][t.col];if(e.clashesWith(i.tile))return new OvergrowthHarmony(e,t,i.tile,new RowAndColumn(o,t.col))}},OvergrowthBoard.prototype.getClashDown=function(e,t){for(var o=t.row+1;o<=16&&!this.cells[o][t.col].hasTile();)o++;if(o<=16){var i=this.cells[o][t.col];if(e.clashesWith(i.tile))return new OvergrowthHarmony(e,t,i.tile,new RowAndColumn(o,t.col))}},OvergrowthBoard.prototype.hasNewHarmony=function(e,t,o,i){var n=this.harmonyManager.harmonies;return this.analyzeHarmonies(),this.harmonyManager.hasNewHarmony(e,n)},OvergrowthBoard.prototype.hasDisharmony=function(e){var t=e.tile,o=!1;return this.hasDisharmonyLeft(t,e)&&(o=!0),this.hasDisharmonyRight(t,e)&&(o=!0),this.hasDisharmonyUp(t,e)&&(o=!0),this.hasDisharmonyDown(t,e)&&(o=!0),o},OvergrowthBoard.prototype.hasDisharmonyLeft=function(e,t){for(var o=t.col-1;o>=0&&!this.cells[t.row][o].hasTile();)o--;if(o>=0){var i=this.cells[t.row][o];if(e.clashesWith(i.tile))return!0}},OvergrowthBoard.prototype.hasDisharmonyRight=function(e,t){for(var o=t.col+1;o<=16&&!this.cells[t.row][o].hasTile();)o++;if(o<=16){var i=this.cells[t.row][o];if(e.clashesWith(i.tile))return!0}},OvergrowthBoard.prototype.hasDisharmonyUp=function(e,t){for(var o=t.row-1;o>=0&&!this.cells[o][t.col].hasTile();)o--;if(o>=0){var i=this.cells[o][t.col];if(e.clashesWith(i.tile))return!0}},OvergrowthBoard.prototype.hasDisharmonyDown=function(e,t){for(var o=t.row+1;o<=16&&!this.cells[o][t.col].hasTile();)o++;if(o<=16){var i=this.cells[o][t.col];if(e.clashesWith(i.tile))return!0}},OvergrowthBoard.prototype.setPossibleMovePoints=function(e){if(e.hasTile())for(var t=e.tile.ownerName,o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++)this.canMoveTileToPoint(t,e,this.cells[o][i])&&this.cells[o][i].addType(POSSIBLE_MOVE)},OvergrowthBoard.prototype.removePossibleMovePoints=function(){this.cells.forEach((function(e){e.forEach((function(e){e.removeType(POSSIBLE_MOVE)}))}))},OvergrowthBoard.prototype.setAllPossiblePointsOpen=function(e,t){for(var o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++){var n=this.cells[o][i];if(n.canHoldTile(e)){var a=n.getCopy();a.putTile(e),t===HOST?this.hasDisharmony(a)||this.cells[o][i].addType(POSSIBLE_MOVE):t===GUEST&&!this.getTileHarmonies(a.tile,a).length>0&&this.cells[o][i].addType(POSSIBLE_MOVE)}}},OvergrowthBoard.prototype.setHarmonyAndClashPointsOpen=function(e){for(var t=!1,o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++){var n=this.cells[o][i];if(n.canHoldTile(e)){var a=n.getCopy();a.putTile(e),(this.hasDisharmony(a)||this.getTileHarmonies(a.tile,a).length>0)&&(this.cells[o][i].addType(POSSIBLE_MOVE),t=!0)}}return t},OvergrowthBoard.prototype.setSolitaireAccentPointsOpen=function(e){for(var t=0;t<this.cells.length;t++)for(var o=0;o<this.cells[t].length;o++){var i=this.cells[t][o],n=[];t>2&&n.push(this.cells[t-2][o]),t<14&&n.push(this.cells[t+2][o]),o>2&&n.push(this.cells[t][o-2]),o<14&&n.push(this.cells[t][o+2]);for(var a=!1,r=0;r<n.length;r++)n[r].isCompletelyWithinRedOrWhiteGarden()&&(a=!0);i.isType(RED)&&i.isType(WHITE)&&(a=!0),a&&i.canHoldTile(e)&&this.cells[t][o].addType(POSSIBLE_MOVE)}},OvergrowthBoard.prototype.playerControlsLessThanTwoGates=function(e){for(var t=0,o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++){var n=this.cells[o][i];n.isType(GATE)&&n.hasTile()&&n.tile.ownerName===e&&t++}return t<2},OvergrowthBoard.prototype.playerHasNoGrowingFlowers=function(e){for(var t=0;t<this.cells.length;t++)for(var o=0;o<this.cells[t].length;o++){var i=this.cells[t][o];if(i.isType(GATE)&&i.hasTile()&&i.tile.ownerName===e)return!1}return!0},OvergrowthBoard.prototype.revealSpecialFlowerPlacementPoints=function(e){var t,o=[],i=0,n=8;(t=this.cells[i][n]).hasTile()&&t.tile.ownerName===e&&(o.push(this.cells[i][n-1]),o.push(this.cells[i][n+1])),i=16,(t=this.cells[i][n]).hasTile()&&t.tile.ownerName===e&&(o.push(this.cells[i][n-1]),o.push(this.cells[i][n+1])),i=8,n=0,(t=this.cells[i][n]).hasTile()&&t.tile.ownerName===e&&(o.push(this.cells[i-1][n]),o.push(this.cells[i+1][n])),n=16,(t=this.cells[i][n]).hasTile()&&t.tile.ownerName===e&&(o.push(this.cells[i-1][n]),o.push(this.cells[i+1][n])),o.forEach((function(e){e.hasTile()||e.addType(POSSIBLE_MOVE)}))},OvergrowthBoard.prototype.setGuestGateOpen=function(){this.cells[16][8].isOpenGate()&&this.cells[16][8].addType(POSSIBLE_MOVE)},OvergrowthBoard.prototype.revealPossiblePlacementPoints=function(e){var t=this;this.cells.forEach((function(o){o.forEach((function(o){var i=!1;(e.accentType===ROCK&&t.canPlaceRock(o)||e.accentType===WHEEL&&t.canPlaceWheel(o)||e.accentType===KNOTWEED&&t.canPlaceKnotweed(o)||e.accentType===BOAT&&t.canPlaceBoat(o,e))&&(i=!0),i&&o.addType(POSSIBLE_MOVE)}))}))},OvergrowthBoard.prototype.revealBoatBonusPoints=function(e){if(e.hasTile()){var t=e.tile.ownerName;if(newKnotweedRules)for(var o=this.getSurroundingRowAndCols(e),i=0;i<o.length;i++){var n=this.cells[o[i].row][o[i].col];this.canTransportTileToPoint(e,n)&&n.addType(POSSIBLE_MOVE)}else for(var a=0;a<this.cells.length;a++)for(var r=0;r<this.cells[a].length;r++){n=this.cells[a][r];Math.abs(e.row-n.row)+Math.abs(e.col-n.col)===1&&this.canMoveTileToPoint(t,e,n)&&n.addType(POSSIBLE_MOVE)}}},OvergrowthBoard.prototype.getCopy=function(){for(var e=new OvergrowthBoard,t=0;t<this.cells.length;t++)for(var o=0;o<this.cells[t].length;o++)e.cells[t][o]=this.cells[t][o].getCopy();return e.analyzeHarmonies(),e},OvergrowthBoard.prototype.numTilesInGardensForPlayer=function(e){for(var t=0,o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++){var n=this.cells[o][i];1===n.types.length&&n.hasTile()&&n.isType(n.tile.basicColorName)&&t++}return t},OvergrowthBoard.prototype.numTilesOnBoardForPlayer=function(e){for(var t=0,o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++){var n=this.cells[o][i];n.hasTile()&&n.tile.ownerName===e&&t++}return t},OvergrowthBoard.prototype.getSurroundness=function(e){for(var t=0,o=0,i=0,n=0,a=0,r=0,l=0,s=0,h=0;h<this.cells.length;h++)for(var d=0;d<this.cells[h].length;d++){var u=this.cells[h][d];u.hasTile()&&u.tile.ownerName===e&&(u.row>8&&(i++,n=1),u.row<8&&(t++,o=1),u.col<8&&(a++,r=1),u.col>8&&(l++,s=1))}var p=t;return i<p&&(p=i),a<p&&(p=a),l<p&&(p=l),0===p?o+n+r+s:4*p},OvergrowthBoardPoint.prototype.addType=function(e){this.types.includes(e)||this.types.push(e)},OvergrowthBoardPoint.prototype.removeType=function(e){for(var t=0;t<this.types.length;t++)this.types[t]===e&&this.types.splice(t,1)},OvergrowthBoardPoint.prototype.getConsoleDisplay=function(){if(this.tile)return this.tile.getConsoleDisplay();var e=thinDot;this.types.includes(NON_PLAYABLE)&&(e=" ");var t="";return this.types.includes(RED)&&(t="R",e=thickDot),this.types.includes(WHITE)&&(t+="W",e=whiteDot),this.types.includes(NEUTRAL)&&(t+="N"),this.types.includes(GATE)&&(t="G",e=gateDot),t.length>1&&(e="+"),e},OvergrowthBoardPoint.prototype.putTile=function(e){this.tile=e},OvergrowthBoardPoint.prototype.hasTile=function(){return!!this.tile},OvergrowthBoardPoint.prototype.isType=function(e){return this.types.includes(e)},OvergrowthBoardPoint.prototype.isOpenGate=function(){return!this.hasTile()&&this.types.includes(GATE)},OvergrowthBoardPoint.prototype.removeTile=function(){var e=this.tile;return this.tile=null,e},OvergrowthBoardPoint.prototype.drainTile=function(){this.tile&&this.tile.drain()},OvergrowthBoardPoint.prototype.restoreTile=function(){this.tile&&this.tile.restore()},OvergrowthBoardPoint.prototype.canHoldTile=function(e,t){return!this.isType(NON_PLAYABLE)&&(!(!t&&this.hasTile())&&(!!this.isType(GATE)||(e.type===BASIC_FLOWER?!(!this.isType(NEUTRAL)&&!this.isType(e.basicColorName)):e.type===SPECIAL_FLOWER||e.type===ACCENT_TILE)))},OvergrowthBoardPoint.prototype.isCompletelyWithinRedOrWhiteGarden=function(){return!this.isType(NEUTRAL)&&(this.isType(RED)&&!this.isType(WHITE)||this.isType(WHITE)&&!this.isType(RED))},OvergrowthBoardPoint.prototype.betweenPlayerHarmony=function(e){return e===GUEST?this.betweenHarmonyGuest:e===HOST&&this.betweenHarmonyHost},OvergrowthBoardPoint.prototype.getCopy=function(){for(var e=new OvergrowthBoardPoint,t=0;t<this.types.length;t++)e.types.push(this.types[t]);return e.row=this.row,e.col=this.col,this.hasTile()&&(e.tile=this.tile.getCopy()),e},OvergrowthBoardPoint.neutral=function(){var e=new OvergrowthBoardPoint;return e.addType(NEUTRAL),e},OvergrowthBoardPoint.gate=function(){var e=new OvergrowthBoardPoint;return e.addType(GATE),e},OvergrowthBoardPoint.red=function(){var e=new OvergrowthBoardPoint;return e.addType(RED),e},OvergrowthBoardPoint.white=function(){var e=new OvergrowthBoardPoint;return e.addType(WHITE),e},OvergrowthBoardPoint.redWhite=function(){var e=new OvergrowthBoardPoint;return e.addType(RED),e.addType(WHITE),e},OvergrowthBoardPoint.redWhiteNeutral=function(){var e=new OvergrowthBoardPoint;return e.addType(RED),e.addType(WHITE),e.addType(NEUTRAL),e},OvergrowthBoardPoint.redNeutral=function(){var e=new OvergrowthBoardPoint;return e.addType(RED),e.addType(NEUTRAL),e},OvergrowthBoardPoint.whiteNeutral=function(){var e=new OvergrowthBoardPoint;return e.addType(WHITE),e.addType(NEUTRAL),e},OvergrowthController.prototype.getGameTypeId=function(){return GameType.OvergrowthPaiSho.id},OvergrowthController.prototype.completeSetup=function(){this.callActuate()},OvergrowthController.prototype.drawRandomTile=function(){this.lastDrawnTile=this.drawnTile,this.drawnTile=this.theGame.drawRandomTile(this.getCurrentPlayer())},OvergrowthController.prototype.resetGameManager=function(){this.theGame=new OvergrowthGameManager(this.actuator)},OvergrowthController.prototype.resetNotationBuilder=function(){this.notationBuilder=new OvergrowthNotationBuilder},OvergrowthController.prototype.resetGameNotation=function(){this.gameNotation=this.getNewGameNotation()},OvergrowthController.prototype.getNewGameNotation=function(){return new OvergrowthGameNotation},OvergrowthController.getHostTilesContainerDivs=function(){return'<div class="HR3 HR4 HR5 HW3 HW4 HW5 HR HW HK HB HL HO">'},OvergrowthController.getGuestTilesContainerDivs=function(){return'<div class="GR3 GR4 GR5 GW3 GW4 GW5 GR GW GK GB GL GO">'},OvergrowthController.prototype.callActuate=function(){this.drawnTile&&(this.theGame.tileManager.peekTile(this.getCurrentPlayer(),this.drawnTile.code,this.drawnTile.id)||(this.drawnTile=null,this.lastDrawnTile=null,this.drawRandomTile()));this.theGame.actuate()},OvergrowthController.prototype.resetMove=function(){this.gameNotation.removeLastMove(),this.drawnTile&&(this.drawnTile.selectedFromPile=!1,this.theGame.tileManager.putTileBack(this.drawnTile)),this.drawnTile=this.lastDrawnTile,this.drawnTile.selectedFromPile=!1},OvergrowthController.prototype.getDefaultHelpMessageText=function(){return"<h4>Overgrowth Pai Sho</h4> <p>A competitive variant of Solitaire Pai Sho.</p><p>Players alternate drawing and placing a tile, following the same placement rules as Solitaire Pai Sho, with these clarifications:<ul><li>Tiles form harmony or disharmony regardless of whose tile it is</li><li>Like tiles form disharmony (for example, Rose (R3) forms disharmony with Rose (R3))</li></ul></p><p>The game ends when all tiles have been played. The winner is as follows: <ul><li>The Host wins if there are more Harmonies on the board</li><li>The Guest wins if there are more Disharmonies on the board</li></ul></p>"},OvergrowthController.prototype.getAdditionalMessage=function(){var e="";return 0===this.gameNotation.moves.length&&(e+=getGameOptionsMessageHtml(GameType.OvergrowthPaiSho.gameOptions)),this.theGame.getWinner()||(e+="<br /><strong>"+this.theGame.getScoreSummary()+"</strong>"),e},OvergrowthController.prototype.unplayedTileClicked=function(e){if(myTurn())if(currentMoveIndex===this.gameNotation.moves.length){var t=e.getAttribute("name"),o=parseInt(e.getAttribute("id")),i=t.charAt(0),n=t.substring(1),a=GUEST;"H"===i&&(a=HOST);var r=this.theGame.tileManager.peekTile(a,n,o);this.notationBuilder.status===BRAND_NEW?(r.selectedFromPile=!0,this.drawnTile.selectedFromPile=!0,this.notationBuilder.moveType=PLANTING,this.notationBuilder.plantedFlowerType=n,this.notationBuilder.status=WAITING_FOR_ENDPOINT,this.theGame.setAllLegalPointsOpen(getCurrentPlayer(),r)):(this.theGame.hidePossibleMovePoints(),this.notationBuilder=new OvergrowthNotationBuilder)}else debug("Can only interact if all moves are played.")},OvergrowthController.prototype.pointClicked=function(e){if(currentMoveIndex===this.gameNotation.moves.length){var t=new NotationPoint(e.getAttribute("name")).rowAndColumn,o=this.theGame.board.cells[t.row][t.col];if(this.notationBuilder.status===WAITING_FOR_ENDPOINT)if(o.isType(POSSIBLE_MOVE)){this.theGame.hidePossibleMovePoints(),this.notationBuilder.endPoint=new NotationPoint(e.getAttribute("name"));var i=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.theGame.runNotationMove(i),this.gameNotation.addMove(i),this.drawRandomTile(),onlinePlayEnabled&&1===this.gameNotation.moves.length?createGameIfThatIsOk(GameType.OvergrowthPaiSho.id):playingOnlineGame()?callSubmitMove():finalizeMove()}else this.theGame.hidePossibleMovePoints(),this.notationBuilder=new OvergrowthNotationBuilder}else debug("Can only interact if all moves are played.")},OvergrowthController.prototype.getTileMessage=function(e){var t=e.getAttribute("name");parseInt(e.getAttribute("id")),new OvergrowthTile(t.substring(1),t.charAt(0));t.startsWith("G");var o=t.substring(1);return{heading:OvergrowthTile.getTileName(o),message:[]}},OvergrowthController.prototype.getPointMessage=function(e){var t=new NotationPoint(e.getAttribute("name")).rowAndColumn,o=this.theGame.board.cells[t.row][t.col],i=[];return o.hasTile()?i.push(toHeading(o.tile.getName())):o.isType(NEUTRAL)?i.push(getNeutralPointMessage()):o.isType(RED)&&o.isType(WHITE)?i.push(getRedWhitePointMessage()):o.isType(RED)?i.push(getRedPointMessage()):o.isType(WHITE)?i.push(getWhitePointMessage()):o.isType(GATE)&&i.push(getNeutralPointMessage()),{heading:null,message:i}},OvergrowthController.prototype.playAiTurn=function(e){},OvergrowthController.prototype.startAiGame=function(e){},OvergrowthController.prototype.getAiList=function(){return[]},OvergrowthController.prototype.getCurrentPlayer=function(){return this.gameNotation.moves.length%2==0?HOST:GUEST},OvergrowthController.prototype.cleanup=function(){},OvergrowthController.prototype.isSolitaire=function(){return!1},OvergrowthController.prototype.setGameNotation=function(e){this.drawnTile&&(this.drawnTile.selectedFromPile=!1,this.theGame.tileManager.putTileBack(this.drawnTile)),this.resetGameManager(),this.gameNotation.setNotationText(e),this.drawRandomTile(),this.theGame.actuate()},OvergrowthGameManager.prototype.setup=function(e){this.board=new OvergrowthBoard},OvergrowthGameManager.prototype.actuate=function(){this.isCopy||this.actuator.actuate(this.board,gameController.theGame,gameController.drawnTile)},OvergrowthGameManager.prototype.runNotationMove=function(e,t){debug("Running Move: "+e.fullMoveText);if(e.moveType===PLANTING){var o=this.tileManager.grabTile(e.player,e.plantedFlowerType);this.board.placeTile(o,e.endPoint)}return t&&this.actuate(),this.endGameWinners=[],this.tileManager.noMoreTilesLeft()&&this.endGameWinners.push(this.board.harmonyManager.getWinningPlayer()),!1},OvergrowthGameManager.prototype.drawRandomTile=function(e){return this.tileManager.drawRandomTile(e)},OvergrowthGameManager.prototype.revealPossibleMovePoints=function(e,t){e.hasTile()&&(this.board.setPossibleMovePoints(e),t||this.actuate())},OvergrowthGameManager.prototype.hidePossibleMovePoints=function(e){this.board.removePossibleMovePoints(),this.tileManager.removeSelectedTileFlags(),e||this.actuate()},OvergrowthGameManager.prototype.setAllLegalPointsOpen=function(e,t,o){t.type===ACCENT_TILE?this.board.setSolitaireAccentPointsOpen(t):this.board.setHarmonyAndClashPointsOpen(t,e)||this.board.setAllPossiblePointsOpen(t,e),o||this.actuate()},OvergrowthGameManager.prototype.playerCanBonusPlant=function(e){return!newGatesRule||(lessBonus?this.board.playerHasNoGrowingFlowers(e):newGatesRule?this.board.playerControlsLessThanTwoGates(e):void 0)},OvergrowthGameManager.prototype.revealSpecialFlowerPlacementPoints=function(e){newSpecialFlowerRules?(this.board.revealSpecialFlowerPlacementPoints(e),this.actuate()):this.revealOpenGates(e)},OvergrowthGameManager.prototype.revealPossiblePlacementPoints=function(e){this.board.revealPossiblePlacementPoints(e),this.actuate()},OvergrowthGameManager.prototype.revealBoatBonusPoints=function(e){this.board.revealBoatBonusPoints(e),this.actuate()},OvergrowthGameManager.prototype.playerHasNotPlayedEitherSpecialTile=function(e){return this.tileManager.playerHasBothSpecialTilesRemaining(e)},OvergrowthGameManager.prototype.getWinner=function(){if(1===this.endGameWinners.length)return this.endGameWinners[0]},OvergrowthGameManager.prototype.getWinReason=function(){var e="";return this.getWinner()&&(e+=" won the game!"),e+"<br /><br />"+this.board.harmonyManager.getScoreSummaryText()},OvergrowthGameManager.prototype.getScoreSummary=function(){var e=this.tileManager.guestTiles.length;return"<br />"+this.board.harmonyManager.getScoreSummaryText()+"<br />"+e+" tiles remaining."},OvergrowthGameManager.prototype.getWinResultTypeCode=function(){if(1===this.endGameWinners.length)return 1},OvergrowthGameManager.prototype.getCopy=function(){var e=new OvergrowthGameManager(this.actuator,!0,!0);return e.board=this.board.getCopy(),e.tileManager=this.tileManager.getCopy(),e},OvergrowthNotationMove.prototype.analyzeMove=function(){this.valid=!0;var e=(n=this.fullMoveText.split("."))[0];this.moveNum=parseInt(e.slice(0,-1)),this.playerCode=e.charAt(e.length-1),"G"===this.playerCode?this.player=GUEST:"H"===this.playerCode&&(this.player=HOST);var t=n[1];if(t)if(0!==this.moveNum){var o=t.charAt(0);if(this.moveType=PLANTING,this.moveType===PLANTING){var i=t.charAt(1);this.plantedFlowerType=o,"("!==i&&(this.plantedFlowerType=this.plantedFlowerType+""+i),"("===t.charAt(2)||"("===t.charAt(1)||(debug("Failure to plant"),this.valid=!1),t.endsWith(")")?this.endPoint=new NotationPoint(t.substring(t.indexOf("(")+1,t.indexOf(")"))):this.valid=!1}if(this.moveType===ARRANGING){var n=t.substring(t.indexOf("(")+1).split(")-(");if(this.startPoint=new NotationPoint(n[0]),this.endPoint=new NotationPoint(n[1].substring(0,n[1].indexOf(")"))),n[1].includes("+")){var a=n[1].substring(n[1].indexOf("+")+1);this.bonusTileCode=a.substring(0,a.indexOf("(")),n.length>2?(this.bonusEndPoint=new NotationPoint(a.substring(a.indexOf("(")+1)),this.boatBonusPoint=new NotationPoint(n[2].substring(0,n[2].indexOf(")")))):this.bonusEndPoint=new NotationPoint(a.substring(a.indexOf("(")+1,a.indexOf(")")))}}}else this.accentTiles=t.split(",")},OvergrowthNotationMove.prototype.hasHarmonyBonus=function(){return void 0!==this.bonusTileCode},OvergrowthNotationMove.prototype.isValidNotation=function(){return this.valid},OvergrowthNotationMove.prototype.equals=function(e){return this.fullMoveText===e.fullMoveText},OvergrowthNotationBuilder.prototype.getFirstMoveForHost=function(e){var t=new OvergrowthNotationBuilder;return t.moveType=PLANTING,t.plantedFlowerType=Tile.getClashTileCode(e),(simpleCanonRules||sameStart)&&(t.plantedFlowerType=e),t.endPoint=new NotationPoint("0,8"),t},OvergrowthNotationBuilder.prototype.getNotationMove=function(e,t){var o=e+t.charAt(0)+".";return this.moveType===ARRANGING?(o+="("+this.startPoint.pointText+")-("+this.endPoint.pointText+")",this.bonusTileCode&&this.bonusEndPoint&&(o+="+"+this.bonusTileCode+"("+this.bonusEndPoint.pointText+")",this.boatBonusPoint&&(o+="-("+this.boatBonusPoint.pointText+")"))):this.moveType===PLANTING&&(o+=this.plantedFlowerType+"("+this.endPoint.pointText+")"),new OvergrowthNotationMove(o)},OvergrowthGameNotation.prototype.setNotationText=function(e){this.notationText=e,this.loadMoves()},OvergrowthGameNotation.prototype.addNotationLine=function(e){this.notationText+=";"+e.trim(),this.loadMoves()},OvergrowthGameNotation.prototype.addMove=function(e){this.notationText?this.notationText+=";"+e.fullMoveText:this.notationText=e.fullMoveText,this.loadMoves()},OvergrowthGameNotation.prototype.removeLastMove=function(){this.notationText=this.notationText.substring(0,this.notationText.lastIndexOf(";")),this.loadMoves()},OvergrowthGameNotation.prototype.getPlayerMoveNum=function(){var e=0,t=this.moves[this.moves.length-1];return t&&(e=t.moveNum,0===t.moveNum&&t.player===HOST?player=GUEST:0===t.moveNum&&t.player===GUEST?(e++,player=GUEST):t.player===HOST?e++:player=HOST),e},OvergrowthGameNotation.prototype.getNotationMoveFromBuilder=function(e){var t=1,o=HOST,i=this.moves[this.moves.length-1];return i&&(t=i.moveNum,i.player===GUEST?t++:o=GUEST),e.getNotationMove(t,o)},OvergrowthGameNotation.prototype.loadMoves=function(){this.moves=[];var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t=this,o=GUEST;e.forEach((function(e){var i=new OvergrowthNotationMove(e);0===i.moveNum&&i.isValidNotation()?t.moves.push(i):i.isValidNotation()&&i.player!==o?(t.moves.push(i),o=i.player):debug("the player check is broken?")}))},OvergrowthGameNotation.prototype.getNotationHtml=function(){var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t="";return e.forEach((function(e){t+=e+"<br />"})),t},OvergrowthGameNotation.prototype.getNotationForEmail=function(){var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t="";return e.forEach((function(e){t+=e+"[BR]"})),t},OvergrowthGameNotation.prototype.notationTextForUrl=function(){return this.notationText},OvergrowthGameNotation.prototype.getLastMoveText=function(){return this.moves[this.moves.length-1].fullMoveText},OvergrowthGameNotation.prototype.getLastMoveNumber=function(){return this.moves[this.moves.length-1].moveNum},OvergrowthHarmony.prototype.equals=function(e){return!(this.tile1!==e.tile1&&this.tile1!==e.tile2||this.tile2!==e.tile1&&this.tile2!==e.tile2)},OvergrowthHarmony.prototype.notAnyOfThese=function(e){for(var t=0;t<e.length;t++)if(this.equals(e[t]))return!1;return!0},OvergrowthHarmony.prototype.containsTile=function(e){return this.tile1===e||this.tile2===e},OvergrowthHarmony.prototype.getTileThatIsNotThisOne=function(e){return this.tile1===e?this.tile2:this.tile2===e?this.tile1:void debug("BOTH TILES ARE NOT THAT ONE!")},OvergrowthHarmony.prototype.containsTilePos=function(e){return this.tile1Pos.samesies(e)||this.tile2Pos.samesies(e)},OvergrowthHarmony.prototype.getPosThatIsNotThisOne=function(e){return this.tile1Pos.samesies(e)?this.tile2Pos:this.tile2Pos.samesies(e)?this.tile1Pos:void debug("\tBOTH TILE POS ARE NOT THAT ONE!")},OvergrowthHarmony.prototype.getString=function(){return this.ownerName+" ("+this.tile1Pos.notationPointString+")-("+this.tile2Pos.notationPointString+")"},OvergrowthHarmony.prototype.getDirectionForTile=function(e){if(this.containsTile(e)){var t=this.tile1Pos,o=this.tile2Pos;return this.tile2.id===e.id&&(t=this.tile2Pos,o=this.tile1Pos),t.row===o.row?t.col<o.col?"East":"West":t.col===o.col?t.row>o.row?"North":"South":void 0}},OvergrowthHarmony.prototype.crossesCenter=function(){var e=this.tile1Pos.row,t=this.tile2Pos.row;if(this.tile1Pos.row<this.tile2Pos.row&&(e=this.tile2Pos.row,t=this.tile1Pos.row),e!==t)return e>8&&t<8;var o=this.tile1Pos.col,i=this.tile2Pos.col;return this.tile1Pos.col<this.tile2Pos.col&&(o=this.tile2Pos.col,i=this.tile1Pos.col),o!==i?o>8&&i<8:void 0},OvergrowthHarmonyManager.prototype.printHarmonies=function(){debug("All Harmonies:");for(var e=0;e<this.harmonies.length;e++)debug(this.harmonies[e].getString())},OvergrowthHarmonyManager.prototype.getHarmoniesWithThisTile=function(e){var t=[];return this.harmonies.forEach((function(o){o.containsTile(e)&&t.push(o)})),t},OvergrowthHarmonyManager.prototype.getClashesWithThisTile=function(e){var t=[];return this.clashes.forEach((function(o){o.containsTile(e)&&t.push(o)})),t},OvergrowthHarmonyManager.prototype.addHarmony=function(e){for(var t=!1,o=0;o<this.harmonies.length;o++)e.equals(this.harmonies[o])&&(t=!0);t||this.harmonies.push(e)},OvergrowthHarmonyManager.prototype.addHarmonies=function(e){if(e)for(var t=0;t<e.length;t++)this.addHarmony(e[t])},OvergrowthHarmonyManager.prototype.addClash=function(e){for(var t=!1,o=0;o<this.clashes.length;o++)e.equals(this.clashes[o])&&(t=!0);t||this.clashes.push(e)},OvergrowthHarmonyManager.prototype.addClashes=function(e){if(e)for(var t=0;t<e.length;t++)this.addClash(e[t])},OvergrowthHarmonyManager.prototype.clearList=function(){this.harmonies=[],this.clashes=[]},OvergrowthHarmonyManager.prototype.getWinningPlayer=function(){if(gameOptionEnabled(FULL_POINTS_SCORING)){var e=this.getHarmonyPoints(this.harmonies),t=this.getHarmonyPoints(this.clashes);if(e>t)return HOST;if(t>e)return GUEST}else{if(this.numHarmonies()>this.numClashes())return HOST;if(this.numClashes()>this.numHarmonies())return GUEST}},OvergrowthHarmonyManager.prototype.getScoreSummaryText=function(){var e=this.numHarmonies()+" Harmonies <br />"+this.numClashes()+" Disharmonies <br />";return e+="<br />"+this.getHarmonyPoints(this.harmonies)+" Harmony Points <br />"+this.getHarmonyPoints(this.clashes)+" Disharmony Points <br />"},OvergrowthHarmonyManager.prototype.getHarmonyPoints=function(e){for(var t=0,o=0;o<e.length;o++){var i=e[o],n=i.getDirectionForTile(i.tile1);"North"===n||"South"===n?t+=Math.abs(i.tile1Pos.row-i.tile2Pos.row)+1:"East"!==n&&"West"!==n||(t+=Math.abs(i.tile1Pos.col-i.tile2Pos.col)+1)}return t},OvergrowthHarmonyManager.prototype.numHarmonies=function(){return this.harmonies.length},OvergrowthHarmonyManager.prototype.numClashes=function(){return this.clashes.length},OvergrowthTile.prototype.setAccentInfo=function(){"R"===this.code?this.accentType=ROCK:"W"===this.code?this.accentType=WHEEL:"K"===this.code?this.accentType=KNOTWEED:"B"===this.code&&(this.accentType=BOAT)},OvergrowthTile.prototype.setSpecialFlowerInfo=function(){"L"===this.code?this.specialFlowerType=WHITE_LOTUS:"O"===this.code&&(this.specialFlowerType=ORCHID)},OvergrowthTile.prototype.getConsoleDisplay=function(){return this.drained?"*"+this.code:this.ownerCode+""+this.code},OvergrowthTile.prototype.getImageName=function(){return this.ownerCode+""+this.code},OvergrowthTile.prototype.formsHarmonyWith=function(e){return"L"===this.code&&"O"===e.code||"L"===e.code&&"O"===this.code||!(this.type!==BASIC_FLOWER&&"L"!==this.code||e.type!==BASIC_FLOWER&&"L"!==e.code)&&(!("L"===this.code&&e.type!==BASIC_FLOWER||"L"===e.code&&this.type!==BASIC_FLOWER)&&("L"===this.code&&e.type!==ACCENT_TILE||"L"===e.code&&this.type!==ACCENT_TILE||(this.basicColorCode===e.basicColorCode&&1===Math.abs(this.basicValue-e.basicValue)||(this.basicColorCode!==e.basicColorCode&&2===Math.abs(this.basicValue-e.basicValue)||(this.type!==e.type||(!(!superHarmonies||this.basicValue===e.basicValue)||void 0))))))},OvergrowthTile.prototype.clashesWith=function(e){return this.type!==ACCENT_TILE&&e.type!==ACCENT_TILE&&(this.specialFlowerType===ORCHID||e.specialFlowerType===ORCHID||this.type===BASIC_FLOWER&&e.type===BASIC_FLOWER&&this.basicValue===e.basicValue)},OvergrowthTile.prototype.getMoveDistance=function(){return this.type===BASIC_FLOWER?parseInt(this.basicValue):"L"===this.code?2:"O"===this.code?6:0},OvergrowthTile.prototype.drain=function(){this.type===BASIC_FLOWER&&(this.drained=!0)},OvergrowthTile.prototype.restore=function(){this.drained=!1},OvergrowthTile.prototype.getName=function(){return OvergrowthTile.getTileName(this.code)},OvergrowthTile.prototype.getCopy=function(){return new OvergrowthTile(this.code,this.ownerCode)},OvergrowthTile.getTileName=function(e){var t="";if(e.length>1){var o=e.charAt(0),i=e.charAt(1);"R"===o?("3"===i?t="Rose":"4"===i?t="Chrysanthemum":"5"===i&&(t="Rhododendron"),t+=" (Red "+i+")"):"W"===o&&("3"===i?t="Jasmine":"4"===i?t="Lily":"5"===i&&(t="White Jade"),t+=" (White "+i+")")}else"R"===e?t="Rock":"W"===e?t="Wheel":"K"===e?t="Knotweed":"B"===e?t="Boat":"O"===e?t="Orchid":"L"===e&&(t="White Lotus");return t},OvergrowthTile.getClashTileCode=function(e){if(2===e.length){if(e.startsWith("R"))return"W"+e.charAt(1);if(e.startsWith("W"))return"R"+e.charAt(1)}},OvergrowthTileManager.prototype.loadTileSet=function(e){return this.loadPlayerTileSet(e,!1,!0)},OvergrowthTileManager.prototype.loadPlayerTileSet=function(e,t,o){var i=[],n=1,a=2;gameOptionEnabled(OPTION_FULL_TILES)&&(n=2,a=3);for(var r=0;r<n;r++)i.push(new OvergrowthTile("R",e)),i.push(new OvergrowthTile("W",e)),i.push(new OvergrowthTile("K",e)),i.push(new OvergrowthTile("B",e));for(r=0;r<a;r++)i.push(new OvergrowthTile("R3",e)),i.push(new OvergrowthTile("R4",e)),i.push(new OvergrowthTile("R5",e)),i.push(new OvergrowthTile("W3",e)),i.push(new OvergrowthTile("W4",e)),i.push(new OvergrowthTile("W5",e));return i.push(new OvergrowthTile("L",e)),i.push(new OvergrowthTile("O",e)),e===hostPlayerCode&&gameOptionEnabled(OPTION_FULL_TILES)&&i.push(new OvergrowthTile("R3",e)),i},OvergrowthTileManager.prototype.loadOneOfEach=function(e){var t=[],o=1;gameOptionEnabled(OPTION_DOUBLE_TILES)&&(o=2,t.push(new OvergrowthTile("L",e))),gameOptionEnabled(OPTION_INSANE_TILES)&&(o=4);for(var i=0;i<o;i++)t.push(new OvergrowthTile("R",e)),t.push(new OvergrowthTile("W",e)),t.push(new OvergrowthTile("K",e)),t.push(new OvergrowthTile("B",e)),t.push(new OvergrowthTile("R3",e)),t.push(new OvergrowthTile("R4",e)),t.push(new OvergrowthTile("R5",e)),t.push(new OvergrowthTile("W3",e)),t.push(new OvergrowthTile("W4",e)),t.push(new OvergrowthTile("W5",e)),t.push(new OvergrowthTile("L",e)),t.push(new OvergrowthTile("O",e));return t},OvergrowthTileManager.prototype.noMoreTilesLeft=function(){return 0===this.hostTiles.length&&0===this.guestTiles.length},OvergrowthTileManager.prototype.getCopy=function(){var e=new OvergrowthTileManager;return e.hostTiles=copyArray(this.hostTiles),e.guestTiles=copyArray(this.guestTiles),e},OvergrowthTileManager.prototype.grabTile=function(e,t){for(var o,i=this.getTilePile(e),n=0;n<i.length;n++)if(i[n].code===t){newTileArr=i.splice(n,1),o=newTileArr[0];break}return o||debug("NONE OF THAT TILE FOUND"),o},OvergrowthTileManager.prototype.putTileBack=function(e){var t=e.ownerName;this.getTilePile(t).push(e)},OvergrowthTileManager.prototype.removeSelectedTileFlags=function(){this.hostTiles.forEach((function(e){e.selectedFromPile=!1})),this.guestTiles.forEach((function(e){e.selectedFromPile=!1}))},OvergrowthTileManager.prototype.peekTile=function(e,t,o){var i,n=this.getTilePile(e);if(o)for(var a=0;a<n.length;a++)if(n[a].id===o)return n[a];for(a=0;a<n.length;a++)if(n[a].code===t){i=n[a];break}return i||debug("NONE OF THAT TILE FOUND"),i},OvergrowthTileManager.prototype.drawRandomTile=function(e){var t=this.getTilePile(e);if(t.length>0){var o=t[Math.floor(Math.random()*t.length)];return this.peekTile(getPlayerCodeFromName(e),o.code)}},OvergrowthTileManager.prototype.getTilePile=function(e){var t=this.hostTiles;return e!==GUEST&&e!==guestPlayerCode||(t=this.guestTiles),t};var paiShoBoardMaxRowOrCol=16;function PaiShoBoardHelper(e,t){this.boardPointClass=e,this.size=t}PaiShoBoardHelper.prototype.putTileOnPoint=function(e,t,o){var i=t.rowAndColumn;(i=o[i.row][i.col]).putTile(e)},PaiShoBoardHelper.prototype.isValidRowCol=function(e){return e.row>=0&&e.col>=0&&e.row<=16&&e.col<=16},PaiShoBoardHelper.prototype.getClockwiseRowCol=function(e,t){return t.row<e.row&&t.col<=e.col?new RowAndColumn(t.row,t.col+1):t.col>e.col&&t.row<=e.row?new RowAndColumn(t.row+1,t.col):t.row>e.row&&t.col>=e.col?new RowAndColumn(t.row,t.col-1):t.col<e.col&&t.row>=e.row?new RowAndColumn(t.row-1,t.col):void debug("ERROR CLOCKWISE CALCULATING")},PaiShoBoardHelper.prototype.getSurroundingRowAndCols=function(e,t){for(var o=[],i=e.row-1;i<=e.row+1;i++)for(var n=e.col-1;n<=e.col+1;n++){if((i!==e.row||n!==e.col)&&i>=0&&n>=0&&i<17&&n<17)t[i][n].isType(NON_PLAYABLE)||o.push(new RowAndColumn(i,n))}return o},PaiShoBoardHelper.prototype.generateBoardCells=function(){var e=[];e[0]=this.newRow(9,[this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.gate(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral()]),e[1]=this.newRow(11,[this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.redWhiteNeutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral()]),e[2]=this.newRow(13,[this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.whiteNeutral(),this.boardPointClass.redWhite(),this.boardPointClass.redNeutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral()]),e[3]=this.newRow(15,[this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.whiteNeutral(),this.boardPointClass.white(),this.boardPointClass.redWhite(),this.boardPointClass.red(),this.boardPointClass.redNeutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral()]),e[4]=this.newRow(17,[this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.whiteNeutral(),this.boardPointClass.white(),this.boardPointClass.white(),this.boardPointClass.redWhite(),this.boardPointClass.red(),this.boardPointClass.red(),this.boardPointClass.redNeutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral()]),e[5]=this.newRow(17,[this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.whiteNeutral(),this.boardPointClass.white(),this.boardPointClass.white(),this.boardPointClass.white(),this.boardPointClass.redWhite(),this.boardPointClass.red(),this.boardPointClass.red(),this.boardPointClass.red(),this.boardPointClass.redNeutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral()]),e[6]=this.newRow(17,[this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.whiteNeutral(),this.boardPointClass.white(),this.boardPointClass.white(),this.boardPointClass.white(),this.boardPointClass.white(),this.boardPointClass.redWhite(),this.boardPointClass.red(),this.boardPointClass.red(),this.boardPointClass.red(),this.boardPointClass.red(),this.boardPointClass.redNeutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral()]),e[7]=this.newRow(17,[this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.whiteNeutral(),this.boardPointClass.white(),this.boardPointClass.white(),this.boardPointClass.white(),this.boardPointClass.white(),this.boardPointClass.white(),this.boardPointClass.redWhite(),this.boardPointClass.red(),this.boardPointClass.red(),this.boardPointClass.red(),this.boardPointClass.red(),this.boardPointClass.red(),this.boardPointClass.redNeutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral()]),e[8]=this.newRow(17,[this.boardPointClass.gate(),this.boardPointClass.redWhiteNeutral(),this.boardPointClass.redWhite(),this.boardPointClass.redWhite(),this.boardPointClass.redWhite(),this.boardPointClass.redWhite(),this.boardPointClass.redWhite(),this.boardPointClass.redWhite(),this.boardPointClass.redWhite(),this.boardPointClass.redWhite(),this.boardPointClass.redWhite(),this.boardPointClass.redWhite(),this.boardPointClass.redWhite(),this.boardPointClass.redWhite(),this.boardPointClass.redWhite(),this.boardPointClass.redWhiteNeutral(),this.boardPointClass.gate()]),e[9]=this.newRow(17,[this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.redNeutral(),this.boardPointClass.red(),this.boardPointClass.red(),this.boardPointClass.red(),this.boardPointClass.red(),this.boardPointClass.red(),this.boardPointClass.redWhite(),this.boardPointClass.white(),this.boardPointClass.white(),this.boardPointClass.white(),this.boardPointClass.white(),this.boardPointClass.white(),this.boardPointClass.whiteNeutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral()]),e[10]=this.newRow(17,[this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.redNeutral(),this.boardPointClass.red(),this.boardPointClass.red(),this.boardPointClass.red(),this.boardPointClass.red(),this.boardPointClass.redWhite(),this.boardPointClass.white(),this.boardPointClass.white(),this.boardPointClass.white(),this.boardPointClass.white(),this.boardPointClass.whiteNeutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral()]),e[11]=this.newRow(17,[this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.redNeutral(),this.boardPointClass.red(),this.boardPointClass.red(),this.boardPointClass.red(),this.boardPointClass.redWhite(),this.boardPointClass.white(),this.boardPointClass.white(),this.boardPointClass.white(),this.boardPointClass.whiteNeutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral()]),e[12]=this.newRow(17,[this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.redNeutral(),this.boardPointClass.red(),this.boardPointClass.red(),this.boardPointClass.redWhite(),this.boardPointClass.white(),this.boardPointClass.white(),this.boardPointClass.whiteNeutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral()]),e[13]=this.newRow(15,[this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.redNeutral(),this.boardPointClass.red(),this.boardPointClass.redWhite(),this.boardPointClass.white(),this.boardPointClass.whiteNeutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral()]),e[14]=this.newRow(13,[this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.redNeutral(),this.boardPointClass.redWhite(),this.boardPointClass.whiteNeutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral()]),e[15]=this.newRow(11,[this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.redWhiteNeutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral()]),e[16]=this.newRow(9,[this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.gate(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral(),this.boardPointClass.neutral()]);for(var t=0;t<e.length;t++)for(var o=0;o<e[t].length;o++)e[t][o].row=t,e[t][o].col=o;return e},PaiShoBoardHelper.prototype.newRow=function(e,t){var o=[],i=(this.size.row-e)/2,n=new this.boardPointClass;n.addType(NON_PLAYABLE);for(var a=0;a<this.size.row;a++)o[a]=a<i?n:a<i+e&&t?t[a-i]:n;return o};var hostPlayerCode="H",guestPlayerCode="G";function getPlayerCodeFromName(e){return e===HOST?hostPlayerCode:e===GUEST?guestPlayerCode:void 0}function getPlayerNameFromCode(e){return e===hostPlayerCode?HOST:e===guestPlayerCode?GUEST:void 0}function getOpponentName(e){return e===HOST?GUEST:HOST}function PaiJoActuator(e,t,o,i){this.gameContainer=e,this.isMobile=t,removeChildren(e);var n=createDivWithClass("hostTilesContainer"),a=createDivWithClass("guestTilesContainer"),r=createDivWithClass("board-container"),l=createDivWithId("response"),s=createDivWithClass("gameMessage"),h=createDivWithClass("tilePileContainer"),d=createDivWithClass("gameMessage2");o=o,i=i;n.innerHTML=o,a.innerHTML=i,h.appendChild(l),h.appendChild(s),h.appendChild(n),h.appendChild(a),h.appendChild(d),e.appendChild(r),e.appendChild(h);var u={hostTilesContainer:n,guestTilesContainer:a};this.boardContainer="",this.hostTilesContainer=u.hostTilesContainer,this.guestTilesContainer=u.guestTilesContainer}PaiJoActuator.prototype.actuate=function(e){window.requestAnimationFrame((function(){}))};var PaiJoDirections={UP_RIGHT:1,DOWN_RIGHT:2,DOWN:3,UP:4,UP_LEFT:5,DOWN_LEFT:6};function PaiJoBoard(){this.edgeLength=4,gameOptionEnabled(FIVE_SIDED_BOARD)&&(this.edgeLength=5),this.cells=this.brandNew(),this.markSpecialBoardPoints()}function PaiJoBoardPoint(){this.types=[],this.row=-1,this.col=-1,this.notationRowNum=-1,this.notationRowString="",this.notationColNum=-1,this.notationColString=""}PaiJoBoard.prototype.markSpecialBoardPoints=function(){this.thronePoint=null,this.cornerPoints=[],4===this.edgeLength?(this.thronePoint="d4",this.cornerPoints.push("a1"),this.cornerPoints.push("d1"),this.cornerPoints.push("a4"),this.cornerPoints.push("g4"),this.cornerPoints.push("d7"),this.cornerPoints.push("g7")):5===this.edgeLength&&(this.thronePoint="e5",this.cornerPoints.push("a1"),this.cornerPoints.push("e1"),this.cornerPoints.push("a5"),this.cornerPoints.push("i5"),this.cornerPoints.push("e9"),this.cornerPoints.push("i9")),this.thronePoint&&this.getBoardPointFromNotationPoint(this.thronePoint).addType(PaiJoBoardPoint.Types.throne);for(var e=0;e<this.cornerPoints.length;e++)this.getBoardPointFromNotationPoint(this.cornerPoints[e]).addType(PaiJoBoardPoint.Types.corner)},PaiJoBoard.prototype.brandNew=function(){for(var e=[],t=2*this.edgeLength-1,o=0;o<t;o++){var i=o,n=this.edgeLength+i;i>=this.edgeLength&&(n=t-i-1+this.edgeLength);var a=(t-n)/2;i%2==1&&(a=(t-1-n)/2),e[o]=this.newRow(a,n)}for(i=0;i<e.length;i++)for(var r=Math.floor(this.edgeLength/2),l=this.edgeLength-r-Math.floor(i/2),s=0;s<e[i].length;s++){var h=e[i][s];h.row=i,h.col=s,h.setNotationRow(t-i),h.setNotationCol(l+s),PaiJoBoardPoint.notationPointStringMap[h.getNotationPointString()]={row:i,col:s}}return e},PaiJoBoard.prototype.newRow=function(e,t){var o=[],i=0,n=new PaiJoBoardPoint;n.addType(PaiJoBoardPoint.Types.nonPlayable);for(var a=0;a<e;a++)o[i]=n,i++;for(a=0;a<t;a++)o[i]=new PaiJoBoardPoint,o[i].addType(PaiJoBoardPoint.Types.normal),i++;return o},PaiJoBoard.prototype.putTileOnPoint=function(e,t){point=this.getBoardPointFromNotationPoint(t),point.putTile(e)},PaiJoBoard.prototype.getBoardPointFromNotationPoint=function(e){var t=PaiJoBoardPoint.notationPointStringMap[e];if(t)return point=this.cells[t.row][t.col],point},PaiJoBoard.prototype.moveTile=function(e,t){var o=this.getBoardPointFromNotationPoint(e),i=this.getBoardPointFromNotationPoint(t);if(o.types.includes(PaiJoBoardPoint.Types.normal)&&i.types.includes(PaiJoBoardPoint.Types.normal)&&o.hasTile()){var n=o.removeTile();i.putTile(n),this.captureOpponentPiecesSandwichedByMove(i),"K"===n&&(this.kingOnCorner=i.types.includes(PaiJoBoardPoint.Types.corner))}return n},PaiJoBoard.prototype.captureOpponentPiecesSandwichedByMove=function(e){for(var t=e.tile,o=this.getAdjacentPoints(e),i=0;i<o.length;i++){var n=o[i];if(n.hasTile()&&this.tilesAreEnemies(t,n.tile)){debug(e),debug(n);var a=this.getOtherPointsNeededForCapture(n,e);debug(a);for(var r=a.length>0,l=0;l<a.length;l++){var s=a[l];r=r&&s&&s.hasTile()&&!this.tilesAreEnemies(s.tile,t)}if(r)"K"===n.removeTile()&&(this.kingCaptured=!0)}}},PaiJoBoard.prototype.getOtherPointsNeededForCapture=function(e,t){var o=[],i=e.notationRowNum,n=e.notationColNum,a=t.notationRowNum,r=t.notationColNum,l=t.getNotationPointString();if(e.types.includes(PaiJoBoardPoint.Types.corner))for(var s=this.getAdjacentPoints(e),h=this.getAdjacentPoints(t),d=0;d<s.length;d++){var u=s[d];if(u.types.includes(PaiJoBoardPoint.Types.normal)){c1IsAdjacentOrEqual=!1;for(var p=0;p<h.length;p++)c1AdjPoint=h[p],u.getNotationPointString()!==c1AdjPoint.getNotationPointString()&&u.getNotationPointString()!==l||(c1IsAdjacentOrEqual=!0);c1IsAdjacentOrEqual||o.push(u)}}else if(e.types.includes(PaiJoBoardPoint.Types.throne)){if(e.types.includes(PaiJoBoardPoint.Types.throne)){var c=this.getAdjacentPoints(e,1)[0],g=this.getAdjacentPoints(e,2)[0],m=this.getAdjacentPoints(e,3)[0],T=this.getAdjacentPoints(e,4)[0],y=this.getAdjacentPoints(e,5)[0],f=this.getAdjacentPoints(e,6)[0];c.getNotationPointString()===l||m.getNotationPointString()===l||y.getNotationPointString()===l?(o.push(c),o.push(m),o.push(y)):g.getNotationPointString()!==l&&T.getNotationPointString()!==l&&f.getNotationPointString()!==l||(o.push(g),o.push(T),o.push(f)),o=o.filter((function(e,t,o){return e.getNotationPointString()!==l}))}}else{var P=i+(i-a),v=n+(n-r);if(P>0&&v>0){var S=new PaiJoBoardPoint;S.setNotationRow(P),S.setNotationCol(v);var w=S.getNotationPointString(),B=this.getBoardPointFromNotationPoint(w);this.rowAndColIsValid(B)&&o.push(this.getBoardPointFromNotationPoint(w))}}return o},PaiJoBoard.prototype.tilesAreEnemies=function(e,t){return("K"!==e&&"K"!==t||"D"!==e&&"D"!==t)&&e!==t},PaiJoBoard.prototype.setPossibleMovePoints=function(e){if(e.hasTile())for(var t=1;t<=6;t++)this.markEmptyAdjacentPointsAsPlayableInDirection(e.tile,e,t,this.decideMoveDistance(e.tile))},PaiJoBoard.prototype.decideMoveDistance=function(e){if("K"===e){if(!gameOptionEnabled(FIVE_SIDED_BOARD))return 1;if(!gameOptionEnabled(KING_MOVES_LIKE_PAWNS))return 2}return 2*this.edgeLength},PaiJoBoard.prototype.removePossibleMovePoints=function(){this.cells.forEach((function(e){e.forEach((function(e){e.removeType(POSSIBLE_MOVE)}))}))},PaiJoBoard.prototype.markEmptyAdjacentPointsAsPlayableInDirection=function(e,t,o,i){for(var n=this.getAdjacentPoints(t,o),a=0;a<n.length;a++){var r=n[a];!r.types.includes(PaiJoBoardPoint.Types.normal)||r.hasTile()||r.types.includes(POSSIBLE_MOVE)||(r.types.includes(PaiJoBoardPoint.Types.throne)&&"K"!==e||r.addType(POSSIBLE_MOVE),i>1&&this.markEmptyAdjacentPointsAsPlayableInDirection(e,r,o,i-1))}},PaiJoBoard.prototype.getAdjacentNotationPointsFromNotationPoint=function(e,t){var o=this.getBoardPointFromNotationPoint(e);return this.getAdjacentNotationPoints(o,t)},PaiJoBoard.prototype.getAdjacentNotationPoints=function(e,t){var o=e.notationRowNum,i=e.notationColNum,n=[],a=new PaiJoBoardPoint;return t!==PaiJoDirections.UP_RIGHT&&t||(a.setNotationRow(o+1),a.setNotationCol(i),n.push(a.getNotationPointString())),t!==PaiJoDirections.DOWN_RIGHT&&t||((a=new PaiJoBoardPoint).setNotationRow(o+1),a.setNotationCol(i+1),n.push(a.getNotationPointString())),t!==PaiJoDirections.DOWN&&t||((a=new PaiJoBoardPoint).setNotationRow(o),a.setNotationCol(i+1),n.push(a.getNotationPointString())),t!==PaiJoDirections.UP&&t||((a=new PaiJoBoardPoint).setNotationRow(o),a.setNotationCol(i-1),n.push(a.getNotationPointString())),t!==PaiJoDirections.UP_LEFT&&t||((a=new PaiJoBoardPoint).setNotationRow(o-1),a.setNotationCol(i-1),n.push(a.getNotationPointString())),t!==PaiJoDirections.DOWN_LEFT&&t||((a=new PaiJoBoardPoint).setNotationRow(o-1),a.setNotationCol(i),n.push(a.getNotationPointString())),n},PaiJoBoard.prototype.getAdjacentPoints=function(e,t){for(var o=this.getAdjacentNotationPoints(e,t),i=[],n=0;n<o.length;n++){var a=PaiJoBoardPoint.notationPointStringMap[o[n]];a&&this.rowAndColIsValid(a)&&i.push(this.cells[a.row][a.col])}return i},PaiJoBoard.prototype.getValidAdjacentPoints=function(e,t){for(var o=this.getAdjacentPoints(e,t),i=[],n=0;n<o.length;n++){var a=o[n];a.types.includes(PaiJoBoardPoint.Types.normal)&&i.push(a)}return i},PaiJoBoard.prototype.rowAndColIsValid=function(e){return e&&e.row<this.cells.length&&e.row>=0&&e.col<this.cells[e.row].length&&e.col>=0},PaiJoBoard.prototype.hasEmptyAdjacentPoint=function(e){for(var t=this.getAdjacentPoints(e),o=0;o<t.length;o++){var i=t[o];if(i.types.includes(PaiJoBoardPoint.Types.normal)&&!i.hasTile())return!0}return!1},PaiJoBoard.prototype.placeKing=function(e){this.putTileOnPoint("K",e)},PaiJoBoard.prototype.placeDefender=function(e){this.putTileOnPoint("D",e)},PaiJoBoard.prototype.placeAttacker=function(e){this.putTileOnPoint("A",e)},PaiJoBoardPoint.Types={nonPlayable:"Non-Playable",scoreTrack:"Score Track",normal:"Normal",throne:"Throne",corner:"Corner"},PaiJoBoardPoint.prototype.addType=function(e){this.types.includes(e)||this.types.push(e)},PaiJoBoardPoint.prototype.removeType=function(e){for(var t=0;t<this.types.length;t++)this.types[t]===e&&this.types.splice(t,1)},PaiJoBoardPoint.prototype.removeTile=function(){var e=this.tile;return this.tile=null,e},PaiJoBoardPoint.prototype.getNotationPointString=function(){return this.notationColString+this.notationRowString},PaiJoBoardPoint.prototype.setNotationRow=function(e){this.notationRowNum=e,this.notationRowString=e.toString()},PaiJoBoardPoint.prototype.setNotationCol=function(e){this.notationColNum=e,this.notationColString=String.fromCharCode(96+e)},PaiJoBoardPoint.prototype.putTile=function(e){this.tile=e},PaiJoBoardPoint.prototype.hasTile=function(){return this.tile},PaiJoBoardPoint.notationPointStringMap={};var PaiJoVars={};function PaiJoController(e,t){PaiJoVars={},gameOptionEnabled(OPTION_ATTACKERS_MOVE_FIRST)&&(PaiJoVars={}),this.additionalTilePileClass=t?"":"desktop",this.actuator=new PaiJoActuator(e,t,this.getHostTilesContainerDivs(),this.getGuestTilesContainerDivs()),this.resetGameManager(),this.resetNotationBuilder(),this.resetGameNotation()}function PaiJoGameManager(e,t,o){this.isCopy=o,this.actuator=e,this.hostScore=0,this.guestScore=0,this.setup(t)}function PaiJoNotationMove(e){this.fullMoveText=e,this.analyzeMove()}function PaiJoNotationBuilder(){this.isKingMove,this.startPoint,this.endPoint,this.status=BRAND_NEW}function PaiJoGameNotation(){this.notationText="",this.moves=[]}function PlaygroundActuator(e,t){this.gameContainer=e,this.mobile=t;var o=setupPaiShoBoard(this.gameContainer,PlaygroundController.getHostTilesContainerDivs(),PlaygroundController.getGuestTilesContainerDivs(),!1);this.boardContainer=o.boardContainer,this.hostTilesContainer=o.hostTilesContainer,this.guestTilesContainer=o.guestTilesContainer}function PlaygroundBoard(){this.size=new RowAndColumn(17,17),this.cells=this.brandNew(),this.harmonyManager=new PlaygroundHarmonyManager,this.rockRowAndCols=[],this.playedWhiteLotusTiles=[],this.winners=[]}PaiJoController.prototype.getGameTypeId=function(){return GameType.PaiJo.id},PaiJoController.prototype.completeSetup=function(){this.callActuate()},PaiJoController.prototype.addSetupForPlayerCode=function(e,t){},PaiJoController.prototype.resetGameManager=function(){this.theGame=new PaiJoGameManager(this.actuator)},PaiJoController.prototype.resetNotationBuilder=function(){this.notationBuilder=new PaiJoNotationBuilder},PaiJoController.prototype.resetGameNotation=function(){this.gameNotation=this.getNewGameNotation()},PaiJoController.prototype.getNewGameNotation=function(){return new PaiJoGameNotation},PaiJoController.prototype.getHostTilesContainerDivs=function(){return"<div></div>"},PaiJoController.prototype.getGuestTilesContainerDivs=function(){return'<div><a href="/js/PaiJo/index.html" target="_blank">Fullscreen</a><br><br></div>'},PaiJoController.prototype.callActuate=function(){this.theGame.actuate(),$(".board-container").css("height","550px"),$(".board-container").html("<iframe id='iPaiJo' src='./js/PaiJo/index_embedded.html' style='width:98%;height:99%;' frameBorder='0' scrolling='no'></iframe>")},PaiJoController.prototype.resetMove=function(){this.notationBuilder.status===BRAND_NEW&&this.gameNotation.removeLastMove(),rerunAll()},PaiJoController.prototype.getDefaultHelpMessageText=function(){return'<a target="_blank" href="http://paisho.pbworks.com/w/page/102793894/Modern%20Pai%20Sho"> Source info - paisho.pbworks </a><p>The Game goes as follows:<br>You can only move one tile per turn. Each piece can only move to a space directly adjacent to it, or jump a piece that is owned by the player moving.</p><p>&nbsp;</p><p>Elemental:<br>Water: Wins against Earth, Losses to Air, Neutral with Fire <br>Fire: Wins against Air, Losses to Earth, Neutral with Water <br>Earth:&nbsp;Wins against Fire, Losses to Water, Neutral with Air <br>Air:&nbsp;Wins against Water, Losses to Fire, Neutral with Earth </p><br><p>Special: <br>Avatar: Wins against Every, Losses to Every, Neutral with none<br>White Lotus: Wins against none, Losses to Every, Neutral with none</p><p>&nbsp;</p><p>The White Lotus piece can\'t jump and has one turn to escape "death" when it becomes in danger.<br>Ever piece that become adjacent with a piece that it beats removes that piece, and if it is adjacent to a piece that beats it, it is removed.<br>The Avatar piece beats any piece it attacks, and is beaten by any piece that attacks it. It then respawns at it\'s starting location if no piece is in the Avatars starting location(the place in started the game at) and no enemy piece is attacking that spot.<br>After a piece is moved, it can be moved again to jump any piece owned by the player (this can be done as the first move too) any number of times, with the exception of the White Lotus, which can\'t jump any piece.<br>When the White Lotus in under attack rather than instantly be removed from the board, it has one turn to be moved to a save location, if that proves impossible the attacking player has won.</p><p>&nbsp;</p><p>You win either by killing the opponents white lotus (DOMINANCE), or getting your safely to the center of the board for one full turn cycle.</p>  </div>'},PaiJoController.prototype.getAdditionalMessage=function(){var e="";return this.gameNotation.moves.length<=2&&(e+=getGameOptionsMessageHtml(GameType.PaiJo.gameOptions)),e},PaiJoController.prototype.unplayedTileClicked=function(e){},PaiJoController.prototype.pointClicked=function(e){if(!this.theGame.getWinner()&&myTurn())if(currentMoveIndex===this.gameNotation.moves.length){var t=e.getAttribute("name"),o=PaiJoBoardPoint.notationPointStringMap[t],i=this.theGame.board.cells[o.row][o.col];if(this.notationBuilder.status===BRAND_NEW){if(i.hasTile()){if(!this.tileBelongsToCurrentPlayer(i.tile)||!myTurn())return debug("That's not your tile!"),void this.callActuate();this.notationBuilder.status=WAITING_FOR_ENDPOINT,this.notationBuilder.moveType=MOVE,this.notationBuilder.startPoint=t,this.theGame.revealPossibleMovePoints(i)}}else if(this.notationBuilder.status===WAITING_FOR_ENDPOINT)if(i.types.includes(POSSIBLE_MOVE)){this.theGame.hidePossibleMovePoints(),this.notationBuilder.endPoint=t;var n=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.theGame.runNotationMove(n),this.gameNotation.addMove(n),onlinePlayEnabled&&3===this.gameNotation.moves.length?createGameIfThatIsOk(this.getGameTypeId()):playingOnlineGame()?callSubmitMove():finalizeMove()}else this.theGame.hidePossibleMovePoints(),this.resetNotationBuilder()}else debug("Can only interact if all moves are played.")},PaiJoController.prototype.tileBelongsToCurrentPlayer=function(e){return this.getCurrentPlayer()===PaiJoVars.DEFENDERS_PLAYER?"D"===e||"K"===e:"A"===e},PaiJoController.prototype.getTileMessage=function(e){},PaiJoController.prototype.getPointMessage=function(e){},PaiJoController.prototype.playAiTurn=function(e){},PaiJoController.prototype.startAiGame=function(e){},PaiJoController.prototype.getAiList=function(){return[]},PaiJoController.prototype.getCurrentPlayer=function(){return""},PaiJoController.prototype.cleanup=function(){},PaiJoController.prototype.isSolitaire=function(){return!1},PaiJoController.prototype.setGameNotation=function(e){this.gameNotation.setNotationText(e)},PaiJoGameManager.prototype.setup=function(e){this.board=new PaiJoBoard,e||this.actuate()},PaiJoGameManager.prototype.actuate=function(){this.isCopy||this.actuator.actuate(this.board)},PaiJoGameManager.prototype.runNotationMove=function(e,t){if(debug("Running Move: "+e.fullMoveText),e.moveType===INITIAL_SETUP){if("D"===e.playerCode){var o=[],i="";switch(e.boardSetupCode){case"1":i=this.board.thronePoint,o=(o=(o=this.board.getAdjacentNotationPointsFromNotationPoint(i,PaiJoDirections.UP)).concat(this.board.getAdjacentNotationPointsFromNotationPoint(i,PaiJoDirections.DOWN_LEFT))).concat(this.board.getAdjacentNotationPointsFromNotationPoint(i,PaiJoDirections.DOWN_RIGHT));break;case"2":i=this.board.thronePoint;o=this.board.getAdjacentNotationPointsFromNotationPoint(i);break;default:debug("Unknown board setup code for "+PaiJoVars.DEFENDERS_PLAYER)}this.board.placeKing(i);var n=this;o.forEach((function(e){n.board.placeDefender(e)}))}else if("A"===e.playerCode){var a=[];switch(e.boardSetupCode){case"1":a=this.board.cornerPoints,gameOptionEnabled(MORE_ATTACKERS)&&(a.push("f4"),a.push("d6"),a.push("b2"));break;case"2":a=this.board.cornerPoints;for(var r=[],l=0;l<a.length;l++){attackerPoint=a[l];for(var s=this.board.getAdjacentPoints(this.board.getBoardPointFromNotationPoint(attackerPoint)),h=0;h<s.length;h++)this.board.getValidAdjacentPoints(s[h]).length>=6&&r.push(s[h].getNotationPointString())}if(a=a.concat(r),gameOptionEnabled(MORE_ATTACKERS)){for(var d=["e8","h5","b2"],u=0;u<d.length;u++){var p=d[u],c=a.indexOf(p);c>=0&&a.splice(c,1)}a.push("h4"),a.push("i6"),a.push("b1"),a.push("a2"),a.push("d8"),a.push("f9")}break;default:debug("Unknown board setup code for "+PaiJoVars.ATTACKERS_PLAYER)}n=this;a.forEach((function(e){n.board.placeAttacker(e)}))}}else this.board.moveTile(e.startPoint,e.endPoint);t&&this.actuate()},PaiJoGameManager.prototype.revealPossibleMovePoints=function(e,t){e.hasTile()&&(this.board.setPossibleMovePoints(e),t||this.actuate())},PaiJoGameManager.prototype.hidePossibleMovePoints=function(e){this.board.removePossibleMovePoints(),e||this.actuate()},PaiJoGameManager.prototype.hasEnded=function(){return this.getWinResultTypeCode()>0},PaiJoGameManager.prototype.getWinner=function(){return this.board.kingCaptured?PaiJoVars.ATTACKERS_PLAYER:this.board.kingOnCorner?PaiJoVars.DEFENDERS_PLAYER:void 0},PaiJoGameManager.prototype.getWinReason=function(){return this.getWinner()===PaiJoVars.DEFENDERS_PLAYER?" wins! They escorted the King to safety!":this.getWinner()===PaiJoVars.ATTACKERS_PLAYER?" wins! They stormed the castle and captured the King!":void 0},PaiJoGameManager.prototype.getWinResultTypeCode=function(){if(this.getWinner())return 1},PaiJoGameManager.prototype.getCopy=function(){var e=new PaiJoGameManager(this.actuator,!0,!0);return e.board=this.board.getCopy(),e},PaiJoGameManager.prototype.pointIsOpen=function(e){var t=PaiJoBoardPoint.notationPointStringMap[e];return t&&!this.board.cells[t.row][t.col].hasTile()&&this.board.cells[t.row][t.col].types.includes(PaiJoBoardPoint.Types.normal)},PaiJoNotationMove.prototype.analyzeMove=function(){this.valid=!0;var e=(t=this.fullMoveText.split("."))[0];this.moveNum=parseInt(e.slice(0,-1)),this.playerCode=e.charAt(e.length-1),"A"===this.playerCode?this.player=PaiJoVars.ATTACKERS_PLAYER:"D"===this.playerCode&&(this.player=PaiJoVars.DEFENDERS_PLAYER);var t,o=t[1];o?o.includes("-")?(this.moveType=MOVE,"K"===(t=o.split("-"))[0].charAt(0)&&(this.isKingMove=!0,t[0]=t[0].substring(1)),this.startPoint=t[0],this.endPoint=t[1]):(this.moveType=INITIAL_SETUP,this.boardSetupCode=o):this.valid=!1},PaiJoNotationMove.prototype.isValidNotation=function(){return this.valid},PaiJoNotationMove.prototype.equals=function(e){return this.fullMoveText===e.fullMoveText},PaiJoNotationBuilder.prototype.getNotationMove=function(e,t){var o="A";t===PaiJoVars.DEFENDERS_PLAYER&&(o="D");var i=e+o+".";return this.isKingMove&&(i+="K"),this.startPoint&&this.endPoint&&(i+=this.startPoint+"-"+this.endPoint),new PaiJoNotationMove(i)},PaiJoNotationBuilder.prototype.moveComplete=function(){return this.startPoint&&this.endPoint},PaiJoGameNotation.prototype.setNotationText=function(e){this.notationText=e,this.loadMoves()},PaiJoGameNotation.prototype.addNotationLine=function(e){this.notationText+=";"+e.trim(),this.loadMoves()},PaiJoGameNotation.prototype.addMove=function(e){this.notationText?this.notationText+=";"+e.fullMoveText:this.notationText=e.fullMoveText,this.loadMoves()},PaiJoGameNotation.prototype.removeLastMove=function(){this.notationText=this.notationText.substring(0,this.notationText.lastIndexOf(";")),this.loadMoves()},PaiJoGameNotation.prototype.getPlayerMoveNum=function(){var e=0,t=this.moves[this.moves.length-1];return t&&(e=t.moveNum,t.player===GUEST&&e++),e},PaiJoGameNotation.prototype.getNotationMoveFromBuilder=function(e){var t=0,o=HOST,i=this.moves[this.moves.length-1];return i&&(t=i.moveNum,i.player===GUEST?t++:o=GUEST),e.getNotationMove(t,o)},PaiJoGameNotation.prototype.loadMoves=function(){this.moves=[];var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t=this,o=GUEST;new PaiJoNotationMove(e[0]).player===GUEST&&(newAttacker=PaiJoVars.DEFENDERS_PLAYER,newDefender=PaiJoVars.ATTACKERS_PLAYER,PaiJoVars={DEFENDERS_PLAYER:newDefender,ATTACKERS_PLAYER:newAttacker}),e.forEach((function(e){var i=new PaiJoNotationMove(e);i.isValidNotation()&&i.player!==o?(t.moves.push(i),o=i.player):debug("the player check is broken?")}))},PaiJoGameNotation.prototype.getNotationHtml=function(){var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t="";return e.forEach((function(e){t+=e+"<br />"})),t},PaiJoGameNotation.prototype.notationTextForUrl=function(){return this.notationText},PaiJoGameNotation.prototype.getNotationForEmail=function(){var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t="";return e.forEach((function(e){t+=e+"[BR]"})),t},PaiJoGameNotation.prototype.getLastMoveText=function(){return this.moves[this.moves.length-1].fullMoveText},PaiJoGameNotation.prototype.getLastMoveNumber=function(){return this.moves[this.moves.length-1].moveNum},PlaygroundActuator.prototype.actuate=function(e,t){var o=this;window.requestAnimationFrame((function(){o.htmlify(e,t)}))},PlaygroundActuator.prototype.htmlify=function(e,t){this.clearContainer(this.boardContainer);var o=this;e.cells.forEach((function(e){e.forEach((function(e){e&&o.addBoardPoint(e)}))}));var i=new PlaygroundTileManager(!0);i.hostTiles.forEach((function(e){o.clearTileContainer(e)})),i.guestTiles.forEach((function(e){o.clearTileContainer(e)})),t.hostTiles.forEach((function(e){o.addTile(e,this.hostTilesContainer)})),t.guestTiles.forEach((function(e){o.addTile(e,this.guestTilesContainer)}))},PlaygroundActuator.prototype.clearContainer=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},PlaygroundActuator.prototype.clearTileContainer=function(e){for(var t=document.querySelector("."+e.getImageName());t.firstChild;)t.removeChild(t.firstChild)},PlaygroundActuator.prototype.addTile=function(e,t){var o=document.querySelector("."+e.getImageName()),i=document.createElement("div");i.classList.add("point"),i.classList.add("hasTile"),e.selectedFromPile&&(i.classList.add("selectedFromPile"),i.classList.add("drained"));var n=document.createElement("img"),a=getSkudTilesSrcPath();n.src=a+e.getImageName()+".png",i.appendChild(n),i.setAttribute("name",e.getImageName()),i.setAttribute("id",e.id),this.mobile?i.setAttribute("onclick","unplayedTileClicked(this); showTileMessage(this);"):(i.setAttribute("onclick","unplayedTileClicked(this);"),i.setAttribute("onmouseover","showTileMessage(this);"),i.setAttribute("onmouseout","clearMessage();")),o.appendChild(i)},PlaygroundActuator.prototype.addBoardPoint=function(e){var t=createBoardPointDiv(e);if(e.isType(NON_PLAYABLE)||(t.classList.add("activePoint"),e.isType(POSSIBLE_MOVE)?t.classList.add("possibleMove"):e.betweenHarmony&&(t.classList.add("betweenHarmony"),e.betweenHarmonyHost&&t.classList.add("bhHost"),e.betweenHarmonyGuest&&t.classList.add("bhGuest")),this.mobile?t.setAttribute("onclick","pointClicked(this); showPointMessage(this);"):(t.setAttribute("onclick","pointClicked(this);"),t.setAttribute("onmouseover","showPointMessage(this);"),t.setAttribute("onmouseout","clearMessage();"))),e.hasTile()){t.classList.add("hasTile");var o=document.createElement("img"),i=getSkudTilesSrcPath();o.src=i+e.tile.getImageName()+".png",e.tile.inHarmony&&t.classList.add(e.tile.ownerName+"harmony"),(e.tile.drained||e.tile.trapped)&&t.classList.add("drained"),t.appendChild(o)}if(this.boardContainer.appendChild(t),e.betweenHarmony&&16===e.col){var n=document.createElement("div");n.classList.add("clear"),this.boardContainer.appendChild(n)}},PlaygroundActuator.prototype.printBoard=function(e){debug("");var t=0;e.cells.forEach((function(e){var o=t+"\t: ";e.forEach((function(e){var t=e.getConsoleDisplay();t.length<3&&(o+=" "),o+=t,t.length<2&&(o+=" ")})),debug(o),t++})),debug("")},PlaygroundBoard.prototype.brandNew=function(){var e=[];e[0]=this.newRow(9,[PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.gate(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral()]),e[1]=this.newRow(11,[PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.redWhiteNeutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral()]),e[2]=this.newRow(13,[PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.whiteNeutral(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.redNeutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral()]),e[3]=this.newRow(15,[PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.whiteNeutral(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.redNeutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral()]),e[4]=this.newRow(17,[PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.whiteNeutral(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.redNeutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral()]),e[5]=this.newRow(17,[PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.whiteNeutral(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.redNeutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral()]),e[6]=this.newRow(17,[PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.whiteNeutral(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.redNeutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral()]),e[7]=this.newRow(17,[PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.whiteNeutral(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.redNeutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral()]),e[8]=this.newRow(17,[PlaygroundBoardPoint.gate(),PlaygroundBoardPoint.redWhiteNeutral(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.redWhiteNeutral(),PlaygroundBoardPoint.gate()]),e[9]=this.newRow(17,[PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.redNeutral(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.whiteNeutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral()]),e[10]=this.newRow(17,[PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.redNeutral(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.whiteNeutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral()]),e[11]=this.newRow(17,[PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.redNeutral(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.whiteNeutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral()]),e[12]=this.newRow(17,[PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.redNeutral(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.whiteNeutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral()]),e[13]=this.newRow(15,[PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.redNeutral(),PlaygroundBoardPoint.red(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.white(),PlaygroundBoardPoint.whiteNeutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral()]),e[14]=this.newRow(13,[PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.redNeutral(),PlaygroundBoardPoint.redWhite(),PlaygroundBoardPoint.whiteNeutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral()]),e[15]=this.newRow(11,[PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.redWhiteNeutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral()]),e[16]=this.newRow(9,[PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.gate(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral(),PlaygroundBoardPoint.neutral()]);for(var t=0;t<e.length;t++)for(var o=0;o<e[t].length;o++)e[t][o].row=t,e[t][o].col=o;return e},PlaygroundBoard.prototype.newRow=function(e,t){var o=[],i=(this.size.row-e)/2,n=new PlaygroundBoardPoint;n.addType(NON_PLAYABLE);for(var a=0;a<this.size.row;a++)o[a]=a<i?n:a<i+e&&t?t[a-i]:n;return o},PlaygroundBoard.prototype.placeTile=function(e,t,o){this.putTileOnPoint(e,t)},PlaygroundBoard.prototype.putTileOnPoint=function(e,t){var o=t.rowAndColumn;(o=this.cells[o.row][o.col]).putTile(e)},PlaygroundBoard.prototype.isValidRowCol=function(e){return e.row>=0&&e.col>=0&&e.row<=16&&e.col<=16},PlaygroundBoard.prototype.getClockwiseRowCol=function(e,t){return t.row<e.row&&t.col<=e.col?new RowAndColumn(t.row,t.col+1):t.col>e.col&&t.row<=e.row?new RowAndColumn(t.row+1,t.col):t.row>e.row&&t.col>=e.col?new RowAndColumn(t.row,t.col-1):t.col<e.col&&t.row>=e.row?new RowAndColumn(t.row-1,t.col):void debug("ERROR CLOCKWISE CALCULATING")},PlaygroundBoard.prototype.getSurroundingRowAndCols=function(e){for(var t=[],o=e.row-1;o<=e.row+1;o++)for(var i=e.col-1;i<=e.col+1;i++){if((o!==e.row||i!==e.col)&&o>=0&&i>=0&&o<17&&i<17)this.cells[o][i].isType(NON_PLAYABLE)||t.push(new RowAndColumn(o,i))}return t},PlaygroundBoard.prototype.pointIsOpenGate=function(e){var t=e.rowAndColumn;return(t=this.cells[t.row][t.col]).isOpenGate()},PlaygroundBoard.prototype.moveTile=function(e,t){var o=e.rowAndColumn,i=t.rowAndColumn;if(o.row<0||o.row>16||i.row<0||i.row>16)return debug("That point does not exist. So it's not gonna happen."),!1;var n=this.cells[o.row][o.col],a=this.cells[i.row][i.col],r=n.removeTile();return r||debug("Error: No tile to move!"),a.putTile(r)?(debug("Error moving tile. It probably didn't get moved."),!1):void 0},PlaygroundBoard.prototype.canCapture=function(e,t){return!0},PlaygroundBoard.prototype.canMoveTileToPoint=function(e,t){return!0},PlaygroundBoard.prototype.verifyAbleToReach=function(e,t,o){return this.pathFound(e,t,o)},PlaygroundBoard.prototype.pathFound=function(e,t,o){if(!e||!t)return!1;if(e.isType(NON_PLAYABLE)||t.isType(NON_PLAYABLE))return!1;if(e.row===t.row&&e.col===t.col)return!0;if(o<=0)return!1;if(1===Math.abs(e.row-t.row)+Math.abs(e.col-t.col))return!0;var i=e.row-1;if(i>=0&&(!(n=this.cells[i][e.col]).hasTile()&&this.pathFound(n,t,o-1)))return!0;if((i=e.row+1)<17&&(!(n=this.cells[i][e.col]).hasTile()&&this.pathFound(n,t,o-1)))return!0;var n,a=e.col-1;if(a>=0&&(!(n=this.cells[e.row][a]).hasTile()&&this.pathFound(n,t,o-1)))return!0;if((a=e.col+1)<17&&(!(n=this.cells[e.row][a]).hasTile()&&this.pathFound(n,t,o-1)))return!0},PlaygroundBoard.prototype.setPossibleMovePoints=function(e){if(e.hasTile())for(var t=e.tile.ownerName,o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++)this.canMoveTileToPoint(t,e,this.cells[o][i])&&this.cells[o][i].addType(POSSIBLE_MOVE)},PlaygroundBoard.prototype.removePossibleMovePoints=function(){this.cells.forEach((function(e){e.forEach((function(e){e.removeType(POSSIBLE_MOVE)}))}))},PlaygroundBoard.prototype.setOpenGatePossibleMoves=function(e){for(var t=0;t<this.cells.length;t++)for(var o=0;o<this.cells[t].length;o++){this.cells[t][o].isOpenGate()&&this.cells[t][o].addType(POSSIBLE_MOVE)}},PlaygroundBoard.prototype.setAllPointsAsPossible=function(){this.cells.forEach((function(e){e.forEach((function(e){e.addType(POSSIBLE_MOVE)}))}))},PlaygroundBoard.prototype.getCopy=function(){for(var e=new PlaygroundBoard,t=0;t<this.cells.length;t++)for(var o=0;o<this.cells[t].length;o++)e.cells[t][o]=this.cells[t][o].getCopy();return e};NON_PLAYABLE="Non-Playable",NEUTRAL="Neutral",GATE="Gate",POSSIBLE_MOVE="Possible Move",OPEN_GATE="OPEN GATE",thinDot="·",thickDot="•",whiteDot="◦",gateDot="⟡";function PlaygroundBoardPoint(){this.types=[],this.row=-1,this.col=-1}function PlaygroundController(e,t){this.actuator=new PlaygroundActuator(e,t),this.resetGameManager(),this.resetNotationBuilder(),this.resetGameNotation(),this.hostAccentTiles=[],this.guestAccentTiles=[],showReplayControls(),this.currentPlayingPlayer=HOST,this.isPaiShoGame=!0}function PlaygroundGameManager(e,t,o){this.isCopy=o,this.actuator=e,this.tileManager=new PlaygroundTileManager,this.setup(t),this.endGameWinners=[]}function PlaygroundNotationMove(e){this.fullMoveText=e,this.analyzeMove()}function PlaygroundNotationBuilder(){this.moveType,this.tileType,this.endPoint,this.startPoint,this.status=BRAND_NEW}function PlaygroundGameNotation(){this.notationText="",this.moves=[]}function PlaygroundHarmony(e,t,o,i){this.tile1=e,this.tile1Pos=t,this.tile2=o,this.tile2Pos=i,this.tile1.type===BASIC_FLOWER?(this.ownerCode=this.tile1.ownerCode,this.ownerName=this.tile1.ownerName):this.tile2.type===BASIC_FLOWER?(this.ownerCode=this.tile2.ownerCode,this.ownerName=this.tile2.ownerName):debug("ERROR: HARMONY REQUIRES A BASIC FLOWER TILE")}function PlaygroundHarmonyManager(){this.harmonies=[]}PlaygroundBoardPoint.prototype.addType=function(e){this.types.includes(e)||this.types.push(e)},PlaygroundBoardPoint.prototype.removeType=function(e){for(var t=0;t<this.types.length;t++)this.types[t]===e&&this.types.splice(t,1)},PlaygroundBoardPoint.prototype.getConsoleDisplay=function(){if(this.tile)return this.tile.getConsoleDisplay();var e=thinDot;this.types.includes(NON_PLAYABLE)&&(e=" ");var t="";return this.types.includes(RED)&&(t="R",e=thickDot),this.types.includes(WHITE)&&(t+="W",e=whiteDot),this.types.includes(NEUTRAL)&&(t+="N"),this.types.includes(GATE)&&(t="G",e=gateDot),t.length>1&&(e="+"),e},PlaygroundBoardPoint.prototype.putTile=function(e){this.tile=e},PlaygroundBoardPoint.prototype.hasTile=function(){return!!this.tile},PlaygroundBoardPoint.prototype.isType=function(e){return this.types.includes(e)},PlaygroundBoardPoint.prototype.isOpenGate=function(){return!this.hasTile()&&this.types.includes(GATE)},PlaygroundBoardPoint.prototype.removeTile=function(){var e=this.tile;return this.tile=null,e},PlaygroundBoardPoint.prototype.drainTile=function(){this.tile&&this.tile.drain()},PlaygroundBoardPoint.prototype.restoreTile=function(){this.tile&&this.tile.restore()},PlaygroundBoardPoint.prototype.canHoldTile=function(e,t){return!this.isType(NON_PLAYABLE)&&(!(!t&&this.hasTile())&&(e.type===BASIC_FLOWER?!(!this.isType(NEUTRAL)&&!this.isType(e.basicColorName))&&!this.isType(GATE):e.type===SPECIAL_FLOWER||e.type===ACCENT_TILE))},PlaygroundBoardPoint.prototype.betweenPlayerHarmony=function(e){return e===GUEST?this.betweenHarmonyGuest:e===HOST&&this.betweenHarmonyHost},PlaygroundBoardPoint.prototype.getCopy=function(){for(var e=new PlaygroundBoardPoint,t=0;t<this.types.length;t++)e.types.push(this.types[t]);return e.row=this.row,e.col=this.col,this.hasTile()&&(e.tile=this.tile.getCopy()),e},PlaygroundBoardPoint.neutral=function(){var e=new PlaygroundBoardPoint;return e.addType(NEUTRAL),e},PlaygroundBoardPoint.gate=function(){var e=new PlaygroundBoardPoint;return e.addType(GATE),e},PlaygroundBoardPoint.red=function(){var e=new PlaygroundBoardPoint;return e.addType(RED),e},PlaygroundBoardPoint.white=function(){var e=new PlaygroundBoardPoint;return e.addType(WHITE),e},PlaygroundBoardPoint.redWhite=function(){var e=new PlaygroundBoardPoint;return e.addType(RED),e.addType(WHITE),e},PlaygroundBoardPoint.redWhiteNeutral=function(){var e=new PlaygroundBoardPoint;return e.addType(RED),e.addType(WHITE),e.addType(NEUTRAL),e},PlaygroundBoardPoint.redNeutral=function(){var e=new PlaygroundBoardPoint;return e.addType(RED),e.addType(NEUTRAL),e},PlaygroundBoardPoint.whiteNeutral=function(){var e=new PlaygroundBoardPoint;return e.addType(WHITE),e.addType(NEUTRAL),e},PlaygroundController.prototype.getGameTypeId=function(){return GameType.Playground.id},PlaygroundController.prototype.resetGameManager=function(){this.theGame=new PlaygroundGameManager(this.actuator)},PlaygroundController.prototype.resetNotationBuilder=function(){this.notationBuilder=new PlaygroundNotationBuilder},PlaygroundController.prototype.resetGameNotation=function(){this.gameNotation=this.getNewGameNotation()},PlaygroundController.prototype.getNewGameNotation=function(){return new PlaygroundGameNotation},PlaygroundController.getHostTilesContainerDivs=function(){return'<div class="HR3"></div> <div class="HR4"></div> <div class="HR5"></div> <div class="HW3"></div> <div class="HW4"></div> <div class="HW5"></div> <br class="clear" /> <div class="HR"></div> <div class="HW"></div> <div class="HK"></div> <div class="HB"></div> <div class="HL"></div> <div class="HO"></div>'},PlaygroundController.getGuestTilesContainerDivs=function(){return'<div class="GR3"></div> <div class="GR4"></div> <div class="GR5"></div> <div class="GW3"></div> <div class="GW4"></div> <div class="GW5"></div> <br class="clear" /> <div class="GR"></div> <div class="GW"></div> <div class="GK"></div> <div class="GB"></div> <div class="GL"></div> <div class="GO"></div>'},PlaygroundController.prototype.callActuate=function(){this.theGame.actuate()},PlaygroundController.prototype.resetMove=function(){this.notationBuilder.status===BRAND_NEW?this.gameNotation.removeLastMove():this.notationBuilder.status,rerunAll()},PlaygroundController.prototype.getDefaultHelpMessageText=function(){return"<h4>Pai Sho Playground</h4> <p>Do anything!</p>"},PlaygroundController.prototype.getAdditionalMessage=function(){var e="";return 0===this.gameNotation.moves.length&&(onlinePlayEnabled&&gameId<0&&userIsLoggedIn()?e+="Click <em>Join Game</em> above to join another player's game. Or, you can start a game that other players can join by making a move. <br />":e+="Sign in to enable online gameplay. Or, start playing a local game by making a move. <br />"),e+="<span class='skipBonus' onClick='gameController.passTurn()'>End Turn</span><br />"},PlaygroundController.prototype.passTurn=function(){this.currentPlayingPlayer===HOST?this.currentPlayingPlayer=GUEST:this.currentPlayingPlayer=HOST,rerunAll()},PlaygroundController.prototype.unplayedTileClicked=function(e){if(!this.theGame.getWinner())if(currentMoveIndex===this.gameNotation.moves.length){var t=e.getAttribute("name"),o=parseInt(e.getAttribute("id")),i=t.charAt(0),n=t,a=GUEST;"H"===i&&(a=HOST);var r=this.theGame.tileManager.peekTile(a,n,o);this.notationBuilder.status===BRAND_NEW?(r.selectedFromPile=!0,this.notationBuilder.playingPlayer=this.currentPlayingPlayer,this.notationBuilder.moveType=DEPLOY,this.notationBuilder.tileType=n,this.notationBuilder.status=WAITING_FOR_ENDPOINT,this.theGame.revealAllPointsAsPossible()):(this.theGame.hidePossibleMovePoints(),this.resetNotationBuilder())}else debug("Can only interact if all moves are played.")},PlaygroundController.prototype.pointClicked=function(e){if(!this.theGame.getWinner())if(currentMoveIndex===this.gameNotation.moves.length){var t=new NotationPoint(e.getAttribute("name")).rowAndColumn,o=this.theGame.board.cells[t.row][t.col];if(this.notationBuilder.status===BRAND_NEW)o.hasTile()&&(this.notationBuilder.playingPlayer=this.currentPlayingPlayer,this.notationBuilder.status=WAITING_FOR_ENDPOINT,this.notationBuilder.moveType=MOVE,this.notationBuilder.startPoint=new NotationPoint(e.getAttribute("name")),this.theGame.revealAllPointsAsPossible());else if(this.notationBuilder.status===WAITING_FOR_ENDPOINT)if(o.isType(POSSIBLE_MOVE)){this.theGame.hidePossibleMovePoints(),this.notationBuilder.endPoint=new NotationPoint(e.getAttribute("name"));var i=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.gameNotation.addMove(i),playingOnlineGame()?callSubmitMove():finalizeMove()}else this.theGame.hidePossibleMovePoints(),this.notationBuilder=new PlaygroundNotationBuilder}else debug("Can only interact if all moves are played.")},PlaygroundController.prototype.getTileMessage=function(e){var t=e.getAttribute("name"),o=(parseInt(e.getAttribute("id")),new PlaygroundTile(t.substring(1),t.charAt(0))),i=[];t.startsWith("G");var n=t.substring(1),a=PlaygroundTile.getTileName(n);return i.push(o.ownerName+"'s tile"),{heading:a,message:i}},PlaygroundController.prototype.getPointMessage=function(e){var t,o=new NotationPoint(e.getAttribute("name")).rowAndColumn,i=this.theGame.board.cells[o.row][o.col],n=[];return i.hasTile()?t=i.tile.getName():i.isType(NEUTRAL)?n.push(getNeutralPointMessage()):i.isType(RED)&&i.isType(WHITE)?n.push(getRedWhitePointMessage()):i.isType(RED)?n.push(getRedPointMessage()):i.isType(WHITE)?n.push(getWhitePointMessage()):i.isType(GATE)&&n.push(getGatePointMessage()),{heading:t,message:n}},PlaygroundController.prototype.playAiTurn=function(e){},PlaygroundController.prototype.startAiGame=function(e){},PlaygroundController.prototype.getAiList=function(){return[]},PlaygroundController.prototype.getCurrentPlayer=function(){return this.currentPlayingPlayer},PlaygroundController.prototype.cleanup=function(){},PlaygroundController.prototype.isSolitaire=function(){return!1},PlaygroundController.prototype.setGameNotation=function(e){this.gameNotation.setNotationText(e)},PlaygroundGameManager.prototype.setup=function(e){this.board=new PlaygroundBoard,e||this.actuate()},PlaygroundGameManager.prototype.actuate=function(){this.isCopy||this.actuator.actuate(this.board,this.tileManager)},PlaygroundGameManager.prototype.runNotationMove=function(e,t){if(debug("Running Move: "+e.fullMoveText),e.moveType===DEPLOY){var o=this.tileManager.grabTile(e.tileOwner,e.tileType);this.board.placeTile(o,e.endPoint)}else e.moveType===MOVE&&this.board.moveTile(e.startPoint,e.endPoint);t&&this.actuate()},PlaygroundGameManager.prototype.revealAllPointsAsPossible=function(){this.board.setAllPointsAsPossible(),this.actuate()},PlaygroundGameManager.prototype.revealPossibleMovePoints=function(e,t){e.hasTile()&&(this.board.setPossibleMovePoints(e),t||this.actuate())},PlaygroundGameManager.prototype.hidePossibleMovePoints=function(e){this.board.removePossibleMovePoints(),this.tileManager.removeSelectedTileFlags(),e||this.actuate()},PlaygroundGameManager.prototype.revealOpenGates=function(e,t,o){2===t?this.board.setGuestGateOpen():this.board.setOpenGatePossibleMoves(e),o||this.actuate()},PlaygroundGameManager.prototype.playerCanBonusPlant=function(e){return!newGatesRule||(lessBonus||limitedGatesRule?this.board.playerHasNoGrowingFlowers(e):newGatesRule?this.board.playerControlsLessThanTwoGates(e):void 0)},PlaygroundGameManager.prototype.revealSpecialFlowerPlacementPoints=function(e){newSpecialFlowerRules?(this.board.revealSpecialFlowerPlacementPoints(e),this.actuate()):this.revealOpenGates(e)},PlaygroundGameManager.prototype.revealPossiblePlacementPoints=function(e){this.board.revealPossiblePlacementPoints(e),this.actuate()},PlaygroundGameManager.prototype.revealBoatBonusPoints=function(e){this.board.revealBoatBonusPoints(e),this.actuate()},PlaygroundGameManager.prototype.aPlayerIsOutOfBasicFlowerTiles=function(){return this.tileManager.aPlayerIsOutOfBasicFlowerTiles()},PlaygroundGameManager.prototype.playerHasNotPlayedEitherSpecialTile=function(e){return this.tileManager.playerHasBothSpecialTilesRemaining(e)},PlaygroundGameManager.prototype.getWinner=function(){return 1===this.board.winners.length?this.board.winners[0]:this.board.winners.length>1?"BOTH players":1===this.endGameWinners.length?this.endGameWinners[0]:this.endGameWinners.length>1?"BOTH players":void 0},PlaygroundGameManager.prototype.getWinReason=function(){return 1===this.board.winners.length?" created a Harmony Ring and won the game!":1===this.endGameWinners.length?this.tileManager.getPlayerWithMoreAccentTiles()?" won the game with more Accent Tiles left.":" won the game with the most Harmonies.":void 0},PlaygroundGameManager.prototype.getWinResultTypeCode=function(){return 1===this.board.winners.length?1:1===this.endGameWinners.length?this.tileManager.getPlayerWithMoreAccentTiles()?2:3:this.endGameWinners.length>1?4:void 0},PlaygroundGameManager.prototype.getCopy=function(){var e=new PlaygroundGameManager(this.actuator,!0,!0);return e.board=this.board.getCopy(),e.tileManager=this.tileManager.getCopy(),e},PlaygroundNotationMove.prototype.analyzeMove=function(){this.valid=!0;var e=(a=this.fullMoveText.split("."))[0];this.moveNum=parseInt(e.slice(0,-1)),this.playerCode=e.charAt(e.length-1),"G"===this.playerCode?this.player=GUEST:"H"===this.playerCode&&(this.player=HOST);var t=a[1];if(t){var o=t.charAt(0);if(this.moveType="("===o?MOVE:DEPLOY,this.moveType===DEPLOY){var i=t.charAt(1),n=t.charAt(2);this.tileOwner=o,this.tileType="("===n?i:i+""+n,"("===t.charAt(2)||(debug("Failure to plant"),this.valid=!1),t.endsWith(")")?this.endPoint=new NotationPoint(t.substring(t.indexOf("(")+1,t.indexOf(")"))):this.valid=!1}else if(this.moveType===MOVE){var a=t.substring(t.indexOf("(")+1).split(")-(");this.startPoint=new NotationPoint(a[0]),this.endPoint=new NotationPoint(a[1].substring(0,a[1].indexOf(")")))}}},PlaygroundNotationMove.prototype.isValidNotation=function(){return this.valid},PlaygroundNotationMove.prototype.equals=function(e){return this.fullMoveText===e.fullMoveText},PlaygroundNotationBuilder.prototype.getNotationMove=function(e,t){var o=e+t.charAt(0)+".";return this.moveType===MOVE?o+="("+this.startPoint.pointText+")-("+this.endPoint.pointText+")":this.moveType===DEPLOY&&(o+=this.tileType+"("+this.endPoint.pointText+")"),new PlaygroundNotationMove(o)},PlaygroundGameNotation.prototype.setNotationText=function(e){this.notationText=e,this.loadMoves()},PlaygroundGameNotation.prototype.addNotationLine=function(e){this.notationText+=";"+e.trim(),this.loadMoves()},PlaygroundGameNotation.prototype.addMove=function(e){this.notationText?this.notationText+=";"+e.fullMoveText:this.notationText=e.fullMoveText,this.loadMoves()},PlaygroundGameNotation.prototype.removeLastMove=function(){this.notationText=this.notationText.substring(0,this.notationText.lastIndexOf(";")),this.loadMoves()},PlaygroundGameNotation.prototype.getPlayerMoveNum=function(){var e=0,t=this.moves[this.moves.length-1];return t&&(e=t.moveNum,t.player===GUEST&&e++),e},PlaygroundGameNotation.prototype.getNotationMoveFromBuilder=function(e){var t=0,o=this.moves[this.moves.length-1];return o&&(t=o.moveNum,o.player!==e.playingPlayer&&t++),e.getNotationMove(t,e.playingPlayer)},PlaygroundGameNotation.prototype.loadMoves=function(){this.moves=[];var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t=this;e.forEach((function(e){var o=new PlaygroundNotationMove(e);t.moves.push(o)}))},PlaygroundGameNotation.prototype.getNotationHtml=function(){var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t="";return e.forEach((function(e){t+=e+"<br />"})),t},PlaygroundGameNotation.prototype.notationTextForUrl=function(){return this.notationText},PlaygroundGameNotation.prototype.getNotationForEmail=function(){var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t="";return e.forEach((function(e){t+=e+"[BR]"})),t},PlaygroundGameNotation.prototype.getLastMoveText=function(){return this.moves[this.moves.length-1].fullMoveText},PlaygroundGameNotation.prototype.getLastMoveNumber=function(){return this.moves[this.moves.length-1].moveNum},PlaygroundHarmony.prototype.equals=function(e){return!(this.ownerName!==e.ownerName||this.ownerCode!==e.ownerCode||this.tile1!==e.tile1&&this.tile1!==e.tile2||this.tile2!==e.tile1&&this.tile2!==e.tile2)},PlaygroundHarmony.prototype.notAnyOfThese=function(e){for(var t=0;t<e.length;t++)if(this.equals(e[t]))return!1;return!0},PlaygroundHarmony.prototype.containsTile=function(e){return this.tile1===e||this.tile2===e},PlaygroundHarmony.prototype.getTileThatIsNotThisOne=function(e){return this.tile1===e?this.tile2:this.tile2===e?this.tile1:void debug("BOTH TILES ARE NOT THAT ONE!")},PlaygroundHarmony.prototype.containsTilePos=function(e){return this.tile1Pos.samesies(e)||this.tile2Pos.samesies(e)},PlaygroundHarmony.prototype.getPosThatIsNotThisOne=function(e){return this.tile1Pos.samesies(e)?this.tile2Pos:this.tile2Pos.samesies(e)?this.tile1Pos:void debug("\tBOTH TILE POS ARE NOT THAT ONE!")},PlaygroundHarmony.prototype.getString=function(){return this.ownerName+" ("+this.tile1Pos.notationPointString+")-("+this.tile2Pos.notationPointString+")"},PlaygroundHarmony.prototype.getDirectionForTile=function(e){if(this.containsTile(e)){var t=this.tile1Pos,o=this.tile2Pos;return this.tile2.id===e.id&&(t=this.tile2Pos,o=this.tile1Pos),t.row===o.row?t.col<o.col?"East":"West":t.col===o.col?t.row>o.row?"North":"South":void 0}},PlaygroundHarmony.prototype.crossesCenter=function(){var e=this.tile1Pos.row,t=this.tile2Pos.row;if(this.tile1Pos.row<this.tile2Pos.row&&(e=this.tile2Pos.row,t=this.tile1Pos.row),e!==t)return e>8&&t<8;var o=this.tile1Pos.col,i=this.tile2Pos.col;return this.tile1Pos.col<this.tile2Pos.col&&(o=this.tile2Pos.col,i=this.tile1Pos.col),o!==i?o>8&&i<8:void 0},PlaygroundHarmonyManager.prototype.printHarmonies=function(){debug("All Harmonies:");for(var e=0;e<this.harmonies.length;e++)debug(this.harmonies[e].getString())},PlaygroundHarmonyManager.prototype.getHarmoniesWithThisTile=function(e){var t=[];return this.harmonies.forEach((function(o){o.containsTile(e)&&t.push(o)})),t},PlaygroundHarmonyManager.prototype.addHarmony=function(e){for(var t=!1,o=0;o<this.harmonies.length;o++)e.equals(this.harmonies[o])&&(t=!0);t||this.harmonies.push(e)},PlaygroundHarmonyManager.prototype.addHarmonies=function(e){if(e)for(var t=0;t<e.length;t++)this.addHarmony(e[t])},PlaygroundHarmonyManager.prototype.clearList=function(){this.harmonies=[]},PlaygroundHarmonyManager.prototype.numHarmoniesForPlayer=function(e){for(var t=0,o=0;o<this.harmonies.length;o++)this.harmonies[o].ownerName===e&&t++;return t},PlaygroundHarmonyManager.prototype.getPlayerWithMostHarmonies=function(){var e=this.numHarmoniesForPlayer(HOST),t=this.numHarmoniesForPlayer(GUEST);return t>e?GUEST:e>t?HOST:void 0},PlaygroundHarmonyManager.prototype.getNumCrossingCenterForPlayer=function(e){for(var t=0,o=0;o<this.harmonies.length;o++)this.harmonies[o].ownerName===e&&this.harmonies[o].crossesCenter()&&t++;return t},PlaygroundHarmonyManager.prototype.ringLengthForPlayer=function(e){for(var t=this.getHarmonyChains(),o=0,i=0;i<t.length;i++){var n=t[i];if(n.pop().ownerName===e){n.length>o&&(o=n.length)}}return o},PlaygroundHarmonyManager.prototype.getPlayerWithLongestChain=function(){var e=this.ringLengthForPlayer(HOST),t=this.ringLengthForPlayer(GUEST);return t>e?GUEST:e>t?HOST:void 0},PlaygroundHarmonyManager.prototype.hasNewHarmony=function(e,t){for(var o=[],i=0;i<this.harmonies.length;i++)if(this.harmonies[i].ownerName===e){for(var n=!1,a=0;a<t.length;a++)this.harmonies[i].equals(t[a])&&(n=!0);n||o.push(this.harmonies[i])}return o.length>0},PlaygroundHarmonyManager.prototype.getHarmonyChains=function(){for(var e=this,t=[],o=0;o<this.harmonies.length;o++){var i=this.harmonies[o],n=[];n.push(i);var a=i.tile2,r=(i.tile2Pos,i.tile1),l=(i.tile1Pos,this.lookForRing(a,r,n));if(l[0]){var s=!1;t.forEach((function(t){e.ringsMatch(t,l[1])&&(s=!0)})),s||t.push(l[1])}}return t},PlaygroundHarmonyManager.prototype.harmonyRingExists=function(){var e=this,t=this.getHarmonyChains(),o=[];return t.forEach((function(t){debug(t);var i=e.verifyHarmonyRing(t);i&&o.push(i)})),o},PlaygroundHarmonyManager.prototype.ringContains345=function(e){for(var t=!1,o=!1,i=!1,n=0;n<e.length;n++){var a=e[n];"3"===a.tile1.basicValue&&(t=!0),"4"===a.tile1.basicValue&&(o=!0),"5"===a.tile1.basicValue&&(i=!0),"3"===a.tile2.basicValue&&(t=!0),"4"===a.tile2.basicValue&&(o=!0),"5"===a.tile2.basicValue&&(i=!0)}return t&&o&&i},PlaygroundHarmonyManager.prototype.verifyHarmonyRing=function(e){if(completeHarmony&&!this.ringContains345(e))return!1;var t=[],o=e.pop(),i=o.ownerName;t.push(new NotationPoint(o.tile1Pos.notationPointString).toArr()),t.push(new NotationPoint(o.tile2Pos.notationPointString).toArr());for(var n=o.tile2Pos,a=0;e.length>0&&a<400;){for(var r=0;r<e.length;r++)if((o=e[r]).containsTilePos(n)){var l=new NotationPoint((n=o.getPosThatIsNotThisOne(n)).notationPointString);l.samesies(new NotationPoint(t[0][0]+","+t[0][1]))||t.push(l.toArr()),e.splice(r,1)}a++}return a>390?(debug("THERE WAS A PROBLEM CONNECTING THE DOTS"),!1):!!this.isCenterInsideShape(t)&&i},PlaygroundHarmonyManager.prototype.isPointInsideShape=function(e,t){for(var o=e.x,i=e.y,n=!1,a=0,r=t.length-1;a<t.length;r=a++){var l=t[a][0],s=t[a][1],h=t[r][0],d=t[r][1];if(l===o&&h===o&&l*h)return!1;s>i!=d>i&&o<(h-l)*(i-s)/(d-s)+l&&(n=!n)}return n},PlaygroundHarmonyManager.prototype.isPointInsideShape_alternate=function(e,t){for(var o=[e.x,e.y],i=!1,n=-1,a=t.length,r=a-1;++n<a;r=n)(t[n][1]<=o[1]&&o[1]<t[r][1]||t[r][1]<=o[1]&&o[1]<t[n][1])&&o[0]<(t[r][0]-t[n][0])*(o[1]-t[n][1])/(t[r][1]-t[n][1])+t[n][0]&&(i=!i);return i},PlaygroundHarmonyManager.prototype.isCenterInsideShape=function(e){for(var t=!1,o=0,i=e.length-1;o<e.length;i=o++){var n=e[o][0],a=e[o][1],r=e[i][0],l=e[i][1];if(0===n&&0===r&&a*l<0||0===a&&0===l&&n*r<0)return debug("Crosses center, cannot count"),!1;if(0===n&&0===a||0===r&&0===l)return debug("On center point, cannot count"),!1;a>0!=l>0&&0<(r-n)*(0-a)/(l-a)+n&&(t=!t)}return t},PlaygroundHarmonyManager.prototype.ringsMatch=function(e,t){if(e.length!==t.length)return!1;var o=!1;return e.forEach((function(e){if(o=!1,t.forEach((function(t){e.equals(t)&&(o=!0)})),!o)return!1})),o},PlaygroundHarmonyManager.prototype.lookForRing=function(e,t,o){for(var i=0;i<this.harmonies.length;i++){var n=this.harmonies[i];if(n.containsTile(e)&&n.notAnyOfThese(o)){if(o.push(n),n.containsTile(t))return[!0,o];var a=n.getTileThatIsNotThisOne(e);return this.lookForRing(a,t,o)}}return[!1]};RED="Red",WHITE="White";function PlaygroundTile(e,t){this.code=e,this.ownerCode=t,"G"===this.ownerCode?this.ownerName=GUEST:"H"===this.ownerCode?this.ownerName=HOST:debug("INCORRECT OWNER CODE"),this.id=tileId++,this.drained=!1,this.selectedFromPile=!1}function PlaygroundTileManager(e){if(e)return this.hostTiles=this.loadTileSet("H"),void(this.guestTiles=this.loadTileSet("G"));this.hostTiles=this.loadTileSet("H"),this.guestTiles=this.loadTileSet("G")}function SkudPaiShoActuator(e,t,o){this.gameContainer=e,this.mobile=t,this.animationOn=o;var i=setupPaiShoBoard(this.gameContainer,SkudPaiShoController.getHostTilesContainerDivs(),SkudPaiShoController.getGuestTilesContainerDivs(),!1);this.boardContainer=i.boardContainer,this.hostTilesContainer=i.hostTilesContainer,this.guestTilesContainer=i.guestTilesContainer}function SkudPaiShoBoard(){this.size=new RowAndColumn(17,17),this.cells=this.brandNew(),this.harmonyManager=new SkudPaiShoHarmonyManager,this.rockRowAndCols=[],this.playedWhiteLotusTiles=[],this.winners=[]}PlaygroundTile.prototype.getConsoleDisplay=function(){return this.ownerCode+""+this.code},PlaygroundTile.prototype.getImageName=function(){return this.ownerCode+""+this.code},PlaygroundTile.prototype.getMoveDistance=function(){return this.type===BASIC_FLOWER?parseInt(this.basicValue):"L"===this.code?2:"O"===this.code?6:0},PlaygroundTile.prototype.getName=function(){return PlaygroundTile.getTileName(this.code)},PlaygroundTile.prototype.getCopy=function(){return new PlaygroundTile(this.code,this.ownerCode)},PlaygroundTile.getTileName=function(e){var t="";if(e.length>1){var o=e.charAt(0),i=e.charAt(1);"R"===o?("3"===i?t="Rose":"4"===i?t="Chrysanthemum":"5"===i&&(t="Rhododendron"),t+=" (Red "+i+")"):"W"===o&&("3"===i?t="Jasmine":"4"===i?t="Lily":"5"===i&&(t="White Jade"),t+=" (White "+i+")")}else"R"===e?t="Rock":"W"===e?t="Wheel":"K"===e?t="Knotweed":"B"===e?t="Boat":"O"===e?t="Orchid":"L"===e&&(t="White Lotus");return t},PlaygroundTileManager.prototype.loadTileSet=function(e){return this.loadPlaygroundSet(e)},PlaygroundTileManager.prototype.loadPlaygroundSet=function(e){var t=[];return t.push(new PlaygroundTile("Skud_R",e)),t.push(new PlaygroundTile("Skud_W",e)),t.push(new PlaygroundTile("Skud_K",e)),t.push(new PlaygroundTile("Skud_B",e)),t.push(new PlaygroundTile("Skud_R3",e)),t.push(new PlaygroundTile("Skud_R4",e)),t.push(new PlaygroundTile("Skud_R5",e)),t.push(new PlaygroundTile("Skud_W3",e)),t.push(new PlaygroundTile("Skud_W4",e)),t.push(new PlaygroundTile("Skud_W5",e)),t.push(new PlaygroundTile("Skud_L",e)),t.push(new PlaygroundTile("Skud_O",e)),t},PlaygroundTileManager.prototype.grabTile=function(e,t){return"G"===e?e=GUEST:"H"===e&&(e=HOST),this.peekTile(e,t)},PlaygroundTileManager.prototype.peekTile=function(e,t,o){var i,n=this.hostTiles;if(e===GUEST&&(n=this.guestTiles),o)for(var a=0;a<n.length;a++)if(n[a].id===o)return n[a];for(a=0;a<n.length;a++)if(n[a].code===t){i=n[a];break}return i||debug("NONE OF THAT TILE FOUND: "+e+" "+t),i},PlaygroundTileManager.prototype.removeSelectedTileFlags=function(){this.hostTiles.forEach((function(e){e.selectedFromPile=!1})),this.guestTiles.forEach((function(e){e.selectedFromPile=!1}))},PlaygroundTileManager.prototype.unselectTiles=function(e){var t=this.hostTiles;e===GUEST&&(t=this.guestTiles),t.forEach((function(e){e.selectedFromPile=!1}))},PlaygroundTileManager.prototype.aPlayerIsOutOfBasicFlowerTiles=function(){for(var e=!1,t=0;t<this.hostTiles.length;t++)if(this.hostTiles[t].type===BASIC_FLOWER){e=!0;break}var o=!1;for(t=0;t<this.guestTiles.length;t++)if(this.guestTiles[t].type===BASIC_FLOWER){o=!0;break}return!e&&o?HOST:!o&&e?GUEST:o||e?void 0:"BOTH PLAYERS"},PlaygroundTileManager.prototype.getPlayerWithMoreAccentTiles=function(){for(var e=0,t=0;t<this.hostTiles.length;t++)this.hostTiles[t].type===ACCENT_TILE&&e++;var o=0;for(t=0;t<this.guestTiles.length;t++)this.guestTiles[t].type===ACCENT_TILE&&o++;return e>o?HOST:o>e?GUEST:void 0},PlaygroundTileManager.prototype.playerHasBothSpecialTilesRemaining=function(e){var t=this.hostTiles;e===GUEST&&(t=this.guestTiles);var o=0;return t.forEach((function(e){e.type===SPECIAL_FLOWER&&o++})),o>1},PlaygroundTileManager.prototype.getCopy=function(){var e=new PlaygroundTileManager;return e.hostTiles=this.copyArr(this.hostTiles),e.guestTiles=this.copyArr(this.guestTiles),e},PlaygroundTileManager.prototype.copyArr=function(e){for(var t=[],o=0;o<e.length;o++)t.push(e[o].getCopy());return t},SkudPaiShoActuator.prototype.setAnimationOn=function(e){this.animationOn=e},SkudPaiShoActuator.prototype.actuate=function(e,t,o,i){var n=this;debug("Game Actuated"),i||(i=0),window.requestAnimationFrame((function(){n.htmlify(e,t,o,i)}))},SkudPaiShoActuator.prototype.htmlify=function(e,t,o,i){if(this.clearContainer(this.boardContainer),o&&o.moveType===ARRANGING){var n=e.cells[o.endPoint.rowAndColumn.row][o.endPoint.rowAndColumn.col];n.hasTile()&&"O"===n.tile.code&&(o.isOrchidMove=!0)}var a=this;e.cells.forEach((function(e){e.forEach((function(e){e&&a.addBoardPoint(e,o,i)}))}));var r=new SkudPaiShoTileManager(!0);r.hostTiles.forEach((function(e){a.clearTileContainer(e)})),r.guestTiles.forEach((function(e){a.clearTileContainer(e)})),t.hostTiles.forEach((function(e){a.addTile(e,this.hostTilesContainer)})),t.guestTiles.forEach((function(e){a.addTile(e,this.guestTilesContainer)}))},SkudPaiShoActuator.prototype.clearContainer=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},SkudPaiShoActuator.prototype.clearTileContainer=function(e){for(var t=document.querySelector("."+e.getImageName());t.firstChild;)t.removeChild(t.firstChild)},SkudPaiShoActuator.prototype.addTile=function(e,t){var o=document.querySelector("."+e.getImageName()),i=document.createElement("div");i.classList.add("point"),i.classList.add("hasTile"),e.selectedFromPile&&(i.classList.add("selectedFromPile"),i.classList.add("drained"));var n=document.createElement("img"),a=getSkudTilesSrcPath();n.src=a+e.getImageName()+".png",i.appendChild(n),i.setAttribute("name",e.getImageName()),i.setAttribute("id",e.id),this.mobile?i.setAttribute("onclick","unplayedTileClicked(this); showTileMessage(this);"):(i.setAttribute("onclick","unplayedTileClicked(this);"),i.setAttribute("onmouseover","showTileMessage(this);"),i.setAttribute("onmouseout","clearMessage();")),o.appendChild(i)},SkudPaiShoActuator.prototype.addBoardPoint=function(e,t,o){var i=createBoardPointDiv(e),n=this.animationOn&&!e.hasTile()&&t&&"B"===t.bonusTileCode&&!t.boatBonusPoint&&isSamePoint(t.bonusEndPoint,e.col,e.row);if(!e.isType(NON_PLAYABLE)){if(i.classList.add("activePoint"),e.isType(POSSIBLE_MOVE))i.classList.add("possibleMove");else if(e.betweenHarmony&&!gameOptionEnabled(NO_HARMONY_VISUAL_AIDS)){var a=[];n?(a.push("betweenHarmony"),e.betweenHarmonyHost&&a.push("bhHost"),e.betweenHarmonyGuest&&a.push("bhGuest"),setTimeout((function(){a.forEach((function(e){i.classList.add(e)}))}),pieceAnimationLength*(2-o))):(i.classList.add("betweenHarmony"),e.betweenHarmonyHost&&i.classList.add("bhHost"),e.betweenHarmonyGuest&&i.classList.add("bhGuest"))}this.mobile?i.setAttribute("onclick","pointClicked(this); showPointMessage(this);"):(i.setAttribute("onclick","pointClicked(this);"),i.setAttribute("onmouseover","showPointMessage(this);"),i.setAttribute("onmouseout","clearMessage();"))}if(n){var r=document.createElement("img");t&&this.doAnimateBoardPoint(e,t,o,r,{}),i.appendChild(r)}else if(e.hasTile()){i.classList.add("hasTile");r=document.createElement("img");var l={drainedOnThisTurn:!1,wasArranged:!1,didBonusMove:!1};t&&this.doAnimateBoardPoint(e,t,o,r,l);var s=getSkudTilesSrcPath();if(r.src=s+e.tile.getImageName()+".png",e.tile.harmonyOwners&&!gameOptionEnabled(NO_HARMONY_VISUAL_AIDS))if(this.animationOn&&(l.didBonusMove||l.wasArranged))setTimeout((function(){for(var t=0;t<e.tile.harmonyOwners.length;t++)i.classList.add(e.tile.harmonyOwners[t]+"harmony")}),((l.didBonusMove?2:1)-o)*pieceAnimationLength);else for(var h=0;h<e.tile.harmonyOwners.length;h++)i.classList.add(e.tile.harmonyOwners[h]+"harmony");if((e.tile.drained||e.tile.trapped)&&(l.drainedOnThisTurn?setTimeout((function(){i.classList.add("drained")}),pieceAnimationLength):i.classList.add("drained")),i.appendChild(r),this.animationOn&&t&&t.capturedTile&&isSamePoint(t.endPoint,e.col,e.row)&&0===o){var d=document.createElement("img");d.src=s+t.capturedTile.getImageName()+".png",d.classList.add("underneath"),i.appendChild(d),setTimeout((function(){requestAnimationFrame((function(){d.style.visibility="hidden"}))}),pieceAnimationLength)}}if(this.boardContainer.appendChild(i),e.betweenHarmony&&16===e.col){var u=document.createElement("div");u.classList.add("clear"),this.boardContainer.appendChild(u)}},SkudPaiShoActuator.prototype.doAnimateBoardPoint=function(e,t,o,i,n){if(this.animationOn){var a=e.col,r=e.row,l=a,s=r,h=!1,d=!1;if(t.hasHarmonyBonus())if(debug(t.bonusTileCode),isSamePoint(t.bonusEndPoint,l,s))if(h=!0,"B"===t.bonusTileCode&&!t.boatBonusPoint&&t.tileRemovedWithBoat&&isSamePoint(t.bonusEndPoint,l,s)){var u=getSkudTilesSrcPath();i.src=u+t.tileRemovedWithBoat.getImageName()+".png",d=!0}else"B"===t.bonusTileCode&&t.boatBonusPoint&&isSamePoint(t.bonusEndPoint,l,s)&&(i.style.zIndex=90);else if(t.boatBonusPoint&&isSamePoint(t.boatBonusPoint,a,r))a=t.bonusEndPoint.rowAndColumn.col,r=t.bonusEndPoint.rowAndColumn.row,n.didBonusMove=!0;else if("W"===t.bonusTileCode){var p=a-t.bonusEndPoint.rowAndColumn.col,c=r-t.bonusEndPoint.rowAndColumn.row;-1<=p&&1>=p&&-1<=c&&1>=c&&p+c!==p*c&&(1===p&&c>-1?r--:-1===c&&p>-1?a--:-1===p&&c<1?r++:a++,n.didBonusMove=!0)}else if("K"===t.bonusTileCode){p=a-t.bonusEndPoint.rowAndColumn.col,c=r-t.bonusEndPoint.rowAndColumn.row;-1<=p&&1>=p&&-1<=c&&1>=c&&p+c!==p*c&&(n.drainedOnThisTurn=!0)}var g=a,m=r;if(0===o)if(t.moveType===ARRANGING&&e.tile&&e.tile.type!==ACCENT_TILE){if(isSamePoint(t.endPoint,a,r))n.wasArranged=!0,a=t.startPoint.rowAndColumn.col,r=t.startPoint.rowAndColumn.row,i.style.transform="scale(1.2)",i.style.zIndex=99;else if(t.isOrchidMove){p=a-t.endPoint.rowAndColumn.col,c=r-t.endPoint.rowAndColumn.row;-1<=p&&1>=p&&-1<=c&&1>=c&&(n.drainedOnThisTurn=!0)}}else t.moveType===PLANTING&&isSamePoint(t.endPoint,l,s)&&1===piecePlaceAnimation&&(i.style.transform="scale(2)",i.style.zIndex=99,requestAnimationFrame((function(){i.style.transform="scale(1)"})));a===l&&r===s||!e.tile||!e.tile.drained&&!e.tile.trapped||(n.drainedOnThisTurn=!0);var T=34,y=T,f="px";window.innerWidth<=612&&(T=5.5555,y=5.611,f="vw"),i.style.left=(a-l)*T+f,i.style.top=(r-s)*y+f,h&&!d&&(i.style.visibility="hidden",1===piecePlaceAnimation&&(i.style.transform="scale(2)")),g=(g-l)*T,m=(m-s)*y,requestAnimationFrame((function(){i.style.left=g+f,i.style.top=m+f})),setTimeout((function(){requestAnimationFrame((function(){i.style.left="0px",i.style.top="0px",i.style.visibility="visible",i.style.transform="scale(1)",d&&(i.classList.add("noTransition"),i.src=u+t.accentTileUsed.getImageName()+".png",i.style.transform="scale(2)",requestAnimationFrame((function(){i.classList.remove("noTransition"),i.style.transform="scale(1)",setTimeout((function(){i.style.visibility="hidden"}),pieceAnimationLength)})))}))}),0===o?pieceAnimationLength:0)}},SkudPaiShoActuator.prototype.printBoard=function(e){debug("");var t=0;e.cells.forEach((function(e){var o=t+"\t: ";e.forEach((function(e){var t=e.getConsoleDisplay();t.length<3&&(o+=" "),o+=t,t.length<2&&(o+=" ")})),debug(o),t++})),debug("")},SkudPaiShoBoard.prototype.brandNew=function(){var e=[];e[0]=this.newRow(9,[SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.gate(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral()]),e[1]=this.newRow(11,[SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.redWhiteNeutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral()]),e[2]=this.newRow(13,[SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.whiteNeutral(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.redNeutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral()]),e[3]=this.newRow(15,[SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.whiteNeutral(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.redNeutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral()]),e[4]=this.newRow(17,[SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.whiteNeutral(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.redNeutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral()]),e[5]=this.newRow(17,[SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.whiteNeutral(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.redNeutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral()]),e[6]=this.newRow(17,[SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.whiteNeutral(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.redNeutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral()]),e[7]=this.newRow(17,[SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.whiteNeutral(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.redNeutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral()]),e[8]=this.newRow(17,[SkudPaiShoBoardPoint.gate(),SkudPaiShoBoardPoint.redWhiteNeutral(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.redWhiteNeutral(),SkudPaiShoBoardPoint.gate()]),e[9]=this.newRow(17,[SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.redNeutral(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.whiteNeutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral()]),e[10]=this.newRow(17,[SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.redNeutral(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.whiteNeutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral()]),e[11]=this.newRow(17,[SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.redNeutral(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.whiteNeutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral()]),e[12]=this.newRow(17,[SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.redNeutral(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.whiteNeutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral()]),e[13]=this.newRow(15,[SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.redNeutral(),SkudPaiShoBoardPoint.red(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.white(),SkudPaiShoBoardPoint.whiteNeutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral()]),e[14]=this.newRow(13,[SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.redNeutral(),SkudPaiShoBoardPoint.redWhite(),SkudPaiShoBoardPoint.whiteNeutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral()]),e[15]=this.newRow(11,[SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.redWhiteNeutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral()]),e[16]=this.newRow(9,[SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.gate(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral(),SkudPaiShoBoardPoint.neutral()]);for(var t=0;t<e.length;t++)for(var o=0;o<e[t].length;o++)e[t][o].row=t,e[t][o].col=o;return e},SkudPaiShoBoard.prototype.newRow=function(e,t){var o=[],i=(this.size.row-e)/2,n=new SkudPaiShoBoardPoint;n.addType(NON_PLAYABLE);for(var a=0;a<this.size.row;a++)o[a]=a<i?n:a<i+e&&t?t[a-i]:n;return o},SkudPaiShoBoard.prototype.placeTile=function(e,t,o,i){var n;if(e.type===ACCENT_TILE?e.accentType===ROCK?this.placeRock(e,t):e.accentType===WHEEL?this.placeWheel(e,t):e.accentType===KNOTWEED?this.placeKnotweed(e,t):e.accentType===BOAT?n=this.placeBoat(e,t,i):e.accentType===BAMBOO?this.placeBamboo(e,t,!1,o):e.accentType===POND?this.placePond(e,t):e.accentType===LION_TURTLE&&this.placeLionTurtle(e,t):(this.putTileOnPoint(e,t),e.specialFlowerType===WHITE_LOTUS&&this.playedWhiteLotusTiles.push(e)),this.flagAllTrappedAndDrainedTiles(),this.analyzeHarmonies(),e.accentType===BOAT)return{tileRemovedWithBoat:n}},SkudPaiShoBoard.prototype.putTileOnPoint=function(e,t){var o=t.rowAndColumn;(o=this.cells[o.row][o.col]).putTile(e)},SkudPaiShoBoard.prototype.canPlaceRock=function(e){return!e.hasTile()&&!e.isType(GATE)},SkudPaiShoBoard.prototype.placeRock=function(e,t){var o=t.rowAndColumn,i=this.cells[o.row][o.col];if(!this.canPlaceRock(i))return!1;i.isType(GATE)||(i.putTile(e),this.rockRowAndCols.push(o))},SkudPaiShoBoard.prototype.canPlaceWheel=function(e){if(e.hasTile())return!1;if(e.isType(GATE))return!1;for(var t=this.getSurroundingRowAndCols(e),o=0;o<t.length;o++){var i=this.cells[t[o].row][t[o].col];if(i.isType(GATE)&&!newWheelRule)return!1;if(!newKnotweedRules&&i.hasTile()&&(i.tile.drained||i.tile.accentType===KNOTWEED))return!1;if(newWheelRule&&i.isType(GATE)&&i.hasTile())return!1;if((rocksUnwheelable||simplest)&&i.hasTile()&&i.tile.accentType===ROCK)return!1;if(superRocks&&i.hasTile())for(var n=this.getSurroundingRowAndCols(i),a=0;a<n.length;a++){var r=this.cells[n[a].row][n[a].col];if(r.hasTile()&&r.tile.accentType===ROCK)return!1}if(i.hasTile()){var l=this.getClockwiseRowCol(e,t[o]);if(!this.isValidRowCol(l))return!1;var s=this.cells[l.row][l.col];if(!s.canHoldTile(i.tile,!0))return!1;if(s.isType(GATE))return!1}}var h=this.getCopy(),d=new NotationPoint(new RowAndColumn(e.row,e.col).notationPointString);return h.placeWheel(new SkudPaiShoTile("W","G"),d,!0),!h.moveCreatesDisharmony(e,e)},SkudPaiShoBoard.prototype.isValidRowCol=function(e){return e.row>=0&&e.col>=0&&e.row<=16&&e.col<=16},SkudPaiShoBoard.prototype.placeWheel=function(e,t,o){var i=t.rowAndColumn,n=this.cells[i.row][i.col],a=this.getSurroundingRowAndCols(i);if(!o&&!this.canPlaceWheel(n))return!1;n.putTile(e);for(var r=[],l=0;l<a.length;l++){e=this.cells[a[l].row][a[l].col].removeTile();var s=this.getClockwiseRowCol(i,a[l]);this.isValidRowCol(s)&&r.push([e,s])}var h=this;r.forEach((function(e){h.cells[e[1].row][e[1].col].putTile(e[0])})),this.refreshRockRowAndCols()},SkudPaiShoBoard.prototype.canPlaceKnotweed=function(e){if(e.hasTile())return!1;if(e.isType(GATE))return!1;if(!newKnotweedRules)for(var t=this.getSurroundingRowAndCols(e),o=0;o<t.length;o++){if(this.cells[t[o].row][t[o].col].isType(GATE))return!1}return!0},SkudPaiShoBoard.prototype.placeKnotweed=function(e,t){var o=t.rowAndColumn,i=this.cells[o.row][o.col],n=this.getSurroundingRowAndCols(o);if(!this.canPlaceKnotweed(i))return!1;i.putTile(e);for(var a=0;a<n.length;a++){this.cells[n[a].row][n[a].col].drainTile()}},SkudPaiShoBoard.prototype.canPlaceBoat=function(e,t){if(!e.hasTile())return!1;if(e.isType(GATE))return!1;if(e.tile.type===ACCENT_TILE&&!boatOnlyMoves)if(e.tile.accentType===KNOTWEED||simplest||rocksUnwheelable){var o=this.getCopy(),i=new NotationPoint(new RowAndColumn(e.row,e.col).notationPointString);o.placeBoat(new SkudPaiShoTile("B","G"),i,e,!0);var n=o.cells[e.row][e.col];if(o.moveCreatesDisharmony(n,n))return!1}else{if(rocksUnwheelable&&e.tile.accentType!==ROCK)return!1;if(!rocksUnwheelable)return!1}return!0},SkudPaiShoBoard.prototype.placeBoat=function(e,t,o,i){var n,a=t.rowAndColumn,r=this.cells[a.row][a.col];if(!i&&!this.canPlaceBoat(r,e))return!1;if(r.tile.type!==ACCENT_TILE||boatOnlyMoves){var l=o.rowAndColumn,s=this.cells[l.row][l.col];if(!s.canHoldTile(r.tile))return debug("Boat cannot move that tile there!"),!1;s.putTile(r.removeTile()),r.putTile(e)}else{n=r.removeTile();for(var h=this.getSurroundingRowAndCols(a),d=0;d<h.length;d++){this.cells[h[d].row][h[d].col].restoreTile()}rocksUnwheelable&&this.refreshRockRowAndCols()}return n},SkudPaiShoBoard.prototype.canPlaceBamboo=function(e,t){if(e.hasTile())return!1;if(e.isType(GATE))return!1;var o=this.getCopy(),i=new NotationPoint(new RowAndColumn(e.row,e.col).notationPointString);return o.placeBamboo(new SkudPaiShoTile("M","G"),i,!0),!o.moveCreatesDisharmony(e,e)},SkudPaiShoBoard.prototype.placeBamboo=function(e,t,o,i){var n=t.rowAndColumn,a=this.cells[n.row][n.col];if(!o&&!this.canPlaceBamboo(a,e))return!1;a.putTile(e);for(var r=this.getSurroundingRowAndCols(n),l=!1,s=!1,h=0;h<r.length;h++){!(d=this.cells[r[h].row][r[h].col]).isType(GATE)&&d.hasTile()&&d.tile.ownerName===e.ownerName&&d.tile.type!==ACCENT_TILE?l=!0:d.isType(GATE)&&d.hasTile()&&(s=!0)}if(l&&!s)for(h=0;h<r.length;h++){var d;if((d=this.cells[r[h].row][r[h].col]).hasTile()){var u=d.removeTile();i&&i.putTileBack(u)}}this.refreshRockRowAndCols()},SkudPaiShoBoard.prototype.canPlacePond=function(e,t){return!e.hasTile()&&!e.isType(GATE)},SkudPaiShoBoard.prototype.placePond=function(e,t,o){var i=t.rowAndColumn,n=this.cells[i.row][i.col];if(!o&&!this.canPlacePond(n,e))return!1;n.putTile(e)},SkudPaiShoBoard.prototype.canPlaceLionTurtle=function(e,t){return!e.hasTile()&&!e.isType(GATE)},SkudPaiShoBoard.prototype.placeLionTurtle=function(e,t,o){var i=t.rowAndColumn,n=this.cells[i.row][i.col];if(!o&&!this.canPlaceLionTurtle(n,e))return!1;n.putTile(e)},SkudPaiShoBoard.prototype.getClockwiseRowCol=function(e,t){return t.row<e.row&&t.col<=e.col?new RowAndColumn(t.row,t.col+1):t.col>e.col&&t.row<=e.row?new RowAndColumn(t.row+1,t.col):t.row>e.row&&t.col>=e.col?new RowAndColumn(t.row,t.col-1):t.col<e.col&&t.row>=e.row?new RowAndColumn(t.row-1,t.col):void debug("ERROR CLOCKWISE CALCULATING")},SkudPaiShoBoard.prototype.getSurroundingRowAndCols=function(e){for(var t=[],o=e.row-1;o<=e.row+1;o++)for(var i=e.col-1;i<=e.col+1;i++){if((o!==e.row||i!==e.col)&&o>=0&&i>=0&&o<17&&i<17)this.cells[o][i].isType(NON_PLAYABLE)||t.push(new RowAndColumn(o,i))}return t},SkudPaiShoBoard.prototype.refreshRockRowAndCols=function(){this.rockRowAndCols=[];var e=this;this.cells.forEach((function(t){t.forEach((function(t){t.hasTile()&&t.tile.accentType===ROCK&&e.rockRowAndCols.push(t)}))}))},SkudPaiShoBoard.prototype.pointIsOpenGate=function(e){var t=e.rowAndColumn;return(t=this.cells[t.row][t.col]).isOpenGate()||this.pointIsOpenAndSurroundsPond(t)},SkudPaiShoBoard.prototype.pointIsOpenAndSurroundsPond=function(e){if(e.hasTile())return!1;for(var t=this.getSurroundingRowAndCols(e),o=0;o<t.length;o++){var i=this.cells[t[o].row][t[o].col];if(i.hasTile()&&i.tile.accentType===POND)return!0}return!1},SkudPaiShoBoard.prototype.moveTile=function(e,t,o){var i=t.rowAndColumn,n=o.rowAndColumn;if(i.row<0||i.row>16||n.row<0||n.row>16)return debug("That point does not exist. So it's not gonna happen."),!1;var a=this.cells[i.row][i.col],r=this.cells[n.row][n.col];if(!this.canMoveTileToPoint(e,a,r))return debug("Bad move bears"),showBadMoveModal(),!1;var l=a.removeTile(),s=r.tile;return l||debug("Error: No tile to move!"),r.putTile(l)?(debug("Error moving tile. It probably didn't get moved."),!1):(this.flagAllTrappedAndDrainedTiles(),{bonusAllowed:this.hasNewHarmony(e,l,i,n),movedTile:l,capturedTile:s})},SkudPaiShoBoard.prototype.flagAllTrappedAndDrainedTiles=function(){for(var e=0;e<this.cells.length;e++)for(var t=0;t<this.cells[e].length;t++){(o=this.cells[e][t]).hasTile()&&(o.tile.trapped=!1,newKnotweedRules&&(o.tile.drained=!1))}for(e=0;e<this.cells.length;e++)for(t=0;t<this.cells[e].length;t++){var o;(o=this.cells[e][t]).isType(GATE)||this.trapTilesSurroundingPointIfNeeded(o),newKnotweedRules&&this.drainTilesSurroundingPointIfNeeded(o)}},SkudPaiShoBoard.prototype.drainTilesSurroundingPointIfNeeded=function(e){if(newKnotweedRules&&e.hasTile()&&e.tile.accentType===KNOTWEED)for(var t=this.getSurroundingRowAndCols(e),o=0;o<t.length;o++){var i=this.cells[t[o].row][t[o].col];i.hasTile()&&!i.isType(GATE)&&i.tile.type!==ACCENT_TILE&&i.tile.specialFlowerType!==ORCHID&&(i.tile.drained=!0)}},SkudPaiShoBoard.prototype.trapTilesSurroundingPointIfNeeded=function(e){if(e.hasTile()&&e.tile.specialFlowerType===ORCHID)for(var t=e.tile.ownerName,o=this.getSurroundingRowAndCols(e),i=0;i<o.length;i++){var n=this.cells[o[i].row][o[i].col];n.hasTile()&&!n.isType(GATE)&&n.tile.ownerName!==t&&n.tile.type!==ACCENT_TILE&&(n.tile.trapped=!0)}},SkudPaiShoBoard.prototype.whiteLotusProtected=function(e){return!(!lotusNoCapture&&!simplest)||!!simpleSpecialFlowerRule},SkudPaiShoBoard.prototype.orchidCanCapture=function(e){if(simpleSpecialFlowerRule||simplest)return!1;var t=!1;return this.cells.forEach((function(o){o.forEach((function(o){o.hasTile()&&o.tile.specialFlowerType===WHITE_LOTUS&&o.tile.ownerName===e.ownerName&&!o.isType(GATE)&&(t=!0)}))})),t},SkudPaiShoBoard.prototype.orchidVulnerable=function(e){if(newOrchidVulnerableRule){var t=!1;return this.cells.forEach((function(o){o.forEach((function(o){o.hasTile()&&o.tile.specialFlowerType===WHITE_LOTUS&&o.tile.ownerName!==e.ownerName&&(t=!0)}))})),t}if(simpleSpecialFlowerRule)return!0;if(lotusNoCapture||simplest){t=!1;return this.cells.forEach((function(o){o.forEach((function(o){!o.isType(GATE)&&o.hasTile()&&o.tile.specialFlowerType===WHITE_LOTUS&&o.tile.ownerName===e.ownerName&&(t=!0)}))})),t}t=!1;return this.playedWhiteLotusTiles.forEach((function(o){o.ownerName===e.ownerName&&(t=!0)})),!!t||void 0},SkudPaiShoBoard.prototype.canCapture=function(e,t){var o=e.tile,i=t.tile;if(o.ownerName===i.ownerName)return!1;for(var n=this.getSurroundingRowAndCols(t),a=0;a<n.length;a++){var r=this.cells[n[a].row][n[a].col];if(r.hasTile()&&r.tile.accentType===BAMBOO)return!1}if(o.specialFlowerType===ORCHID&&i.type!==ACCENT_TILE&&this.orchidCanCapture(o))return!0;if(i.specialFlowerType===WHITE_LOTUS){if(this.whiteLotusProtected(i))return!1;if(o.type===BASIC_FLOWER)return!0}return!!o.clashesWith(i)||(!(i.specialFlowerType!==ORCHID||o.type===ACCENT_TILE||!this.orchidVulnerable(i))||void 0)},SkudPaiShoBoard.prototype.canMoveTileToPoint=function(e,t,o){if(!t.hasTile())return!1;if(t.tile.ownerName!==e)return!1;if(t.tile.trapped)return!1;if(!newKnotweedRules&&t.tile.drained)return!1;if(o.isType(GATE))return!1;var i=!1;if(o.hasTile()&&(i=this.canCapture(t,o)),o.hasTile()&&!i)return!1;if(!o.canHoldTile(t.tile,i))return!1;var n=t.tile.getMoveDistance();return!(Math.abs(t.row-o.row)+Math.abs(t.col-o.col)>n)&&(!!this.verifyAbleToReach(t,o,n)&&!this.moveCreatesDisharmony(t,o))},SkudPaiShoBoard.prototype.canTransportTileToPointWithBoat=function(e,t){if(!e.hasTile())return!1;if(t.isType(GATE))return!1;if(t.hasTile())return!1;if(!t.canHoldTile(e.tile))return!1;var o=this.getCopy(),i=o.cells[e.row][e.col],n=new NotationPoint(new RowAndColumn(i.row,i.col).notationPointString),a=new NotationPoint(new RowAndColumn(t.row,t.col).notationPointString);return o.placeBoat(new SkudPaiShoTile("B","G"),n,a,!0),!o.moveCreatesDisharmony(i,i)},SkudPaiShoBoard.prototype.moveCreatesDisharmony=function(e,t){var o;e.row===t.row&&e.col===t.col||(o=t.removeTile(),t.putTile(e.removeTile()));for(var i=!1,n=0;n<this.cells.length;n++)for(var a=0;a<this.cells[n].length;a++){var r=this.cells[n][a];if(r.hasTile()&&this.hasDisharmony(r)){i=!0;break}}return e.row===t.row&&e.col===t.col||(e.putTile(t.removeTile()),t.putTile(o)),i},SkudPaiShoBoard.prototype.verifyAbleToReach=function(e,t,o){return this.pathFound(e,t,o)},SkudPaiShoBoard.prototype.pathFound=function(e,t,o){if(!e||!t)return!1;if(e.isType(NON_PLAYABLE)||t.isType(NON_PLAYABLE))return!1;if(e.row===t.row&&e.col===t.col)return!0;if(o<=0)return!1;if(1===Math.abs(e.row-t.row)+Math.abs(e.col-t.col))return!0;var i=e.row-1;if(i>=0&&(!(n=this.cells[i][e.col]).hasTile()&&this.pathFound(n,t,o-1)))return!0;if((i=e.row+1)<17&&(!(n=this.cells[i][e.col]).hasTile()&&this.pathFound(n,t,o-1)))return!0;var n,a=e.col-1;if(a>=0&&(!(n=this.cells[e.row][a]).hasTile()&&this.pathFound(n,t,o-1)))return!0;if((a=e.col+1)<17&&(!(n=this.cells[e.row][a]).hasTile()&&this.pathFound(n,t,o-1)))return!0},SkudPaiShoBoard.prototype.rowBlockedByRock=function(e){if(simpleRocks||simplest)return!1;var t=!1;return this.rockRowAndCols.forEach((function(o){o.row===e&&(t=!0)})),t},SkudPaiShoBoard.prototype.columnBlockedByRock=function(e){if(simpleRocks||simplest)return!1;var t=!1;return this.rockRowAndCols.forEach((function(o){o.col===e&&(t=!0)})),t},SkudPaiShoBoard.prototype.markSpacesBetweenHarmonies=function(){this.cells.forEach((function(e){e.forEach((function(e){e.betweenHarmony=!1,e.betweenHarmonyHost=!1,e.betweenHarmonyGuest=!1}))}));var e=this;this.harmonyManager.harmonies.forEach((function(t){if(t.tile1Pos.row===t.tile2Pos.row){var o=t.tile1Pos.row,i=t.tile1Pos.col,n=t.tile2Pos.col;t.tile2Pos.col<t.tile1Pos.col&&(i=t.tile2Pos.col,n=t.tile1Pos.col);for(var a=i+1;a<n;a++)e.cells[o][a].betweenHarmony=!0,t.hasOwner(GUEST)&&(e.cells[o][a].betweenHarmonyGuest=!0),t.hasOwner(HOST)&&(e.cells[o][a].betweenHarmonyHost=!0)}else if(t.tile2Pos.col==t.tile2Pos.col){a=t.tile1Pos.col;var r=t.tile1Pos.row,l=t.tile2Pos.row;t.tile2Pos.row<t.tile1Pos.row&&(r=t.tile2Pos.row,l=t.tile1Pos.row);for(o=r+1;o<l;o++)e.cells[o][a].betweenHarmony=!0,t.hasOwner(GUEST)&&(e.cells[o][a].betweenHarmonyGuest=!0),t.hasOwner(HOST)&&(e.cells[o][a].betweenHarmonyHost=!0)}}))},SkudPaiShoBoard.prototype.analyzeHarmonies=function(){this.harmonyManager.clearList();for(var e=0;e<this.cells.length;e++)for(var t=0;t<this.cells[e].length;t++){var o=this.cells[e][t];if(o.hasTile()){var i=this.getTileHarmonies(o);this.harmonyManager.addHarmonies(i),o.tile.harmonyOwners=[];for(var n=0;n<i.length;n++)for(var a=0;a<i[n].owners.length;a++){var r=i[n].owners[a].ownerName,l=i[n].tile1,s=i[n].tile2;l.harmonyOwners||(l.harmonyOwners=[]),s.harmonyOwners||(s.harmonyOwners=[]),l.harmonyOwners.includes(r)||l.harmonyOwners.push(r),s.harmonyOwners.includes(r)||s.harmonyOwners.push(r)}}}this.markSpacesBetweenHarmonies(),this.winners=[];var h=this,d=this.harmonyManager.harmonyRingExists();d.length>0&&d.forEach((function(e){h.winners.includes(e)||h.winners.push(e)}))},SkudPaiShoBoard.prototype.getSurroundingLionTurtleTiles=function(e){for(var t=[],o=this.getSurroundingRowAndCols(e),i=0;i<o.length;i++){var n=this.cells[o[i].row][o[i].col];n.hasTile()&&n.tile.accentType===LION_TURTLE&&t.push(n.tile)}return t},SkudPaiShoBoard.prototype.getTileHarmonies=function(e){var t=e.tile,o=e,i=[];if(this.cells[o.row][o.col].isType(GATE))return i;var n=this.getSurroundingLionTurtleTiles(o);if(!this.rowBlockedByRock(o.row)){var a=this.getHarmonyLeft(t,o,n);a&&i.push(a);var r=this.getHarmonyRight(t,o,n);r&&i.push(r)}if(!this.columnBlockedByRock(o.col)){var l=this.getHarmonyUp(t,o,n);l&&i.push(l);var s=this.getHarmonyDown(t,o,n);s&&i.push(s)}return i},SkudPaiShoBoard.prototype.getHarmonyLeft=function(e,t,o){for(var i=t.col-1;i>=0&&!this.cells[t.row][i].hasTile()&&!this.cells[t.row][i].isType(GATE);)i--;if(i>=0){var n=this.cells[t.row][i],a=this.getSurroundingLionTurtleTiles(n),r=(a=a.concat(o)).length>0;if(!n.isType(GATE)&&e.formsHarmonyWith(n.tile,r))return new SkudPaiShoHarmony(e,t,n.tile,new RowAndColumn(t.row,i),a)}},SkudPaiShoBoard.prototype.getHarmonyRight=function(e,t,o){for(var i=t.col+1;i<=16&&!this.cells[t.row][i].hasTile()&&!this.cells[t.row][i].isType(GATE);)i++;if(i<=16){var n=this.cells[t.row][i],a=this.getSurroundingLionTurtleTiles(n),r=(a=a.concat(o)).length>0;if(!n.isType(GATE)&&e.formsHarmonyWith(n.tile,r))return new SkudPaiShoHarmony(e,t,n.tile,new RowAndColumn(t.row,i),a)}},SkudPaiShoBoard.prototype.getHarmonyUp=function(e,t,o){for(var i=t.row-1;i>=0&&!this.cells[i][t.col].hasTile()&&!this.cells[i][t.col].isType(GATE);)i--;if(i>=0){var n=this.cells[i][t.col],a=this.getSurroundingLionTurtleTiles(n),r=(a=a.concat(o)).length>0;if(!n.isType(GATE)&&e.formsHarmonyWith(n.tile,r))return new SkudPaiShoHarmony(e,t,n.tile,new RowAndColumn(i,t.col),a)}},SkudPaiShoBoard.prototype.getHarmonyDown=function(e,t,o){for(var i=t.row+1;i<=16&&!this.cells[i][t.col].hasTile()&&!this.cells[i][t.col].isType(GATE);)i++;if(i<=16){var n=this.cells[i][t.col],a=this.getSurroundingLionTurtleTiles(n),r=(a=a.concat(o)).length>0;if(!n.isType(GATE)&&e.formsHarmonyWith(n.tile,r))return new SkudPaiShoHarmony(e,t,n.tile,new RowAndColumn(i,t.col),a)}},SkudPaiShoBoard.prototype.hasNewHarmony=function(e,t,o,i){var n=this.harmonyManager.harmonies;return this.analyzeHarmonies(),this.harmonyManager.hasNewHarmony(e,n)},SkudPaiShoBoard.prototype.hasDisharmony=function(e){if(e.isType(GATE))return!1;var t=e.tile,o=!1;return this.hasDisharmonyLeft(t,e)&&(o=!0),this.hasDisharmonyRight(t,e)&&(o=!0),this.hasDisharmonyUp(t,e)&&(o=!0),this.hasDisharmonyDown(t,e)&&(o=!0),o},SkudPaiShoBoard.prototype.hasDisharmonyLeft=function(e,t){for(var o=t.col-1;o>=0&&!this.cells[t.row][o].hasTile()&&!this.cells[t.row][o].isType(GATE);)o--;if(o>=0){var i=this.cells[t.row][o];if(!i.isType(GATE)&&e.clashesWith(i.tile))return!0}},SkudPaiShoBoard.prototype.hasDisharmonyRight=function(e,t){for(var o=t.col+1;o<=16&&!this.cells[t.row][o].hasTile()&&!this.cells[t.row][o].isType(GATE);)o++;if(o<=16){var i=this.cells[t.row][o];if(!i.isType(GATE)&&e.clashesWith(i.tile))return!0}},SkudPaiShoBoard.prototype.hasDisharmonyUp=function(e,t){for(var o=t.row-1;o>=0&&!this.cells[o][t.col].hasTile()&&!this.cells[o][t.col].isType(GATE);)o--;if(o>=0){var i=this.cells[o][t.col];if(!i.isType(GATE)&&e.clashesWith(i.tile))return!0}},SkudPaiShoBoard.prototype.hasDisharmonyDown=function(e,t){for(var o=t.row+1;o<=16&&!this.cells[o][t.col].hasTile()&&!this.cells[o][t.col].isType(GATE);)o++;if(o<=16){var i=this.cells[o][t.col];if(!i.isType(GATE)&&e.clashesWith(i.tile))return!0}},SkudPaiShoBoard.prototype.setPossibleMovePoints=function(e){if(e.hasTile())for(var t=e.tile.ownerName,o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++)this.canMoveTileToPoint(t,e,this.cells[o][i])&&this.cells[o][i].addType(POSSIBLE_MOVE)},SkudPaiShoBoard.prototype.removePossibleMovePoints=function(){this.cells.forEach((function(e){e.forEach((function(e){e.removeType(POSSIBLE_MOVE)}))}))},SkudPaiShoBoard.prototype.setOpenGatePossibleMoves=function(e,t){for(var o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++){var n=this.cells[o][i];if(n.isOpenGate()&&this.cells[o][i].addType(POSSIBLE_MOVE),t&&n.hasTile()&&n.tile.accentType===POND)for(var a=this.getSurroundingRowAndCols(n),r=0;r<a.length;r++){var l=this.cells[a[r].row][a[r].col];if(l.canHoldTile(t)){var s=this.getCopy(),h=new NotationPoint(new RowAndColumn(l.row,l.col).notationPointString);s.placeTile(t,h),s.moveCreatesDisharmony(h,h)||l.addType(POSSIBLE_MOVE)}}}},SkudPaiShoBoard.prototype.playerControlsLessThanTwoGates=function(e){for(var t=0,o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++){var n=this.cells[o][i];n.isType(GATE)&&n.hasTile()&&n.tile.ownerName===e&&t++}return t<2},SkudPaiShoBoard.prototype.playerHasNoGrowingFlowers=function(e){for(var t=0;t<this.cells.length;t++)for(var o=0;o<this.cells[t].length;o++){var i=this.cells[t][o];if(i.isType(GATE)&&i.hasTile()&&i.tile.ownerName===e)return!1}return!0},SkudPaiShoBoard.prototype.revealSpecialFlowerPlacementPoints=function(e){var t,o=[],i=0,n=8;(t=this.cells[i][n]).hasTile()&&t.tile.ownerName===e&&(o.push(this.cells[i][n-1]),o.push(this.cells[i][n+1])),i=16,(t=this.cells[i][n]).hasTile()&&t.tile.ownerName===e&&(o.push(this.cells[i][n-1]),o.push(this.cells[i][n+1])),i=8,n=0,(t=this.cells[i][n]).hasTile()&&t.tile.ownerName===e&&(o.push(this.cells[i-1][n]),o.push(this.cells[i+1][n])),n=16,(t=this.cells[i][n]).hasTile()&&t.tile.ownerName===e&&(o.push(this.cells[i-1][n]),o.push(this.cells[i+1][n])),o.forEach((function(e){e.hasTile()||e.addType(POSSIBLE_MOVE)}))},SkudPaiShoBoard.prototype.setGuestGateOpen=function(){this.cells[16][8].isOpenGate()&&this.cells[16][8].addType(POSSIBLE_MOVE)},SkudPaiShoBoard.prototype.revealPossiblePlacementPoints=function(e){var t=this;this.cells.forEach((function(o){o.forEach((function(o){var i=!1;(e.accentType===ROCK&&t.canPlaceRock(o)||e.accentType===WHEEL&&t.canPlaceWheel(o)||e.accentType===KNOTWEED&&t.canPlaceKnotweed(o)||e.accentType===BOAT&&t.canPlaceBoat(o,e)||e.accentType===BAMBOO&&t.canPlaceBamboo(o,e)||e.accentType===POND&&t.canPlacePond(o,e)||e.accentType===LION_TURTLE&&t.canPlaceLionTurtle(o,e))&&(i=!0),i&&o.addType(POSSIBLE_MOVE)}))}))},SkudPaiShoBoard.prototype.revealBoatBonusPoints=function(e){if(e.hasTile()){var t=e.tile.ownerName;if(newKnotweedRules)for(var o=this.getSurroundingRowAndCols(e),i=0;i<o.length;i++){var n=this.cells[o[i].row][o[i].col];this.canTransportTileToPointWithBoat(e,n)&&n.addType(POSSIBLE_MOVE)}else for(var a=0;a<this.cells.length;a++)for(var r=0;r<this.cells[a].length;r++){n=this.cells[a][r];Math.abs(e.row-n.row)+Math.abs(e.col-n.col)===1&&this.canMoveTileToPoint(t,e,n)&&n.addType(POSSIBLE_MOVE)}}},SkudPaiShoBoard.prototype.getCopy=function(){for(var e=new SkudPaiShoBoard,t=0;t<this.cells.length;t++)for(var o=0;o<this.cells[t].length;o++)e.cells[t][o]=this.cells[t][o].getCopy();for(var i=0;i<this.playedWhiteLotusTiles.length;i++)e.playedWhiteLotusTiles.push(this.playedWhiteLotusTiles[i].getCopy());return e.refreshRockRowAndCols(),e.analyzeHarmonies(),e},SkudPaiShoBoard.prototype.numTilesInGardensForPlayer=function(e){for(var t=0,o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++){var n=this.cells[o][i];1===n.types.length&&n.hasTile()&&n.isType(n.tile.basicColorName)&&t++}return t},SkudPaiShoBoard.prototype.numTilesOnBoardForPlayer=function(e){for(var t=0,o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++){var n=this.cells[o][i];n.hasTile()&&n.tile.ownerName===e&&t++}return t},SkudPaiShoBoard.prototype.getSurroundness=function(e){for(var t=0,o=0,i=0,n=0,a=0,r=0,l=0,s=0,h=0;h<this.cells.length;h++)for(var d=0;d<this.cells[h].length;d++){var u=this.cells[h][d];u.hasTile()&&u.tile.ownerName===e&&(u.row>8&&(i++,n=1),u.row<8&&(t++,o=1),u.col<8&&(a++,r=1),u.col>8&&(l++,s=1))}var p=t;return i<p&&(p=i),a<p&&(p=a),l<p&&(p=l),0===p?o+n+r+s:4*p};NON_PLAYABLE="Non-Playable",NEUTRAL="Neutral",GATE="Gate",POSSIBLE_MOVE="Possible Move",OPEN_GATE="OPEN GATE",thinDot="·",thickDot="•",whiteDot="◦",gateDot="⟡";function SkudPaiShoBoardPoint(){this.types=[],this.row=-1,this.col=-1}function SkudPaiShoController(e,t){this.actuator=new SkudPaiShoActuator(e,t,this.isAnimationsEnabled()),this.resetGameManager(),this.resetNotationBuilder(),this.resetGameNotation(),this.hostAccentTiles=[],this.guestAccentTiles=[],this.isPaiShoGame=!0}function SkudPaiShoGameManager(e,t,o){this.gameLogText="",this.isCopy=o,this.actuator=e,this.tileManager=new SkudPaiShoTileManager,this.setup(t),this.endGameWinners=[]}function SkudPaiShoNotationMove(e){this.fullMoveText=e,this.analyzeMove()}function SkudPaiShoNotationBuilder(){this.moveType,this.plantedFlowerType,this.endPoint,this.startPoint,this.bonusTileCode,this.bonusEndPoint,this.boatBonusPoint,this.status=BRAND_NEW}function SkudPaiShoGameNotation(){this.notationText="",this.moves=[]}function SkudPaiShoHarmony(e,t,o,i,n){this.tile1=e,this.tile1Pos=new RowAndColumn(t.row,t.col),this.tile2=o,this.tile2Pos=new RowAndColumn(i.row,i.col),this.owners=[];var a=n.length>0&&e.ownerCode!==o.ownerCode;if(a)for(var r=0;r<n.length;r++)this.addOwner(n[r].ownerCode,n[r].ownerName);else this.tile1.type===BASIC_FLOWER?this.addOwner(this.tile1.ownerCode,this.tile1.ownerName):this.tile2.type===BASIC_FLOWER?this.addOwner(this.tile2.ownerCode,this.tile2.ownerName):debug("ERROR: HARMONY REQUIRES A BASIC FLOWER TILE");a&&(this.overwriteOtherHarmonyEntries=!0)}function SkudPaiShoHarmonyManager(){this.harmonies=[]}SkudPaiShoBoardPoint.prototype.addType=function(e){this.types.includes(e)||this.types.push(e)},SkudPaiShoBoardPoint.prototype.removeType=function(e){for(var t=0;t<this.types.length;t++)this.types[t]===e&&this.types.splice(t,1)},SkudPaiShoBoardPoint.prototype.getConsoleDisplay=function(){if(this.tile)return this.tile.getConsoleDisplay();var e=thinDot;this.types.includes(NON_PLAYABLE)&&(e=" ");var t="";return this.types.includes(RED)&&(t="R",e=thickDot),this.types.includes(WHITE)&&(t+="W",e=whiteDot),this.types.includes(NEUTRAL)&&(t+="N"),this.types.includes(GATE)&&(t="G",e=gateDot),t.length>1&&(e="+"),e},SkudPaiShoBoardPoint.prototype.putTile=function(e){this.tile=e},SkudPaiShoBoardPoint.prototype.hasTile=function(){return!!this.tile},SkudPaiShoBoardPoint.prototype.isType=function(e){return this.types.includes(e)},SkudPaiShoBoardPoint.prototype.isOpenGate=function(){return!this.hasTile()&&this.types.includes(GATE)},SkudPaiShoBoardPoint.prototype.removeTile=function(){var e=this.tile;return this.tile=null,e},SkudPaiShoBoardPoint.prototype.drainTile=function(){this.tile&&this.tile.drain()},SkudPaiShoBoardPoint.prototype.restoreTile=function(){this.tile&&this.tile.restore()},SkudPaiShoBoardPoint.prototype.canHoldTile=function(e,t){return!this.isType(NON_PLAYABLE)&&(!(!t&&this.hasTile())&&(e.type===BASIC_FLOWER?!(!this.isType(NEUTRAL)&&!this.isType(e.basicColorName))&&!this.isType(GATE):e.type===SPECIAL_FLOWER||e.type===ACCENT_TILE))},SkudPaiShoBoardPoint.prototype.betweenPlayerHarmony=function(e){return e===GUEST?this.betweenHarmonyGuest:e===HOST&&this.betweenHarmonyHost},SkudPaiShoBoardPoint.prototype.getCopy=function(){for(var e=new SkudPaiShoBoardPoint,t=0;t<this.types.length;t++)e.types.push(this.types[t]);return e.row=this.row,e.col=this.col,this.hasTile()&&(e.tile=this.tile.getCopy()),e},SkudPaiShoBoardPoint.neutral=function(){var e=new SkudPaiShoBoardPoint;return e.addType(NEUTRAL),e},SkudPaiShoBoardPoint.gate=function(){var e=new SkudPaiShoBoardPoint;return e.addType(GATE),e},SkudPaiShoBoardPoint.red=function(){var e=new SkudPaiShoBoardPoint;return e.addType(RED),e},SkudPaiShoBoardPoint.white=function(){var e=new SkudPaiShoBoardPoint;return e.addType(WHITE),e},SkudPaiShoBoardPoint.redWhite=function(){var e=new SkudPaiShoBoardPoint;return e.addType(RED),e.addType(WHITE),e},SkudPaiShoBoardPoint.redWhiteNeutral=function(){var e=new SkudPaiShoBoardPoint;return e.addType(RED),e.addType(WHITE),e.addType(NEUTRAL),e},SkudPaiShoBoardPoint.redNeutral=function(){var e=new SkudPaiShoBoardPoint;return e.addType(RED),e.addType(NEUTRAL),e},SkudPaiShoBoardPoint.whiteNeutral=function(){var e=new SkudPaiShoBoardPoint;return e.addType(WHITE),e.addType(NEUTRAL),e},SkudPaiShoController.animationsEnabledKey="AnimationsEnabled",SkudPaiShoController.prototype.getGameTypeId=function(){return GameType.SkudPaiSho.id},SkudPaiShoController.prototype.resetGameManager=function(){this.theGame=new SkudPaiShoGameManager(this.actuator)},SkudPaiShoController.prototype.resetNotationBuilder=function(){this.notationBuilder=new SkudPaiShoNotationBuilder},SkudPaiShoController.prototype.resetGameNotation=function(){this.gameNotation=this.getNewGameNotation()},SkudPaiShoController.prototype.getNewGameNotation=function(){return new SkudPaiShoGameNotation},SkudPaiShoController.getHostTilesContainerDivs=function(){var e='<div class="HR3"></div> <div class="HR4"></div> <div class="HR5"></div> <div class="HW3"></div> <div class="HW4"></div> <div class="HW5"></div> <br class="clear" /> <div class="HR"></div> <div class="HW"></div> <div class="HK"></div> <div class="HB"></div> <div class="HL"></div> <div class="HO"></div>';return gameOptionEnabled(OPTION_ANCIENT_OASIS_EXPANSION)&&(e+='<br class="clear" /> <div class="HM"></div> <div class="HP"></div> <div class="HT"></div>'),e},SkudPaiShoController.getGuestTilesContainerDivs=function(){var e='<div class="GR3"></div> <div class="GR4"></div> <div class="GR5"></div> <div class="GW3"></div> <div class="GW4"></div> <div class="GW5"></div> <br class="clear" /> <div class="GR"></div> <div class="GW"></div> <div class="GK"></div> <div class="GB"></div> <div class="GL"></div> <div class="GO"></div>';return gameOptionEnabled(OPTION_ANCIENT_OASIS_EXPANSION)&&(e+='<br class="clear" /> <div class="GM"></div> <div class="GP"></div> <div class="GT"></div>'),e},SkudPaiShoController.prototype.callActuate=function(){this.theGame.actuate()},SkudPaiShoController.prototype.resetMove=function(){this.notationBuilder.status===BRAND_NEW?(this.gameNotation.removeLastMove(),3===this.gameNotation.moves.length&&this.gameNotation.removeLastMove()):this.notationBuilder.status,this.gameNotation.moves.length<=1&&(getCurrentPlayer()===GUEST?this.guestAccentTiles=[]:getCurrentPlayer()===HOST&&(this.hostAccentTiles=[]))},SkudPaiShoController.prototype.getDefaultHelpMessageText=function(){return"<h4>Skud Pai Sho</h4> <p>Pai Sho is a game of harmony. The goal is to arrange your Flower Tiles to create a ring of Harmonies that surrounds the center of the board.</p> <p>Harmonies are created when two of a player's harmonious tiles are on the same line with nothing in between them. But be careful; tiles that clash can never be lined up on the board.</p> <p>Select tiles or points on the board to learn more or <a href='https://skudpaisho.com/site/games/skud-pai-sho/' target='_blank'>view the resources page</a> for the rules, a video tutorial on how to play, a print and play Pai Sho set, and more!</p>"},SkudPaiShoController.prototype.getAdditionalMessage=function(){var e="";return 0===this.gameNotation.moves.length?(onlinePlayEnabled&&gameId<0&&userIsLoggedIn()?gameOptionEnabled(OPTION_ALL_ACCENT_TILES)?e+="Click <em>Join Game</em> above to join another player's game. Or, you can start a game that other players can join by selecting ALL of your Accent Tiles. <br />":gameOptionEnabled(OPTION_DOUBLE_ACCENT_TILES)?e+="Click <em>Join Game</em> above to join another player's game. Or, you can start a game that other players can join by selecting 8 of your Accent Tiles. <br />":e+="Click <em>Join Game</em> above to join another player's game. Or, you can start a game that other players can join by selecting your 4 Accent Tiles. <br />":gameOptionEnabled(OPTION_ALL_ACCENT_TILES)?e+="Select ALL Accent Tiles to begin the game.":gameOptionEnabled(OPTION_DOUBLE_ACCENT_TILES)?e+="Select 8 Accent Tiles to play with.":e+="Select 4 Accent Tiles to play with.",playingOnlineGame()||(e+=getGameOptionsMessageHtml(GameType.SkudPaiSho.gameOptions))):1===this.gameNotation.moves.length?(gameOptionEnabled(OPTION_ALL_ACCENT_TILES)?e+="Select ALL Accent Tiles to play with,":gameOptionEnabled(OPTION_DOUBLE_ACCENT_TILES)?e+="Select 8 Accent Tiles to play with,":e+="Select 4 Accent Tiles to play with,",e+=" then Plant a Basic Flower Tile."):2===this.gameNotation.moves.length?e+="Plant a Basic Flower Tile.":gameOptionEnabled(OPTION_INFORMAL_START)||4!==this.gameNotation.moves.length||(e+="Now, make the first move of the game."),e},SkudPaiShoController.prototype.getExtraHarmonyBonusHelpText=function(){return limitedGatesRule?this.theGame.playerCanBonusPlant(getCurrentPlayer())?" <br />You can choose an Accent Tile or, since you have no Growing Flowers, a Basic or Special Flower Tile.":" <br />You can choose an Accent Tile or a Special Flower Tile. You cannot choose a Basic Flower Tile because you have at least one Growing Flower.":this.theGame.playerCanBonusPlant(getCurrentPlayer())?" <br />You can choose an Accent Tile, Special Flower Tile, or, since you have less than two Growing Flowers, a Basic Flower Tile.":" <br />You can choose an Accent Tile or a Special Flower Tile. You cannot choose a Basic Flower Tile because you have two or more Growing Flowers."},SkudPaiShoController.prototype.showHarmonyBonusMessage=function(){document.querySelector(".gameMessage").innerHTML="Harmony Bonus! Select a tile to play or <span class='skipBonus' onclick='gameController.skipHarmonyBonus();'>skip</span>."+this.getExtraHarmonyBonusHelpText()+getResetMoveText()},SkudPaiShoController.prototype.unplayedTileClicked=function(e){if((!this.theGame.getWinner()||this.notationBuilder.status===READY_FOR_BONUS)&&myTurn())if(currentMoveIndex===this.gameNotation.moves.length){var t=e.getAttribute("name"),o=parseInt(e.getAttribute("id")),i=t.charAt(0),n=t.substring(1),a=GUEST;"H"===i&&(a=HOST);var r=this.theGame.tileManager.peekTile(a,n,o);if(r.ownerName===getCurrentPlayer())if(this.gameNotation.moves.length<=1){if(r.type!==ACCENT_TILE)return;if(!r.selectedFromPile){r.selectedFromPile=!0;var l=this.hostAccentTiles;return getCurrentPlayer()===GUEST&&(l=this.guestAccentTiles),l.splice(l.indexOf(n),1),void this.theGame.actuate()}r.selectedFromPile=!1;var s=4;if(gameOptionEnabled(OPTION_ALL_ACCENT_TILES)?s=this.theGame.tileManager.numberOfAccentTilesPerPlayerSet():gameOptionEnabled(OPTION_DOUBLE_ACCENT_TILES)&&(s*=2),getCurrentPlayer()===HOST){if(this.hostAccentTiles.push(n),this.hostAccentTiles.length===s||simpleCanonRules&&2===this.hostAccentTiles.length){var h=new SkudPaiShoNotationMove("0H."+this.hostAccentTiles.join());this.gameNotation.addMove(h),onlinePlayEnabled?createGameIfThatIsOk(GameType.SkudPaiSho.id):finalizeMove()}}else if(this.guestAccentTiles.push(n),this.guestAccentTiles.length===s||simpleCanonRules&&2===this.guestAccentTiles.length){h=new SkudPaiShoNotationMove("0G."+this.guestAccentTiles.join());this.gameNotation.addMove(h),rerunAll(),showResetMoveMessage()}this.theGame.actuate()}else if(this.notationBuilder.status===BRAND_NEW){if(r.type!==BASIC_FLOWER)return debug("Can only Plant a Basic Flower tile. That's not one of them."),!1;r.selectedFromPile=!0,this.notationBuilder.moveType=PLANTING,this.notationBuilder.plantedFlowerType=n,this.notationBuilder.status=WAITING_FOR_ENDPOINT,this.theGame.revealOpenGates(getCurrentPlayer(),r,this.gameNotation.moves.length)}else if(this.notationBuilder.status===READY_FOR_BONUS){if(simpleSpecialFlowerRule&&r.type===SPECIAL_FLOWER&&!this.theGame.playerHasNotPlayedEitherSpecialTile(r.ownerName))return!1;r.selectedFromPile=!0,this.notationBuilder.bonusTileCode=n,this.notationBuilder.status=WAITING_FOR_BONUS_ENDPOINT,r.type===BASIC_FLOWER&&this.theGame.playerCanBonusPlant(getCurrentPlayer())?this.theGame.revealOpenGates(getCurrentPlayer(),r):r.type===ACCENT_TILE?this.theGame.revealPossiblePlacementPoints(r):r.type===SPECIAL_FLOWER&&(!specialFlowerLimitedRule||specialFlowerLimitedRule&&this.theGame.playerCanBonusPlant(getCurrentPlayer()))&&this.theGame.revealSpecialFlowerPlacementPoints(getCurrentPlayer(),r)}else this.theGame.hidePossibleMovePoints(),this.notationBuilder.status===WAITING_FOR_BONUS_ENDPOINT||this.notationBuilder.status===WAITING_FOR_BOAT_BONUS_POINT?(this.notationBuilder.status=READY_FOR_BONUS,this.showHarmonyBonusMessage()):this.notationBuilder=new SkudPaiShoNotationBuilder}else debug("Can only interact if all moves are played.")},SkudPaiShoController.prototype.pointClicked=function(e){if((!this.theGame.getWinner()||this.notationBuilder.status===WAITING_FOR_BONUS_ENDPOINT||this.notationBuilder.status===WAITING_FOR_BOAT_BONUS_POINT)&&myTurn())if(currentMoveIndex===this.gameNotation.moves.length){var t=new NotationPoint(e.getAttribute("name")).rowAndColumn,o=this.theGame.board.cells[t.row][t.col];if(this.notationBuilder.status===BRAND_NEW){if(o.hasTile()){if(o.tile.ownerName!==getCurrentPlayer())return void debug("That's not your tile!");if(o.tile.type===ACCENT_TILE)return;if(o.tile.trapped)return;if(!newKnotweedRules&&o.tile.trapped)return;this.notationBuilder.status=WAITING_FOR_ENDPOINT,this.notationBuilder.moveType=ARRANGING,this.notationBuilder.startPoint=new NotationPoint(e.getAttribute("name")),this.theGame.revealPossibleMovePoints(o)}}else if(this.notationBuilder.status===WAITING_FOR_ENDPOINT)if(o.isType(POSSIBLE_MOVE)){this.notationBuilder.endPoint=new NotationPoint(e.getAttribute("name"));var i=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.theGame.hidePossibleMovePoints(!1,i);var n=this.theGame.runNotationMove(i);if(gameOptionEnabled(OPTION_INFORMAL_START)||2!==this.gameNotation.moves.length)n?(this.notationBuilder.status=READY_FOR_BONUS,this.showHarmonyBonusMessage()):(this.gameNotation.addMove(i),playingOnlineGame()?callSubmitMove():finalizeMove());else{this.gameNotation.addMove(i);var a=this.notationBuilder.getFirstMoveForHost(this.notationBuilder.plantedFlowerType);this.gameNotation.addMove(this.gameNotation.getNotationMoveFromBuilder(a)),rerunAll(!0),showResetMoveMessage()}}else this.theGame.hidePossibleMovePoints(),this.notationBuilder=new SkudPaiShoNotationBuilder;else if(this.notationBuilder.status===WAITING_FOR_BONUS_ENDPOINT)if(o.isType(POSSIBLE_MOVE))if(this.theGame.hidePossibleMovePoints(),this.notationBuilder.bonusEndPoint=new NotationPoint(e.getAttribute("name")),this.notationBuilder.bonusTileCode.endsWith("B")&&(boatOnlyMoves||o.tile.type!==ACCENT_TILE))this.notationBuilder.status=WAITING_FOR_BOAT_BONUS_POINT,this.theGame.revealBoatBonusPoints(o);else{i=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.gameNotation.addMove(i),playingOnlineGame()?callSubmitMove(1):finalizeMove(1)}else this.theGame.hidePossibleMovePoints(),this.notationBuilder.status=READY_FOR_BONUS;else if(this.notationBuilder.status===WAITING_FOR_BOAT_BONUS_POINT)if(o.isType(POSSIBLE_MOVE)){this.notationBuilder.status=MOVE_DONE,this.theGame.hidePossibleMovePoints(),this.notationBuilder.boatBonusPoint=new NotationPoint(e.getAttribute("name"));i=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.gameNotation.addMove(i),playingOnlineGame()?callSubmitMove(1):finalizeMove(1)}else this.theGame.hidePossibleMovePoints(),this.notationBuilder.status=READY_FOR_BONUS}else debug("Can only interact if all moves are played.")},SkudPaiShoController.prototype.skipHarmonyBonus=function(){if(this.notationBuilder.status!==MOVE_DONE){this.notationBuilder.status=MOVE_DONE,this.notationBuilder.bonusEndPoint=null;var e=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.gameNotation.addMove(e),playingOnlineGame()?callSubmitMove(1):finalizeMove(1)}},SkudPaiShoController.prototype.getTileMessage=function(e){var t=e.getAttribute("name"),o=(parseInt(e.getAttribute("id")),new SkudPaiShoTile(t.substring(1),t.charAt(0))),i=[];t.startsWith("G");var n=t.substring(1),a=SkudPaiShoTile.getTileName(n);if(i.push(o.ownerName+"'s tile"),n.length>1){var r=n.charAt(0),l=parseInt(n.charAt(1)),s=l-1,h=r;s<3&&(s=5,h="R"===r?"W":"R");var d=SkudPaiShoTile.getTileName(h+s);h=r,(s=l+1)>5&&(s=3,h="R"===r?"W":"R");var u=SkudPaiShoTile.getTileName(h+s);s=l,h="R"===r?"W":"R";var p=SkudPaiShoTile.getTileName(h+s);i.push("Basic Flower Tile"),i.push("Can move up to "+l+" spaces"),i.push("Forms Harmony with "+d+" and "+u),i.push("Clashes with "+p)}else"R"===n?(a="Accent Tile: Rock",simplest?i.push("The Rock disrupts Harmonies and cannot be moved by a Wheel."):rocksUnwheelable?simpleRocks?i.push("The Rock blocks Harmonies and cannot be moved by a Wheel."):i.push("The Rock cancels Harmonies on horizontal and vertical lines it lies on. A Rock cannot be moved by a Wheel."):i.push("The Rock cancels Harmonies on horizontal and vertical lines it lies on.")):"W"===n?(a="Accent Tile: Wheel",rocksUnwheelable||simplest?i.push("The Wheel rotates all surrounding tiles one space clockwise but cannot move a Rock (cannot move tiles off the board or onto or off of a Gate)."):i.push("The Wheel rotates all surrounding tiles one space clockwise (cannot move tiles off the board or onto or off of a Gate).")):"K"===n?(a="Accent Tile: Knotweed",newKnotweedRules?i.push("The Knotweed drains surrounding Flower Tiles so they are unable to form Harmony."):i.push("The Knotweed drains surrounding Basic Flower Tiles so they are unable to move or form Harmony.")):"B"===n?(a="Accent Tile: Boat",simplest||rocksUnwheelable?i.push("The Boat moves a Flower Tile to a surrounding space or removes an Accent tile."):rocksUnwheelable?i.push("The Boat moves a Flower Tile to a surrounding space or removes a Rock or Knotweed tile."):i.push("The Boat moves a Flower Tile to a surrounding space or removes a Knotweed tile.")):"L"===n?(a="Special Flower: White Lotus",i.push("Can move up to 2 spaces"),i.push("Forms Harmony with all Basic Flower Tiles of either player"),lotusNoCapture||simplest||i.push("Can be captured by any Flower Tile")):"O"===n?(a="Special Flower: Orchid",i.push("Can move up to 6 spaces"),i.push("Traps opponent's surrounding Blooming Flower Tiles so they cannot move"),simplest||i.push("Can capture Flower Tiles if you have a Blooming White Lotus"),lotusNoCapture||simplest?i.push("Can be captured by any Flower Tile if you have a Blooming White Lotus"):i.push("Can be captured by any Basic Flower Tile if your White Lotus has been played")):"M"===n?(a="Accent Tile: Bamboo",i.push("<em>--- Ancient Oasis Expansion rules subject to change ---</em>"),i.push("If played on a point surrounding a Blooming Flower Tile belonging to the owner (but not surrounding a tile in a Gate), return each surrounding tile to owner's hand when played."),i.push("Tiles surrounding Bamboo cannot be captured")):"P"===n?(a="Accent Tile: Pond",i.push("<em>--- Ancient Oasis Expansion rules subject to change ---</em>"),i.push("Flower Tiles may be Planted on points surrounding a Pond"),i.push("(Tiles are Blooming after being Planted)")):"T"===n&&(a="Accent Tile: Lion Turtle",i.push("<em>--- Ancient Oasis Expansion rules subject to change ---</em>"),i.push("Flower tiles surrounding a Lion Turtle form Harmony with all Basic Flower Tiles of either player"),i.push("The owner of the Lion Turtle owns the Harmonies that include both players' tiles"),i.push("(Overlap with other Lion Turtle tiles can combine this effect, so Harmonies can potentially belong to both players)"));return{heading:a,message:i}},SkudPaiShoController.prototype.getPointMessage=function(e){var t,o=new NotationPoint(e.getAttribute("name")).rowAndColumn,i=this.theGame.board.cells[o.row][o.col],n=[];if(i.hasTile()){t=i.tile.getName();var a=this.theGame.board.harmonyManager.getHarmoniesWithThisTile(i.tile);if(a.length>0){var r=[];a.forEach((function(e){var t=e.getTileThatIsNotThisOne(i.tile);r.push(t.getName()+" to the "+e.getDirectionForTile(i.tile))})),n.push("<strong>Currently in Harmony with: </strong>"+toBullets(r))}i.tile.drained&&n.push("Currently <em>drained</em> by a Knotweed."),i.tile.trapped&&n.push("Currently <em>trapped</em> by an Orchid.")}else i.isType(NEUTRAL)?n.push(getNeutralPointMessage()):i.isType(RED)&&i.isType(WHITE)?n.push(getRedWhitePointMessage()):i.isType(RED)?n.push(getRedPointMessage()):i.isType(WHITE)?n.push(getWhitePointMessage()):i.isType(GATE)&&n.push(getGatePointMessage());return{heading:t,message:n}},SkudPaiShoController.prototype.playAiTurn=function(e){if(!this.theGame.getWinner()){var t=activeAi;activeAi2&&activeAi2.player===getCurrentPlayer()&&(t=activeAi2);var o=this.gameNotation.getPlayerMoveNum();if(1===o&&getCurrentPlayer()===HOST){var i=this.notationBuilder.getFirstMoveForHost(this.gameNotation.moves[this.gameNotation.moves.length-1].plantedFlowerType);this.gameNotation.addMove(this.gameNotation.getNotationMoveFromBuilder(i)),e()}else if(o<3){var n=t.getMove(this.theGame.getCopy(),o);if(!n)return void debug("No move given...");this.gameNotation.addMove(n),e()}else{var a=this;setTimeout((function(){var i=t.getMove(a.theGame.getCopy(),o);i?(a.gameNotation.addMove(i),e()):debug("No move given...")}),10)}}},SkudPaiShoController.prototype.startAiGame=function(e){if(this.playAiTurn(e),1===this.gameNotation.getPlayerMoveNum()&&this.playAiTurn(e),1===this.gameNotation.getPlayerMoveNum()){var t=this.notationBuilder.getFirstMoveForHost(this.gameNotation.moves[this.gameNotation.moves.length-1].plantedFlowerType);this.gameNotation.addMove(this.gameNotation.getNotationMoveFromBuilder(t)),e()}2===this.gameNotation.getPlayerMoveNum()&&getCurrentPlayer()===GUEST&&this.playAiTurn(e)},SkudPaiShoController.prototype.getAiList=function(){return[new SkudAIv1]},SkudPaiShoController.prototype.getCurrentPlayer=function(){if(this.gameNotation.moves.length<=1)return 0===this.gameNotation.moves.length?HOST:GUEST;if(this.gameNotation.moves.length<=2)return GUEST;var e=this.gameNotation.moves[this.gameNotation.moves.length-1].player;return e===HOST?GUEST:e===GUEST?HOST:void 0},SkudPaiShoController.prototype.cleanup=function(){},SkudPaiShoController.prototype.isSolitaire=function(){return!1},SkudPaiShoController.prototype.setGameNotation=function(e){this.gameNotation.setNotationText(e)},SkudPaiShoController.prototype.getAdditionalHelpTabDiv=function(){var e=document.createElement("div"),t=document.createElement("h4");return t.innerText="Skud Pai Sho Preferences:",e.appendChild(t),e.appendChild(this.buildTileDesignDropdownDiv()),e.appendChild(document.createElement("br")),e.appendChild(this.buildToggleAnimationsDiv()),e.appendChild(document.createElement("br")),e},SkudPaiShoController.prototype.buildTileDesignDropdownDiv=function(){return buildDropdownDiv("skudPaiShoTileDesignDropdown","Tile Designs:",tileDesignTypeValues,localStorage.getItem(tileDesignTypeKey),(function(){setSkudTilesOption(this.value)}))},SkudPaiShoController.prototype.buildToggleAnimationsDiv=function(){var e=document.createElement("div"),t=this.isAnimationsEnabled()?"on":"off";return e.innerHTML="Move animations are "+t+": <span class='skipBonus' onclick='gameController.toggleAnimations();'>toggle</span>",e},SkudPaiShoController.prototype.toggleAnimations=function(){this.isAnimationsEnabled()?(setUserGamePreference(SkudPaiShoController.animationsEnabledKey,"false"),this.actuator.setAnimationOn(!1)):(setUserGamePreference(SkudPaiShoController.animationsEnabledKey,"true"),this.actuator.setAnimationOn(!0)),clearMessage()},SkudPaiShoController.prototype.isAnimationsEnabled=function(){return"false"!==getUserGamePreference(SkudPaiShoController.animationsEnabledKey)},SkudPaiShoGameManager.prototype.setup=function(e){this.board=new SkudPaiShoBoard,e||this.actuate()},SkudPaiShoGameManager.prototype.actuate=function(e,t){this.isCopy||(this.actuator.actuate(this.board,this.tileManager,e,t),setGameLogText(this.gameLogText))},SkudPaiShoGameManager.prototype.runNotationMove=function(e,t,o){debug("Running Move("+(t?"":"Not ")+"Actuated): "+e.fullMoveText);var i=!1;if(0===e.moveNum&&e.accentTiles){var n=this,a=["R","W","K","B","R","W","K","B","M","P","T"];e.accentTiles.forEach((function(e){var t=a.indexOf(e);t>=0&&a.splice(t,1)})),a.forEach((function(t){n.tileManager.grabTile(e.player,t)})),n.tileManager.unselectTiles(e.player),this.buildChooseAccentTileGameLogText(e)}else 1===e.moveNum&&(this.tileManager.unselectTiles(GUEST),this.tileManager.unselectTiles(HOST));if(e.moveType===PLANTING){if(!this.board.pointIsOpenGate(e.endPoint))return debug("Invalid planting point: "+e.endPoint.pointText),!0,!1;var r=this.tileManager.grabTile(e.player,e.plantedFlowerType);this.board.placeTile(r,e.endPoint,this.tileManager),this.buildPlantingGameLogText(e,r)}else if(e.moveType===ARRANGING){if(moveResults=this.board.moveTile(e.player,e.startPoint,e.endPoint),i=moveResults.bonusAllowed,e.capturedTile=moveResults.capturedTile,moveResults.bonusAllowed&&e.hasHarmonyBonus()){r=this.tileManager.grabTile(e.player,e.bonusTileCode);e.accentTileUsed=r,e.boatBonusPoint?this.board.placeTile(r,e.bonusEndPoint,this.tileManager,e.boatBonusPoint):(placeTileResult=this.board.placeTile(r,e.bonusEndPoint,this.tileManager),placeTileResult&&placeTileResult.tileRemovedWithBoat&&(e.tileRemovedWithBoat=placeTileResult.tileRemovedWithBoat))}else!moveResults.bonusAllowed&&e.hasHarmonyBonus()&&(debug("BONUS NOT ALLOWED so I won't give it to you!"),!0);this.buildArrangingGameLogText(e,moveResults)}if(t&&this.actuate(e,o),this.endGameWinners=[],0===this.board.winners.length){var l=this.aPlayerIsOutOfBasicFlowerTiles();if(l){debug("PLAYER OUT OF TILES: "+l);var s=this.tileManager.getPlayerWithMoreAccentTiles();if(s)debug("Player has more Accent Tiles: "+s),this.endGameWinners.push(s);else{var h=this.board.harmonyManager.getPlayerWithMostHarmoniesCrossingMidlines();h?(this.endGameWinners.push(h),debug("Most Harmonies winner: "+h)):(this.endGameWinners.push(HOST),this.endGameWinners.push(GUEST),debug("Most Harmonies is a tie!"))}}}return i},SkudPaiShoGameManager.prototype.buildChooseAccentTileGameLogText=function(e){this.gameLogText=e.moveNum+e.playerCode+". "+e.player+" chose Accent Tiles "+e.accentTiles},SkudPaiShoGameManager.prototype.buildPlantingGameLogText=function(e,t){this.gameLogText=e.moveNum+e.playerCode+". "+e.player+" Planted "+t.getName()+" at "+e.endPoint.pointText},SkudPaiShoGameManager.prototype.buildArrangingGameLogText=function(e,t){this.gameLogText=e.moveNum+e.playerCode+". "+e.player+" moved "+t.movedTile.getName()+" "+e.moveTextOnly,t.capturedTile&&(this.gameLogText+=" to capture "+getOpponentName(e.player)+"'s "+t.capturedTile.getName()),t.bonusAllowed&&e.hasHarmonyBonus()&&(this.gameLogText+=" and used "+SkudPaiShoTile.getTileName(e.bonusTileCode)+" on Harmony Bonus")},SkudPaiShoGameManager.prototype.revealPossibleMovePoints=function(e,t){e.hasTile()&&(this.board.setPossibleMovePoints(e),t||this.actuate())},SkudPaiShoGameManager.prototype.hidePossibleMovePoints=function(e,t){this.board.removePossibleMovePoints(),this.tileManager.removeSelectedTileFlags(),e||this.actuate(t)},SkudPaiShoGameManager.prototype.revealOpenGates=function(e,t,o,i){gameOptionEnabled(OPTION_INFORMAL_START)||2!==o?this.board.setOpenGatePossibleMoves(e,t):this.board.setGuestGateOpen(),i||this.actuate()},SkudPaiShoGameManager.prototype.playerCanBonusPlant=function(e){return!newGatesRule||(lessBonus||limitedGatesRule?this.board.playerHasNoGrowingFlowers(e):newGatesRule?this.board.playerControlsLessThanTwoGates(e):void 0)},SkudPaiShoGameManager.prototype.revealSpecialFlowerPlacementPoints=function(e,t){newSpecialFlowerRules?(this.board.revealSpecialFlowerPlacementPoints(e),this.actuate()):this.revealOpenGates(e,t)},SkudPaiShoGameManager.prototype.revealPossiblePlacementPoints=function(e){this.board.revealPossiblePlacementPoints(e),this.actuate()},SkudPaiShoGameManager.prototype.revealBoatBonusPoints=function(e){this.board.revealBoatBonusPoints(e),this.actuate()},SkudPaiShoGameManager.prototype.aPlayerIsOutOfBasicFlowerTiles=function(){return this.tileManager.aPlayerIsOutOfBasicFlowerTiles()},SkudPaiShoGameManager.prototype.playerHasNotPlayedEitherSpecialTile=function(e){return this.tileManager.playerHasBothSpecialTilesRemaining(e)},SkudPaiShoGameManager.prototype.getWinner=function(){return 1===this.board.winners.length?this.board.winners[0]:this.board.winners.length>1?"BOTH players":1===this.endGameWinners.length?this.endGameWinners[0]:this.endGameWinners.length>1||this.board.winners.length>1?"BOTH players":void 0},SkudPaiShoGameManager.prototype.getWinReason=function(){return 1===this.board.winners.length?" created a Harmony Ring and won the game!":1===this.endGameWinners.length?this.tileManager.getPlayerWithMoreAccentTiles()?" won the game with more Accent Tiles left.":" won the game with the most Harmonies crossing the midlines.":2===this.board.winners.length?" formed Harmony Rings for a tie!":2===this.board.endGameWinners.length?" tied with the same number of Harmonies!":void 0},SkudPaiShoGameManager.prototype.getWinResultTypeCode=function(){return 1===this.board.winners.length?1:1===this.endGameWinners.length?this.tileManager.getPlayerWithMoreAccentTiles()?2:3:this.endGameWinners.length>1||this.board.winners.length>1?4:void 0},SkudPaiShoGameManager.prototype.getCopy=function(){var e=new SkudPaiShoGameManager(this.actuator,!0,!0);return e.board=this.board.getCopy(),e.tileManager=this.tileManager.getCopy(),e},SkudPaiShoNotationMove.prototype.analyzeMove=function(){this.valid=!0;var e=(n=this.fullMoveText.split("."))[0];this.moveNum=parseInt(e.slice(0,-1)),this.playerCode=e.charAt(e.length-1),"G"===this.playerCode?this.player=GUEST:"H"===this.playerCode&&(this.player=HOST);var t=n[1];if(this.moveTextOnly=t,t)if(0!==this.moveNum){var o=t.charAt(0);if("R"===o||"W"===o?this.moveType=PLANTING:"("===o&&(this.moveType=ARRANGING),this.moveType===PLANTING){var i=t.charAt(1);this.plantedFlowerType=o+""+i,"("===t.charAt(2)||(debug("Failure to plant"),this.valid=!1),t.endsWith(")")?this.endPoint=new NotationPoint(t.substring(t.indexOf("(")+1,t.indexOf(")"))):this.valid=!1}if(this.moveType===ARRANGING){var n=t.substring(t.indexOf("(")+1).split(")-(");if(this.startPoint=new NotationPoint(n[0]),this.endPoint=new NotationPoint(n[1].substring(0,n[1].indexOf(")"))),n[1].includes("+")||n[1].includes("_")){var a="+";n[1].includes("_")&&(a="_");var r=n[1].substring(n[1].indexOf(a)+1);this.bonusTileCode=r.substring(0,r.indexOf("(")),n.length>2?(this.bonusEndPoint=new NotationPoint(r.substring(r.indexOf("(")+1)),this.boatBonusPoint=new NotationPoint(n[2].substring(0,n[2].indexOf(")")))):this.bonusEndPoint=new NotationPoint(r.substring(r.indexOf("(")+1,r.indexOf(")")))}}}else this.accentTiles=t.split(",")},SkudPaiShoNotationMove.prototype.hasHarmonyBonus=function(){return void 0!==this.bonusTileCode},SkudPaiShoNotationMove.prototype.isValidNotation=function(){return this.valid},SkudPaiShoNotationMove.prototype.equals=function(e){return this.fullMoveText===e.fullMoveText},SkudPaiShoNotationBuilder.prototype.getFirstMoveForHost=function(e){var t=new SkudPaiShoNotationBuilder;return t.moveType=PLANTING,t.plantedFlowerType=SkudPaiShoTile.getClashTileCode(e),(simpleCanonRules||sameStart)&&(t.plantedFlowerType=e),t.endPoint=new NotationPoint("0,8"),t},SkudPaiShoNotationBuilder.prototype.getNotationMove=function(e,t){var o=e+t.charAt(0)+".";return this.moveType===ARRANGING?(o+="("+this.startPoint.pointText+")-("+this.endPoint.pointText+")",this.bonusTileCode&&this.bonusEndPoint&&(o+="+"+this.bonusTileCode+"("+this.bonusEndPoint.pointText+")",this.boatBonusPoint&&(o+="-("+this.boatBonusPoint.pointText+")"))):this.moveType===PLANTING&&(o+=this.plantedFlowerType+"("+this.endPoint.pointText+")"),new SkudPaiShoNotationMove(o)},SkudPaiShoGameNotation.prototype.setNotationText=function(e){this.notationText=e,this.loadMoves()},SkudPaiShoGameNotation.prototype.addNotationLine=function(e){this.notationText+=";"+e.trim(),this.loadMoves()},SkudPaiShoGameNotation.prototype.addMove=function(e){this.notationText?this.notationText+=";"+e.fullMoveText:this.notationText=e.fullMoveText,this.loadMoves()},SkudPaiShoGameNotation.prototype.removeLastMove=function(){this.notationText=this.notationText.substring(0,this.notationText.lastIndexOf(";")),this.loadMoves()},SkudPaiShoGameNotation.prototype.getPlayerMoveNum=function(){var e=0,t=this.moves[this.moves.length-1];return t&&(e=t.moveNum,0===t.moveNum&&t.player===HOST?player=GUEST:0===t.moveNum&&t.player===GUEST?(e++,player=GUEST):t.player===HOST?e++:player=HOST),e},SkudPaiShoGameNotation.prototype.getNotationMoveFromBuilder=function(e){var t=1,o=GUEST,i=this.moves[this.moves.length-1];return i&&(t=i.moveNum,0===i.moveNum&&i.player===HOST?o=GUEST:0===i.moveNum&&i.player===GUEST?(t++,o=GUEST):i.player===HOST?t++:o=HOST),e.getNotationMove(t,o)},SkudPaiShoGameNotation.prototype.loadMoves=function(){this.moves=[];var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t=this,o=HOST;e.forEach((function(e){var i=new SkudPaiShoNotationMove(e);0===i.moveNum&&i.isValidNotation()?t.moves.push(i):i.isValidNotation()&&i.player!==o?(t.moves.push(i),o=i.player):debug("the player check is broken?")}))},SkudPaiShoGameNotation.prototype.getNotationHtml=function(){var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t="";return e.forEach((function(e){t+=e+"<br />"})),t},SkudPaiShoGameNotation.prototype.getNotationForEmail=function(){var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t="";return e.forEach((function(e){t+=e+"[BR]"})),t},SkudPaiShoGameNotation.prototype.notationTextForUrl=function(){return this.notationText},SkudPaiShoGameNotation.prototype.getLastMoveText=function(){return this.moves[this.moves.length-1].fullMoveText},SkudPaiShoGameNotation.prototype.getLastMoveNumber=function(){return this.moves[this.moves.length-1].moveNum},SkudPaiShoHarmony.prototype.addOwner=function(e,t){this.hasOwner(t)||this.owners.push({ownerCode:e,ownerName:t})},SkudPaiShoHarmony.prototype.hasOwner=function(e){for(var t=0;t<this.owners.length;t++)if(this.owners[t].ownerName===e)return!0},SkudPaiShoHarmony.prototype.equals=function(e){return!(this.tile1!==e.tile1&&this.tile1!==e.tile2||this.tile2!==e.tile1&&this.tile2!==e.tile2)},SkudPaiShoHarmony.prototype.notAnyOfThese=function(e){for(var t=0;t<e.length;t++)if(this.equals(e[t]))return!1;return!0},SkudPaiShoHarmony.prototype.containsTile=function(e){return this.tile1===e||this.tile2===e},SkudPaiShoHarmony.prototype.getTileThatIsNotThisOne=function(e){return this.tile1===e?this.tile2:this.tile2===e?this.tile1:void debug("BOTH TILES ARE NOT THAT ONE!")},SkudPaiShoHarmony.prototype.containsTilePos=function(e){return this.tile1Pos.samesies(e)||this.tile2Pos.samesies(e)},SkudPaiShoHarmony.prototype.getPosThatIsNotThisOne=function(e){return this.tile1Pos.samesies(e)?this.tile2Pos:this.tile2Pos.samesies(e)?this.tile1Pos:void debug("\tBOTH TILE POS ARE NOT THAT ONE!")},SkudPaiShoHarmony.prototype.getString=function(){return this.owners+" ("+this.tile1Pos.notationPointString+")-("+this.tile2Pos.notationPointString+")"},SkudPaiShoHarmony.prototype.getDirectionForTile=function(e){if(this.containsTile(e)){var t=this.tile1Pos,o=this.tile2Pos;return this.tile2.id===e.id&&(t=this.tile2Pos,o=this.tile1Pos),t.row===o.row?t.col<o.col?"East":"West":t.col===o.col?t.row>o.row?"North":"South":void 0}},SkudPaiShoHarmony.prototype.crossesCenter=function(){var e=this.tile1Pos.row,t=this.tile2Pos.row;if(this.tile1Pos.row<this.tile2Pos.row&&(e=this.tile2Pos.row,t=this.tile1Pos.row),e!==t)return e>8&&t<8;var o=this.tile1Pos.col,i=this.tile2Pos.col;return this.tile1Pos.col<this.tile2Pos.col&&(o=this.tile2Pos.col,i=this.tile1Pos.col),o!==i?o>8&&i<8:void 0},SkudPaiShoHarmonyManager.prototype.printHarmonies=function(){debug("All Harmonies:");for(var e=0;e<this.harmonies.length;e++)debug(this.harmonies[e].getString())},SkudPaiShoHarmonyManager.prototype.getHarmoniesWithThisTile=function(e){var t=[];return this.harmonies.forEach((function(o){o.containsTile(e)&&t.push(o)})),t},SkudPaiShoHarmonyManager.prototype.addHarmony=function(e){for(var t=[],o=!1,i=0;i<this.harmonies.length;i++)if(e.equals(this.harmonies[i])){this.harmonies[i];o=!0,e.overwriteOtherHarmonyEntries&&(t.push(i),o=!1)}for(var n=0;n<t.length;n++)this.harmonies.splice(t[n],1);o||this.harmonies.push(e)},SkudPaiShoHarmonyManager.prototype.addHarmonies=function(e){if(e)for(var t=0;t<e.length;t++)this.addHarmony(e[t])},SkudPaiShoHarmonyManager.prototype.clearList=function(){this.harmonies=[]},SkudPaiShoHarmonyManager.prototype.numHarmoniesForPlayer=function(e){for(var t=0,o=0;o<this.harmonies.length;o++)this.harmonies[o].hasOwner(e)&&t++;return t},SkudPaiShoHarmonyManager.prototype.getPlayerWithMostHarmonies=function(){var e=this.numHarmoniesForPlayer(HOST),t=this.numHarmoniesForPlayer(GUEST);return t>e?GUEST:e>t?HOST:void 0},SkudPaiShoHarmonyManager.prototype.getPlayerWithMostHarmoniesCrossingMidlines=function(){var e=this.getNumCrossingCenterForPlayer(HOST),t=this.getNumCrossingCenterForPlayer(GUEST);return t>e?GUEST:e>t?HOST:void 0},SkudPaiShoHarmonyManager.prototype.getNumCrossingCenterForPlayer=function(e){for(var t=0,o=0;o<this.harmonies.length;o++)this.harmonies[o].hasOwner(e)&&this.harmonies[o].crossesCenter()&&t++;return t},SkudPaiShoHarmonyManager.prototype.ringLengthForPlayer=function(e){for(var t=this.getHarmonyChains(),o=0,i=0;i<t.length;i++){var n=t[i];if(n.pop().hasOwner(e)){n.length>o&&(o=n.length)}}return o},SkudPaiShoHarmonyManager.prototype.getPlayerWithLongestChain=function(){var e=this.ringLengthForPlayer(HOST),t=this.ringLengthForPlayer(GUEST);return t>e?GUEST:e>t?HOST:void 0},SkudPaiShoHarmonyManager.prototype.hasNewHarmony=function(e,t){for(var o=[],i=0;i<this.harmonies.length;i++)if(this.harmonies[i].hasOwner(e)){for(var n=!1,a=0;a<t.length;a++)this.harmonies[i].equals(t[a])&&t[a].hasOwner(e)&&(n=!0);n||o.push(this.harmonies[i])}return o.length>0},SkudPaiShoHarmonyManager.prototype.getHarmonyChains=function(){for(var e=this,t=[],o=0;o<this.harmonies.length;o++){var i=this.harmonies[o],n=[];n.push(i);var a=i.tile2,r=(i.tile2Pos,i.tile1),l=(i.tile1Pos,this.lookForRings(a,r,n));l&&l.length>0&&l.forEach((function(o){var i=!1;t.forEach((function(t){e.ringsMatch(t,o)&&(i=!0)})),i||t.push(o)}))}return t.length>0&&(debug("Rings Found:"),debug(t)),t},SkudPaiShoHarmonyManager.prototype.harmonyRingExists=function(){var e=this,t=this.getHarmonyChains(),o=[];return t.forEach((function(t){debug(t);var i=e.verifyHarmonyRing(t);i&&o.push(i)})),o},SkudPaiShoHarmonyManager.prototype.ringContains345=function(e){for(var t=!1,o=!1,i=!1,n=0;n<e.length;n++){var a=e[n];"3"===a.tile1.basicValue&&(t=!0),"4"===a.tile1.basicValue&&(o=!0),"5"===a.tile1.basicValue&&(i=!0),"3"===a.tile2.basicValue&&(t=!0),"4"===a.tile2.basicValue&&(o=!0),"5"===a.tile2.basicValue&&(i=!0)}return t&&o&&i},SkudPaiShoHarmonyManager.prototype.verifyHarmonyRing=function(e){if(completeHarmony&&!this.ringContains345(e))return!1;for(var t=[],o=!0,i=!0,n=0;n<e.length;n++)e[n].hasOwner(HOST)||(o=!1),e[n].hasOwner(GUEST)||(i=!1);var a="";o&&i?a="Host and Guest":o?a=HOST:i&&(a=GUEST);var r=e.pop();t.push(new NotationPoint(r.tile1Pos.notationPointString).toArr()),t.push(new NotationPoint(r.tile2Pos.notationPointString).toArr());for(var l=r.tile2Pos,s=0;e.length>0&&s<400;){for(n=0;n<e.length;n++)if((r=e[n]).containsTilePos(l)){var h=new NotationPoint((l=r.getPosThatIsNotThisOne(l)).notationPointString);h.samesies(new NotationPoint(t[0][0]+","+t[0][1]))||t.push(h.toArr()),e.splice(n,1)}s++}return s>390?(debug("THERE WAS A PROBLEM CONNECTING THE DOTS"),!1):!!this.isCenterInsideShape(t)&&a},SkudPaiShoHarmonyManager.prototype.isPointInsideShape=function(e,t){for(var o=e.x,i=e.y,n=!1,a=0,r=t.length-1;a<t.length;r=a++){var l=t[a][0],s=t[a][1],h=t[r][0],d=t[r][1];if(l===o&&h===o&&l*h)return!1;s>i!=d>i&&o<(h-l)*(i-s)/(d-s)+l&&(n=!n)}return n},SkudPaiShoHarmonyManager.prototype.isPointInsideShape_alternate=function(e,t){for(var o=[e.x,e.y],i=!1,n=-1,a=t.length,r=a-1;++n<a;r=n)(t[n][1]<=o[1]&&o[1]<t[r][1]||t[r][1]<=o[1]&&o[1]<t[n][1])&&o[0]<(t[r][0]-t[n][0])*(o[1]-t[n][1])/(t[r][1]-t[n][1])+t[n][0]&&(i=!i);return i},SkudPaiShoHarmonyManager.prototype.isCenterInsideShapeOld=function(e){for(var t=!1,o=0,i=e.length-1;o<e.length;i=o++){var n=e[o][0],a=e[o][1],r=e[i][0],l=e[i][1];if(0===n&&0===r&&a*l<0||0===a&&0===l&&n*r<0)return debug("Crosses center, cannot count"),!1;if(0===n&&0===a||0===r&&0===l)return debug("On center point, cannot count"),!1;a>0!=l>0&&0<(r-n)*(0-a)/(l-a)+n&&(t=!t)}return t},SkudPaiShoHarmonyManager.prototype.isCenterInsideShape=function(e){for(var t=0,o=0,i=e.length-1;o<e.length;i=o++){var n=parseFloat(e[o][0]),a=parseFloat(e[o][1]),r=parseFloat(e[i][0]),l=parseFloat(e[i][1]);if(0===n&&0===r&&a*l<0||0===a&&0===l&&n*r<0)return debug("Crosses center, cannot count"),!1;if(0===n&&0===a||0===r&&0===l)return debug("On center point, cannot count"),!1;l<=0?a>0&&this.isLeft([r,l],[n,a],[0,0])>0&&t++:a<=0&&this.isLeft([r,l],[n,a],[0,0])<0&&t--}return 0!=t},SkudPaiShoHarmonyManager.prototype.isLeft=function(e,t,o){return(t[0]-e[0])*(o[1]-e[1])-(o[0]-e[0])*(t[1]-e[1])},SkudPaiShoHarmonyManager.prototype.ringsMatch=function(e,t){if(e.length!==t.length)return!1;var o=!1;return e.forEach((function(e){if(o=!1,t.forEach((function(t){e.equals(t)&&(o=!0)})),!o)return!1})),o},SkudPaiShoHarmonyManager.prototype.lookForRings=function(e,t,o){for(var i=[],n=[],a=0;a<this.harmonies.length;a++){currentChain=o.slice(),(r=this.harmonies[a]).containsTile(e)&&r.notAnyOfThese(currentChain)&&(currentChain.push(r),r.containsTile(t)?i.push(currentChain):n.push(r))}for(a=0;a<this.harmonies.length;a++){currentChain=o.slice();var r=this.harmonies[a];if(n.includes(r)){currentChain.push(r);var l=r.getTileThatIsNotThisOne(e);i=i.concat(this.lookForRings(l,t,currentChain))}}return i},SkudPaiShoHarmonyManager.prototype.lookForRing=function(e,t,o){for(var i=0;i<this.harmonies.length;i++){var n=this.harmonies[i];if(n.containsTile(e)&&n.notAnyOfThese(o)){if(o.push(n),n.containsTile(t))return[!0,o];var a=n.getTileThatIsNotThisOne(e);return this.lookForRing(a,t,o)}}return[!1]};RED="Red",WHITE="White";var tileId=1;function SkudPaiShoTile(e,t){this.code=e,this.ownerCode=t,"G"===this.ownerCode?this.ownerName=GUEST:"H"===this.ownerCode?this.ownerName=HOST:debug("INCORRECT OWNER CODE"),this.id=tileId++,this.drained=!1,this.selectedFromPile=!1,2===this.code.length&&(this.code.includes("R")||this.code.includes("W"))?(this.type=BASIC_FLOWER,this.basicColorCode=this.code.charAt(0),this.basicValue=this.code.charAt(1),"R"===this.basicColorCode?this.basicColorName=RED:"W"===this.basicColorCode&&(this.basicColorName=WHITE)):"L"===this.code||"O"===this.code?(this.type=SPECIAL_FLOWER,this.setSpecialFlowerInfo()):"R"===this.code||"W"===this.code||"K"===this.code||"B"===this.code||"P"===this.code||"M"===this.code||"T"===this.code?(this.type=ACCENT_TILE,this.setAccentInfo()):debug("Error: Unknown tile type")}function SkudPaiShoTileManager(e){if(e)return this.hostTiles=this.loadOneOfEach("H"),void(this.guestTiles=this.loadOneOfEach("G"));this.hostTiles=this.loadTileSet("H"),this.guestTiles=this.loadTileSet("G"),this.additionalAncientOasisCount=0}function SolitaireActuator(e,t){this.gameContainer=e,this.mobile=t;var o=setupPaiShoBoard(this.gameContainer,SolitaireController.getHostTilesContainerDivs(),SolitaireController.getGuestTilesContainerDivs(),!1);this.boardContainer=o.boardContainer,this.hostTilesContainer=o.hostTilesContainer,this.guestTilesContainer=o.guestTilesContainer}function SolitaireBoard(){this.size=new RowAndColumn(17,17),this.cells=this.brandNew(),this.harmonyManager=new SolitaireHarmonyManager,this.rockRowAndCols=[],this.playedWhiteLotusTiles=[],this.winners=[]}SkudPaiShoTile.prototype.setAccentInfo=function(){"R"===this.code?this.accentType=ROCK:"W"===this.code?this.accentType=WHEEL:"K"===this.code?this.accentType=KNOTWEED:"B"===this.code?this.accentType=BOAT:"P"===this.code?this.accentType=POND:"M"===this.code?this.accentType=BAMBOO:"T"===this.code&&(this.accentType=LION_TURTLE)},SkudPaiShoTile.prototype.setSpecialFlowerInfo=function(){"L"===this.code?this.specialFlowerType=WHITE_LOTUS:"O"===this.code&&(this.specialFlowerType=ORCHID)},SkudPaiShoTile.prototype.getConsoleDisplay=function(){return this.drained?"*"+this.code:this.ownerCode+""+this.code},SkudPaiShoTile.prototype.getImageName=function(){return this.ownerCode+""+this.code},SkudPaiShoTile.prototype.formsHarmonyWith=function(e,t){return!(this.type!==BASIC_FLOWER&&"L"!==this.code||e.type!==BASIC_FLOWER&&"L"!==e.code)&&(!("L"===this.code&&e.type!==BASIC_FLOWER||"L"===e.code&&this.type!==BASIC_FLOWER)&&(!this.drained&&!e.drained&&("L"===this.code&&e.type===BASIC_FLOWER||"L"===e.code&&this.type==BASIC_FLOWER||!(!t&&e.ownerName!==this.ownerName)&&(!!(this.basicColorCode===e.basicColorCode&&1===Math.abs(this.basicValue-e.basicValue)||t)||(!!(this.basicColorCode!==e.basicColorCode&&2===Math.abs(this.basicValue-e.basicValue)||t)||(!(!superHarmonies||this.basicValue===e.basicValue)||void 0))))))},SkudPaiShoTile.prototype.clashesWith=function(e){return!(!newOrchidClashRule||this.ownerName===e.ownerName||this.specialFlowerType!==ORCHID&&e.specialFlowerType!==ORCHID)||this.type===BASIC_FLOWER&&e.type===BASIC_FLOWER&&this.basicColorCode!==e.basicColorCode&&this.basicValue===e.basicValue},SkudPaiShoTile.prototype.getMoveDistance=function(){return this.type===BASIC_FLOWER?parseInt(this.basicValue):"L"===this.code?2:"O"===this.code?6:0},SkudPaiShoTile.prototype.drain=function(){this.type===BASIC_FLOWER&&(this.drained=!0)},SkudPaiShoTile.prototype.restore=function(){this.drained=!1},SkudPaiShoTile.prototype.getName=function(){return SkudPaiShoTile.getTileName(this.code)},SkudPaiShoTile.prototype.getCopy=function(){return new SkudPaiShoTile(this.code,this.ownerCode)},SkudPaiShoTile.getTileName=function(e){var t="";if(e.length>1){var o=e.charAt(0),i=e.charAt(1);"R"===o?("3"===i?t="Rose":"4"===i?t="Chrysanthemum":"5"===i&&(t="Rhododendron"),t+=" (Red "+i+")"):"W"===o&&("3"===i?t="Jasmine":"4"===i?t="Lily":"5"===i&&(t="White Jade"),t+=" (White "+i+")")}else"R"===e?t="Rock":"W"===e?t="Wheel":"K"===e?t="Knotweed":"B"===e?t="Boat":"O"===e?t="Orchid":"L"===e?t="White Lotus":"P"===e?t="Pond":"M"===e?t="Bamboo":"T"===e&&(t="Lion Turtle");return t},SkudPaiShoTile.getClashTileCode=function(e){if(2===e.length){if(e.startsWith("R"))return"W"+e.charAt(1);if(e.startsWith("W"))return"R"+e.charAt(1)}},SkudPaiShoTileManager.prototype.loadTileSet=function(e){return simpleCanonRules?this.loadSimpleCanonSet(e):this.loadSkudSet(e)},SkudPaiShoTileManager.prototype.loadSkudSet=function(e){for(var t=[],o=0;o<2;o++)t.push(new SkudPaiShoTile("R",e)),t.push(new SkudPaiShoTile("W",e)),t.push(new SkudPaiShoTile("K",e)),t.push(new SkudPaiShoTile("B",e));gameOptionEnabled(OPTION_ANCIENT_OASIS_EXPANSION)&&(t.push(new SkudPaiShoTile("P",e)),t.push(new SkudPaiShoTile("M",e)),t.push(new SkudPaiShoTile("T",e))),t.forEach((function(e){e.selectedFromPile=!0}));for(o=0;o<3;o++)t.push(new SkudPaiShoTile("R3",e)),t.push(new SkudPaiShoTile("R4",e)),t.push(new SkudPaiShoTile("R5",e)),t.push(new SkudPaiShoTile("W3",e)),t.push(new SkudPaiShoTile("W4",e)),t.push(new SkudPaiShoTile("W5",e));return t.push(new SkudPaiShoTile("L",e)),t.push(new SkudPaiShoTile("O",e)),t},SkudPaiShoTileManager.prototype.loadSimpleCanonSet=function(e){for(var t=[],o=0;o<2;o++)t.push(new SkudPaiShoTile("W",e));t.forEach((function(e){e.selectedFromPile=!0}));for(o=0;o<6;o++)t.push(new SkudPaiShoTile("R3",e)),t.push(new SkudPaiShoTile("W5",e));return t.push(new SkudPaiShoTile("L",e)),t.push(new SkudPaiShoTile("O",e)),t},SkudPaiShoTileManager.prototype.loadOneOfEach=function(e){var t=[];return t.push(new SkudPaiShoTile("R",e)),t.push(new SkudPaiShoTile("W",e)),t.push(new SkudPaiShoTile("K",e)),t.push(new SkudPaiShoTile("B",e)),gameOptionEnabled(OPTION_ANCIENT_OASIS_EXPANSION)&&(t.push(new SkudPaiShoTile("P",e)),t.push(new SkudPaiShoTile("M",e)),t.push(new SkudPaiShoTile("T",e))),t.push(new SkudPaiShoTile("R3",e)),t.push(new SkudPaiShoTile("R4",e)),t.push(new SkudPaiShoTile("R5",e)),t.push(new SkudPaiShoTile("W3",e)),t.push(new SkudPaiShoTile("W4",e)),t.push(new SkudPaiShoTile("W5",e)),t.push(new SkudPaiShoTile("L",e)),t.push(new SkudPaiShoTile("O",e)),t},SkudPaiShoTileManager.prototype.grabTile=function(e,t){var o,i=this.hostTiles;e===GUEST&&(i=this.guestTiles);for(var n=0;n<i.length;n++)if(i[n].code===t){newTileArr=i.splice(n,1),o=newTileArr[0];break}if(!o&&(debug("NONE OF THAT TILE FOUND"),this.additionalAncientOasisCount<3)){["M","P","T"].includes(t)&&(this.additionalAncientOasisCount++,o=new SkudPaiShoTile(t,getPlayerCodeFromName(e)))}return o},SkudPaiShoTileManager.prototype.numberOfAccentTilesPerPlayerSet=function(){for(var e=this.loadSkudSet(hostPlayerCode),t=0,o=0;o<e.length;o++)e[o].type===ACCENT_TILE&&t++;return t},SkudPaiShoTileManager.prototype.peekTile=function(e,t,o){var i,n=this.hostTiles;if(e===GUEST&&(n=this.guestTiles),o)for(var a=0;a<n.length;a++)if(n[a].id===o)return n[a];for(a=0;a<n.length;a++)if(n[a].code===t){i=n[a];break}return i||debug("NONE OF THAT TILE FOUND"),i},SkudPaiShoTileManager.prototype.removeSelectedTileFlags=function(){this.hostTiles.forEach((function(e){e.selectedFromPile=!1})),this.guestTiles.forEach((function(e){e.selectedFromPile=!1}))},SkudPaiShoTileManager.prototype.unselectTiles=function(e){var t=this.hostTiles;e===GUEST&&(t=this.guestTiles),t.forEach((function(e){e.selectedFromPile=!1}))},SkudPaiShoTileManager.prototype.putTileBack=function(e){var t=e.ownerName,o=this.hostTiles;t===GUEST&&(o=this.guestTiles),o.push(e)},SkudPaiShoTileManager.prototype.aPlayerIsOutOfBasicFlowerTiles=function(){for(var e=!1,t=0;t<this.hostTiles.length;t++)if(this.hostTiles[t].type===BASIC_FLOWER){e=!0;break}var o=!1;for(t=0;t<this.guestTiles.length;t++)if(this.guestTiles[t].type===BASIC_FLOWER){o=!0;break}return!e&&o?HOST:!o&&e?GUEST:o||e?void 0:"BOTH PLAYERS"},SkudPaiShoTileManager.prototype.getPlayerWithMoreAccentTiles=function(){for(var e=0,t=0;t<this.hostTiles.length;t++)this.hostTiles[t].type===ACCENT_TILE&&e++;var o=0;for(t=0;t<this.guestTiles.length;t++)this.guestTiles[t].type===ACCENT_TILE&&o++;return e>o?HOST:o>e?GUEST:void 0},SkudPaiShoTileManager.prototype.playerHasBothSpecialTilesRemaining=function(e){var t=this.hostTiles;e===GUEST&&(t=this.guestTiles);var o=0;return t.forEach((function(e){e.type===SPECIAL_FLOWER&&o++})),o>1},SkudPaiShoTileManager.prototype.getCopy=function(){var e=new SkudPaiShoTileManager;return e.hostTiles=copyArray(this.hostTiles),e.guestTiles=copyArray(this.guestTiles),e},SolitaireActuator.prototype.actuate=function(e,t,o){var i=this;window.requestAnimationFrame((function(){i.htmlify(e,t,o)}))},SolitaireActuator.prototype.htmlify=function(e,t,o){this.clearContainer(this.boardContainer);var i=this;e.cells.forEach((function(e){e.forEach((function(e){e&&i.addBoardPoint(e)}))})),new SolitaireTileManager(!0).tiles.forEach((function(e){i.clearTileContainer(e)})),!t.getWinner()&&o&&this.addTile(o)},SolitaireActuator.prototype.clearContainer=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},SolitaireActuator.prototype.clearTileContainer=function(e){for(var t=document.querySelector("."+e.getImageName());t.firstChild;)t.removeChild(t.firstChild)},SolitaireActuator.prototype.addTile=function(e,t){var o=document.querySelector("."+e.getImageName()),i=document.createElement("div");i.classList.add("point"),i.classList.add("hasTile"),e.selectedFromPile&&(i.classList.add("selectedFromPile"),i.classList.add("drained"));var n=document.createElement("img"),a=getSkudTilesSrcPath();n.src=a+e.getImageName()+".png",i.appendChild(n),i.setAttribute("name",e.getImageName()),i.setAttribute("id",e.id),this.mobile?i.setAttribute("onclick","unplayedTileClicked(this); showTileMessage(this);"):(i.setAttribute("onclick","unplayedTileClicked(this);"),i.setAttribute("onmouseover","showTileMessage(this);"),i.setAttribute("onmouseout","clearMessage();")),o.appendChild(i)},SolitaireActuator.prototype.addBoardPoint=function(e){var t=createBoardPointDiv(e);if(e.isType(NON_PLAYABLE)||(t.classList.add("activePoint"),e.isType(POSSIBLE_MOVE)?t.classList.add("possibleMove"):e.betweenHarmony&&(t.classList.add("betweenHarmony"),e.betweenHarmonyHost&&t.classList.add("bhHost"),e.betweenHarmonyGuest&&t.classList.add("bhGuest")),this.mobile?t.setAttribute("onclick","pointClicked(this); showPointMessage(this);"):(t.setAttribute("onclick","pointClicked(this);"),t.setAttribute("onmouseover","showPointMessage(this);"),t.setAttribute("onmouseout","clearMessage();"))),e.hasTile()){t.classList.add("hasTile");var o=document.createElement("img"),i=getSkudTilesSrcPath();o.src=i+e.tile.getImageName()+".png",e.tile.inHarmony&&t.classList.add(e.tile.ownerName+"harmony"),e.tile.inClash&&t.classList.add(e.tile.opponentName+"harmony"),(e.tile.drained||e.tile.trapped)&&t.classList.add("drained"),t.appendChild(o)}if(this.boardContainer.appendChild(t),e.betweenHarmony&&16===e.col){var n=document.createElement("div");n.classList.add("clear"),this.boardContainer.appendChild(n)}},SolitaireActuator.prototype.printBoard=function(e){debug("");var t=0;e.cells.forEach((function(e){var o=t+"\t: ";e.forEach((function(e){var t=e.getConsoleDisplay();t.length<3&&(o+=" "),o+=t,t.length<2&&(o+=" ")})),debug(o),t++})),debug("")},SolitaireBoard.prototype.brandNew=function(){var e=[];e[0]=this.newRow(9,[SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.gate(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral()]),e[1]=this.newRow(11,[SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.redWhiteNeutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral()]),e[2]=this.newRow(13,[SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.whiteNeutral(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.redNeutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral()]),e[3]=this.newRow(15,[SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.whiteNeutral(),SolitaireBoardPoint.white(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.red(),SolitaireBoardPoint.redNeutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral()]),e[4]=this.newRow(17,[SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.whiteNeutral(),SolitaireBoardPoint.white(),SolitaireBoardPoint.white(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.red(),SolitaireBoardPoint.red(),SolitaireBoardPoint.redNeutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral()]),e[5]=this.newRow(17,[SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.whiteNeutral(),SolitaireBoardPoint.white(),SolitaireBoardPoint.white(),SolitaireBoardPoint.white(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.red(),SolitaireBoardPoint.red(),SolitaireBoardPoint.red(),SolitaireBoardPoint.redNeutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral()]),e[6]=this.newRow(17,[SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.whiteNeutral(),SolitaireBoardPoint.white(),SolitaireBoardPoint.white(),SolitaireBoardPoint.white(),SolitaireBoardPoint.white(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.red(),SolitaireBoardPoint.red(),SolitaireBoardPoint.red(),SolitaireBoardPoint.red(),SolitaireBoardPoint.redNeutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral()]),e[7]=this.newRow(17,[SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.whiteNeutral(),SolitaireBoardPoint.white(),SolitaireBoardPoint.white(),SolitaireBoardPoint.white(),SolitaireBoardPoint.white(),SolitaireBoardPoint.white(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.red(),SolitaireBoardPoint.red(),SolitaireBoardPoint.red(),SolitaireBoardPoint.red(),SolitaireBoardPoint.red(),SolitaireBoardPoint.redNeutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral()]),e[8]=this.newRow(17,[SolitaireBoardPoint.gate(),SolitaireBoardPoint.redWhiteNeutral(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.redWhiteNeutral(),SolitaireBoardPoint.gate()]),e[9]=this.newRow(17,[SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.redNeutral(),SolitaireBoardPoint.red(),SolitaireBoardPoint.red(),SolitaireBoardPoint.red(),SolitaireBoardPoint.red(),SolitaireBoardPoint.red(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.white(),SolitaireBoardPoint.white(),SolitaireBoardPoint.white(),SolitaireBoardPoint.white(),SolitaireBoardPoint.white(),SolitaireBoardPoint.whiteNeutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral()]),e[10]=this.newRow(17,[SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.redNeutral(),SolitaireBoardPoint.red(),SolitaireBoardPoint.red(),SolitaireBoardPoint.red(),SolitaireBoardPoint.red(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.white(),SolitaireBoardPoint.white(),SolitaireBoardPoint.white(),SolitaireBoardPoint.white(),SolitaireBoardPoint.whiteNeutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral()]),e[11]=this.newRow(17,[SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.redNeutral(),SolitaireBoardPoint.red(),SolitaireBoardPoint.red(),SolitaireBoardPoint.red(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.white(),SolitaireBoardPoint.white(),SolitaireBoardPoint.white(),SolitaireBoardPoint.whiteNeutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral()]),e[12]=this.newRow(17,[SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.redNeutral(),SolitaireBoardPoint.red(),SolitaireBoardPoint.red(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.white(),SolitaireBoardPoint.white(),SolitaireBoardPoint.whiteNeutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral()]),e[13]=this.newRow(15,[SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.redNeutral(),SolitaireBoardPoint.red(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.white(),SolitaireBoardPoint.whiteNeutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral()]),e[14]=this.newRow(13,[SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.redNeutral(),SolitaireBoardPoint.redWhite(),SolitaireBoardPoint.whiteNeutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral()]),e[15]=this.newRow(11,[SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.redWhiteNeutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral()]),e[16]=this.newRow(9,[SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.gate(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral(),SolitaireBoardPoint.neutral()]);for(var t=0;t<e.length;t++)for(var o=0;o<e[t].length;o++)e[t][o].row=t,e[t][o].col=o;return e},SolitaireBoard.prototype.newRow=function(e,t){var o=[],i=(this.size.row-e)/2,n=new SolitaireBoardPoint;n.addType(NON_PLAYABLE);for(var a=0;a<this.size.row;a++)o[a]=a<i?n:a<i+e&&t?t[a-i]:n;return o},SolitaireBoard.prototype.placeTile=function(e,t,o){this.putTileOnPoint(e,t),e.specialFlowerType===WHITE_LOTUS&&this.playedWhiteLotusTiles.push(e),this.analyzeHarmonies()},SolitaireBoard.prototype.putTileOnPoint=function(e,t){var o=t.rowAndColumn;(o=this.cells[o.row][o.col]).putTile(e)},SolitaireBoard.prototype.canPlaceRock=function(e){return!e.hasTile()&&!e.isType(GATE)},SolitaireBoard.prototype.placeRock=function(e,t){var o=t.rowAndColumn,i=this.cells[o.row][o.col];if(!this.canPlaceRock(i))return!1;i.isType(GATE)||(i.putTile(e),this.rockRowAndCols.push(o))},SolitaireBoard.prototype.canPlaceWheel=function(e){if(e.hasTile())return!1;if(e.isType(GATE))return!1;for(var t=this.getSurroundingRowAndCols(e),o=0;o<t.length;o++){var i=this.cells[t[o].row][t[o].col];if(i.isType(GATE)&&!newWheelRule)return!1;if(!newKnotweedRules&&i.hasTile()&&(i.tile.drained||i.tile.accentType===KNOTWEED))return!1;if(newWheelRule&&i.isType(GATE)&&i.hasTile())return!1;if((rocksUnwheelable||simplest)&&i.hasTile()&&i.tile.accentType===ROCK)return!1;if(superRocks&&i.hasTile())for(var n=this.getSurroundingRowAndCols(i),a=0;a<n.length;a++){var r=this.cells[n[a].row][n[a].col];if(r.hasTile()&&r.tile.accentType===ROCK)return!1}if(i.hasTile()){var l=this.getClockwiseRowCol(e,t[o]);if(!this.isValidRowCol(l))return!1;var s=this.cells[l.row][l.col];if(!s.canHoldTile(i.tile,!0))return!1;if(s.isType(GATE))return!1}}var h=this.getCopy(),d=new NotationPoint(new RowAndColumn(e.row,e.col).notationPointString);return h.placeWheel(new SolitaireTile("W","G"),d,!0),!h.moveCreatesDisharmony(e,e)},SolitaireBoard.prototype.isValidRowCol=function(e){return e.row>=0&&e.col>=0&&e.row<=16&&e.col<=16},SolitaireBoard.prototype.placeWheel=function(e,t,o){var i=t.rowAndColumn,n=this.cells[i.row][i.col],a=this.getSurroundingRowAndCols(i);if(!o&&!this.canPlaceWheel(n))return!1;n.putTile(e);for(var r=[],l=0;l<a.length;l++){e=this.cells[a[l].row][a[l].col].removeTile();var s=this.getClockwiseRowCol(i,a[l]);this.isValidRowCol(s)&&r.push([e,s])}var h=this;r.forEach((function(e){h.cells[e[1].row][e[1].col].putTile(e[0])})),this.refreshRockRowAndCols()},SolitaireBoard.prototype.canPlaceKnotweed=function(e){if(e.hasTile())return!1;if(e.isType(GATE))return!1;if(!newKnotweedRules)for(var t=this.getSurroundingRowAndCols(e),o=0;o<t.length;o++){if(this.cells[t[o].row][t[o].col].isType(GATE))return!1}return!0},SolitaireBoard.prototype.placeKnotweed=function(e,t){var o=t.rowAndColumn,i=this.cells[o.row][o.col],n=this.getSurroundingRowAndCols(o);if(!this.canPlaceKnotweed(i))return!1;i.putTile(e);for(var a=0;a<n.length;a++){this.cells[n[a].row][n[a].col].drainTile()}},SolitaireBoard.prototype.canPlaceBoat=function(e,t){if(!e.hasTile())return!1;if(e.isType(GATE))return!1;if(e.tile.type===ACCENT_TILE&&!boatOnlyMoves)if(e.tile.accentType===KNOTWEED||simplest||rocksUnwheelable){var o=this.getCopy(),i=new NotationPoint(new RowAndColumn(e.row,e.col).notationPointString);if(o.placeBoat(new SolitaireTile("B","G"),i,e,!0),o.moveCreatesDisharmony(e,e))return!1}else{if(rocksUnwheelable&&e.tile.accentType!==ROCK)return!1;if(!rocksUnwheelable)return!1}return!0},SolitaireBoard.prototype.placeBoat=function(e,t,o,i){var n=t.rowAndColumn,a=this.cells[n.row][n.col];if(!i&&!this.canPlaceBoat(a,e))return!1;if(a.tile.type!==ACCENT_TILE||boatOnlyMoves){var r=o.rowAndColumn,l=this.cells[r.row][r.col];if(!l.canHoldTile(a.tile))return debug("Boat cannot move that tile there!"),!1;l.putTile(a.removeTile()),a.putTile(e)}else{a.removeTile();for(var s=this.getSurroundingRowAndCols(n),h=0;h<s.length;h++){this.cells[s[h].row][s[h].col].restoreTile()}rocksUnwheelable&&this.refreshRockRowAndCols()}},SolitaireBoard.prototype.getClockwiseRowCol=function(e,t){return t.row<e.row&&t.col<=e.col?new RowAndColumn(t.row,t.col+1):t.col>e.col&&t.row<=e.row?new RowAndColumn(t.row+1,t.col):t.row>e.row&&t.col>=e.col?new RowAndColumn(t.row,t.col-1):t.col<e.col&&t.row>=e.row?new RowAndColumn(t.row-1,t.col):void debug("ERROR CLOCKWISE CALCULATING")},SolitaireBoard.prototype.getSurroundingRowAndCols=function(e){for(var t=[],o=e.row-1;o<=e.row+1;o++)for(var i=e.col-1;i<=e.col+1;i++){if((o!==e.row||i!==e.col)&&o>=0&&i>=0&&o<17&&i<17)this.cells[o][i].isType(NON_PLAYABLE)||t.push(new RowAndColumn(o,i))}return t},SolitaireBoard.prototype.refreshRockRowAndCols=function(){this.rockRowAndCols=[];var e=this;this.cells.forEach((function(t){t.forEach((function(t){t.hasTile()&&t.tile.accentType===ROCK&&e.rockRowAndCols.push(t)}))}))},SolitaireBoard.prototype.pointIsOpenGate=function(e){var t=e.rowAndColumn;return(t=this.cells[t.row][t.col]).isOpenGate()},SolitaireBoard.prototype.moveTile=function(e,t,o){var i=t.rowAndColumn,n=o.rowAndColumn;if(i.row<0||i.row>16||n.row<0||n.row>16)return debug("That point does not exist. So it's not gonna happen."),!1;var a=this.cells[i.row][i.col],r=this.cells[n.row][n.col];if(!this.canMoveTileToPoint(e,a,r))return debug("Bad move bears"),showBadMoveModal(),!1;var l=a.removeTile();return l||debug("Error: No tile to move!"),r.putTile(l)?(debug("Error moving tile. It probably didn't get moved."),!1):(this.flagAllTrappedAndDrainedTiles(),this.hasNewHarmony(e,l,i,n))},SolitaireBoard.prototype.flagAllTrappedAndDrainedTiles=function(){for(var e=0;e<this.cells.length;e++)for(var t=0;t<this.cells[e].length;t++){(o=this.cells[e][t]).hasTile()&&(o.tile.trapped=!1,newKnotweedRules&&(o.tile.drained=!1))}for(e=0;e<this.cells.length;e++)for(t=0;t<this.cells[e].length;t++){var o;(o=this.cells[e][t]).isType(GATE)||this.trapTilesSurroundingPointIfNeeded(o),newKnotweedRules&&this.drainTilesSurroundingPointIfNeeded(o)}},SolitaireBoard.prototype.drainTilesSurroundingPointIfNeeded=function(e){if(newKnotweedRules&&e.hasTile()&&e.tile.accentType===KNOTWEED)for(var t=this.getSurroundingRowAndCols(e),o=0;o<t.length;o++){var i=this.cells[t[o].row][t[o].col];i.hasTile()&&(i.tile.drained=!0)}},SolitaireBoard.prototype.trapTilesSurroundingPointIfNeeded=function(e){if(e.hasTile()&&e.tile.specialFlowerType===ORCHID)for(var t=e.tile.ownerName,o=this.getSurroundingRowAndCols(e),i=0;i<o.length;i++){var n=this.cells[o[i].row][o[i].col];n.hasTile()&&!n.isType(GATE)&&n.tile.ownerName!==t&&n.tile.type!==ACCENT_TILE&&(n.tile.trapped=!0)}},SolitaireBoard.prototype.whiteLotusProtected=function(e){return!(!lotusNoCapture&&!simplest)||!!simpleSpecialFlowerRule},SolitaireBoard.prototype.orchidCanCapture=function(e){if(simpleSpecialFlowerRule||simplest)return!1;var t=!1;return this.cells.forEach((function(o){o.forEach((function(o){o.hasTile()&&o.tile.specialFlowerType===WHITE_LOTUS&&o.tile.ownerName===e.ownerName&&!o.isType(GATE)&&(t=!0)}))})),t},SolitaireBoard.prototype.orchidVulnerable=function(e){if(newOrchidVulnerableRule){var t=!1;return this.cells.forEach((function(o){o.forEach((function(o){o.hasTile()&&o.tile.specialFlowerType===WHITE_LOTUS&&o.tile.ownerName!==e.ownerName&&(t=!0)}))})),t}if(simpleSpecialFlowerRule)return!0;if(lotusNoCapture||simplest){t=!1;return this.cells.forEach((function(o){o.forEach((function(o){!o.isType(GATE)&&o.hasTile()&&o.tile.specialFlowerType===WHITE_LOTUS&&o.tile.ownerName===e.ownerName&&(t=!0)}))})),t}t=!1;return this.playedWhiteLotusTiles.forEach((function(o){o.ownerName===e.ownerName&&(t=!0)})),!!t||void 0},SolitaireBoard.prototype.canCapture=function(e,t){var o=e.tile,i=t.tile;if(o.ownerName===i.ownerName)return!1;if(o.specialFlowerType===ORCHID&&i.type!==ACCENT_TILE&&this.orchidCanCapture(o))return!0;if(i.specialFlowerType===WHITE_LOTUS){if(this.whiteLotusProtected(i))return!1;if(o.type===BASIC_FLOWER)return!0}return!!o.clashesWith(i)||(!(i.specialFlowerType!==ORCHID||o.type===ACCENT_TILE||!this.orchidVulnerable(i))||void 0)},SolitaireBoard.prototype.canMoveTileToPoint=function(e,t,o){if(!t.hasTile())return!1;if(t.tile.ownerName!==e)return!1;if(t.tile.trapped)return!1;if(!newKnotweedRules&&t.tile.drained)return!1;if(o.isType(GATE))return!1;var i=!1;if(o.hasTile()&&(i=this.canCapture(t,o)),o.hasTile()&&!i)return!1;if(!o.canHoldTile(t.tile,i))return!1;var n=t.tile.getMoveDistance();return!(Math.abs(t.row-o.row)+Math.abs(t.col-o.col)>n)&&(!!this.verifyAbleToReach(t,o,n)&&!this.moveCreatesDisharmony(t,o))},SolitaireBoard.prototype.canTransportTileToPoint=function(e,t){return!!e.hasTile()&&(!t.isType(GATE)&&(!t.hasTile()&&(!!t.canHoldTile(e.tile)&&!this.moveCreatesDisharmony(e,t))))},SolitaireBoard.prototype.moveCreatesDisharmony=function(e,t){var o=t.removeTile();t.putTile(e.removeTile());for(var i=!1,n=0;n<this.cells.length;n++)for(var a=0;a<this.cells[n].length;a++){var r=this.cells[n][a];if(r.hasTile()&&this.hasDisharmony(r)){i=!0;break}}return e.putTile(t.removeTile()),t.putTile(o),i},SolitaireBoard.prototype.verifyAbleToReach=function(e,t,o){return this.pathFound(e,t,o)},SolitaireBoard.prototype.pathFound=function(e,t,o){if(!e||!t)return!1;if(e.isType(NON_PLAYABLE)||t.isType(NON_PLAYABLE))return!1;if(e.row===t.row&&e.col===t.col)return!0;if(o<=0)return!1;if(1===Math.abs(e.row-t.row)+Math.abs(e.col-t.col))return!0;var i=e.row-1;if(i>=0&&(!(n=this.cells[i][e.col]).hasTile()&&this.pathFound(n,t,o-1)))return!0;if((i=e.row+1)<17&&(!(n=this.cells[i][e.col]).hasTile()&&this.pathFound(n,t,o-1)))return!0;var n,a=e.col-1;if(a>=0&&(!(n=this.cells[e.row][a]).hasTile()&&this.pathFound(n,t,o-1)))return!0;if((a=e.col+1)<17&&(!(n=this.cells[e.row][a]).hasTile()&&this.pathFound(n,t,o-1)))return!0},SolitaireBoard.prototype.rowBlockedByRock=function(e){if(simpleRocks||simplest)return!1;var t=!1;return this.rockRowAndCols.forEach((function(o){o.row===e&&(t=!0)})),t},SolitaireBoard.prototype.columnBlockedByRock=function(e){if(simpleRocks||simplest)return!1;var t=!1;return this.rockRowAndCols.forEach((function(o){o.col===e&&(t=!0)})),t},SolitaireBoard.prototype.markSpacesBetweenHarmonies=function(){this.cells.forEach((function(e){e.forEach((function(e){e.betweenHarmony=!1,e.betweenHarmonyHost=!1,e.betweenHarmonyGuest=!1}))}));var e=this;this.harmonyManager.harmonies.forEach((function(t){if(t.tile1Pos.row===t.tile2Pos.row){var o=t.tile1Pos.row,i=t.tile1Pos.col,n=t.tile2Pos.col;t.tile2Pos.col<t.tile1Pos.col&&(i=t.tile2Pos.col,n=t.tile1Pos.col);for(var a=i+1;a<n;a++)e.cells[o][a].betweenHarmony=!0,e.cells[o][a].betweenHarmonyHost=!0}else if(t.tile2Pos.col==t.tile2Pos.col){a=t.tile1Pos.col;var r=t.tile1Pos.row,l=t.tile2Pos.row;t.tile2Pos.row<t.tile1Pos.row&&(r=t.tile2Pos.row,l=t.tile1Pos.row);for(o=r+1;o<l;o++)e.cells[o][a].betweenHarmony=!0,e.cells[o][a].betweenHarmonyHost=!0}})),this.harmonyManager.clashes.forEach((function(t){if(t.tile1Pos.row===t.tile2Pos.row){var o=t.tile1Pos.row,i=t.tile1Pos.col,n=t.tile2Pos.col;t.tile2Pos.col<t.tile1Pos.col&&(i=t.tile2Pos.col,n=t.tile1Pos.col);for(var a=i+1;a<n;a++)e.cells[o][a].betweenHarmony=!0,e.cells[o][a].betweenHarmonyGuest=!0}else if(t.tile2Pos.col==t.tile2Pos.col){a=t.tile1Pos.col;var r=t.tile1Pos.row,l=t.tile2Pos.row;t.tile2Pos.row<t.tile1Pos.row&&(r=t.tile2Pos.row,l=t.tile1Pos.row);for(o=r+1;o<l;o++)e.cells[o][a].betweenHarmony=!0,e.cells[o][a].betweenHarmonyGuest=!0}}))},SolitaireBoard.prototype.analyzeHarmonies=function(){this.harmonyManager.clearList();for(var e=0;e<this.cells.length;e++)for(var t=0;t<this.cells[e].length;t++){var o=this.cells[e][t];if(o.hasTile()){var i=this.getTileHarmonies(o.tile,new RowAndColumn(e,t));this.harmonyManager.addHarmonies(i);var n=this.getTileClashes(o.tile,new RowAndColumn(e,t));this.harmonyManager.addClashes(n),o.tile.inHarmony=i.length>0,o.tile.inClash=n.length>0}}this.markSpacesBetweenHarmonies()},SolitaireBoard.prototype.getTileHarmonies=function(e,t){var o=[];if(!this.rowBlockedByRock(t.row)){var i=this.getHarmonyLeft(e,t);i&&o.push(i);var n=this.getHarmonyRight(e,t);n&&o.push(n)}if(!this.columnBlockedByRock(t.col)){var a=this.getHarmonyUp(e,t);a&&o.push(a);var r=this.getHarmonyDown(e,t);r&&o.push(r)}return o},SolitaireBoard.prototype.getHarmonyLeft=function(e,t){for(var o=t.col-1;o>=0&&!this.cells[t.row][o].hasTile();)o--;if(o>=0){var i=this.cells[t.row][o];if(e.formsHarmonyWith(i.tile))return new SolitaireHarmony(e,t,i.tile,new RowAndColumn(t.row,o))}},SolitaireBoard.prototype.getHarmonyRight=function(e,t){for(var o=t.col+1;o<=16&&!this.cells[t.row][o].hasTile();)o++;if(o<=16){var i=this.cells[t.row][o];if(e.formsHarmonyWith(i.tile))return new SolitaireHarmony(e,t,i.tile,new RowAndColumn(t.row,o))}},SolitaireBoard.prototype.getHarmonyUp=function(e,t){for(var o=t.row-1;o>=0&&!this.cells[o][t.col].hasTile();)o--;if(o>=0){var i=this.cells[o][t.col];if(e.formsHarmonyWith(i.tile))return new SolitaireHarmony(e,t,i.tile,new RowAndColumn(o,t.col))}},SolitaireBoard.prototype.getHarmonyDown=function(e,t){for(var o=t.row+1;o<=16&&!this.cells[o][t.col].hasTile();)o++;if(o<=16){var i=this.cells[o][t.col];if(e.formsHarmonyWith(i.tile))return new SolitaireHarmony(e,t,i.tile,new RowAndColumn(o,t.col))}},SolitaireBoard.prototype.getTileClashes=function(e,t){var o=[];if(!this.rowBlockedByRock(t.row)){var i=this.getClashLeft(e,t);i&&o.push(i);var n=this.getClashRight(e,t);n&&o.push(n)}if(!this.columnBlockedByRock(t.col)){var a=this.getClashUp(e,t);a&&o.push(a);var r=this.getClashDown(e,t);r&&o.push(r)}return o},SolitaireBoard.prototype.getClashLeft=function(e,t){for(var o=t.col-1;o>=0&&!this.cells[t.row][o].hasTile();)o--;if(o>=0){var i=this.cells[t.row][o];if(e.clashesWith(i.tile))return new SolitaireHarmony(e,t,i.tile,new RowAndColumn(t.row,o))}},SolitaireBoard.prototype.getClashRight=function(e,t){for(var o=t.col+1;o<=16&&!this.cells[t.row][o].hasTile();)o++;if(o<=16){var i=this.cells[t.row][o];if(e.clashesWith(i.tile))return new SolitaireHarmony(e,t,i.tile,new RowAndColumn(t.row,o))}},SolitaireBoard.prototype.getClashUp=function(e,t){for(var o=t.row-1;o>=0&&!this.cells[o][t.col].hasTile();)o--;if(o>=0){var i=this.cells[o][t.col];if(e.clashesWith(i.tile))return new SolitaireHarmony(e,t,i.tile,new RowAndColumn(o,t.col))}},SolitaireBoard.prototype.getClashDown=function(e,t){for(var o=t.row+1;o<=16&&!this.cells[o][t.col].hasTile();)o++;if(o<=16){var i=this.cells[o][t.col];if(e.clashesWith(i.tile))return new SolitaireHarmony(e,t,i.tile,new RowAndColumn(o,t.col))}},SolitaireBoard.prototype.hasNewHarmony=function(e,t,o,i){var n=this.harmonyManager.harmonies;return this.analyzeHarmonies(),this.harmonyManager.hasNewHarmony(e,n)},SolitaireBoard.prototype.hasDisharmony=function(e){var t=e.tile,o=!1;return this.hasDisharmonyLeft(t,e)&&(o=!0),this.hasDisharmonyRight(t,e)&&(o=!0),this.hasDisharmonyUp(t,e)&&(o=!0),this.hasDisharmonyDown(t,e)&&(o=!0),o},SolitaireBoard.prototype.hasDisharmonyLeft=function(e,t){for(var o=t.col-1;o>=0&&!this.cells[t.row][o].hasTile();)o--;if(o>=0){var i=this.cells[t.row][o];if(e.clashesWith(i.tile))return!0}},SolitaireBoard.prototype.hasDisharmonyRight=function(e,t){for(var o=t.col+1;o<=16&&!this.cells[t.row][o].hasTile();)o++;if(o<=16){var i=this.cells[t.row][o];if(e.clashesWith(i.tile))return!0}},SolitaireBoard.prototype.hasDisharmonyUp=function(e,t){for(var o=t.row-1;o>=0&&!this.cells[o][t.col].hasTile();)o--;if(o>=0){var i=this.cells[o][t.col];if(e.clashesWith(i.tile))return!0}},SolitaireBoard.prototype.hasDisharmonyDown=function(e,t){for(var o=t.row+1;o<=16&&!this.cells[o][t.col].hasTile();)o++;if(o<=16){var i=this.cells[o][t.col];if(e.clashesWith(i.tile))return!0}},SolitaireBoard.prototype.setPossibleMovePoints=function(e){if(e.hasTile())for(var t=e.tile.ownerName,o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++)this.canMoveTileToPoint(t,e,this.cells[o][i])&&this.cells[o][i].addType(POSSIBLE_MOVE)},SolitaireBoard.prototype.removePossibleMovePoints=function(){this.cells.forEach((function(e){e.forEach((function(e){e.removeType(POSSIBLE_MOVE)}))}))},SolitaireBoard.prototype.setOpenGatePossibleMoves=function(e){for(var t=0;t<this.cells.length;t++)for(var o=0;o<this.cells[t].length;o++){this.cells[t][o].isOpenGate()&&this.cells[t][o].addType(POSSIBLE_MOVE)}},SolitaireBoard.prototype.setAllPossiblePointsOpen=function(e){for(var t=0;t<this.cells.length;t++)for(var o=0;o<this.cells[t].length;o++){this.cells[t][o].canHoldTile(e)&&this.cells[t][o].addType(POSSIBLE_MOVE)}},SolitaireBoard.prototype.setHarmonyAndClashPointsOpen=function(e){for(var t=!1,o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++){var n=this.cells[o][i];if(n.canHoldTile(e)){var a=n.getCopy();a.putTile(e),(this.hasDisharmony(a)||this.getTileHarmonies(a.tile,a).length>0)&&(this.cells[o][i].addType(POSSIBLE_MOVE),t=!0)}}return t},SolitaireBoard.prototype.setSolitaireAccentPointsOpen=function(e){for(var t=0;t<this.cells.length;t++)for(var o=0;o<this.cells[t].length;o++){var i=this.cells[t][o],n=[];t>2&&n.push(this.cells[t-2][o]),t<14&&n.push(this.cells[t+2][o]),o>2&&n.push(this.cells[t][o-2]),o<14&&n.push(this.cells[t][o+2]);for(var a=!1,r=0;r<n.length;r++)n[r].isCompletelyWithinRedOrWhiteGarden()&&(a=!0);i.isType(RED)&&i.isType(WHITE)&&(a=!0),a&&i.canHoldTile(e)&&this.cells[t][o].addType(POSSIBLE_MOVE)}},SolitaireBoard.prototype.playerControlsLessThanTwoGates=function(e){for(var t=0,o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++){var n=this.cells[o][i];n.isType(GATE)&&n.hasTile()&&n.tile.ownerName===e&&t++}return t<2},SolitaireBoard.prototype.playerHasNoGrowingFlowers=function(e){for(var t=0;t<this.cells.length;t++)for(var o=0;o<this.cells[t].length;o++){var i=this.cells[t][o];if(i.isType(GATE)&&i.hasTile()&&i.tile.ownerName===e)return!1}return!0},SolitaireBoard.prototype.revealSpecialFlowerPlacementPoints=function(e){var t,o=[],i=0,n=8;(t=this.cells[i][n]).hasTile()&&t.tile.ownerName===e&&(o.push(this.cells[i][n-1]),o.push(this.cells[i][n+1])),i=16,(t=this.cells[i][n]).hasTile()&&t.tile.ownerName===e&&(o.push(this.cells[i][n-1]),o.push(this.cells[i][n+1])),i=8,n=0,(t=this.cells[i][n]).hasTile()&&t.tile.ownerName===e&&(o.push(this.cells[i-1][n]),o.push(this.cells[i+1][n])),n=16,(t=this.cells[i][n]).hasTile()&&t.tile.ownerName===e&&(o.push(this.cells[i-1][n]),o.push(this.cells[i+1][n])),o.forEach((function(e){e.hasTile()||e.addType(POSSIBLE_MOVE)}))},SolitaireBoard.prototype.setGuestGateOpen=function(){this.cells[16][8].isOpenGate()&&this.cells[16][8].addType(POSSIBLE_MOVE)},SolitaireBoard.prototype.revealPossiblePlacementPoints=function(e){var t=this;this.cells.forEach((function(o){o.forEach((function(o){var i=!1;(e.accentType===ROCK&&t.canPlaceRock(o)||e.accentType===WHEEL&&t.canPlaceWheel(o)||e.accentType===KNOTWEED&&t.canPlaceKnotweed(o)||e.accentType===BOAT&&t.canPlaceBoat(o,e))&&(i=!0),i&&o.addType(POSSIBLE_MOVE)}))}))},SolitaireBoard.prototype.revealBoatBonusPoints=function(e){if(e.hasTile()){var t=e.tile.ownerName;if(newKnotweedRules)for(var o=this.getSurroundingRowAndCols(e),i=0;i<o.length;i++){var n=this.cells[o[i].row][o[i].col];this.canTransportTileToPoint(e,n)&&n.addType(POSSIBLE_MOVE)}else for(var a=0;a<this.cells.length;a++)for(var r=0;r<this.cells[a].length;r++){n=this.cells[a][r];Math.abs(e.row-n.row)+Math.abs(e.col-n.col)===1&&this.canMoveTileToPoint(t,e,n)&&n.addType(POSSIBLE_MOVE)}}},SolitaireBoard.prototype.getCopy=function(){for(var e=new SolitaireBoard,t=0;t<this.cells.length;t++)for(var o=0;o<this.cells[t].length;o++)e.cells[t][o]=this.cells[t][o].getCopy();for(var i=0;i<this.playedWhiteLotusTiles.length;i++)e.playedWhiteLotusTiles.push(this.playedWhiteLotusTiles[i].getCopy());return e.refreshRockRowAndCols(),e.analyzeHarmonies(),e},SolitaireBoard.prototype.numTilesInGardensForPlayer=function(e){for(var t=0,o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++){var n=this.cells[o][i];1===n.types.length&&n.hasTile()&&n.isType(n.tile.basicColorName)&&t++}return t},SolitaireBoard.prototype.numTilesOnBoardForPlayer=function(e){for(var t=0,o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++){var n=this.cells[o][i];n.hasTile()&&n.tile.ownerName===e&&t++}return t},SolitaireBoard.prototype.getSurroundness=function(e){for(var t=0,o=0,i=0,n=0,a=0,r=0,l=0,s=0,h=0;h<this.cells.length;h++)for(var d=0;d<this.cells[h].length;d++){var u=this.cells[h][d];u.hasTile()&&u.tile.ownerName===e&&(u.row>8&&(i++,n=1),u.row<8&&(t++,o=1),u.col<8&&(a++,r=1),u.col>8&&(l++,s=1))}var p=t;return i<p&&(p=i),a<p&&(p=a),l<p&&(p=l),0===p?o+n+r+s:4*p};NON_PLAYABLE="Non-Playable",NEUTRAL="Neutral",GATE="Gate",POSSIBLE_MOVE="Possible Move",OPEN_GATE="OPEN GATE",thinDot="·",thickDot="•",whiteDot="◦",gateDot="⟡";function SolitaireBoardPoint(){this.types=[],this.row=-1,this.col=-1}function SolitaireController(e,t){this.actuator=new SolitaireActuator(e,t),this.showGameMessageUnderneath=!0,this.resetGameNotation(),this.resetGameManager(),this.resetNotationBuilder(),this.drawnTile=null,this.lastDrawnTile=null,this.drawRandomTile(),this.isPaiShoGame=!0}function SolitaireGameManager(e,t,o){this.isCopy=o,this.actuator=e,this.tileManager=new SolitaireTileManager,this.setup(t),this.endGameWinners=[]}function SolitaireNotationMove(e){this.fullMoveText=e,this.analyzeMove()}function SolitaireNotationBuilder(){this.moveType,this.plantedFlowerType,this.endPoint,this.startPoint,this.bonusTileCode,this.bonusEndPoint,this.boatBonusPoint,this.status=BRAND_NEW}function SolitaireGameNotation(){this.notationText="",this.moves=[]}function SolitaireHarmony(e,t,o,i){this.tile1=e,this.tile1Pos=t,this.tile2=o,this.tile2Pos=i,this.tile1.type!==ACCENT_TILE?(this.ownerCode=this.tile1.ownerCode,this.ownerName=this.tile1.ownerName):this.tile2.type!==ACCENT_TILE?(this.ownerCode=this.tile2.ownerCode,this.ownerName=this.tile2.ownerName):debug("ERROR: HARMONY REQUIRES A BASIC FLOWER TILE")}function SolitaireHarmonyManager(){this.harmonies=[],this.clashes=[]}SolitaireBoardPoint.prototype.addType=function(e){this.types.includes(e)||this.types.push(e)},SolitaireBoardPoint.prototype.removeType=function(e){for(var t=0;t<this.types.length;t++)this.types[t]===e&&this.types.splice(t,1)},SolitaireBoardPoint.prototype.getConsoleDisplay=function(){if(this.tile)return this.tile.getConsoleDisplay();var e=thinDot;this.types.includes(NON_PLAYABLE)&&(e=" ");var t="";return this.types.includes(RED)&&(t="R",e=thickDot),this.types.includes(WHITE)&&(t+="W",e=whiteDot),this.types.includes(NEUTRAL)&&(t+="N"),this.types.includes(GATE)&&(t="G",e=gateDot),t.length>1&&(e="+"),e},SolitaireBoardPoint.prototype.putTile=function(e){this.tile=e},SolitaireBoardPoint.prototype.hasTile=function(){return!!this.tile},SolitaireBoardPoint.prototype.isType=function(e){return this.types.includes(e)},SolitaireBoardPoint.prototype.isOpenGate=function(){return!this.hasTile()&&this.types.includes(GATE)},SolitaireBoardPoint.prototype.removeTile=function(){var e=this.tile;return this.tile=null,e},SolitaireBoardPoint.prototype.drainTile=function(){this.tile&&this.tile.drain()},SolitaireBoardPoint.prototype.restoreTile=function(){this.tile&&this.tile.restore()},SolitaireBoardPoint.prototype.canHoldTile=function(e,t){return!this.isType(NON_PLAYABLE)&&(!(!t&&this.hasTile())&&(!!this.isType(GATE)||(e.type===BASIC_FLOWER?!(!this.isType(NEUTRAL)&&!this.isType(e.basicColorName)):e.type===SPECIAL_FLOWER||e.type===ACCENT_TILE)))},SolitaireBoardPoint.prototype.isCompletelyWithinRedOrWhiteGarden=function(){return!this.isType(NEUTRAL)&&(this.isType(RED)&&!this.isType(WHITE)||this.isType(WHITE)&&!this.isType(RED))},SolitaireBoardPoint.prototype.betweenPlayerHarmony=function(e){return e===GUEST?this.betweenHarmonyGuest:e===HOST&&this.betweenHarmonyHost},SolitaireBoardPoint.prototype.getCopy=function(){for(var e=new SolitaireBoardPoint,t=0;t<this.types.length;t++)e.types.push(this.types[t]);return e.row=this.row,e.col=this.col,this.hasTile()&&(e.tile=this.tile.getCopy()),e},SolitaireBoardPoint.neutral=function(){var e=new SolitaireBoardPoint;return e.addType(NEUTRAL),e},SolitaireBoardPoint.gate=function(){var e=new SolitaireBoardPoint;return e.addType(GATE),e},SolitaireBoardPoint.red=function(){var e=new SolitaireBoardPoint;return e.addType(RED),e},SolitaireBoardPoint.white=function(){var e=new SolitaireBoardPoint;return e.addType(WHITE),e},SolitaireBoardPoint.redWhite=function(){var e=new SolitaireBoardPoint;return e.addType(RED),e.addType(WHITE),e},SolitaireBoardPoint.redWhiteNeutral=function(){var e=new SolitaireBoardPoint;return e.addType(RED),e.addType(WHITE),e.addType(NEUTRAL),e},SolitaireBoardPoint.redNeutral=function(){var e=new SolitaireBoardPoint;return e.addType(RED),e.addType(NEUTRAL),e},SolitaireBoardPoint.whiteNeutral=function(){var e=new SolitaireBoardPoint;return e.addType(WHITE),e.addType(NEUTRAL),e},SolitaireController.prototype.getGameTypeId=function(){return GameType.SolitairePaiSho.id},SolitaireController.prototype.completeSetup=function(){this.callActuate()},SolitaireController.prototype.drawRandomTile=function(){this.lastDrawnTile=this.drawnTile,this.drawnTile=this.theGame.drawRandomTile()},SolitaireController.prototype.resetGameManager=function(){this.theGame=new SolitaireGameManager(this.actuator)},SolitaireController.prototype.resetNotationBuilder=function(){this.notationBuilder=new SolitaireNotationBuilder},SolitaireController.prototype.resetGameNotation=function(){this.gameNotation=this.getNewGameNotation()},SolitaireController.prototype.getNewGameNotation=function(){return new SolitaireGameNotation},SolitaireController.getHostTilesContainerDivs=function(){return'<div class="HR3 HR4 HR5 HW3 HW4 HW5 HR HW HK HB HL HO">'},SolitaireController.getGuestTilesContainerDivs=function(){return"<div></div>"},SolitaireController.prototype.callActuate=function(){this.drawnTile&&(this.theGame.tileManager.peekTile(HOST,this.drawnTile.code,this.drawnTile.id)||(this.drawnTile=null,this.lastDrawnTile=null,this.drawRandomTile()));this.theGame.actuate()},SolitaireController.prototype.resetMove=function(){if(this.gameNotation.removeLastMove(),this.drawnTile)this.drawnTile.selectedFromPile=!1,this.theGame.tileManager.putTileBack(this.drawnTile);else{var e=new SolitaireTile(this.gameNotation.moves[this.gameNotation.moves.length-1].plantedFlowerType,hostPlayerCode);this.theGame.tileManager.putTileBack(e),this.lastDrawnTile=e}this.drawnTile=this.lastDrawnTile,this.drawnTile.selectedFromPile=!1},SolitaireController.prototype.getDefaultHelpMessageText=function(){return"<h4>Solitaire Pai Sho</h4> <p>Pai Sho is a game of harmony. The goal of Solitaire Pai Sho is to place Flower Tiles to create a balance of Harmony and Disharmony on the board.</p> <p>Each turn, you are given a tile that's been drawn for you to place on the board. When all the tiles have been played, the game ends and your score will be calculated.</p> <p><a href='https://skudpaisho.com/site/games/solitaire-pai-sho/'>View the resources page</a> for the rules.</p>"},SolitaireController.prototype.getAdditionalMessage=function(){var e="";return 0===this.gameNotation.moves.length&&(e+=getGameOptionsMessageHtml(GameType.SolitairePaiSho.gameOptions)),this.theGame.getWinner()||(e+="<br /><strong>"+this.theGame.getWinReason()+"</strong>"),e},SolitaireController.prototype.unplayedTileClicked=function(e){if(myTurn())if(currentMoveIndex===this.gameNotation.moves.length){var t=e.getAttribute("name"),o=parseInt(e.getAttribute("id")),i=t.charAt(0),n=t.substring(1),a=GUEST;"H"===i&&(a=HOST);var r=this.theGame.tileManager.peekTile(a,n,o);this.notationBuilder.status===BRAND_NEW?(r.selectedFromPile=!0,this.drawnTile.selectedFromPile=!0,this.notationBuilder.moveType=PLANTING,this.notationBuilder.plantedFlowerType=n,this.notationBuilder.status=WAITING_FOR_ENDPOINT,this.theGame.setAllLegalPointsOpen(getCurrentPlayer(),r)):(this.theGame.hidePossibleMovePoints(),this.notationBuilder=new SolitaireNotationBuilder)}else debug("Can only interact if all moves are played.")},SolitaireController.prototype.pointClicked=function(e){if(currentMoveIndex===this.gameNotation.moves.length){var t=new NotationPoint(e.getAttribute("name")).rowAndColumn,o=this.theGame.board.cells[t.row][t.col];if(this.notationBuilder.status===BRAND_NEW){if(o.hasTile()){if(o.tile.ownerName!==getCurrentPlayer())return void debug("That's not your tile!");if(o.tile.type===ACCENT_TILE)return;if(o.tile.trapped)return;if(!newKnotweedRules&&o.tile.trapped)return}}else if(this.notationBuilder.status===WAITING_FOR_ENDPOINT)if(o.isType(POSSIBLE_MOVE)){this.theGame.hidePossibleMovePoints(),this.notationBuilder.endPoint=new NotationPoint(e.getAttribute("name"));var i=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.theGame.runNotationMove(i)||(this.gameNotation.addMove(i),this.drawRandomTile(),onlinePlayEnabled&&1===this.gameNotation.moves.length?createGameIfThatIsOk(GameType.SolitairePaiSho.id):playingOnlineGame()?callSubmitMove():finalizeMove())}else this.theGame.hidePossibleMovePoints(),this.notationBuilder=new SolitaireNotationBuilder}else debug("Can only interact if all moves are played.")},SolitaireController.prototype.skipHarmonyBonus=function(){var e=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.gameNotation.addMove(e),onlinePlayEnabled&&1===this.gameNotation.moves.length?createGameIfThatIsOk(GameType.SolitairePaiSho.id):playingOnlineGame()?callSubmitMove():finalizeMove()},SolitaireController.prototype.addTileSummaryToMessageArr=function(e,t){if(t.length>1){var o=t.charAt(0),i=parseInt(t.charAt(1)),n=i-1,a=o;n<3&&(n=5,a="R"===o?"W":"R");var r=SolitaireTile.getTileName(a+n);a=o,(n=i+1)>5&&(n=3,a="R"===o?"W":"R");var l=SolitaireTile.getTileName(a+n);n=i,a="R"===o?"W":"R";var s=SolitaireTile.getTileName(a+n);e.push("Forms Harmony with "+r+", "+l+", and the Lotus"),e.push("Forms Disharmony with "+s+" and the Orchid")}else"R"===t?(heading="Accent Tile: Rock",simplest?e.push("The Rock disrupts Harmonies and cannot be moved by a Wheel."):rocksUnwheelable?simpleRocks?e.push("The Rock blocks Harmonies and cannot be moved by a Wheel."):e.push("The Rock cancels Harmonies on horizontal and vertical lines it lies on. A Rock cannot be moved by a Wheel."):e.push("The Rock cancels Harmonies on horizontal and vertical lines it lies on.")):"W"===t?(heading="Accent Tile: Wheel",rocksUnwheelable||simplest?e.push("The Wheel rotates all surrounding tiles one space clockwise but cannot move a Rock (cannot move tiles off the board or onto or off of a Gate)."):e.push("The Wheel rotates all surrounding tiles one space clockwise (cannot move tiles off the board or onto or off of a Gate).")):"K"===t?(heading="Accent Tile: Knotweed",newKnotweedRules?e.push("The Knotweed drains surrounding Flower Tiles so they are unable to form Harmony."):e.push("The Knotweed drains surrounding Basic Flower Tiles so they are unable to move or form Harmony.")):"B"===t?(heading="Accent Tile: Boat",simplest||rocksUnwheelable?e.push("The Boat moves a Flower Tile to a surrounding space or removes an Accent tile."):rocksUnwheelable?e.push("The Boat moves a Flower Tile to a surrounding space or removes a Rock or Knotweed tile."):e.push("The Boat moves a Flower Tile to a surrounding space or removes a Knotweed tile.")):"L"===t?(heading="Special Flower: White Lotus",e.push("Forms Harmony with all Flower Tiles")):"O"===t&&(heading="Special Flower: Orchid",e.push("Forms Disharmony will all Flower Tiles"))},SolitaireController.prototype.getTileMessage=function(e){var t=e.getAttribute("name"),o=(parseInt(e.getAttribute("id")),new SolitaireTile(t.substring(1),t.charAt(0)),[]);t.startsWith("G");var i=t.substring(1),n=SolitaireTile.getTileName(i);return this.addTileSummaryToMessageArr(o,i),{heading:n,message:o}},SolitaireController.prototype.getPointMessage=function(e){var t=new NotationPoint(e.getAttribute("name")).rowAndColumn,o=this.theGame.board.cells[t.row][t.col],i=[];if(o.hasTile()){i.push(toHeading(o.tile.getName())),this.addTileSummaryToMessageArr(i,o.tile.code);var n=this.theGame.board.harmonyManager.getHarmoniesWithThisTile(o.tile);if(n.length>0){var a=[];n.forEach((function(e){var t=e.getTileThatIsNotThisOne(o.tile);a.push(t.getName()+" to the "+e.getDirectionForTile(o.tile))})),i.push("<strong>Currently in Harmony with: </strong>"+toBullets(a))}if((n=this.theGame.board.harmonyManager.getClashesWithThisTile(o.tile)).length>0){a=[];n.forEach((function(e){var t=e.getTileThatIsNotThisOne(o.tile);a.push(t.getName()+" to the "+e.getDirectionForTile(o.tile))})),i.push("<strong>Currently in Disharmony with: </strong>"+toBullets(a))}}else o.isType(NEUTRAL)?i.push(getNeutralPointMessage()):o.isType(RED)&&o.isType(WHITE)?i.push(getRedWhitePointMessage()):o.isType(RED)?i.push(getRedPointMessage()):o.isType(WHITE)?i.push(getWhitePointMessage()):o.isType(GATE)&&i.push(getNeutralPointMessage());return{heading:null,message:i}},SolitaireController.prototype.playAiTurn=function(e){},SolitaireController.prototype.startAiGame=function(e){},SolitaireController.prototype.getAiList=function(){return[]},SolitaireController.prototype.getCurrentPlayer=function(){return HOST},SolitaireController.prototype.cleanup=function(){},SolitaireController.prototype.isSolitaire=function(){return!0},SolitaireController.prototype.setGameNotation=function(e){this.drawnTile&&(this.drawnTile.selectedFromPile=!1,this.theGame.tileManager.putTileBack(this.drawnTile)),this.resetGameManager(),this.gameNotation.setNotationText(e),this.drawRandomTile(),this.theGame.actuate()},SolitaireGameManager.prototype.setup=function(e){this.board=new SolitaireBoard},SolitaireGameManager.prototype.actuate=function(){this.isCopy||this.actuator.actuate(this.board,gameController.theGame,gameController.drawnTile)},SolitaireGameManager.prototype.runNotationMove=function(e,t){debug("Running Move: "+e.fullMoveText);var o=!1;if(e.moveType===PLANTING){var i=this.tileManager.grabTile(e.player,e.plantedFlowerType);this.board.placeTile(i,e.endPoint)}else if(e.moveType===ARRANGING)if((o=this.board.moveTile(e.player,e.startPoint,e.endPoint))&&e.hasHarmonyBonus()){i=this.tileManager.grabTile(e.player,e.bonusTileCode);e.boatBonusPoint?this.board.placeTile(i,e.bonusEndPoint,e.boatBonusPoint):this.board.placeTile(i,e.bonusEndPoint)}else!o&&e.hasHarmonyBonus()&&(debug("BONUS NOT ALLOWED so I won't give it to you!"),!0);if(t&&this.actuate(),this.endGameWinners=[],0===this.board.winners.length){var n=this.tileManager.aPlayerIsOutOfTiles();n&&(debug("PLAYER OUT OF TILES: "+n),this.endGameWinners.push(HOST))}return o},SolitaireGameManager.prototype.drawRandomTile=function(){return this.tileManager.drawRandomTile()},SolitaireGameManager.prototype.revealPossibleMovePoints=function(e,t){e.hasTile()&&(this.board.setPossibleMovePoints(e),t||this.actuate())},SolitaireGameManager.prototype.hidePossibleMovePoints=function(e){this.board.removePossibleMovePoints(),this.tileManager.removeSelectedTileFlags(),e||this.actuate()},SolitaireGameManager.prototype.setAllLegalPointsOpen=function(e,t,o){t.type===ACCENT_TILE?this.board.setSolitaireAccentPointsOpen(t):this.board.setHarmonyAndClashPointsOpen(t)||this.board.setAllPossiblePointsOpen(t),o||this.actuate()},SolitaireGameManager.prototype.playerCanBonusPlant=function(e){return!newGatesRule||(lessBonus?this.board.playerHasNoGrowingFlowers(e):newGatesRule?this.board.playerControlsLessThanTwoGates(e):void 0)},SolitaireGameManager.prototype.revealSpecialFlowerPlacementPoints=function(e){newSpecialFlowerRules?(this.board.revealSpecialFlowerPlacementPoints(e),this.actuate()):this.revealOpenGates(e)},SolitaireGameManager.prototype.revealPossiblePlacementPoints=function(e){this.board.revealPossiblePlacementPoints(e),this.actuate()},SolitaireGameManager.prototype.revealBoatBonusPoints=function(e){this.board.revealBoatBonusPoints(e),this.actuate()},SolitaireGameManager.prototype.playerHasNotPlayedEitherSpecialTile=function(e){return this.tileManager.playerHasBothSpecialTilesRemaining(e)},SolitaireGameManager.prototype.getWinner=function(){if(1===this.endGameWinners.length)return this.endGameWinners[0]},SolitaireGameManager.prototype.getWinReason=function(){return"<br />"+this.board.harmonyManager.getSolitaireGameSummaryText()},SolitaireGameManager.prototype.getWinResultTypeCode=function(){if(1===this.endGameWinners.length)return 6},SolitaireGameManager.prototype.getCopy=function(){var e=new SolitaireGameManager(this.actuator,!0,!0);return e.board=this.board.getCopy(),e.tileManager=this.tileManager.getCopy(),e},SolitaireNotationMove.prototype.analyzeMove=function(){this.valid=!0;var e=(n=this.fullMoveText.split("."))[0];this.moveNum=parseInt(e.slice(0,-1)),this.playerCode=e.charAt(e.length-1),"G"===this.playerCode?this.player=GUEST:"H"===this.playerCode&&(this.player=HOST);var t=n[1];if(t)if(0!==this.moveNum){var o=t.charAt(0);if(this.moveType=PLANTING,this.moveType===PLANTING){var i=t.charAt(1);this.plantedFlowerType=o,"("!==i&&(this.plantedFlowerType=this.plantedFlowerType+""+i),"("===t.charAt(2)||"("===t.charAt(1)||(debug("Failure to plant"),this.valid=!1),t.endsWith(")")?this.endPoint=new NotationPoint(t.substring(t.indexOf("(")+1,t.indexOf(")"))):this.valid=!1}if(this.moveType===ARRANGING){var n=t.substring(t.indexOf("(")+1).split(")-(");if(this.startPoint=new NotationPoint(n[0]),this.endPoint=new NotationPoint(n[1].substring(0,n[1].indexOf(")"))),n[1].includes("+")){var a=n[1].substring(n[1].indexOf("+")+1);this.bonusTileCode=a.substring(0,a.indexOf("(")),n.length>2?(this.bonusEndPoint=new NotationPoint(a.substring(a.indexOf("(")+1)),this.boatBonusPoint=new NotationPoint(n[2].substring(0,n[2].indexOf(")")))):this.bonusEndPoint=new NotationPoint(a.substring(a.indexOf("(")+1,a.indexOf(")")))}}}else this.accentTiles=t.split(",")},SolitaireNotationMove.prototype.hasHarmonyBonus=function(){return void 0!==this.bonusTileCode},SolitaireNotationMove.prototype.isValidNotation=function(){return this.valid},SolitaireNotationMove.prototype.equals=function(e){return this.fullMoveText===e.fullMoveText},SolitaireNotationBuilder.prototype.getFirstMoveForHost=function(e){var t=new SolitaireNotationBuilder;return t.moveType=PLANTING,t.plantedFlowerType=Tile.getClashTileCode(e),(simpleCanonRules||sameStart)&&(t.plantedFlowerType=e),t.endPoint=new NotationPoint("0,8"),t},SolitaireNotationBuilder.prototype.getNotationMove=function(e,t){var o=e+t.charAt(0)+".";return this.moveType===ARRANGING?(o+="("+this.startPoint.pointText+")-("+this.endPoint.pointText+")",this.bonusTileCode&&this.bonusEndPoint&&(o+="+"+this.bonusTileCode+"("+this.bonusEndPoint.pointText+")",this.boatBonusPoint&&(o+="-("+this.boatBonusPoint.pointText+")"))):this.moveType===PLANTING&&(o+=this.plantedFlowerType+"("+this.endPoint.pointText+")"),new SolitaireNotationMove(o)},SolitaireGameNotation.prototype.setNotationText=function(e){this.notationText=e,this.loadMoves()},SolitaireGameNotation.prototype.addNotationLine=function(e){this.notationText+=";"+e.trim(),this.loadMoves()},SolitaireGameNotation.prototype.addMove=function(e){this.notationText?this.notationText+=";"+e.fullMoveText:this.notationText=e.fullMoveText,this.loadMoves()},SolitaireGameNotation.prototype.removeLastMove=function(){this.notationText=this.notationText.substring(0,this.notationText.lastIndexOf(";")),this.loadMoves()},SolitaireGameNotation.prototype.getPlayerMoveNum=function(){var e=0,t=this.moves[this.moves.length-1];return t&&(e=t.moveNum,0===t.moveNum&&t.player===HOST?player=GUEST:0===t.moveNum&&t.player===GUEST?(e++,player=GUEST):t.player===HOST?e++:player=HOST),e},SolitaireGameNotation.prototype.getNotationMoveFromBuilder=function(e){var t=1,o=GUEST,i=this.moves[this.moves.length-1];return i&&(t=i.moveNum,0===i.moveNum&&i.player===HOST?o=GUEST:0===i.moveNum&&i.player===GUEST?(t++,o=GUEST):i.player===HOST?t++:o=HOST),e.getNotationMove(t,o)},SolitaireGameNotation.prototype.loadMoves=function(){this.moves=[];var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t=this,o=HOST;e.forEach((function(e){var i=new SolitaireNotationMove(e);0===i.moveNum&&i.isValidNotation()?t.moves.push(i):i.isValidNotation()&&i.player!==o?(t.moves.push(i),o=i.player):debug("the player check is broken?")}))},SolitaireGameNotation.prototype.getNotationHtml=function(){var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t="";return e.forEach((function(e){t+=e+"<br />"})),t},SolitaireGameNotation.prototype.getNotationForEmail=function(){var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t="";return e.forEach((function(e){t+=e+"[BR]"})),t},SolitaireGameNotation.prototype.notationTextForUrl=function(){return this.notationText},SolitaireGameNotation.prototype.getLastMoveText=function(){return this.moves[this.moves.length-1].fullMoveText},SolitaireGameNotation.prototype.getLastMoveNumber=function(){return this.moves[this.moves.length-1].moveNum},SolitaireHarmony.prototype.equals=function(e){return!(this.ownerName!==e.ownerName||this.ownerCode!==e.ownerCode||this.tile1!==e.tile1&&this.tile1!==e.tile2||this.tile2!==e.tile1&&this.tile2!==e.tile2)},SolitaireHarmony.prototype.notAnyOfThese=function(e){for(var t=0;t<e.length;t++)if(this.equals(e[t]))return!1;return!0},SolitaireHarmony.prototype.containsTile=function(e){return this.tile1===e||this.tile2===e},SolitaireHarmony.prototype.getTileThatIsNotThisOne=function(e){return this.tile1===e?this.tile2:this.tile2===e?this.tile1:void debug("BOTH TILES ARE NOT THAT ONE!")},SolitaireHarmony.prototype.containsTilePos=function(e){return this.tile1Pos.samesies(e)||this.tile2Pos.samesies(e)},SolitaireHarmony.prototype.getPosThatIsNotThisOne=function(e){return this.tile1Pos.samesies(e)?this.tile2Pos:this.tile2Pos.samesies(e)?this.tile1Pos:void debug("\tBOTH TILE POS ARE NOT THAT ONE!")},SolitaireHarmony.prototype.getString=function(){return this.ownerName+" ("+this.tile1Pos.notationPointString+")-("+this.tile2Pos.notationPointString+")"},SolitaireHarmony.prototype.getDirectionForTile=function(e){if(this.containsTile(e)){var t=this.tile1Pos,o=this.tile2Pos;return this.tile2.id===e.id&&(t=this.tile2Pos,o=this.tile1Pos),t.row===o.row?t.col<o.col?"East":"West":t.col===o.col?t.row>o.row?"North":"South":void 0}},SolitaireHarmony.prototype.crossesCenter=function(){var e=this.tile1Pos.row,t=this.tile2Pos.row;if(this.tile1Pos.row<this.tile2Pos.row&&(e=this.tile2Pos.row,t=this.tile1Pos.row),e!==t)return e>8&&t<8;var o=this.tile1Pos.col,i=this.tile2Pos.col;return this.tile1Pos.col<this.tile2Pos.col&&(o=this.tile2Pos.col,i=this.tile1Pos.col),o!==i?o>8&&i<8:void 0},SolitaireHarmonyManager.prototype.printHarmonies=function(){debug("All Harmonies:");for(var e=0;e<this.harmonies.length;e++)debug(this.harmonies[e].getString())},SolitaireHarmonyManager.prototype.getHarmoniesWithThisTile=function(e){var t=[];return this.harmonies.forEach((function(o){o.containsTile(e)&&t.push(o)})),t},SolitaireHarmonyManager.prototype.getClashesWithThisTile=function(e){var t=[];return this.clashes.forEach((function(o){o.containsTile(e)&&t.push(o)})),t},SolitaireHarmonyManager.prototype.addHarmony=function(e){for(var t=!1,o=0;o<this.harmonies.length;o++)e.equals(this.harmonies[o])&&(t=!0);t||this.harmonies.push(e)},SolitaireHarmonyManager.prototype.addHarmonies=function(e){if(e)for(var t=0;t<e.length;t++)this.addHarmony(e[t])},SolitaireHarmonyManager.prototype.addClash=function(e){for(var t=!1,o=0;o<this.clashes.length;o++)e.equals(this.clashes[o])&&(t=!0);t||this.clashes.push(e)},SolitaireHarmonyManager.prototype.addClashes=function(e){if(e)for(var t=0;t<e.length;t++)this.addClash(e[t])},SolitaireHarmonyManager.prototype.clearList=function(){this.harmonies=[],this.clashes=[]},SolitaireHarmonyManager.prototype.getSolitaireGameSummaryText=function(){var e=this.getPlayerWithMostHarmonies(),t=this.numHarmoniesForPlayer(e),o=this.numClashesForPlayer(e),i=t>o?o:t;return debug("Simple Score: "+i),t+" Harmonies <br />"+o+" Disharmonies <br />Simple Score: "+i+"<br /><br />"+(t=this.getHarmonyPointsForPlayer(e,this.harmonies))+" Harmony Points <br />"+(o=this.getHarmonyPointsForPlayer(e,this.clashes))+" Disharmony Points <br />Full Score: "+(t>o?o:t)},SolitaireHarmonyManager.prototype.getHarmonyPointsForPlayer=function(e,t){for(var o=0,i=0;i<t.length;i++){var n=t[i];if(n.ownerName===e){var a=n.getDirectionForTile(n.tile1);"North"===a||"South"===a?o+=Math.abs(n.tile1Pos.row-n.tile2Pos.row)+1:"East"!==a&&"West"!==a||(o+=Math.abs(n.tile1Pos.col-n.tile2Pos.col)+1)}}return o},SolitaireHarmonyManager.prototype.numHarmoniesForPlayer=function(e){for(var t=0,o=0;o<this.harmonies.length;o++)this.harmonies[o].ownerName===e&&t++;return t},SolitaireHarmonyManager.prototype.numClashesForPlayer=function(e){for(var t=0,o=0;o<this.clashes.length;o++)this.clashes[o].ownerName===e&&t++;return t},SolitaireHarmonyManager.prototype.getPlayerWithMostHarmonies=function(){var e=this.numHarmoniesForPlayer(HOST),t=this.numHarmoniesForPlayer(GUEST);return t>e?GUEST:HOST},SolitaireHarmonyManager.prototype.getNumCrossingCenterForPlayer=function(e){for(var t=0,o=0;o<this.harmonies.length;o++)this.harmonies[o].ownerName===e&&this.harmonies[o].crossesCenter()&&t++;return t},SolitaireHarmonyManager.prototype.ringLengthForPlayer=function(e){for(var t=this.getHarmonyChains(),o=0,i=0;i<t.length;i++){var n=t[i];if(n.pop().ownerName===e){n.length>o&&(o=n.length)}}return o},SolitaireHarmonyManager.prototype.getPlayerWithLongestChain=function(){var e=this.ringLengthForPlayer(HOST),t=this.ringLengthForPlayer(GUEST);return t>e?GUEST:e>t?HOST:void 0},SolitaireHarmonyManager.prototype.hasNewHarmony=function(e,t){for(var o=[],i=0;i<this.harmonies.length;i++)if(this.harmonies[i].ownerName===e){for(var n=!1,a=0;a<t.length;a++)this.harmonies[i].equals(t[a])&&(n=!0);n||o.push(this.harmonies[i])}return o.length>0},SolitaireHarmonyManager.prototype.getHarmonyChains=function(){for(var e=this,t=[],o=0;o<this.harmonies.length;o++){var i=this.harmonies[o],n=[];n.push(i);var a=i.tile2,r=(i.tile2Pos,i.tile1),l=(i.tile1Pos,this.lookForRing(a,r,n));if(l[0]){var s=!1;t.forEach((function(t){e.ringsMatch(t,l[1])&&(s=!0)})),s||t.push(l[1])}}return t},SolitaireHarmonyManager.prototype.harmonyRingExists=function(){var e=this,t=this.getHarmonyChains(),o=[];return t.forEach((function(t){debug(t);var i=e.verifyHarmonyRing(t);i&&o.push(i)})),o},SolitaireHarmonyManager.prototype.ringContains345=function(e){for(var t=!1,o=!1,i=!1,n=0;n<e.length;n++){var a=e[n];"3"===a.tile1.basicValue&&(t=!0),"4"===a.tile1.basicValue&&(o=!0),"5"===a.tile1.basicValue&&(i=!0),"3"===a.tile2.basicValue&&(t=!0),"4"===a.tile2.basicValue&&(o=!0),"5"===a.tile2.basicValue&&(i=!0)}return t&&o&&i},SolitaireHarmonyManager.prototype.verifyHarmonyRing=function(e){if(completeHarmony&&!this.ringContains345(e))return!1;var t=[],o=e.pop(),i=o.ownerName;t.push(new NotationPoint(o.tile1Pos.notationPointString).toArr()),t.push(new NotationPoint(o.tile2Pos.notationPointString).toArr());for(var n=o.tile2Pos,a=0;e.length>0&&a<400;){for(var r=0;r<e.length;r++)if((o=e[r]).containsTilePos(n)){var l=new NotationPoint((n=o.getPosThatIsNotThisOne(n)).notationPointString);l.samesies(new NotationPoint(t[0][0]+","+t[0][1]))||t.push(l.toArr()),e.splice(r,1)}a++}return a>390?(debug("THERE WAS A PROBLEM CONNECTING THE DOTS"),!1):!!this.isCenterInsideShape(t)&&i},SolitaireHarmonyManager.prototype.isPointInsideShape=function(e,t){for(var o=e.x,i=e.y,n=!1,a=0,r=t.length-1;a<t.length;r=a++){var l=t[a][0],s=t[a][1],h=t[r][0],d=t[r][1];if(l===o&&h===o&&l*h)return!1;s>i!=d>i&&o<(h-l)*(i-s)/(d-s)+l&&(n=!n)}return n},SolitaireHarmonyManager.prototype.isPointInsideShape_alternate=function(e,t){for(var o=[e.x,e.y],i=!1,n=-1,a=t.length,r=a-1;++n<a;r=n)(t[n][1]<=o[1]&&o[1]<t[r][1]||t[r][1]<=o[1]&&o[1]<t[n][1])&&o[0]<(t[r][0]-t[n][0])*(o[1]-t[n][1])/(t[r][1]-t[n][1])+t[n][0]&&(i=!i);return i},SolitaireHarmonyManager.prototype.isCenterInsideShape=function(e){for(var t=!1,o=0,i=e.length-1;o<e.length;i=o++){var n=e[o][0],a=e[o][1],r=e[i][0],l=e[i][1];if(0===n&&0===r&&a*l<0||0===a&&0===l&&n*r<0)return debug("Crosses center, cannot count"),!1;if(0===n&&0===a||0===r&&0===l)return debug("On center point, cannot count"),!1;a>0!=l>0&&0<(r-n)*(0-a)/(l-a)+n&&(t=!t)}return t},SolitaireHarmonyManager.prototype.ringsMatch=function(e,t){return e.length===t.length&&(e.forEach((function(e){var o=!1;if(t.forEach((function(t){e.equals(t)&&(o=!0)})),!o)return!1})),!0)},SolitaireHarmonyManager.prototype.lookForRing=function(e,t,o){for(var i=0;i<this.harmonies.length;i++){var n=this.harmonies[i];if(n.containsTile(e)&&n.notAnyOfThese(o)){if(o.push(n),n.containsTile(t))return[!0,o];var a=n.getTileThatIsNotThisOne(e);return this.lookForRing(a,t,o)}}return[!1]};RED="Red",WHITE="White",tileId=1;function SolitaireTile(e,t){this.code=e,this.ownerCode=t,"G"===this.ownerCode?(this.ownerName=GUEST,this.opponentName=HOST):"H"===this.ownerCode?(this.ownerName=HOST,this.opponentName=GUEST):debug("INCORRECT OWNER CODE"),this.id=tileId++,this.drained=!1,this.selectedFromPile=!1,2===this.code.length&&(this.code.includes("R")||this.code.includes("W"))?(this.type=BASIC_FLOWER,this.basicColorCode=this.code.charAt(0),this.basicValue=this.code.charAt(1),"R"===this.basicColorCode?this.basicColorName=RED:"W"===this.basicColorCode&&(this.basicColorName=WHITE)):"L"===this.code||"O"===this.code?(this.type=SPECIAL_FLOWER,this.setSpecialFlowerInfo()):"R"===this.code||"W"===this.code||"K"===this.code||"B"===this.code?(this.type=ACCENT_TILE,this.setAccentInfo()):debug("Error: Unknown tile type")}function SolitaireTileManager(e){this.playerCode="H",this.tiles=e?this.loadOneOfEach(this.playerCode):this.loadTileSet(this.playerCode)}function StreetActuator(e,t){this.gameContainer=e,this.mobile=t;var o=setupPaiShoBoard(this.gameContainer,StreetController.getHostTilesContainerDivs(),StreetController.getGuestTilesContainerDivs(),!1);this.boardContainer=o.boardContainer,this.hostTilesContainer=o.hostTilesContainer,this.guestTilesContainer=o.guestTilesContainer}function StreetBoard(){this.size=new RowAndColumn(17,17),this.cells=this.brandNew(),this.harmonyManager=new StreetHarmonyManager,this.winners=[],this.ableToReachPointsChecked=[],this.debugCount=0}SolitaireTile.prototype.setAccentInfo=function(){"R"===this.code?this.accentType=ROCK:"W"===this.code?this.accentType=WHEEL:"K"===this.code?this.accentType=KNOTWEED:"B"===this.code&&(this.accentType=BOAT)},SolitaireTile.prototype.setSpecialFlowerInfo=function(){"L"===this.code?this.specialFlowerType=WHITE_LOTUS:"O"===this.code&&(this.specialFlowerType=ORCHID)},SolitaireTile.prototype.getConsoleDisplay=function(){return this.drained?"*"+this.code:this.ownerCode+""+this.code},SolitaireTile.prototype.getImageName=function(){return this.ownerCode+""+this.code},SolitaireTile.prototype.formsHarmonyWith=function(e){return"L"===this.code&&"O"===e.code||"L"===e.code&&"O"===this.code||!(this.type!==BASIC_FLOWER&&"L"!==this.code||e.type!==BASIC_FLOWER&&"L"!==e.code)&&(!("L"===this.code&&e.type!==BASIC_FLOWER||"L"===e.code&&this.type!==BASIC_FLOWER)&&(!this.drained&&!e.drained&&("L"===this.code&&e.type!==ACCENT_TILE||"L"===e.code&&this.type!==ACCENT_TILE||e.ownerName===this.ownerName&&(this.basicColorCode===e.basicColorCode&&1===Math.abs(this.basicValue-e.basicValue)||(this.basicColorCode!==e.basicColorCode&&2===Math.abs(this.basicValue-e.basicValue)||(this.type!==e.type||(!(!superHarmonies||this.basicValue===e.basicValue)||void 0)))))))},SolitaireTile.prototype.clashesWith=function(e){return this.type!==ACCENT_TILE&&e.type!==ACCENT_TILE&&(this.specialFlowerType===ORCHID||e.specialFlowerType===ORCHID||this.type===BASIC_FLOWER&&e.type===BASIC_FLOWER&&this.basicColorCode!==e.basicColorCode&&this.basicValue===e.basicValue)},SolitaireTile.prototype.getMoveDistance=function(){return this.type===BASIC_FLOWER?parseInt(this.basicValue):"L"===this.code?2:"O"===this.code?6:0},SolitaireTile.prototype.drain=function(){this.type===BASIC_FLOWER&&(this.drained=!0)},SolitaireTile.prototype.restore=function(){this.drained=!1},SolitaireTile.prototype.getName=function(){return SolitaireTile.getTileName(this.code)},SolitaireTile.prototype.getCopy=function(){return new SolitaireTile(this.code,this.ownerCode)},SolitaireTile.getTileName=function(e){var t="";if(e.length>1){var o=e.charAt(0),i=e.charAt(1);"R"===o?("3"===i?t="Rose":"4"===i?t="Chrysanthemum":"5"===i&&(t="Rhododendron"),t+=" (Red "+i+")"):"W"===o&&("3"===i?t="Jasmine":"4"===i?t="Lily":"5"===i&&(t="White Jade"),t+=" (White "+i+")")}else"R"===e?t="Rock":"W"===e?t="Wheel":"K"===e?t="Knotweed":"B"===e?t="Boat":"O"===e?t="Orchid":"L"===e&&(t="White Lotus");return t},SolitaireTile.getClashTileCode=function(e){if(2===e.length){if(e.startsWith("R"))return"W"+e.charAt(1);if(e.startsWith("W"))return"R"+e.charAt(1)}},SolitaireTileManager.prototype.loadTileSet=function(e){return this.loadSolitaireSet(e,!1,!0)},SolitaireTileManager.prototype.loadSolitaireSet=function(e,t,o){var i=[],n=1;gameOptionEnabled(OPTION_DOUBLE_TILES)&&(n=2,i.push(new SolitaireTile("L",e))),gameOptionEnabled(OPTION_INSANE_TILES)&&(n=4);for(var a=0;a<2*n;a++)i.push(new SolitaireTile("R",e)),i.push(new SolitaireTile("W",e)),i.push(new SolitaireTile("K",e)),i.push(new SolitaireTile("B",e));for(a=0;a<3*n;a++)i.push(new SolitaireTile("R3",e)),i.push(new SolitaireTile("R4",e)),i.push(new SolitaireTile("R5",e)),i.push(new SolitaireTile("W3",e)),i.push(new SolitaireTile("W4",e)),i.push(new SolitaireTile("W5",e));for(a=0;a<n;a++)i.push(new SolitaireTile("L",e)),i.push(new SolitaireTile("O",e));return i},SolitaireTileManager.prototype.loadSkudSet=function(e){for(var t=[],o=0;o<2;o++)t.push(new SolitaireTile("R",e)),t.push(new SolitaireTile("W",e)),t.push(new SolitaireTile("K",e)),t.push(new SolitaireTile("B",e));t.forEach((function(e){e.selectedFromPile=!0}));for(o=0;o<3;o++)t.push(new SolitaireTile("R3",e)),t.push(new SolitaireTile("R4",e)),t.push(new SolitaireTile("R5",e)),t.push(new SolitaireTile("W3",e)),t.push(new SolitaireTile("W4",e)),t.push(new SolitaireTile("W5",e));return t.push(new SolitaireTile("L",e)),t.push(new SolitaireTile("O",e)),t},SolitaireTileManager.prototype.loadSimpleCanonSet=function(e){for(var t=[],o=0;o<2;o++)t.push(new SolitaireTile("W",e));t.forEach((function(e){e.selectedFromPile=!0}));for(o=0;o<6;o++)t.push(new SolitaireTile("R3",e)),t.push(new SolitaireTile("W5",e));return t.push(new SolitaireTile("L",e)),t.push(new SolitaireTile("O",e)),t},SolitaireTileManager.prototype.loadOneOfEach=function(e){var t=[];return t.push(new SolitaireTile("R",e)),t.push(new SolitaireTile("W",e)),t.push(new SolitaireTile("K",e)),t.push(new SolitaireTile("B",e)),t.push(new SolitaireTile("R3",e)),t.push(new SolitaireTile("R4",e)),t.push(new SolitaireTile("R5",e)),t.push(new SolitaireTile("W3",e)),t.push(new SolitaireTile("W4",e)),t.push(new SolitaireTile("W5",e)),t.push(new SolitaireTile("L",e)),t.push(new SolitaireTile("O",e)),t},SolitaireTileManager.prototype.drawRandomTile=function(){if(this.tiles.length>0){var e=this.tiles[Math.floor(Math.random()*this.tiles.length)];return this.peekTile(this.playerCode,e.code)}},SolitaireTileManager.prototype.grabTile=function(e,t){for(var o,i=this.tiles,n=0;n<i.length;n++)if(i[n].code===t){newTileArr=i.splice(n,1),o=newTileArr[0];break}return o||debug("NONE OF THAT TILE FOUND"),o},SolitaireTileManager.prototype.peekTile=function(e,t,o){var i,n=this.tiles;if(o)for(var a=0;a<n.length;a++)if(n[a].id===o)return n[a];for(a=0;a<n.length;a++)if(n[a].code===t){i=n[a];break}return i||debug("NONE OF THAT TILE FOUND"),i},SolitaireTileManager.prototype.removeSelectedTileFlags=function(){this.tiles.forEach((function(e){e.selectedFromPile=!1})),this.tiles.forEach((function(e){e.selectedFromPile=!1}))},SolitaireTileManager.prototype.unselectTiles=function(e){var t=this.tiles;e===GUEST&&(t=this.tiles),t.forEach((function(e){e.selectedFromPile=!1}))},SolitaireTileManager.prototype.putTileBack=function(e){var t=e.ownerName,o=this.tiles;t===GUEST&&(o=this.tiles),o.push(e)},SolitaireTileManager.prototype.aPlayerIsOutOfTiles=function(){var e=this.tiles.length>0;return!e||!e},SolitaireTileManager.prototype.getPlayerWithMoreAccentTiles=function(){for(var e=0,t=0;t<this.tiles.length;t++)this.tiles[t].type===ACCENT_TILE&&e++;var o=0;for(t=0;t<this.tiles.length;t++)this.tiles[t].type===ACCENT_TILE&&o++;return e>o?HOST:o>e?GUEST:void 0},SolitaireTileManager.prototype.playerHasBothSpecialTilesRemaining=function(e){var t=this.tiles;e===GUEST&&(t=this.tiles);var o=0;return t.forEach((function(e){e.type===SPECIAL_FLOWER&&o++})),o>1},SolitaireTileManager.prototype.getCopy=function(){var e=new SolitaireTileManager;return e.tiles=this.copyArr(this.tiles),e.tiles=this.copyArr(this.tiles),e},SolitaireTileManager.prototype.copyArr=function(e){for(var t=[],o=0;o<e.length;o++)t.push(e[o].getCopy());return t},StreetActuator.prototype.actuate=function(e,t){var o=this;window.requestAnimationFrame((function(){o.htmlify(e,t)}))},StreetActuator.prototype.htmlify=function(e,t){this.clearContainer(this.boardContainer);var o=this;e.cells.forEach((function(e){e.forEach((function(e){e&&o.addBoardPoint(e)}))}));var i=new StreetTileManager(!0);i.hostTiles.forEach((function(e){o.clearTileContainer(e)})),i.guestTiles.forEach((function(e){o.clearTileContainer(e)})),t.hostTiles.forEach((function(e){o.addTile(e,this.hostTilesContainer)})),t.guestTiles.forEach((function(e){o.addTile(e,this.guestTilesContainer)}))},StreetActuator.prototype.clearContainer=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},StreetActuator.prototype.clearTileContainer=function(e){for(var t=document.querySelector("."+e.getImageName());t.firstChild;)t.removeChild(t.firstChild)},StreetActuator.prototype.addTile=function(e,t){var o=document.querySelector("."+e.getImageName()),i=document.createElement("div");i.classList.add("point"),i.classList.add("hasTile"),e.selectedFromPile&&(i.classList.add("selectedFromPile"),i.classList.add("drained"));var n=document.createElement("img"),a=getSkudTilesSrcPath();n.src=a+e.getImageName()+".png",i.appendChild(n),i.setAttribute("name",e.getImageName()),i.setAttribute("id",e.id),this.mobile?i.setAttribute("onclick","unplayedTileClicked(this); showTileMessage(this);"):(i.setAttribute("onclick","unplayedTileClicked(this);"),i.setAttribute("onmouseover","showTileMessage(this);"),i.setAttribute("onmouseout","clearMessage();")),o.appendChild(i)},StreetActuator.prototype.addBoardPoint=function(e){var t=createBoardPointDiv(e);if(e.isType(NON_PLAYABLE)||(t.classList.add("activePoint"),e.isType(POSSIBLE_MOVE)?t.classList.add("possibleMove"):e.betweenHarmony&&(t.classList.add("betweenHarmony"),e.betweenHarmonyHost&&t.classList.add("bhHost"),e.betweenHarmonyGuest&&t.classList.add("bhGuest")),this.mobile?t.setAttribute("onclick","pointClicked(this); showPointMessage(this);"):(t.setAttribute("onclick","pointClicked(this);"),t.setAttribute("onmouseover","showPointMessage(this);"),t.setAttribute("onmouseout","clearMessage();"))),e.hasTile()){t.classList.add("hasTile");var o=document.createElement("img"),i=getSkudTilesSrcPath();o.src=i+e.tile.getImageName()+".png",e.tile.capturedTile&&t.classList.add("hasCapturedTile"),t.appendChild(o)}if(this.boardContainer.appendChild(t),e.betweenHarmony&&16===e.col){var n=document.createElement("div");n.classList.add("clear"),this.boardContainer.appendChild(n)}},StreetActuator.prototype.printBoard=function(e){debug("");var t=0;e.cells.forEach((function(e){var o=t+"\t: ";e.forEach((function(e){var t=e.getConsoleDisplay();t.length<3&&(o+=" "),o+=t,t.length<2&&(o+=" ")})),debug(o),t++})),debug("")},StreetBoard.prototype.brandNew=function(){var e=[];e[0]=this.newRow(9,[StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral()]),e[1]=this.newRow(11,[StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.gate(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral()]),e[2]=this.newRow(13,[StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.whiteNeutral(),StreetBoardPoint.redWhite(),StreetBoardPoint.redNeutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral()]),e[3]=this.newRow(15,[StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.whiteNeutral(),StreetBoardPoint.white(),StreetBoardPoint.redWhite(),StreetBoardPoint.red(),StreetBoardPoint.redNeutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral()]),e[4]=this.newRow(17,[StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.whiteNeutral(),StreetBoardPoint.white(),StreetBoardPoint.white(),StreetBoardPoint.redWhite(),StreetBoardPoint.red(),StreetBoardPoint.red(),StreetBoardPoint.redNeutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral()]),e[5]=this.newRow(17,[StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.whiteNeutral(),StreetBoardPoint.white(),StreetBoardPoint.white(),StreetBoardPoint.white(),StreetBoardPoint.redWhite(),StreetBoardPoint.red(),StreetBoardPoint.red(),StreetBoardPoint.red(),StreetBoardPoint.redNeutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral()]),e[6]=this.newRow(17,[StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.whiteNeutral(),StreetBoardPoint.white(),StreetBoardPoint.white(),StreetBoardPoint.white(),StreetBoardPoint.white(),StreetBoardPoint.redWhite(),StreetBoardPoint.red(),StreetBoardPoint.red(),StreetBoardPoint.red(),StreetBoardPoint.red(),StreetBoardPoint.redNeutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral()]),e[7]=this.newRow(17,[StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.whiteNeutral(),StreetBoardPoint.white(),StreetBoardPoint.white(),StreetBoardPoint.white(),StreetBoardPoint.white(),StreetBoardPoint.white(),StreetBoardPoint.redWhite(),StreetBoardPoint.red(),StreetBoardPoint.red(),StreetBoardPoint.red(),StreetBoardPoint.red(),StreetBoardPoint.red(),StreetBoardPoint.redNeutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral()]),e[8]=this.newRow(17,[StreetBoardPoint.gate(),StreetBoardPoint.redWhiteNeutral(),StreetBoardPoint.redWhite(),StreetBoardPoint.redWhite(),StreetBoardPoint.redWhite(),StreetBoardPoint.redWhite(),StreetBoardPoint.redWhite(),StreetBoardPoint.redWhite(),StreetBoardPoint.redWhite(),StreetBoardPoint.redWhite(),StreetBoardPoint.redWhite(),StreetBoardPoint.redWhite(),StreetBoardPoint.redWhite(),StreetBoardPoint.redWhite(),StreetBoardPoint.redWhite(),StreetBoardPoint.redWhiteNeutral(),StreetBoardPoint.gate()]),e[9]=this.newRow(17,[StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.redNeutral(),StreetBoardPoint.red(),StreetBoardPoint.red(),StreetBoardPoint.red(),StreetBoardPoint.red(),StreetBoardPoint.red(),StreetBoardPoint.redWhite(),StreetBoardPoint.white(),StreetBoardPoint.white(),StreetBoardPoint.white(),StreetBoardPoint.white(),StreetBoardPoint.white(),StreetBoardPoint.whiteNeutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral()]),e[10]=this.newRow(17,[StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.redNeutral(),StreetBoardPoint.red(),StreetBoardPoint.red(),StreetBoardPoint.red(),StreetBoardPoint.red(),StreetBoardPoint.redWhite(),StreetBoardPoint.white(),StreetBoardPoint.white(),StreetBoardPoint.white(),StreetBoardPoint.white(),StreetBoardPoint.whiteNeutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral()]),e[11]=this.newRow(17,[StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.redNeutral(),StreetBoardPoint.red(),StreetBoardPoint.red(),StreetBoardPoint.red(),StreetBoardPoint.redWhite(),StreetBoardPoint.white(),StreetBoardPoint.white(),StreetBoardPoint.white(),StreetBoardPoint.whiteNeutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral()]),e[12]=this.newRow(17,[StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.redNeutral(),StreetBoardPoint.red(),StreetBoardPoint.red(),StreetBoardPoint.redWhite(),StreetBoardPoint.white(),StreetBoardPoint.white(),StreetBoardPoint.whiteNeutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral()]),e[13]=this.newRow(15,[StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.redNeutral(),StreetBoardPoint.red(),StreetBoardPoint.redWhite(),StreetBoardPoint.white(),StreetBoardPoint.whiteNeutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral()]),e[14]=this.newRow(13,[StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.redNeutral(),StreetBoardPoint.redWhite(),StreetBoardPoint.whiteNeutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral()]),e[15]=this.newRow(11,[StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.gate(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral()]),e[16]=this.newRow(9,[StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral(),StreetBoardPoint.neutral()]);for(var t=0;t<e.length;t++)for(var o=0;o<e[t].length;o++)e[t][o].row=t,e[t][o].col=o;return e},StreetBoard.prototype.newRow=function(e,t){var o=[],i=(this.size.row-e)/2,n=new StreetBoardPoint;n.addType(NON_PLAYABLE);for(var a=0;a<this.size.row;a++)o[a]=a<i?n:a<i+e&&t?t[a-i]:n;return o},StreetBoard.prototype.placeTile=function(e,t){this.putTileOnPoint(e,t),this.analyzeHarmonies()},StreetBoard.prototype.putTileOnPoint=function(e,t){var o=t.rowAndColumn;(o=this.cells[o.row][o.col]).putTile(e)},StreetBoard.prototype.isValidRowCol=function(e){return e.row>=0&&e.col>=0&&e.row<=16&&e.col<=16},StreetBoard.prototype.pointIsOpenGate=function(e){var t=e.rowAndColumn;return(t=this.cells[t.row][t.col]).isOpenGate()},StreetBoard.prototype.moveTile=function(e,t,o){var i=t.rowAndColumn,n=o.rowAndColumn;if(i.row<0||i.row>16||n.row<0||n.row>16)return debug("That point does not exist. So it's not gonna happen."),!1;var a=this.cells[i.row][i.col],r=this.cells[n.row][n.col];if(!this.canMoveTileToPoint(e,a,r,!1))return debug("Bad move bears"),showBadMoveModal(),!1;var l=a.removeTile();if(l||debug("Error: No tile to move!"),gameOptionEnabled(RELEASE_CAPTIVE_TILES)&&l.capturedTile){var s=l.releaseCapturedTile();a.putTile(s)}return r.putTile(l)?(debug("Error moving tile. It probably didn't get moved."),!1):(this.analyzeHarmonies(),l)},StreetBoard.prototype.canCapture=function(e,t){var o=e.tile,i=t.tile;return o.ownerName!==i.ownerName&&(!(o.capturedTile&&!gameOptionEnabled(RELEASE_CAPTIVE_TILES))||void 0)},StreetBoard.prototype.canMoveTileToPoint=function(e,t,o,i){if(!t.hasTile())return!1;if(t.tile.ownerName!==e)return!1;if(!newKnotweedRules&&t.tile.drained)return!1;var n=!1;if(o.hasTile()&&(n=this.canCapture(t,o)),o.hasTile()&&!n)return!1;if(!o.canHoldTile(t.tile,n))return!1;var a=t.tile.getMoveDistance();return!(Math.abs(t.row-o.row)+Math.abs(t.col-o.col)>a)&&!!this.verifyAbleToReach(t,o,a,e,i)},StreetBoard.prototype.verifyAbleToReach=function(e,t,o,i,n){return this.pathFound(e,t,o,i,n)},StreetBoard.prototype.pathFound=function(e,t,o,i,n,a){if(!e||!t)return!1;if(this.debugCount++,e.isType(NON_PLAYABLE)||t.isType(NON_PLAYABLE))return!1;if(n&&(e.hasTile()||e.addType(POSSIBLE_MOVE),t.isType(POSSIBLE_MOVE)))return!0;if(e.row===t.row&&e.col===t.col)return!0;if(o<=0)return!1;if(1===Math.abs(e.row-t.row)+Math.abs(e.col-t.col))return!0;if("DOWN"!==a){var r=e.row-1;if(r>=0)if(!(l=this.cells[r][e.col]).hasEnemyTile(i)&&this.pathFound(l,t,o-1,i,n,"UP"))return!0}if("UP"!==a&&((r=e.row+1)<17&&!(l=this.cells[r][e.col]).hasEnemyTile(i)&&this.pathFound(l,t,o-1,i,n,"DOWN")))return!0;if("RIGHT"!==a){var l,s=e.col-1;if(s>=0)if(!(l=this.cells[e.row][s]).hasEnemyTile(i)&&this.pathFound(l,t,o-1,i,n,"LEFT"))return!0}if("LEFT"!==a&&((s=e.col+1)<17&&!(l=this.cells[e.row][s]).hasEnemyTile(i)&&this.pathFound(l,t,o-1,i,n,"RIGHT")))return!0},StreetBoard.prototype.markSpacesBetweenHarmonies=function(){this.cells.forEach((function(e){e.forEach((function(e){e.betweenHarmony=!1,e.betweenHarmonyHost=!1,e.betweenHarmonyGuest=!1}))}));var e=this;this.harmonyManager.harmonies.forEach((function(t){if(t.tile1Pos.row===t.tile2Pos.row){var o=t.tile1Pos.row,i=t.tile1Pos.col,n=t.tile2Pos.col;t.tile2Pos.col<t.tile1Pos.col&&(i=t.tile2Pos.col,n=t.tile1Pos.col);for(var a=i+1;a<n;a++)e.cells[o][a].betweenHarmony=!0,t.ownerName===GUEST?e.cells[o][a].betweenHarmonyGuest=!0:t.ownerName===HOST&&(e.cells[o][a].betweenHarmonyHost=!0)}else if(t.tile2Pos.col==t.tile2Pos.col){a=t.tile1Pos.col;var r=t.tile1Pos.row,l=t.tile2Pos.row;t.tile2Pos.row<t.tile1Pos.row&&(r=t.tile2Pos.row,l=t.tile1Pos.row);for(o=r+1;o<l;o++)e.cells[o][a].betweenHarmony=!0,t.ownerName===GUEST?e.cells[o][a].betweenHarmonyGuest=!0:t.ownerName===HOST&&(e.cells[o][a].betweenHarmonyHost=!0)}}))},StreetBoard.prototype.analyzeHarmonies=function(){this.harmonyManager.clearList();for(var e=0;e<this.cells.length;e++)for(var t=0;t<this.cells[e].length;t++){var o=this.cells[e][t];if(o.hasTile()){var i=this.getTileHarmonies(o.tile,new RowAndColumn(e,t));this.harmonyManager.addHarmonies(i),o.tile.inHarmony=i.length>0}}this.markSpacesBetweenHarmonies(),this.winners=[];var n=this,a=this.harmonyManager.harmonyRingExists();a.length>0&&a.forEach((function(e){n.winners.includes(e)||n.winners.push(e)}))},StreetBoard.prototype.pointsAreNotOnMidline=function(e,t){return 8!=e.row&&8!=e.col&&8!=t.row&&8!=t.col},StreetBoard.prototype.pointsCrossMidline=function(e,t){var o=new RowAndColumn(e.row,e.col).getNotationPoint(),i=new RowAndColumn(t.row,t.col).getNotationPoint();return o.x>0&&i.x<0||o.x<0&&i.x>0||o.y>0&&i.y<0||o.y<0&&i.y>0},StreetBoard.prototype.boardPointsFormHarmony=function(e,t){return e.tile&&t.tile&&this.pointsAreNotOnMidline(e,t)&&this.pointsCrossMidline(e,t)&&e.tile.formsHarmonyWith(t.tile)},StreetBoard.prototype.getTileHarmonies=function(e,t){var o=[];if(this.cells[t.row][t.col].isType(GATE))return o;var i=this.getHarmonyLeft(e,t);i&&o.push(i);var n=this.getHarmonyRight(e,t);n&&o.push(n);var a=this.getHarmonyUp(e,t);a&&o.push(a);var r=this.getHarmonyDown(e,t);return r&&o.push(r),o},StreetBoard.prototype.getHarmonyLeft=function(e,t){for(var o=t.col-1;o>=0&&!this.cells[t.row][o].hasTile();)o--;if(o>=0){var i=this.cells[t.row][o];if(!i.isType(GATE)&&this.boardPointsFormHarmony(i,this.cells[t.row][t.col]))return new StreetHarmony(e,t,i.tile,new RowAndColumn(t.row,o))}},StreetBoard.prototype.getHarmonyRight=function(e,t){for(var o=t.col+1;o<=16&&!this.cells[t.row][o].hasTile();)o++;if(o<=16){var i=this.cells[t.row][o];if(!i.isType(GATE)&&this.boardPointsFormHarmony(i,this.cells[t.row][t.col]))return new StreetHarmony(e,t,i.tile,new RowAndColumn(t.row,o))}},StreetBoard.prototype.getHarmonyUp=function(e,t){for(var o=t.row-1;o>=0&&!this.cells[o][t.col].hasTile();)o--;if(o>=0){var i=this.cells[o][t.col];if(!i.isType(GATE)&&this.boardPointsFormHarmony(i,this.cells[t.row][t.col]))return new StreetHarmony(e,t,i.tile,new RowAndColumn(o,t.col))}},StreetBoard.prototype.getHarmonyDown=function(e,t){for(var o=t.row+1;o<=16&&!this.cells[o][t.col].hasTile();)o++;if(o<=16){var i=this.cells[o][t.col];if(!i.isType(GATE)&&this.boardPointsFormHarmony(i,this.cells[t.row][t.col]))return new StreetHarmony(e,t,i.tile,new RowAndColumn(o,t.col))}},StreetBoard.prototype.setPossibleMovePoints=function(e){if(e.hasTile()){for(var t=e.tile.ownerName,o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++)!this.cells[o][i].isType(POSSIBLE_MOVE)&&this.canMoveTileToPoint(t,e,this.cells[o][i],!0)&&this.cells[o][i].addType(POSSIBLE_MOVE);debug(Number(this.debugCount).toLocaleString()+" movement checks"),this.debugCount=0}},StreetBoard.prototype.removePossibleMovePoints=function(){this.cells.forEach((function(e){e.forEach((function(e){e.removeType(POSSIBLE_MOVE)}))}))},StreetBoard.prototype.setOpenGatePossibleMoves=function(e){this.numTilesOnBoardForPlayer(e)<16&&(e===HOST?this.setHostGateOpen():this.setGuestGateOpen())},StreetBoard.prototype.setGuestGateOpen=function(){this.cells[15][8].isOpenGate()&&this.cells[15][8].addType(POSSIBLE_MOVE)},StreetBoard.prototype.setHostGateOpen=function(){this.cells[1][8].isOpenGate()&&this.cells[1][8].addType(POSSIBLE_MOVE)},StreetBoard.prototype.isHostGateOpen=function(){return this.cells[1][8].isOpenGate()},StreetBoard.prototype.isGuestGateOpen=function(){return this.cells[15][8].isOpenGate()},StreetBoard.prototype.revealPossiblePlacementPoints=function(e){this.cells.forEach((function(t){t.forEach((function(t){e.ownerName===HOST?this.setHostGateOpen():this.setGuestGateOpen()}))}))},StreetBoard.prototype.getCopy=function(){for(var e=new StreetBoard,t=0;t<this.cells.length;t++)for(var o=0;o<this.cells[t].length;o++)e.cells[t][o]=this.cells[t][o].getCopy();return e.analyzeHarmonies(),e},StreetBoard.prototype.aPlayerIsOutOfTilesWithoutOpenGate=function(){return 0!==this.numTilesOnBoardForPlayer(HOST)||this.isHostGateOpen()?0!==this.numTilesOnBoardForPlayer(GUEST)||this.isGuestGateOpen()?void 0:GUEST:HOST},StreetBoard.prototype.numTilesOnBoardForPlayer=function(e){for(var t=0,o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++){var n=this.cells[o][i];n.hasTile()&&n.tile.ownerName===e&&t++}return t};NON_PLAYABLE="Non-Playable",NEUTRAL="Neutral",GATE="Gate",POSSIBLE_MOVE="Possible Move",OPEN_GATE="OPEN GATE",thinDot="·",thickDot="•",whiteDot="◦",gateDot="⟡";function StreetBoardPoint(){this.types=[],this.row=-1,this.col=-1}function StreetController(e,t){this.actuator=new StreetActuator(e,t),this.initializeBoardSetupCodes(),this.resetGameManager(),this.resetNotationBuilder(),this.resetGameNotation(),this.hostAccentTiles=[],this.guestAccentTiles=[],this.isPaiShoGame=!0}function StreetGameManager(e,t,o){this.isCopy=o,this.actuator=e,this.tileManager=new StreetTileManager,this.setup(t),this.endGameWinners=[],this.potentialWinners=[]}function StreetNotationMove(e){this.fullMoveText=e,this.analyzeMove()}function StreetNotationBuilder(){this.moveType,this.plantedFlowerType,this.endPoint,this.startPoint,this.bonusTileCode,this.bonusEndPoint,this.boatBonusPoint,this.status=BRAND_NEW}function StreetGameNotation(){this.notationText="",this.moves=[]}function StreetHarmony(e,t,o,i){this.tile1=e,this.tile1Pos=new RowAndColumn(t.row,t.col),this.tile2=o,this.tile2Pos=new RowAndColumn(i.row,i.col),this.ownerCode=this.tile1.ownerCode,this.ownerName=this.tile1.ownerName}function StreetHarmonyManager(){this.harmonies=[]}function StreetTile(e){this.code="L",this.ownerCode=e,"G"===this.ownerCode?this.ownerName=GUEST:"H"===this.ownerCode?this.ownerName=HOST:debug("INCORRECT OWNER CODE"),this.id=tileId++,this.selectedFromPile=!1}function StreetTileManager(e){if(e)return this.hostTiles=this.loadOneOfEach("H"),void(this.guestTiles=this.loadOneOfEach("G"));this.hostTiles=this.loadTileSet("H"),this.guestTiles=this.loadTileSet("G")}function TrifleActuator(e,t){this.gameContainer=e,this.mobile=t;var o=setupPaiShoBoard(this.gameContainer,TrifleController.getHostTilesContainerDivs(),TrifleController.getGuestTilesContainerDivs(),!0);this.boardContainer=o.boardContainer,this.hostTilesContainer=o.hostTilesContainer,this.guestTilesContainer=o.guestTilesContainer}function TrifleBoard(){this.size=new RowAndColumn(17,17),this.cells=this.brandNew(),this.winners=[],this.tilePresenceAbilities=[],this.activeDurationAbilities=[],this.hostBannerPlayed=!1,this.guestBannerPlayed=!1}StreetBoardPoint.prototype.addType=function(e){this.types.includes(e)||this.types.push(e)},StreetBoardPoint.prototype.removeType=function(e){for(var t=0;t<this.types.length;t++)this.types[t]===e&&this.types.splice(t,1)},StreetBoardPoint.prototype.getConsoleDisplay=function(){if(this.tile)return this.tile.getConsoleDisplay();var e=thinDot;this.types.includes(NON_PLAYABLE)&&(e=" ");var t="";return this.types.includes(RED)&&(t="R",e=thickDot),this.types.includes(WHITE)&&(t+="W",e=whiteDot),this.types.includes(NEUTRAL)&&(t+="N"),this.types.includes(GATE)&&(t="G",e=gateDot),t.length>1&&(e="+"),e},StreetBoardPoint.prototype.putTile=function(e){this.tile&&e.captureTile(this.tile),this.tile=e},StreetBoardPoint.prototype.hasTile=function(){return!!this.tile},StreetBoardPoint.prototype.hasEnemyTile=function(e){return this.tile&&this.tile.ownerName!==e},StreetBoardPoint.prototype.isType=function(e){return this.types.includes(e)},StreetBoardPoint.prototype.isOpenGate=function(){return!this.hasTile()&&this.types.includes(GATE)},StreetBoardPoint.prototype.removeTile=function(){var e=this.tile;return this.tile=null,e},StreetBoardPoint.prototype.drainTile=function(){this.tile&&this.tile.drain()},StreetBoardPoint.prototype.restoreTile=function(){this.tile&&this.tile.restore()},StreetBoardPoint.prototype.canHoldTile=function(e,t){return!this.isType(NON_PLAYABLE)&&!(!t&&this.hasTile())},StreetBoardPoint.prototype.betweenPlayerHarmony=function(e){return e===GUEST?this.betweenHarmonyGuest:e===HOST&&this.betweenHarmonyHost},StreetBoardPoint.prototype.getCopy=function(){for(var e=new StreetBoardPoint,t=0;t<this.types.length;t++)e.types.push(this.types[t]);return e.row=this.row,e.col=this.col,this.hasTile()&&(e.tile=this.tile.getCopy()),e},StreetBoardPoint.neutral=function(){var e=new StreetBoardPoint;return e.addType(NEUTRAL),e},StreetBoardPoint.gate=function(){var e=new StreetBoardPoint;return e.addType(GATE),e},StreetBoardPoint.red=function(){var e=new StreetBoardPoint;return e.addType(RED),e},StreetBoardPoint.white=function(){var e=new StreetBoardPoint;return e.addType(WHITE),e},StreetBoardPoint.redWhite=function(){var e=new StreetBoardPoint;return e.addType(RED),e.addType(WHITE),e},StreetBoardPoint.redWhiteNeutral=function(){var e=new StreetBoardPoint;return e.addType(RED),e.addType(WHITE),e.addType(NEUTRAL),e},StreetBoardPoint.redNeutral=function(){var e=new StreetBoardPoint;return e.addType(RED),e.addType(NEUTRAL),e},StreetBoardPoint.whiteNeutral=function(){var e=new StreetBoardPoint;return e.addType(WHITE),e.addType(NEUTRAL),e},StreetController.prototype.initializeBoardSetupCodes=function(){gameOptionEnabled(ORIGINAL_BOARD_SETUP)?(this.hostBoardSetupCode=1,this.guestBoardSetupCode=1):(this.hostBoardSetupCode=2,this.guestBoardSetupCode=2)},StreetController.prototype.getGameTypeId=function(){return GameType.StreetPaiSho.id},StreetController.prototype.completeSetup=function(){this.addSetupForPlayerCode("H",this.hostBoardSetupCode),this.addSetupForPlayerCode("G",this.guestBoardSetupCode),rerunAll(),this.callActuate()},StreetController.prototype.addSetupForPlayerCode=function(e,t){var o="0"+e+"."+t;debug(o);var i=new StreetNotationMove(o);this.theGame.runNotationMove(i),this.gameNotation.addMove(i)},StreetController.prototype.resetGameManager=function(){this.theGame=new StreetGameManager(this.actuator)},StreetController.prototype.resetNotationBuilder=function(){this.notationBuilder=new StreetNotationBuilder},StreetController.prototype.resetGameNotation=function(){this.gameNotation=this.getNewGameNotation()},StreetController.prototype.getNewGameNotation=function(){return new StreetGameNotation},StreetController.getHostTilesContainerDivs=function(){return'<span class="HL streetTileContainer"></span>'},StreetController.getGuestTilesContainerDivs=function(){return'<span class="GL streetTileContainer"></span>'},StreetController.prototype.callActuate=function(){this.theGame.actuate()},StreetController.prototype.resetMove=function(){this.notationBuilder.status===BRAND_NEW&&this.gameNotation.removeLastMove(),rerunAll()},StreetController.prototype.getDefaultHelpMessageText=function(){return"<h4>Street Pai Sho</h4> <p>Street Pai Sho is meant to be a great game that is simple and easy to learn.</p><p>The goal is to form a Harmony across each <em>midline</em>, which are the lines from the center of the board to the edge of the board that divide each quadrant. Tiles can move up to 3 spaces and may move over friendly tiles but not opponent's tiles. Tiles capture by landing on an opponent's tile, but a tile that has a captured tile underneath it cannot capture again. Full rules coming soon. Enjoy!</p>"},StreetController.prototype.getAdditionalMessage=function(){var e="";return this.gameNotation.moves.length<=2&&(onlinePlayEnabled&&gameId<=0&&userIsLoggedIn()?e+="Click <em>Join Game</em> above to join another player's game. Or, you can start a game that other players can join by making a move. <br />":e+="Make the first move.",e+=getGameOptionsMessageHtml(GameType.StreetPaiSho.gameOptions)),e},StreetController.prototype.unplayedTileClicked=function(e){if((!this.theGame.getWinner()||this.notationBuilder.status===READY_FOR_BONUS)&&myTurn())if(currentMoveIndex===this.gameNotation.moves.length){var t=e.getAttribute("name"),o=parseInt(e.getAttribute("id")),i=t.charAt(0),n=t.substring(1),a=GUEST;"H"===i&&(a=HOST);var r=this.theGame.tileManager.peekTile(a,n,o);r.ownerName===getCurrentPlayer()&&(this.notationBuilder.status===BRAND_NEW?(r.selectedFromPile=!0,this.notationBuilder.moveType=PLANTING,this.notationBuilder.plantedFlowerType=n,this.notationBuilder.status=WAITING_FOR_ENDPOINT,this.theGame.revealOpenGates(getCurrentPlayer(),this.gameNotation.moves.length)):(this.theGame.hidePossibleMovePoints(),this.notationBuilder.status===WAITING_FOR_BONUS_ENDPOINT||this.notationBuilder.status===WAITING_FOR_BOAT_BONUS_POINT?(this.notationBuilder.status=READY_FOR_BONUS,this.showHarmonyBonusMessage()):this.notationBuilder=new StreetNotationBuilder))}else debug("Can only interact if all moves are played.")},StreetController.prototype.pointClicked=function(e){if((!this.theGame.getWinner()||this.notationBuilder.status===WAITING_FOR_BONUS_ENDPOINT||this.notationBuilder.status===WAITING_FOR_BOAT_BONUS_POINT)&&myTurn())if(currentMoveIndex===this.gameNotation.moves.length){var t=new NotationPoint(e.getAttribute("name")).rowAndColumn,o=this.theGame.board.cells[t.row][t.col];if(this.notationBuilder.status===BRAND_NEW){if(o.hasTile()){if(o.tile.ownerName!==getCurrentPlayer())return void debug("That's not your tile!");this.notationBuilder.status=WAITING_FOR_ENDPOINT,this.notationBuilder.moveType=ARRANGING,this.notationBuilder.startPoint=new NotationPoint(e.getAttribute("name")),this.theGame.revealPossibleMovePoints(o)}}else if(this.notationBuilder.status===WAITING_FOR_ENDPOINT)if(o.isType(POSSIBLE_MOVE)){this.theGame.hidePossibleMovePoints(),this.notationBuilder.endPoint=new NotationPoint(e.getAttribute("name"));var i=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.theGame.runNotationMove(i),this.gameNotation.addMove(i),onlinePlayEnabled&&3===this.gameNotation.moves.length?createGameIfThatIsOk(GameType.StreetPaiSho.id):playingOnlineGame()?callSubmitMove():finalizeMove()}else this.theGame.hidePossibleMovePoints(),this.notationBuilder=new StreetNotationBuilder;else if(this.notationBuilder.status===WAITING_FOR_BONUS_ENDPOINT)if(o.isType(POSSIBLE_MOVE))if(this.theGame.hidePossibleMovePoints(),this.notationBuilder.bonusEndPoint=new NotationPoint(e.getAttribute("name")),this.notationBuilder.bonusTileCode.endsWith("B")&&(boatOnlyMoves||o.tile.type!==ACCENT_TILE))this.notationBuilder.status=WAITING_FOR_BOAT_BONUS_POINT,this.theGame.revealBoatBonusPoints(o);else{i=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.gameNotation.addMove(i),playingOnlineGame()?callSubmitMove():finalizeMove()}else this.theGame.hidePossibleMovePoints(),this.notationBuilder.status=READY_FOR_BONUS;else if(this.notationBuilder.status===WAITING_FOR_BOAT_BONUS_POINT)if(o.isType(POSSIBLE_MOVE)){this.notationBuilder.status=MOVE_DONE,this.theGame.hidePossibleMovePoints(),this.notationBuilder.boatBonusPoint=new NotationPoint(e.getAttribute("name"));i=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.gameNotation.addMove(i),playingOnlineGame()?callSubmitMove():finalizeMove()}else this.theGame.hidePossibleMovePoints(),this.notationBuilder.status=READY_FOR_BONUS}else debug("Can only interact if all moves are played.")},StreetController.prototype.skipHarmonyBonus=function(){if(this.notationBuilder.status!==MOVE_DONE){this.notationBuilder.status=MOVE_DONE,this.notationBuilder.bonusEndPoint=null;var e=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.gameNotation.addMove(e),playingOnlineGame()?callSubmitMove():finalizeMove()}},StreetController.prototype.getTileMessage=function(e){var t=e.getAttribute("name"),o=(parseInt(e.getAttribute("id")),new StreetTile(t.charAt(0))),i=[];t.startsWith("G");var n=t.substring(1),a=StreetTile.getTileName(n);return i.push(o.ownerName+"'s tile"),{heading:a,message:i}},StreetController.prototype.getPointMessage=function(e){var t,o=new NotationPoint(e.getAttribute("name")).rowAndColumn,i=this.theGame.board.cells[o.row][o.col],n=[];if(i.hasTile()){t=i.tile.getName(),n.push("Number of captives: "+i.tile.getNumCaptivesInStack());var a=this.theGame.board.harmonyManager.getHarmoniesWithThisTile(i.tile);if(a.length>0){var r=[];a.forEach((function(e){var t=e.getTileThatIsNotThisOne(i.tile);r.push(t.getName()+" to the "+e.getDirectionForTile(i.tile))})),n.push("<strong>Currently in Harmony with: </strong>"+toBullets(r))}i.tile.drained&&n.push("Currently <em>drained</em> by a Knotweed."),i.tile.trapped&&n.push("Currently <em>trapped</em> by an Orchid.")}else i.isType(NEUTRAL)?n.push(getNeutralPointMessage()):i.isType(RED)&&i.isType(WHITE)?n.push(getRedWhitePointMessage()):i.isType(RED)?n.push(getRedPointMessage()):i.isType(WHITE)?n.push(getWhitePointMessage()):i.isType(GATE)&&n.push(getGatePointMessage());return{heading:t,message:n}},StreetController.prototype.playAiTurn=function(e){if(!this.theGame.getWinner()){var t=activeAi;activeAi2&&activeAi2.player===getCurrentPlayer()&&(t=activeAi2);var o=this.gameNotation.getPlayerMoveNum();if(1===o&&getCurrentPlayer()===HOST){var i=this.notationBuilder.getFirstMoveForHost(this.gameNotation.moves[this.gameNotation.moves.length-1].plantedFlowerType);this.gameNotation.addMove(this.gameNotation.getNotationMoveFromBuilder(i)),e()}else if(o<3){var n=t.getMove(this.theGame.getCopy(),o);if(!n)return void debug("No move given...");this.gameNotation.addMove(n),e()}else{var a=this;setTimeout((function(){var i=t.getMove(a.theGame.getCopy(),o);i?(a.gameNotation.addMove(i),e()):debug("No move given...")}),10)}}},StreetController.prototype.startAiGame=function(e){if(this.playAiTurn(e),1===this.gameNotation.getPlayerMoveNum()&&this.playAiTurn(e),1===this.gameNotation.getPlayerMoveNum()){var t=this.notationBuilder.getFirstMoveForHost(this.gameNotation.moves[this.gameNotation.moves.length-1].plantedFlowerType);this.gameNotation.addMove(this.gameNotation.getNotationMoveFromBuilder(t)),e()}2===this.gameNotation.getPlayerMoveNum()&&getCurrentPlayer()===GUEST&&this.playAiTurn(e)},StreetController.prototype.getAiList=function(){return[]},StreetController.prototype.getCurrentPlayer=function(){return this.gameNotation.moves.length%2==0?HOST:GUEST},StreetController.prototype.cleanup=function(){},StreetController.prototype.isSolitaire=function(){return!1},StreetController.prototype.setGameNotation=function(e){this.gameNotation.setNotationText(e)},StreetGameManager.prototype.setup=function(e){this.board=new StreetBoard,e||this.actuate()},StreetGameManager.prototype.actuate=function(){this.isCopy||this.actuator.actuate(this.board,this.tileManager)},StreetGameManager.prototype.runNotationMove=function(e,t){if(debug("Running Move: "+e.fullMoveText),e.moveType===PLANTING){if(!this.board.pointIsOpenGate(e.endPoint))return debug("Invalid planting point: "+e.endPoint.pointText),!1;var o=this.tileManager.grabTile(e.player,e.plantedFlowerType);this.board.placeTile(o,e.endPoint)}else if(e.moveType===ARRANGING)this.board.moveTile(e.player,e.startPoint,e.endPoint);else if(INITIAL_SETUP){var i=[];switch(e.boardSetupCode){case"1":e.player===HOST?(i.push(new NotationPoint("-7,0")),i.push(new NotationPoint("-6,5")),i.push(new NotationPoint("-4,3")),i.push(new NotationPoint("-2,5")),i.push(new NotationPoint("0,7")),i.push(new NotationPoint("2,5")),i.push(new NotationPoint("4,3")),i.push(new NotationPoint("6,5"))):e.player===GUEST&&(i.push(new NotationPoint("-6,-5")),i.push(new NotationPoint("-4,-3")),i.push(new NotationPoint("-2,-5")),i.push(new NotationPoint("0,-7")),i.push(new NotationPoint("2,-5")),i.push(new NotationPoint("4,-3")),i.push(new NotationPoint("6,-5")),i.push(new NotationPoint("7,0")));break;case"2":e.player===HOST?(i.push(new NotationPoint("0,3")),i.push(new NotationPoint("-6,5")),i.push(new NotationPoint("-4,3")),i.push(new NotationPoint("-2,5")),i.push(new NotationPoint("0,7")),i.push(new NotationPoint("2,5")),i.push(new NotationPoint("4,3")),i.push(new NotationPoint("6,5"))):e.player===GUEST&&(i.push(new NotationPoint("-6,-5")),i.push(new NotationPoint("-4,-3")),i.push(new NotationPoint("-2,-5")),i.push(new NotationPoint("0,-7")),i.push(new NotationPoint("2,-5")),i.push(new NotationPoint("4,-3")),i.push(new NotationPoint("6,-5")),i.push(new NotationPoint("0,-3")));break;default:debug("Unknown board setup code.")}var n=this;i.forEach((function(t){var o=n.tileManager.grabTile(e.player);n.board.placeTile(o,t)}))}if(t&&this.actuate(),this.endGameWinners=[],this.potentialWinners=[],0===this.board.winners.length){var a=this.board.aPlayerIsOutOfTilesWithoutOpenGate();a&&(debug("PLAYER OUT OF TILES: "+a),a===HOST?this.endGameWinners.push(GUEST):this.endGameWinners.push(HOST))}else if(this.board.winners.length>0)for(var r=0;r<this.board.winners.length;r++)this.potentialWinners.push(this.board.winners[r])},StreetGameManager.prototype.revealPossibleMovePoints=function(e,t){e.hasTile()&&(this.board.setPossibleMovePoints(e),t||this.actuate())},StreetGameManager.prototype.hidePossibleMovePoints=function(e){this.board.removePossibleMovePoints(),this.tileManager.removeSelectedTileFlags(),e||this.actuate()},StreetGameManager.prototype.revealOpenGates=function(e,t,o){this.board.setOpenGatePossibleMoves(e),o||this.actuate()},StreetGameManager.prototype.playerCanBonusPlant=function(e){return!newGatesRule||(lessBonus||limitedGatesRule?this.board.playerHasNoGrowingFlowers(e):newGatesRule?this.board.playerControlsLessThanTwoGates(e):void 0)},StreetGameManager.prototype.revealSpecialFlowerPlacementPoints=function(e){newSpecialFlowerRules?(this.board.revealSpecialFlowerPlacementPoints(e),this.actuate()):this.revealOpenGates(e)},StreetGameManager.prototype.revealPossiblePlacementPoints=function(e){this.board.revealPossiblePlacementPoints(e),this.actuate()},StreetGameManager.prototype.revealBoatBonusPoints=function(e){this.board.revealBoatBonusPoints(e),this.actuate()},StreetGameManager.prototype.aPlayerIsOutOfBasicFlowerTiles=function(){return this.tileManager.aPlayerIsOutOfBasicFlowerTiles()},StreetGameManager.prototype.playerHasNotPlayedEitherSpecialTile=function(e){return this.tileManager.playerHasBothSpecialTilesRemaining(e)},StreetGameManager.prototype.getWinner=function(){if(gameOptionEnabled(FORMAL_WIN_CONDITION)){if(this.potentialWinners.includes(HOST)&&getCurrentPlayer()===HOST)return HOST;if(this.potentialWinners.includes(GUEST)&&getCurrentPlayer()===GUEST)return GUEST}else{if(this.potentialWinners.length>1)return"TIE";if(1==this.potentialWinners.length)return this.potentialWinners[0]}},StreetGameManager.prototype.getWinReason=function(){return this.potentialWinners.length>0?" achieved Harmony across all midlines and won the game!":1===this.endGameWinners.length?" won the game by eliminating opponent's tiles.":void 0},StreetGameManager.prototype.getWinResultTypeCode=function(){return 1===this.board.winners.length?1:1===this.endGameWinners.length?this.tileManager.getPlayerWithMoreAccentTiles()?2:3:this.endGameWinners.length>1?4:void 0},StreetGameManager.prototype.getCopy=function(){var e=new StreetGameManager(this.actuator,!0,!0);return e.board=this.board.getCopy(),e.tileManager=this.tileManager.getCopy(),e},StreetNotationMove.prototype.analyzeMove=function(){this.valid=!0;var e=(i=this.fullMoveText.split("."))[0];this.moveNum=parseInt(e.slice(0,-1)),this.playerCode=e.charAt(e.length-1),"G"===this.playerCode?this.player=GUEST:"H"===this.playerCode&&(this.player=HOST);var t=i[1];if(t){var o=t.charAt(0);if(this.moveType="L"===o?PLANTING:"("===o?ARRANGING:INITIAL_SETUP,this.moveType===INITIAL_SETUP?this.boardSetupCode=t:this.moveType===PLANTING&&(this.plantedFlowerType=o,"("===t.charAt(1)||(debug("Failure to plant"),this.valid=!1),t.endsWith(")")?this.endPoint=new NotationPoint(t.substring(t.indexOf("(")+1,t.indexOf(")"))):this.valid=!1),this.moveType===ARRANGING){var i=t.substring(t.indexOf("(")+1).split(")-(");this.startPoint=new NotationPoint(i[0]),this.endPoint=new NotationPoint(i[1].substring(0,i[1].indexOf(")")))}}},StreetNotationMove.prototype.hasHarmonyBonus=function(){return void 0!==this.bonusTileCode},StreetNotationMove.prototype.isValidNotation=function(){return this.valid},StreetNotationMove.prototype.equals=function(e){return this.fullMoveText===e.fullMoveText},StreetNotationBuilder.prototype.getFirstMoveForHost=function(e){var t=new StreetNotationBuilder;return t.moveType=PLANTING,t.plantedFlowerType=StreetTile.getClashTileCode(e),(simpleCanonRules||sameStart)&&(t.plantedFlowerType=e),t.endPoint=new NotationPoint("0,8"),t},StreetNotationBuilder.prototype.getNotationMove=function(e,t){var o=e+t.charAt(0)+".";return this.moveType===ARRANGING?(o+="("+this.startPoint.pointText+")-("+this.endPoint.pointText+")",this.bonusTileCode&&this.bonusEndPoint&&(o+="+"+this.bonusTileCode+"("+this.bonusEndPoint.pointText+")",this.boatBonusPoint&&(o+="-("+this.boatBonusPoint.pointText+")"))):this.moveType===PLANTING&&(o+=this.plantedFlowerType+"("+this.endPoint.pointText+")"),new StreetNotationMove(o)},StreetGameNotation.prototype.setNotationText=function(e){this.notationText=e,this.loadMoves()},StreetGameNotation.prototype.addNotationLine=function(e){this.notationText+=";"+e.trim(),this.loadMoves()},StreetGameNotation.prototype.addMove=function(e){this.notationText?this.notationText+=";"+e.fullMoveText:this.notationText=e.fullMoveText,this.loadMoves()},StreetGameNotation.prototype.removeLastMove=function(){this.notationText=this.notationText.substring(0,this.notationText.lastIndexOf(";")),this.loadMoves()},StreetGameNotation.prototype.getPlayerMoveNum=function(){var e=0,t=this.moves[this.moves.length-1];return t&&(e=t.moveNum,t.player===GUEST&&e++),e},StreetGameNotation.prototype.getNotationMoveFromBuilder=function(e){var t=0,o=HOST,i=this.moves[this.moves.length-1];return i&&(t=i.moveNum,i.player===GUEST?t++:o=GUEST),e.getNotationMove(t,o)},StreetGameNotation.prototype.loadMoves=function(){this.moves=[];var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t=this,o=GUEST;e.forEach((function(e){var i=new StreetNotationMove(e);0===i.moveNum&&i.isValidNotation()?t.moves.push(i):i.isValidNotation()&&i.player!==o?(t.moves.push(i),o=i.player):debug("the player check is broken?")}))},StreetGameNotation.prototype.getNotationHtml=function(){var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t="";return e.forEach((function(e){t+=e+"<br />"})),t},StreetGameNotation.prototype.getNotationForEmail=function(){var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t="";return e.forEach((function(e){t+=e+"[BR]"})),t},StreetGameNotation.prototype.notationTextForUrl=function(){return this.notationText},StreetGameNotation.prototype.getLastMoveText=function(){return this.moves[this.moves.length-1].fullMoveText},StreetGameNotation.prototype.getLastMoveNumber=function(){return this.moves[this.moves.length-1].moveNum},StreetHarmony.prototype.equals=function(e){return!(this.ownerName!==e.ownerName||this.ownerCode!==e.ownerCode||this.tile1!==e.tile1&&this.tile1!==e.tile2||this.tile2!==e.tile1&&this.tile2!==e.tile2)},StreetHarmony.prototype.notAnyOfThese=function(e){for(var t=0;t<e.length;t++)if(this.equals(e[t]))return!1;return!0},StreetHarmony.prototype.containsTile=function(e){return this.tile1===e||this.tile2===e},StreetHarmony.prototype.getTileThatIsNotThisOne=function(e){return this.tile1===e?this.tile2:this.tile2===e?this.tile1:void debug("BOTH TILES ARE NOT THAT ONE!")},StreetHarmony.prototype.containsTilePos=function(e){return this.tile1Pos.samesies(e)||this.tile2Pos.samesies(e)},StreetHarmony.prototype.getPosThatIsNotThisOne=function(e){return this.tile1Pos.samesies(e)?this.tile2Pos:this.tile2Pos.samesies(e)?this.tile1Pos:void debug("\tBOTH TILE POS ARE NOT THAT ONE!")},StreetHarmony.prototype.getString=function(){return this.ownerName+" ("+this.tile1Pos.notationPointString+")-("+this.tile2Pos.notationPointString+")"},StreetHarmony.prototype.getDirectionForTile=function(e){if(this.containsTile(e)){var t=this.tile1Pos,o=this.tile2Pos;return this.tile2.id===e.id&&(t=this.tile2Pos,o=this.tile1Pos),t.row===o.row?t.col<o.col?"East":"West":t.col===o.col?t.row>o.row?"North":"South":void 0}},StreetHarmony.prototype.crossesCenter=function(){var e=this.tile1Pos.row,t=this.tile2Pos.row;if(this.tile1Pos.row<this.tile2Pos.row&&(e=this.tile2Pos.row,t=this.tile1Pos.row),e!==t)return e>8&&t<8;var o=this.tile1Pos.col,i=this.tile2Pos.col;return this.tile1Pos.col<this.tile2Pos.col&&(o=this.tile2Pos.col,i=this.tile1Pos.col),o!==i?o>8&&i<8:void 0},StreetHarmonyManager.prototype.printHarmonies=function(){debug("All Harmonies:");for(var e=0;e<this.harmonies.length;e++)debug(this.harmonies[e].getString())},StreetHarmonyManager.prototype.getHarmoniesWithThisTile=function(e){var t=[];return this.harmonies.forEach((function(o){o.containsTile(e)&&t.push(o)})),t},StreetHarmonyManager.prototype.addHarmony=function(e){for(var t=!1,o=0;o<this.harmonies.length;o++)e.equals(this.harmonies[o])&&(t=!0);t||this.harmonies.push(e)},StreetHarmonyManager.prototype.addHarmonies=function(e){if(e)for(var t=0;t<e.length;t++)this.addHarmony(e[t])},StreetHarmonyManager.prototype.clearList=function(){this.harmonies=[]},StreetHarmonyManager.prototype.numHarmoniesForPlayer=function(e){for(var t=0,o=0;o<this.harmonies.length;o++)this.harmonies[o].ownerName===e&&t++;return t},StreetHarmonyManager.prototype.getPlayerWithMostHarmonies=function(){var e=this.numHarmoniesForPlayer(HOST),t=this.numHarmoniesForPlayer(GUEST);return t>e?GUEST:e>t?HOST:void 0},StreetHarmonyManager.prototype.getNumCrossingCenterForPlayer=function(e){for(var t=0,o=0;o<this.harmonies.length;o++)this.harmonies[o].ownerName===e&&this.harmonies[o].crossesCenter()&&t++;return t},StreetHarmonyManager.prototype.ringLengthForPlayer=function(e){for(var t=this.getHarmonyChains(),o=0,i=0;i<t.length;i++){var n=t[i];if(n.pop().ownerName===e){n.length>o&&(o=n.length)}}return o},StreetHarmonyManager.prototype.getPlayerWithLongestChain=function(){var e=this.ringLengthForPlayer(HOST),t=this.ringLengthForPlayer(GUEST);return t>e?GUEST:e>t?HOST:void 0},StreetHarmonyManager.prototype.hasNewHarmony=function(e,t){for(var o=[],i=0;i<this.harmonies.length;i++)if(this.harmonies[i].ownerName===e){for(var n=!1,a=0;a<t.length;a++)this.harmonies[i].equals(t[a])&&(n=!0);n||o.push(this.harmonies[i])}return o.length>0},StreetHarmonyManager.prototype.getHarmonyChains=function(){for(var e=this,t=[],o=0;o<this.harmonies.length;o++){var i=this.harmonies[o],n=[];n.push(i);var a=i.tile2,r=(i.tile2Pos,i.tile1),l=(i.tile1Pos,this.lookForRing(a,r,n));if(l[0]){var s=!1;t.forEach((function(t){e.ringsMatch(t,l[1])&&(s=!0)})),s||t.push(l[1])}}return t},StreetHarmonyManager.prototype.checkHarmoniesAcrossAllMidlinesForPlayer=function(e){for(var t=!1,o=!1,i=!1,n=!1,a=0;a<this.harmonies.length;a++){var r=this.harmonies[a];if(r.ownerName===e){r.tile1;var l=r.tile1Pos.getNotationPoint(),s=(r.tile2,r.tile2Pos.getNotationPoint());l.x<0&&s.x===l.x&&(n=!0),l.x>0&&s.x===l.x&&(o=!0),l.y<0&&s.y===l.y&&(i=!0),l.y>0&&s.y===l.y&&(t=!0)}}return t&&o&&i&&n},StreetHarmonyManager.prototype.harmonyRingExists=function(){var e=[];return this.checkHarmoniesAcrossAllMidlinesForPlayer(HOST)&&e.push(HOST),this.checkHarmoniesAcrossAllMidlinesForPlayer(GUEST)&&e.push(GUEST),e},StreetHarmonyManager.prototype.verifyHarmonyRing=function(e){if(completeHarmony&&!this.ringContains345(e))return!1;var t=[],o=e.pop(),i=o.ownerName;t.push(new NotationPoint(o.tile1Pos.notationPointString).toArr()),t.push(new NotationPoint(o.tile2Pos.notationPointString).toArr());for(var n=o.tile2Pos,a=0;e.length>0&&a<400;){for(var r=0;r<e.length;r++)if((o=e[r]).containsTilePos(n)){var l=new NotationPoint((n=o.getPosThatIsNotThisOne(n)).notationPointString);l.samesies(new NotationPoint(t[0][0]+","+t[0][1]))||t.push(l.toArr()),e.splice(r,1)}a++}return a>390?(debug("THERE WAS A PROBLEM CONNECTING THE DOTS"),!1):!!this.isCenterInsideShape(t)&&i},StreetHarmonyManager.prototype.ringsMatch=function(e,t){if(e.length!==t.length)return!1;var o=!1;return e.forEach((function(e){if(o=!1,t.forEach((function(t){e.equals(t)&&(o=!0)})),!o)return!1})),o},StreetHarmonyManager.prototype.lookForRing=function(e,t,o){for(var i=0;i<this.harmonies.length;i++){var n=this.harmonies[i];if(n.containsTile(e)&&n.notAnyOfThese(o)){if(o.push(n),n.containsTile(t))return[!0,o];var a=n.getTileThatIsNotThisOne(e);return this.lookForRing(a,t,o)}}return[!1]},StreetTile.baseMoveDistance=4,StreetTile.prototype.getConsoleDisplay=function(){return this.ownerCode+""+this.code},StreetTile.prototype.getImageName=function(){return this.ownerCode+""+this.code},StreetTile.prototype.getMoveDistance=function(){if(this.capturedTile){if(gameOptionEnabled(BONUS_MOVEMENT_BASED_ON_NUM_CAPTIVES))return StreetTile.baseMoveDistance+this.getNumCaptivesInStack();if(gameOptionEnabled(BONUS_MOVEMENT_5))return 5}return StreetTile.baseMoveDistance},StreetTile.prototype.getNumCaptivesInStack=function(){return this.capturedTile?this.capturedTile.getNumCaptivesInStack()+1:0},StreetTile.prototype.formsHarmonyWith=function(e){return e.ownerName===this.ownerName},StreetTile.prototype.captureTile=function(e){this.capturedTile&&debug("Error - already has captured tile"),this.capturedTile=e},StreetTile.prototype.releaseCapturedTile=function(){var e=this.capturedTile;return this.capturedTile=null,e},StreetTile.prototype.getName=function(){return StreetTile.getTileName(this.code)},StreetTile.getTileName=function(e){return"Tile"},StreetTile.prototype.getCopy=function(){return new StreetTile(this.ownerCode)},StreetTileManager.prototype.loadTileSet=function(e){return this.loadStreetSet(e)},StreetTileManager.prototype.loadStreetSet=function(e){for(var t=[],o=0;o<22;o++)t.push(new StreetTile(e));return t},StreetTileManager.prototype.loadOneOfEach=function(e){var t=[];return t.push(new StreetTile(e)),t},StreetTileManager.prototype.grabTile=function(e){var t,o=this.hostTiles;e===GUEST&&(o=this.guestTiles);for(var i=0;i<o.length;i++){newTileArr=o.splice(i,1),t=newTileArr[0];break}return t||debug("NONE OF THAT TILE FOUND"),t},StreetTileManager.prototype.peekTile=function(e,t,o){var i,n=this.hostTiles;if(e===GUEST&&(n=this.guestTiles),o)for(var a=0;a<n.length;a++)if(n[a].id===o)return n[a];for(a=0;a<n.length;a++)if(n[a].code===t){i=n[a];break}return i||debug("NONE OF THAT TILE FOUND"),i},StreetTileManager.prototype.removeSelectedTileFlags=function(){this.hostTiles.forEach((function(e){e.selectedFromPile=!1})),this.guestTiles.forEach((function(e){e.selectedFromPile=!1}))},StreetTileManager.prototype.unselectTiles=function(e){var t=this.hostTiles;e===GUEST&&(t=this.guestTiles),t.forEach((function(e){e.selectedFromPile=!1}))},StreetTileManager.prototype.putTileBack=function(e){var t=e.ownerName,o=this.hostTiles;t===GUEST&&(o=this.guestTiles),o.push(e)},StreetTileManager.prototype.aPlayerIsOutOfTiles=function(){return 0===this.guestTiles.length?GUEST:0===this.hostTiles.length?HOST:void 0},StreetTileManager.prototype.getCopy=function(){var e=new StreetTileManager;return e.hostTiles=this.copyArr(this.hostTiles),e.guestTiles=this.copyArr(this.guestTiles),e},StreetTileManager.prototype.copyArr=function(e){for(var t=[],o=0;o<e.length;o++)t.push(e[o].getCopy());return t},TrifleActuator.imagePath="images/Trifle/standard/",TrifleActuator.hostTeamTilesDivId="hostTilesContainer",TrifleActuator.guestTeamTilesDivId="guestTilesContainer",TrifleActuator.prototype.actuate=function(e,t){var o=this;window.requestAnimationFrame((function(){o.htmlify(e,t)}))},TrifleActuator.prototype.htmlify=function(e,t){this.clearContainer(this.boardContainer);var o=this;e.cells.forEach((function(e){e.forEach((function(e){e&&o.addBoardPoint(e)}))})),o.clearContainerWithId(TrifleActuator.hostTeamTilesDivId),o.clearContainerWithId(TrifleActuator.guestTeamTilesDivId),t.hostTiles.forEach((function(e){o.addTeamTile(e,HOST)})),t.guestTiles.forEach((function(e){o.addTeamTile(e,GUEST)})),t.hostTeamIsFull()||(this.addLineBreakInTilePile(HOST),this.addLineBreakInTilePile(HOST),Object.keys(TrifleTileCodes).forEach((function(e,t){o.addTeamTile(new TrifleTile(TrifleTileCodes[e],hostPlayerCode),HOST,!0)}))),t.guestTeamIsFull()||(this.addLineBreakInTilePile(GUEST),this.addLineBreakInTilePile(GUEST),Object.keys(TrifleTileCodes).forEach((function(e,t){o.addTeamTile(new TrifleTile(TrifleTileCodes[e],guestPlayerCode),GUEST,!0)})))},TrifleActuator.prototype.clearContainer=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},TrifleActuator.prototype.clearContainerWithId=function(e){var t=document.getElementById(e);t&&this.clearContainer(t)},TrifleActuator.prototype.addLineBreakInTilePile=function(e){var t=e===HOST?TrifleActuator.hostTeamTilesDivId:TrifleActuator.guestTeamTilesDivId,o=document.getElementById(t),i=document.createElement("br");i.classList.add("clear"),o.appendChild(i)},TrifleActuator.prototype.addTeamTile=function(e,t,o){var i=t===HOST?TrifleActuator.hostTeamTilesDivId:TrifleActuator.guestTeamTilesDivId,n=document.getElementById(i),a=document.createElement("div");a.classList.add("point"),a.classList.add("hasTile"),o?a.classList.add("selectedFromPile"):e.selectedFromPile&&(a.classList.add("selectedFromPile"),a.classList.add("drained"));var r=document.createElement("img"),l=TrifleActuator.imagePath;r.src=l+e.getImageName()+".png",a.appendChild(r),a.setAttribute("name",e.getImageName()),a.setAttribute("id",e.id),this.mobile?a.setAttribute("onclick","unplayedTileClicked(this); showTileMessage(this);"):(a.setAttribute("onclick","unplayedTileClicked(this);"),a.setAttribute("onmouseover","showTileMessage(this);"),a.setAttribute("onmouseout","clearMessage();")),n.appendChild(a)},TrifleActuator.prototype.addBoardPoint=function(e){var t=createBoardPointDiv(e);if(e.isType(NON_PLAYABLE)||(t.classList.add("activePoint"),t.classList.add("vagabondPointRotate"),e.isType(POSSIBLE_MOVE)&&t.classList.add("possibleMove"),this.mobile?t.setAttribute("onclick","pointClicked(this); showPointMessage(this);"):(t.setAttribute("onclick","pointClicked(this);"),t.setAttribute("onmouseover","showPointMessage(this);"),t.setAttribute("onmouseout","clearMessage();"))),e.hasTile()){t.classList.add("hasTile");var o=document.createElement("img"),i=TrifleActuator.imagePath;o.src=i+e.tile.getImageName()+".png",e.tile.inHarmony&&t.classList.add(e.tile.ownerName+"harmony"),(e.tile.drained||e.tile.trapped)&&t.classList.add("drained"),t.appendChild(o)}if(this.boardContainer.appendChild(t),e.betweenHarmony&&16===e.col){var n=document.createElement("div");n.classList.add("clear"),this.boardContainer.appendChild(n)}},TrifleActuator.prototype.printBoard=function(e){debug("");var t=0;e.cells.forEach((function(e){var o=t+"\t: ";e.forEach((function(e){var t=e.getConsoleDisplay();t.length<3&&(o+=" "),o+=t,t.length<2&&(o+=" ")})),debug(o),t++})),debug("")},TrifleBoard.prototype.brandNew=function(){var e=[];e[0]=this.newRow(9,[TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.gate(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral()]),e[1]=this.newRow(11,[TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.redWhiteNeutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral()]),e[2]=this.newRow(13,[TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.whiteNeutral(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.redNeutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral()]),e[3]=this.newRow(15,[TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.whiteNeutral(),TrifleBoardPoint.white(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.red(),TrifleBoardPoint.redNeutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral()]),e[4]=this.newRow(17,[TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.whiteNeutral(),TrifleBoardPoint.white(),TrifleBoardPoint.white(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.red(),TrifleBoardPoint.red(),TrifleBoardPoint.redNeutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral()]),e[5]=this.newRow(17,[TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.whiteNeutral(),TrifleBoardPoint.white(),TrifleBoardPoint.white(),TrifleBoardPoint.white(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.red(),TrifleBoardPoint.red(),TrifleBoardPoint.red(),TrifleBoardPoint.redNeutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral()]),e[6]=this.newRow(17,[TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.whiteNeutral(),TrifleBoardPoint.white(),TrifleBoardPoint.white(),TrifleBoardPoint.white(),TrifleBoardPoint.white(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.red(),TrifleBoardPoint.red(),TrifleBoardPoint.red(),TrifleBoardPoint.red(),TrifleBoardPoint.redNeutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral()]),e[7]=this.newRow(17,[TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.whiteNeutral(),TrifleBoardPoint.white(),TrifleBoardPoint.white(),TrifleBoardPoint.white(),TrifleBoardPoint.white(),TrifleBoardPoint.white(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.red(),TrifleBoardPoint.red(),TrifleBoardPoint.red(),TrifleBoardPoint.red(),TrifleBoardPoint.red(),TrifleBoardPoint.redNeutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral()]),e[8]=this.newRow(17,[TrifleBoardPoint.gate(),TrifleBoardPoint.redWhiteNeutral(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.redWhiteNeutral(),TrifleBoardPoint.gate()]),e[9]=this.newRow(17,[TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.redNeutral(),TrifleBoardPoint.red(),TrifleBoardPoint.red(),TrifleBoardPoint.red(),TrifleBoardPoint.red(),TrifleBoardPoint.red(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.white(),TrifleBoardPoint.white(),TrifleBoardPoint.white(),TrifleBoardPoint.white(),TrifleBoardPoint.white(),TrifleBoardPoint.whiteNeutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral()]),e[10]=this.newRow(17,[TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.redNeutral(),TrifleBoardPoint.red(),TrifleBoardPoint.red(),TrifleBoardPoint.red(),TrifleBoardPoint.red(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.white(),TrifleBoardPoint.white(),TrifleBoardPoint.white(),TrifleBoardPoint.white(),TrifleBoardPoint.whiteNeutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral()]),e[11]=this.newRow(17,[TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.redNeutral(),TrifleBoardPoint.red(),TrifleBoardPoint.red(),TrifleBoardPoint.red(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.white(),TrifleBoardPoint.white(),TrifleBoardPoint.white(),TrifleBoardPoint.whiteNeutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral()]),e[12]=this.newRow(17,[TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.redNeutral(),TrifleBoardPoint.red(),TrifleBoardPoint.red(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.white(),TrifleBoardPoint.white(),TrifleBoardPoint.whiteNeutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral()]),e[13]=this.newRow(15,[TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.redNeutral(),TrifleBoardPoint.red(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.white(),TrifleBoardPoint.whiteNeutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral()]),e[14]=this.newRow(13,[TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.redNeutral(),TrifleBoardPoint.redWhite(),TrifleBoardPoint.whiteNeutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral()]),e[15]=this.newRow(11,[TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.redWhiteNeutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral()]),e[16]=this.newRow(9,[TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.gate(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral(),TrifleBoardPoint.neutral()]);for(var t=0;t<e.length;t++)for(var o=0;o<e[t].length;o++)e[t][o].row=t,e[t][o].col=o;return e},TrifleBoard.prototype.newRow=function(e,t){var o=[],i=(this.size.row-e)/2,n=new TrifleBoardPoint;n.addType(NON_PLAYABLE);for(var a=0;a<this.size.row;a++)o[a]=a<i?n:a<i+e&&t?t[a-i]:n;return o},TrifleBoard.prototype.placeTile=function(e,t){this.tilesCapturedByTriggeredAbility=[],this.putTileOnPoint(e,t),TrifleTileInfo.tileIsBanner(TrifleTiles[e.code])&&(e.ownerName===HOST?this.hostBannerPlayed=!0:this.guestBannerPlayed=!0);var o=TrifleTiles[e.code],i=this.getPointFromNotationPoint(t);i.hasTile()&&i.tile.code===e.code&&this.applyZoneAbilityToTile(i),this.applyBoardScanAbilities(),this.applyWhenLandsTriggers(e,o,i,[])},TrifleBoard.prototype.setTilePresenceAbilitiesForPlayer=function(e,t,o){if(o&&o.abilities){var i=this;o.abilities.forEach((function(n){i.abilityIsActive(e,e.tile,o,n)&&i.tilePresenceAbilities.push({playerName:t,abilityInfo:n})}))}},TrifleBoard.prototype.abilityIsActive=function(e,t,o,i){var n=!0,a=this;return this.forEachBoardPointWithTile((function(i){var r=TrifleTiles[i.tile.code],l=TrifleTileInfo.getTerritorialZone(r);l&&l.abilities&&l.abilities.forEach((function(r){r.type===ZoneAbility.removesTileAbilities&&(r.targetTeams.includes(TileTeam.friendly)&&t.ownerCode===i.tile.ownerCode||r.targetTeams.includes(TileTeam.enemy)&&t.ownerCode!==i.tile.ownerCode)&&(r.targetTileTypes&&(arrayIncludesOneOf(r.targetTileTypes,o.types)||r.targetTileTypes.includes(TileCategory.allTileTypes))||r.targetTileCodes&&r.targetTileCodes.includes(t.code))&&a.pointTileZoneContainsPoint(i,e)&&(n=!1,debug("Ability disabled for tile: "+t.code+" by tile: "+i.tile.code))}))})),i.triggeringBoardState&&(n=!1,i.triggeringBoardState),n},TrifleBoard.prototype.applyZoneAbilityToTile=function(e){var t=TrifleTiles[e.tile.code],o=e.tile;zone=TrifleTileInfo.getTerritorialZone(t),zone&&(o.activeZone={size:zone.size},zone.abilities&&zone.abilities.forEach((function(t){t.type===ZoneAbility.canceledWhenInTemple&&(o.activeZone.canceled=e.isType(TEMPLE))})))},TrifleBoard.prototype.applyBoardScanAbilities=function(){var e=this;this.forEachBoardPoint((function(e){e.hasTile()&&(e.tile.protected=!1)})),this.tilePresenceAbilities=[],this.forEachBoardPointWithTile((function(t){var o=TrifleTiles[t.tile.code];e.setTilePresenceAbilitiesForPlayer(t,t.tile.ownerName,o),e.applyZoneProtectionAbilityForBoardPoint(t)}))},TrifleBoard.prototype.applyZoneProtectionAbilityForBoardPoint=function(e){var t=TrifleTiles[e.tile.code],o=TrifleTileInfo.getTerritorialZone(t);if(o&&o.abilities){var i=this;o.abilities.forEach((function(n){i.abilityIsActive(e,e.tile,t,n)&&n.type===ZoneAbility.protectFriendlyTilesFromCapture&&i.applyProtectFriendlyTilesFromCaptureAbility(e,o,n)}))}},TrifleBoard.prototype.applyProtectFriendlyTilesFromCaptureAbility=function(e,t,o){var i=this;o&&o.targetTileTypes&&this.forEachBoardPoint((function(n){if(n.hasTile()&&n.tile.ownerName===e.tile.ownerName){var a=TrifleTiles[n.tile.code];if(TrifleTileInfo.tileIsOneOfTheseTypes(a,o.targetTileTypes))i.getDistanceBetweenPoints(e,n)<=t.size&&i.isEffectActive(n,a,e,o)&&(n.tile.protected=!0,debug("I protected tile: "+n.tile))}}))},TrifleBoard.prototype.isEffectActive=function(e,t,o,i){var n=!0,a=this;return this.forEachBoardPointWithTile((function(r){r.tile;var l=TrifleTiles[r.tile.code];n=n&&!a.effectIsDisabledByRemoveEffectsAbility(e,t,o,i,r,l)})),n},TrifleBoard.prototype.effectIsDisabledByRemoveEffectsAbility=function(e,t,o,i,n,a){var r=!1,l=this;return a.abilities&&a.abilities.length>0&&a.abilities.forEach((function(t){t.type===Ability.removeEffects&&t.targetEffectTypes&&arrayIncludesOneOf(t.targetEffectTypes,AbilityTypes[i.type])&&t.triggeringBoardState&&t.triggeringBoardState===AbilityTrigger.whileTileInLineOfSight&&l.targetPointIsInLineOfSightOfThesePoints(e,[n])&&(r=!0,debug(n.tile.code+" has disabled effect granted by "+o.tile.code))})),r},TrifleBoard.prototype.getDistanceBetweenPoints=function(e,t){return Math.abs(e.row-t.row)+Math.abs(e.col-t.col)},TrifleBoard.prototype.putTileOnPoint=function(e,t){var o=t.rowAndColumn;(o=this.cells[o.row][o.col]).putTile(e)},TrifleBoard.prototype.getPointFromNotationPoint=function(e){var t=e.rowAndColumn;return this.cells[t.row][t.col]},TrifleBoard.prototype.getSurroundingRowAndCols=function(e){for(var t=[],o=e.row-1;o<=e.row+1;o++)for(var i=e.col-1;i<=e.col+1;i++){if((o!==e.row||i!==e.col)&&o>=0&&i>=0&&o<17&&i<17)this.cells[o][i].isType(NON_PLAYABLE)||t.push(new RowAndColumn(o,i))}return t},TrifleBoard.prototype.getSurroundingBoardPoints=function(e){for(var t=[],o=e.row-1;o<=e.row+1;o++)for(var i=e.col-1;i<=e.col+1;i++)if((o!==e.row||i!==e.col)&&o>=0&&i>=0&&o<17&&i<17){var n=this.cells[o][i];n.isType(NON_PLAYABLE)||t.push(n)}return t},TrifleBoard.prototype.getAdjacentRowAndCols=function(e){var t,o=[];e.row>0&&((t=this.cells[e.row-1][e.col]).isType(NON_PLAYABLE)||o.push(t));e.row<paiShoBoardMaxRowOrCol&&((t=this.cells[e.row+1][e.col]).isType(NON_PLAYABLE)||o.push(t));e.col>0&&((t=this.cells[e.row][e.col-1]).isType(NON_PLAYABLE)||o.push(t));e.col<paiShoBoardMaxRowOrCol&&((t=this.cells[e.row][e.col+1]).isType(NON_PLAYABLE)||o.push(t));return o},TrifleBoard.prototype.getAdjacentPoints=function(e){return this.getAdjacentRowAndCols(e)},TrifleBoard.prototype.getAdjacentPointsPotentialPossibleMoves=function(e,t,o,i){var n=[];e||(e=t);var a=t.row-e.row,r=t.col-e.col;e.row>0&&n.push(this.cells[e.row-1][e.col]),e.row<paiShoBoardMaxRowOrCol&&n.push(this.cells[e.row+1][e.col]),e.col>0&&n.push(this.cells[e.row][e.col-1]),e.col<paiShoBoardMaxRowOrCol&&n.push(this.cells[e.row][e.col+1]);var l=[];return n.forEach((function(e){if(!e.isType(NON_PLAYABLE)&&!e.isPossibleForMovementType(i)){var n=t.row-e.row,s=t.col-e.col;(!o||a>=0&&n>=0&&0===s||a<=0&&n<=0&&0===s||r>=0&&s>=0&&0===n||r<=0&&s<=0&&0===n)&&l.push(e)}})),l},TrifleBoard.prototype.getAdjacentDiagonalPointsPotentialPossibleMoves=function(e,t,o,i){var n=[];e||(e=t);var a,r=t.row-e.row,l=t.col-e.col;(!o||o&&r>=0&&l>=0)&&e.row>0&&e.col>0&&((a=this.cells[e.row-1][e.col-1]).isType(NON_PLAYABLE)||a.isPossibleForMovementType(i)||n.push(a));(!o||o&&r<=0&&l<=0)&&e.row<paiShoBoardMaxRowOrCol&&e.col<paiShoBoardMaxRowOrCol&&((a=this.cells[e.row+1][e.col+1]).isType(NON_PLAYABLE)||a.isPossibleForMovementType(i)||n.push(a));(!o||o&&l>=0&&r<=0)&&e.col>0&&e.row<paiShoBoardMaxRowOrCol&&((a=this.cells[e.row+1][e.col-1]).isType(NON_PLAYABLE)||a.isPossibleForMovementType(i)||n.push(a));(!o||o&&l<=0&&r>=0)&&e.col<paiShoBoardMaxRowOrCol&&e.row>0&&((a=this.cells[e.row-1][e.col+1]).isType(NON_PLAYABLE)||a.isPossibleForMovementType(i)||n.push(a));return n},TrifleBoard.prototype.calculateSlopeBetweenPoints=function(e,t){var o=t.row-e.row,i=t.col-e.col;return 0===i?0:o/i},TrifleBoard.prototype.getNextPointsForTravelShapeMovement=function(e,t,o,i,n,a){var r=[];if(e.shape&&e.shape.length>0){var l=e.shape[t];if(0===t)l===MoveDirection.any&&(r=this.getAdjacentPoints(i));else{var s=this.getDirectionalMovements(n);!s[MoveDirection.left]||l!==MoveDirection.left&&l!==MoveDirection.turn||r.push(s[MoveDirection.left]),!s[MoveDirection.right]||l!==MoveDirection.right&&l!==MoveDirection.turn||r.push(s[MoveDirection.right]),s[MoveDirection.straight]&&l===MoveDirection.straight&&r.push(s[MoveDirection.straight])}}return r},TrifleBoard.prototype.getDirectionalMovements=function(e){var t={};if(e.length>1){var o=e[e.length-2],i=e[e.length-1];i.col>o.col?(i.row-1>=0&&(t[MoveDirection.left]=this.cells[i.row-1][i.col]),i.row+1<=paiShoBoardMaxRowOrCol&&(t[MoveDirection.right]=this.cells[i.row+1][i.col]),i.col+1<=paiShoBoardMaxRowOrCol&&(t[MoveDirection.straight]=this.cells[i.row][i.col+1])):i.col<o.col?(i.row+1<=paiShoBoardMaxRowOrCol&&(t[MoveDirection.left]=this.cells[i.row+1][i.col]),i.row-1>=0&&(t[MoveDirection.right]=this.cells[i.row-1][i.col]),i.col-1>=0&&(t[MoveDirection.straight]=this.cells[i.row][i.col-1])):i.row>o.row?(i.col+1<=paiShoBoardMaxRowOrCol&&(t[MoveDirection.left]=this.cells[i.row][i.col+1]),i.col-1>=0&&(t[MoveDirection.right]=this.cells[i.row][i.col-1]),i.row+1<=paiShoBoardMaxRowOrCol&&(t[MoveDirection.straight]=this.cells[i.row+1][i.col])):i.row<o.row&&(i.col-1>=0&&(t[MoveDirection.left]=this.cells[i.row][i.col-1]),i.col+1<=paiShoBoardMaxRowOrCol&&(t[MoveDirection.right]=this.cells[i.row][i.col+1]),i.row-1>=0&&(t[MoveDirection.straight]=this.cells[i.row-1][i.col]))}return t},TrifleBoard.prototype.getNextPointsForJumpShapeMovement=function(e,t,o,i){var n=[],a=[],r=[],l=this.calculateSlopeBetweenPoints(t,o);if(e.shape&&e.shape.length>0){for(var s=0;s<e.shape.length;s++){var h=e.shape[s];0===s?(n=this.getPointsWithMoveStepAppliedToRow([o],h),a=this.getPointsWithMoveStepAppliedToCol([o],h)):s%2==1?(n=this.getPointsWithMoveStepAppliedToCol(n,h),a=this.getPointsWithMoveStepAppliedToRow(a,h)):s%2==0&&(n=this.getPointsWithMoveStepAppliedToRow(n,h),a=this.getPointsWithMoveStepAppliedToCol(a,h))}var d=n.concat(a),u=this,p=i&&0!==l;d.forEach((function(t){t.isType(NON_PLAYABLE)||t.isPossibleForMovementType(e)||p&&u.calculateSlopeBetweenPoints(o,t)!==l||r.push(t)}))}return r},TrifleBoard.prototype.getPointsWithMoveStepAppliedToRow=function(e,t){var o=[];if(e&&e.length){var i=this;e.forEach((function(e){var n=e.row+t;n<=paiShoBoardMaxRowOrCol&&((a=i.cells[n][e.col]).isType(NON_PLAYABLE)||o.push(a));var a,r=e.row-t;r>=0&&((a=i.cells[r][e.col]).isType(NON_PLAYABLE)||o.push(a))}))}return o},TrifleBoard.prototype.getPointsWithMoveStepAppliedToCol=function(e,t){var o=[];if(e&&e.length){var i=this;e.forEach((function(e){var n=e.col+t;n<=paiShoBoardMaxRowOrCol&&((a=i.cells[e.row][n]).isType(NON_PLAYABLE)||o.push(a));var a,r=e.col-t;r>=0&&((a=i.cells[e.row][r]).isType(NON_PLAYABLE)||o.push(a))}))}return o},TrifleBoard.prototype.getPointsNextToTilesInLineOfSight=function(e,t){var o=[];if(e.type===MovementType.jumpAlongLineOfSight&&e.targetTileTypes){for(var i=!1,n=t.row+1;n<paiShoBoardMaxRowOrCol&&!i;n++){if((r=this.cells[n+1][t.col]).hasTile())i=!0,(l=TrifleTiles[r.tile.code])&&TrifleTileInfo.tileIsOneOfTheseTypes(l,e.targetTileTypes)&&o.push(this.cells[n][t.col])}i=!1;for(n=t.row-1;n>0&&!i;n--){if((r=this.cells[n-1][t.col]).hasTile())i=!0,(l=TrifleTiles[r.tile.code])&&TrifleTileInfo.tileIsOneOfTheseTypes(l,e.targetTileTypes)&&o.push(this.cells[n][t.col])}i=!1;for(var a=t.col+1;a<paiShoBoardMaxRowOrCol&&!i;a++){if((r=this.cells[t.row][a+1]).hasTile())i=!0,(l=TrifleTiles[r.tile.code])&&TrifleTileInfo.tileIsOneOfTheseTypes(l,e.targetTileTypes)&&o.push(this.cells[t.row][a])}i=!1;for(a=t.col-1;a>0&&!i;a--){var r,l;if((r=this.cells[t.row][a-1]).hasTile())i=!0,(l=TrifleTiles[r.tile.code])&&TrifleTileInfo.tileIsOneOfTheseTypes(l,e.targetTileTypes)&&o.push(this.cells[t.row][a])}}return o},TrifleBoard.prototype.getPointsForTilesInLineOfSight=function(e){for(var t=[],o=!1,i=e.row+1;i<=paiShoBoardMaxRowOrCol&&!o;i++){this.cells[i][e.col].hasTile()&&(o=!0,t.push(this.cells[i][e.col]))}o=!1;for(i=e.row-1;i>=0&&!o;i--){this.cells[i][e.col].hasTile()&&(o=!0,t.push(this.cells[i][e.col]))}o=!1;for(var n=e.col+1;n<+paiShoBoardMaxRowOrCol&&!o;n++){this.cells[e.row][n].hasTile()&&(o=!0,t.push(this.cells[e.row][n]))}o=!1;for(n=e.col-1;n>=0&&!o;n--){this.cells[e.row][n].hasTile()&&(o=!0,t.push(this.cells[e.row][n]))}return t},TrifleBoard.prototype.pointIsOpenGate=function(e){var t=e.rowAndColumn;return(t=this.cells[t.row][t.col]).isOpenGate()},TrifleBoard.prototype.moveTile=function(e,t,o){this.tilesCapturedByTriggeredAbility=[];var i=t.rowAndColumn,n=o.rowAndColumn;if(i.row<0||i.row>16||n.row<0||n.row>16)return!1;var a=this.cells[i.row][i.col],r=this.cells[n.row][n.col],l=[],s=null,h=TrifleTiles[a.tile.code];TrifleTileInfo.tileHasOnlyOneMovement(h)&&TrifleTileInfo.tileHasMovementAbility(h,MovementAbility.chargeCapture)&&(this.setPossibleMovePoints(a),s=r.getOnlyPossibleMovementPath(),debug("Movement Path: "),debug(s),this.removePossibleMovePoints(),s.forEach((function(e){e.hasTile()&&e!==a&&l.push(e.removeTile())})));var d=a.removeTile();return d||debug("Error: No tile to move!"),r.hasTile()&&TrifleTileInfo.tileIsBanner(TrifleTiles[r.tile.code])&&d.ownerName!==r.tile.ownerName&&this.winners.push(d.ownerName),r.hasTile()&&!l.includes(r.tile)&&l.push(r.tile),r.putTile(d),this.setPointFlags(),l.length>0&&this.applyWhenCapturingTrigger(d,h,r,l),this.applyZoneAbilityToTile(r),this.applyBoardScanAbilities(),this.applyWhenLandsTriggers(d,h,r,l),{movedTile:d,startPoint:a,endPoint:r,capturedTiles:l}},TrifleBoard.prototype.applyWhenLandsTriggers=function(e,t,o,i){this.applyWhenLandsInZoneTriggers(e,t,o,i)},TrifleBoard.prototype.applyWhenLandsInZoneTriggers=function(e,t,o,i){var n=this;this.getZonesPointIsWithin(o).forEach((function(e){debug("Zone landed in: "+e.tile.code);var t=TrifleTiles[e.tile.code],i={pointOfLandingTile:o,pointWithZone:e};TrifleTileInfo.getZoneAbilitiesWithAbilityTrigger(t,AbilityTrigger.whenTileLandsInZone).forEach((function(e){debug("Triggered ability found: "),debug(e),n.processAbility(e,i)}))}))},TrifleBoard.prototype.processAbility=function(e,t){e.type===Ability.captureTiles&&e.triggeringAction===AbilityTrigger.whenTileLandsInZone&&e.targetTileTypes.includes(TileCategory.landingTile)&&this.tileCanBeCaptured(t.pointWithZone.tile.ownerName,t.pointOfLandingTile)&&(this.tilesCapturedByTriggeredAbility.push(t.pointOfLandingTile.removeTile()),debug("Tile captured by triggered ability: "),debug(this.tilesCapturedByTriggeredAbility))},TrifleBoard.prototype.getZonesPointIsWithin=function(e){var t=[],o=this;return this.forEachBoardPointWithTile((function(i){i!=e&&o.pointTileZoneContainsPoint(i,e)&&t.push(i)})),t},TrifleBoard.prototype.applyWhenCapturingTrigger=function(e,t,o,i){var n=TrifleTileInfo.getAbilitiesWithAbilityTrigger(t,AbilityTrigger.whenCapturing),a=this;n.forEach((function(t){debug("When capturing trigger.. triggered"),t.duration&&t.duration>0&&a.activateAbility(e,t)}))},TrifleBoard.prototype.setPointFlags=function(){},TrifleBoard.prototype.inLineWithAdjacentFlowerTileWithNothingBetween=function(e,t){var o;if(e.row===t.row){var i=t.col+1,n=e.col;e.col>t.col&&t.col>0?o=this.cells[t.row][t.col-1]:e.col<t.col&&t.col<16&&(o=this.cells[t.row][t.col+1],i=e.col+1,n=t.col);for(var a=i;a<n;a++)if(this.cells[e.row][a].hasTile())return!1}else if(e.col===t.col){var r=t.row+1,l=e.row;e.row>t.row&&t.row>0?o=this.cells[t.row-1][t.col]:e.row<t.row&&t.row<16&&(o=this.cells[t.row+1][t.col],r=e.row+1,l=t.row);for(var s=r;s<l;s++)if(this.cells[s][e.col].hasTile())return!1}return!(!o||!o.hasTile())&&o.tile.isFlowerTile()},TrifleBoard.prototype.verifyAbleToReach=function(e,t,o,i){return this.pathFound(e,t,o,i)},TrifleBoard.prototype.pathFound=function(e,t,o,i){if(!e||!t)return!1;if(e.isType(NON_PLAYABLE)||t.isType(NON_PLAYABLE))return!1;if(e.row===t.row&&e.col===t.col)return!0;if(o<=0)return!1;if("S"===i.code&&this.pointIsNextToOpponentTile(e,i.ownerCode,"C"))return!1;if(1===Math.abs(e.row-t.row)+Math.abs(e.col-t.col))return!0;var n=e.row-1;if(n>=0&&(!(a=this.cells[n][e.col]).hasTile()&&this.pathFound(a,t,o-1,i)))return!0;if((n=e.row+1)<17&&(!(a=this.cells[n][e.col]).hasTile()&&this.pathFound(a,t,o-1,i)))return!0;var a,r=e.col-1;if(r>=0&&(!(a=this.cells[e.row][r]).hasTile()&&this.pathFound(a,t,o-1,i)))return!0;if((r=e.col+1)<17&&(!(a=this.cells[e.row][r]).hasTile()&&this.pathFound(a,t,o-1,i)))return!0},TrifleBoard.prototype.pointIsNextToOpponentTile=function(e,t,o){for(var i=this.getAdjacentRowAndCols(e),n=0;n<i.length;n++)if(i[n].hasTile()&&i[n].tile.code===o&&i[n].tile.ownerCode!==t)return!0;return!1},TrifleBoard.prototype.setPossibleMovePoints=function(e){if(e.hasTile()){e.tile.ownerName;var t=TrifleTiles[e.tile.code];if(t){var o=this;t.movements&&t.movements.forEach((function(t){o.setPossibleMovesForMovement(t,e)}));var i=this.getBonusMovementInfo(e);this.setBonusMovementPossibleMoves(i,e)}}},TrifleBoard.prototype.getBonusMovementInfo=function(e){var t=e.tile.ownerName,o=TrifleTiles[e.tile.code],i={};if(this.tilePresenceAbilities.forEach((function(e){e.playerName===t&&e.abilityInfo.type===BoardPresenceAbility.increaseFriendlyTileMovementDistance&&(e.abilityInfo.targetTileTypes&&arrayIncludesOneOf(e.abilityInfo.targetTileTypes,o.types)||!e.abilityInfo.targetTileTypes)&&(bonusMovementDistance=e.abilityInfo.amount,i={type:MovementType.standard,distance:bonusMovementDistance,movementFunction:TrifleBoard.standardMovementFunction})})),i.type)return i},TrifleBoard.prototype.setPossibleMovesForMovement=function(e,t){this.movementPointChecks=0,this.tileMovementIsImmobilized(t.tile,e,t)||(e.type===MovementType.standard?this.setPossibleMovementPointsFromMovePoints([t],TrifleBoard.standardMovementFunction,t.tile,e,t,e.distance,0):e.type===MovementType.diagonal?this.setPossibleMovementPointsFromMovePoints([t],TrifleBoard.diagonalMovementFunction,t.tile,e,t,e.distance,0):e.type===MovementType.jumpAlongLineOfSight?this.setPossibleMovementPointsFromMovePoints([t],TrifleBoard.jumpAlongLineOfSightMovementFunction,t.tile,e,t,1,0):e.type===MovementType.withinFriendlyTileZone?this.setMovePointsWithinTileZone(t,t.tile.ownerName,t.tile,e):e.type===MovementType.anywhere?this.setMovePointsAnywhere(t,e):e.type===MovementType.jumpShape?this.setPossibleMovementPointsFromMovePoints([t],TrifleBoard.jumpShapeMovementFunction,t.tile,e,t,e.distance,0):e.type===MovementType.travelShape&&this.setPossibleMovementPointsFromMovePointsOnePathAtATime(TrifleBoard.travelShapeMovementFunction,t.tile,e,t,t,e.shape.length,0,[t])),debug("Movement Point Checks: "+this.movementPointChecks)},TrifleBoard.standardMovementFunction=function(e,t,o,i,n){var a=TrifleTileInfo.movementMustPreserveDirection(i);return e.getAdjacentPointsPotentialPossibleMoves(o,t,a,i)},TrifleBoard.diagonalMovementFunction=function(e,t,o,i,n){var a=TrifleTileInfo.movementMustPreserveDirection(i);return e.getAdjacentDiagonalPointsPotentialPossibleMoves(o,t,a,i)},TrifleBoard.jumpAlongLineOfSightMovementFunction=function(e,t,o,i,n){return e.getPointsNextToTilesInLineOfSight(i,t)},TrifleBoard.jumpShapeMovementFunction=function(e,t,o,i,n){var a=TrifleTileInfo.movementMustPreserveDirection(i);return e.getNextPointsForJumpShapeMovement(i,t,o,a)},TrifleBoard.travelShapeMovementFunction=function(e,t,o,i,n,a){var r=TrifleTileInfo.movementMustPreserveDirection(i);return e.getNextPointsForTravelShapeMovement(i,n,t,o,a,r)},TrifleBoard.prototype.setPossibleMovementPointsFromMovePoints=function(e,t,o,i,n,a,r){if(0!==a&&e&&!(e.length<=0)){debug("MovePoints: "),debug(e);var l=this,s=[];e.forEach((function(e){t(l,n,e,i,r).forEach((function(t){if(l.movementPointChecks++,!l.canMoveHereMoreEfficientlyAlready(t,a,i)){t.setMoveDistanceRemaining(i,a);var r=l.tileCanMoveThroughPoint(o,i,t,e);if(r||t.setMoveDistanceRemaining(i,0),l.tileCanMoveOntoPoint(o,i,t,e))l.setPointAsPossibleMovement(t,o,n)&&(t.setPossibleForMovementType(i),t.hasTile()&&!r||s.push(t));else r&&s.push(t)}}))})),this.setPossibleMovementPointsFromMovePoints(s,t,o,i,n,a-1,r+1)}},TrifleBoard.prototype.getPointsMarkedAsPossibleMove=function(){var e=[];return this.forEachBoardPoint((function(t){t.isType(POSSIBLE_MOVE)&&e.push(t)})),e},TrifleBoard.prototype.setPossibleMovementPointsFromMovePointsOnePathAtATime=function(e,t,o,i,n,a,r,l){if(0!==a){var s=this,h=e(s,i,n,o,r,l);i.setMoveDistanceRemaining(o,a),h.forEach((function(h){if(s.movementPointChecks++,!s.canMoveHereMoreEfficientlyAlready(h,a,o)){var d=s.tileCanMoveThroughPoint(t,o,h,n);if(s.tileCanMoveOntoPoint(t,o,h,n))s.setPointAsPossibleMovement(h,i.tile,i,l)&&(h.setPossibleForMovementType(o),h.hasTile()&&!d||s.setPossibleMovementPointsFromMovePointsOnePathAtATime(e,t,o,i,h,a-1,r+1,l.concat([h])));else d&&s.setPossibleMovementPointsFromMovePointsOnePathAtATime(e,t,o,i,h,a-1,r+1,l.concat([h]))}}))}},TrifleBoard.prototype.setBonusMovementPossibleMoves=function(e,t){if(e&&e.type&&e.distance&&e.movementFunction){var o=this.getPointsMarkedAsPossibleMove();o.push(t);var i=this;o.forEach((function(o){i.setPossibleMovementPointsFromMovePoints([o],e.movementFunction,t.tile,e,o,e.distance,0)}))}},TrifleBoard.prototype.setMovePointsAnywhere=function(e,t){var o=this;this.forEachBoardPoint((function(i){o.tileCanMoveOntoPoint(e.tile,t,i,e)&&o.setPointAsPossibleMovement(i,e.tile,e)}))},TrifleBoard.prototype.tileMovementIsImmobilized=function(e,t,o){return this.tileMovementIsImmobilizedByMovementRestriction(e,t,o)||this.tileMovementIsImmobilizedByZoneAbility(e,t,o)},TrifleBoard.prototype.tileMovementIsImmobilizedByZoneAbility=function(e,t,o){var i=!1,n=TrifleTiles[e.code],a=this;return this.forEachBoardPointWithTile((function(t){var r=TrifleTileInfo.getTerritorialZone(TrifleTiles[t.tile.code]);r&&r.abilities&&r.abilities.forEach((function(r){a.tileMovementIsImmobilizedByTileZoneAbility(r,t,e,n,o)&&(i=!0)}))})),i},TrifleBoard.prototype.tileMovementIsImmobilizedByTileZoneAbility=function(e,t,o,i,n){var a=!1;return e.type===ZoneAbility.immobilizesOpponentTiles&&t.tile.ownerName!==o.ownerName&&this.pointTileZoneContainsPoint(t,n)&&this.abilityIsActive(t,t.tile,TrifleTiles[t.tile.code],e)&&(e.targetTileCodes?e.targetTileCodes.includes(o.code)&&(a=!0):a=!0),e.type===ZoneAbility.immobilizesTiles&&this.pointTileZoneContainsPoint(t,n)&&this.abilityIsActive(t,t.tile,TrifleTiles[t.tile.code],e)&&(e.targetTileCodes?e.targetTileCodes.includes(o.code)&&(a=!0):e.targetTeams?(e.targetTeams.includes(TileTeam.enemy)&&t.tile.ownerName!==o.ownerName||e.targetTeams.includes(TileTeam.friendly)&&t.tile.ownerName===o.ownerName)&&(a=!0):a=!0),a},TrifleBoard.prototype.tileMovementIsImmobilizedByMovementRestriction=function(e,t,o){var i=!1;if(e&&t.restrictions){var n=this;t.restrictions.forEach((function(t){t.type===MovementRestriction.immobilizedByOpponentTileZones&&t.affectingTiles.forEach((function(t){i=n.pointIsInTargetTileZone(o,t,getOpponentName(e.ownerName))}))}))}return i},TrifleBoard.prototype.pointIsInTargetTileZone=function(e,t,o){var i=!1,n=this.getTilePoints(t,o);if(n.length>0){var a=this;n.forEach((function(t){a.pointTileZoneContainsPoint(t,e)&&(i=!0)}))}return i},TrifleBoard.prototype.getTilePoints=function(e,t){var o=[];return this.forEachBoardPoint((function(i){i.hasTile()&&i.tile.code===e&&i.tile.ownerName===t&&o.push(i)})),o},TrifleBoard.prototype.getPointsForTileCodes=function(e,t){var o=[];return this.forEachBoardPoint((function(i){i.hasTile()&&e.includes(i.tile.code)&&i.tile.ownerName===t&&o.push(i)})),o},TrifleBoard.prototype.canMoveHereMoreEfficientlyAlready=function(e,t,o){return e.getMoveDistanceRemaining(o)>=t},TrifleBoard.prototype.tileCanMoveOntoPoint=function(e,t,o,i){TrifleTiles[e.code];var n=this.targetPointHasTileTileThatCanBeCaptured(e,t,i,o);return(!o.hasTile()||n)&&(!o.isType(TEMPLE)||n)&&!this.tileZonedOutOfSpace(e,t,o)&&!this.tileMovementIsImmobilized(e,t,i)},TrifleBoard.prototype.targetPointIsEmptyOrCanBeCaptured=function(e,t,o,i){return!i.hasTile()||this.targetPointHasTileTileThatCanBeCaptured(e,t,o,i)},TrifleBoard.prototype.targetPointHasTileTileThatCanBeCaptured=function(e,t,o,i){return i.hasTile()&&this.tileCanCapture(e,t,o,i)&&!this.tileHasActiveCaptureProtectionFromCapturingTile(i.tile,e)},TrifleBoard.prototype.tileHasActiveCaptureProtectionFromCapturingTile=function(e,t){var o=!1;return this.activeDurationAbilities.forEach((function(i){if(debug("Active Duration Ability: "),debug(i),i.tile===e){debug("Yes, for this tile");var n=TrifleTiles[t.code];if(i.ability.tileTypesProtectedFrom&&arrayIncludesOneOf(i.ability.tileTypesProtectedFrom,n.types)||i.ability.tileTypesProtectedFrom&&i.ability.tileTypesProtectedFrom.includes(TileCategory.allTileTypes)||i.ability.tilesProtectedFrom&&i.ability.tilesProtectedFrom.includes(t.code))return void(o=!0)}})),o},TrifleBoard.prototype.tileCanCapture=function(e,t,o,i){var n=this.hostBannerPlayed,a=this.guestBannerPlayed;e.ownerName===GUEST&&(n=this.guestBannerPlayed,a=this.hostBannerPlayed);var r=i.tile,l=TrifleTiles[r.code];return l&&t&&t.captureTypes&&t.captureTypes.includes(CaptureType.all)&&(n&&TrifleTileInfo.tileIsOneOfTheseTypes(l,[TileType.flower,TileType.banner])||n&&a)&&this.tilesBelongToDifferentOwnersOrTargetTileHasFriendlyCapture(e,r,l)&&!i.tile.protected},TrifleBoard.prototype.tileCanBeCaptured=function(e,t){var o=this.hostBannerPlayed,i=this.guestBannerPlayed;e===GUEST&&(o=this.guestBannerPlayed,i=this.hostBannerPlayed);var n=t.tile,a=TrifleTiles[n.code];return a&&(o&&TrifleTileInfo.tileIsOneOfTheseTypes(a,[TileType.flower,TileType.banner])||o&&i)&&!t.tile.protected},TrifleBoard.prototype.tilesBelongToDifferentOwnersOrTargetTileHasFriendlyCapture=function(e,t,o){return e.ownerName!==t.ownerName||TrifleTileInfo.tileCanBeCapturedByFriendlyTiles(o)},TrifleBoard.prototype.tileCanMoveThroughPoint=function(e,t,o,i){return TrifleTiles[e.code]&&(!o.hasTile()||this.movementInfoHasAbility(t,MovementAbility.jumpOver)||this.movementInfoHasAbility(t,MovementAbility.chargeCapture)&&this.tileCanMoveOntoPoint(e,t,o,i))&&!this.tileMovementIsImmobilized(e,t,i)},TrifleBoard.prototype.movementInfoHasAbility=function(e,t){var o=!1;return e&&e.abilities&&e.abilities.forEach((function(e){e.type!==t||(o=!0)})),o},TrifleBoard.prototype.tileZonedOutOfSpace=function(e,t,o){var i=this.tileZonedOutOfSpaceByMovementRestriction(e,t,o);return i=i||this.tileZonedOutOfSpaceByZoneAbility(e.code,e.ownerName,o)},TrifleBoard.prototype.tileZonedOutOfSpaceByZoneAbility=function(e,t,o){var i=!1,n=getPlayerCodeFromName(t),a=TrifleTiles[e],r=this;return this.forEachBoardPointWithTile((function(t){var l=TrifleTiles[t.tile.code],s=TrifleTileInfo.getTerritorialZone(l);s&&s.abilities&&s.abilities.forEach((function(s){var h=r.abilityIsActive(t,t.tile,l,s);s.type===ZoneAbility.restrictMovementWithinZone&&(s.targetTeams.includes(TileTeam.friendly)&&n===t.tile.ownerCode||s.targetTeams.includes(TileTeam.enemy)&&n!==t.tile.ownerCode)&&(s.targetTileTypes&&(arrayIncludesOneOf(s.targetTileTypes,a.types)||s.targetTileTypes.includes(TileCategory.allTileTypes))||s.targetTileCodes&&s.targetTileCodes.includes(e))&&r.pointTileZoneContainsPoint(t,o)&&h&&(i=!0,debug("Zoned out! For tile: "+e+" by tile: "+t.tile.code))}))})),i},TrifleBoard.prototype.tileZonedOutOfSpaceByMovementRestriction=function(e,t,o){var i=!1;if(t.restrictions&&t.restrictions.length>0){var n=this;t.restrictions.forEach((function(t){t.type===MovementRestriction.restrictedByOpponentTileZones&&t.affectingTiles.forEach((function(t){i=n.pointIsInTargetTileZone(o,t,getOpponentName(e.ownerName))}))}))}return i},TrifleBoard.prototype.tileInfoHasMovementType=function(e,t){var o=!1;return e.movements.forEach((function(e){e.type===t&&(o=!0)})),o},TrifleBoard.prototype.removePossibleMovePoints=function(){this.forEachBoardPoint((function(e){e.removeType(POSSIBLE_MOVE),e.clearPossibleMovementTypes(),e.clearPossibleMovementPaths()}))},TrifleBoard.prototype.getFireLilyPoint=function(e){for(var t=0;t<this.cells.length;t++)for(var o=0;o<this.cells[t].length;o++){var i=this.cells[t][o];if(i.hasTile()&&i.tile.ownerName===e&&"F"===i.tile.code)return i}},TrifleBoard.prototype.getFireLilyPoints=function(e){for(var t=[],o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++){var n=this.cells[o][i];n.hasTile()&&n.tile.ownerName===e&&"F"===n.tile.code&&t.push(n)}return t},TrifleBoard.prototype.setDeployPointsPossibleMoves=function(e,t){var o=TrifleTiles[t];o||debug("You need the tileInfo for "+t);var i=this;o&&o.specialDeployTypes&&o.specialDeployTypes.forEach((function(n){i.setDeployPointsPossibleForSpecialDeploy(e,t,o,n)})),o&&o.deployTypes&&(o.deployTypes.includes(DeployType.anywhere)&&this.forEachBoardPoint((function(o){o.hasTile()||o.isType(GATE)||i.tileZonedOutOfSpaceByZoneAbility(t,e,o)||o.addType(POSSIBLE_MOVE)})),o.deployTypes.includes(DeployType.temple)&&this.forEachBoardPoint((function(o){o.hasTile()||!o.isType(GATE)||i.tileZonedOutOfSpaceByZoneAbility(t,e,o)||o.addType(POSSIBLE_MOVE)})),o.deployTypes.includes(DeployType.adjacentToTemple)&&this.forEachBoardPoint((function(o){!o.hasTile()&&o.isType(TEMPLE)&&i.getAdjacentPoints(o).forEach((function(o){o.hasTile()||i.tileZonedOutOfSpaceByZoneAbility(t,e,o)||o.addType(POSSIBLE_MOVE)}))})))},TrifleBoard.prototype.setDeployPointsPossibleForSpecialDeploy=function(e,t,o,i){i.type===SpecialDeployType.withinFriendlyTileZone&&this.setDeployPointsWithinTileZone(e,t,o,i)},TrifleBoard.prototype.setDeployPointsWithinTileZone=function(e,t,o,i){if(i.targetTileCodes&&i.targetTileCodes.length>0){var n=this;this.forEachBoardPoint((function(o){o.hasTile()||o.isType(TEMPLE)||!n.pointIsWithinZoneOfOneOfTheseTiles(o,i.targetTileCodes,e)||n.tileZonedOutOfSpaceByZoneAbility(t,e,o)||o.addType(POSSIBLE_MOVE)}))}},TrifleBoard.prototype.setMovePointsWithinTileZone=function(e,t,o,i){if(i.targetTileCodes&&i.targetTileCodes.length>0){var n=this,a=this.getPointsForTileCodes(i.targetTileCodes,t);this.forEachBoardPoint((function(t){n.oneOfTheseZonesContainsPoints(a,[e,t])&&n.tileCanMoveOntoPoint(o,i,t,null)&&n.setPointAsPossibleMovement(t,o,e)}))}},TrifleBoard.prototype.setPointAsPossibleMovement=function(e,t,o,i){var n=!1;return(n=this.movementPassesLineOfSightTest(e,t,o))&&e.addType(POSSIBLE_MOVE),i&&e.addPossibleMovementPath(i),n},TrifleBoard.prototype.movementPassesLineOfSightTest=function(e,t,o){var i=[],n=!0,a=this.getPointsForTilesInLineOfSight(o),r=this;return a.forEach((function(a){if(a.hasTile()&&a.tile.ownerName!==t.ownerName){var l=TrifleTiles[a.tile.code];if(TrifleTileInfo.tileHasDrawOpponentTilesInLineOfSightAbility(l)&&(i.push(a),!(n=r.targetPointIsInLineOfSightOfThesePoints(e,[a])&&r.targetPointIsCloserToThesePointsThanOriginPointIs(e,[a],o)&&r.getDistanceBetweenPoints(o,e)<r.getDistanceBetweenPoints(o,a))))return!1}})),n},TrifleBoard.prototype.targetPointIsInLineOfSightOfThesePoints=function(e,t){var o=0;return this.getPointsForTilesInLineOfSight(e).forEach((function(e){t.includes(e)&&o++})),o===t.length},TrifleBoard.prototype.targetPointIsCloserToThesePointsThanOriginPointIs=function(e,t,o){var i=!0,n=this;return t.forEach((function(t){n.getDistanceBetweenPoints(e,t)>=n.getDistanceBetweenPoints(o,t)&&(i=!1)})),i},TrifleBoard.prototype.oneOfTheseZonesContainsPoints=function(e,t){var o=this,i=!1;return e.forEach((function(e){var n=!0;t.forEach((function(t){n=n&&o.pointTileZoneContainsPoint(e,t)})),n&&(i=!0)})),i},TrifleBoard.prototype.pointTileZoneContainsPoint=function(e,t){return e.hasTile()&&e.tile.activeZone&&!e.tile.activeZone.canceled&&this.getDistanceBetweenPoints(e,t)<=e.tile.activeZone.size},TrifleBoard.prototype.pointIsWithinZoneOfOneOfTheseTiles=function(e,t,o){var i=!1;if(t&&t.length>0){var n=this;t.forEach((function(t){n.pointIsInTargetTileZone(e,t,o)&&(i=!0)}))}return i},TrifleBoard.prototype.forEachBoardPoint=function(e){this.cells.forEach((function(t){t.forEach((function(t){t.isType(NON_PLAYABLE)||e(t)}))}))},TrifleBoard.prototype.forEachBoardPointDoMany=function(e){this.cells.forEach((function(t){t.forEach((function(t){t.isType(NON_PLAYABLE)||e.forEach((function(e){e(t)}))}))}))},TrifleBoard.prototype.forEachBoardPointWithTile=function(e){this.forEachBoardPoint((function(t){t.hasTile()&&e(t)}))},TrifleBoard.prototype.setGuestGateOpen=function(){this.cells[16][8].isOpenGate()&&this.cells[16][8].addType(POSSIBLE_MOVE)},TrifleBoard.prototype.activateAbility=function(e,t){t.duration&&t.duration>0&&(t.active=!0,t.remainingDuration=t.duration,this.activeDurationAbilities.push({tile:e,ability:t}),debug("Activated ability!"),debug(t))},TrifleBoard.prototype.tickDurationAbilities=function(){for(var e=this.activeDurationAbilities.length-1;e>=0;e--){var t=this.activeDurationAbilities[e].ability;t.remainingDuration-=.5,t.remainingDuration<=0&&(t.active=!1,this.activeDurationAbilities.splice(e,1),debug("Ability deactivated!"),debug(t))}};NON_PLAYABLE="Non-Playable",NEUTRAL="Neutral",RED="Red",WHITE="White";var TEMPLE=GATE="Gate";POSSIBLE_MOVE="Possible Move",OPEN_GATE="OPEN GATE",thinDot="·",thickDot="•",whiteDot="◦",gateDot="⟡";function TrifleBoardPoint(){this.types=[],this.row=-1,this.col=-1,this.possibleMoveTypes=[],this.moveDistanceRemaining={},this.possibleMovementPaths=[]}function TrifleController(e,t){this.actuator=new TrifleActuator(e,t),this.resetGameManager(),this.resetNotationBuilder(),this.resetGameNotation(),this.hostAccentTiles=[],this.guestAccentTiles=[],this.isPaiShoGame=!0}function TrifleGameManager(e,t,o){this.gameLogText="",this.isCopy=o,this.actuator=e,this.tileManager=new TrifleTileManager,this.setup(t)}function TrifleNotationMove(e){this.fullMoveText=e,this.analyzeMove()}function TrifleNotationBuilder(){this.moveType,this.tileType,this.endPoint,this.startPoint,this.status=BRAND_NEW}function TrifleGameNotation(){this.notationText="",this.moves=[]}function TrifleTile(e,t){this.code=e,this.ownerCode=t,"G"===this.ownerCode?this.ownerName=GUEST:"H"===this.ownerCode?this.ownerName=HOST:debug("INCORRECT OWNER CODE"),this.id=tileId++,this.selectedFromPile=!1}TrifleBoardPoint.prototype.addType=function(e){this.types.includes(e)||this.types.push(e)},TrifleBoardPoint.prototype.removeType=function(e){for(var t=0;t<this.types.length;t++)this.types[t]===e&&this.types.splice(t,1)},TrifleBoardPoint.prototype.putTile=function(e){this.tile=e},TrifleBoardPoint.prototype.hasTile=function(){return!!this.tile},TrifleBoardPoint.prototype.isType=function(e){return this.types.includes(e)},TrifleBoardPoint.prototype.setPossibleForMovementType=function(e){var t=TrifleBoardPoint.getMovementType(e);this.possibleMoveTypes.includes(t)||this.possibleMoveTypes.push(t)},TrifleBoardPoint.prototype.isPossibleForMovementType=function(e){var t=TrifleBoardPoint.getMovementType(e);return this.possibleMoveTypes.includes(t)},TrifleBoardPoint.prototype.clearPossibleMovementTypes=function(){this.possibleMoveTypes=[],this.moveDistanceRemaining={}},TrifleBoardPoint.prototype.clearPossibleMovementPaths=function(){this.possibleMovementPaths=[]},TrifleBoardPoint.prototype.addPossibleMovementPath=function(e){this.possibleMovementPaths.push(e)},TrifleBoardPoint.prototype.getOnlyPossibleMovementPath=function(){if(this.possibleMovementPaths&&1===this.possibleMovementPaths.length)return this.possibleMovementPaths[0]},TrifleBoardPoint.prototype.setMoveDistanceRemaining=function(e,t){var o=TrifleBoardPoint.getMovementType(e);this.moveDistanceRemaining[o]=t},TrifleBoardPoint.prototype.getMoveDistanceRemaining=function(e){var t=TrifleBoardPoint.getMovementType(e);return this.moveDistanceRemaining[t]},TrifleBoardPoint.getMovementType=function(e){return e.title?e.title:e.type},TrifleBoardPoint.prototype.isOpenGate=function(){return!this.hasTile()&&this.types.includes(GATE)},TrifleBoardPoint.prototype.removeTile=function(){var e=this.tile;return this.tile=null,e},TrifleBoardPoint.prototype.drainTile=function(){this.tile&&this.tile.drain()},TrifleBoardPoint.prototype.restoreTile=function(){this.tile&&this.tile.restore()},TrifleBoardPoint.prototype.canHoldTile=function(e,t){return!this.isType(NON_PLAYABLE)&&(!(!t&&this.hasTile())&&(e.type===BASIC_FLOWER?!(!this.isType(NEUTRAL)&&!this.isType(e.basicColorName))&&!this.isType(GATE):e.type===SPECIAL_FLOWER||e.type===ACCENT_TILE))},TrifleBoardPoint.prototype.betweenPlayerHarmony=function(e){return e===GUEST?this.betweenHarmonyGuest:e===HOST&&this.betweenHarmonyHost},TrifleBoardPoint.prototype.getCopy=function(){for(var e=new TrifleBoardPoint,t=0;t<this.types.length;t++)e.types.push(this.types[t]);return e.row=this.row,e.col=this.col,this.hasTile()&&(e.tile=this.tile.getCopy()),e},TrifleBoardPoint.neutral=function(){var e=new TrifleBoardPoint;return e.addType(NEUTRAL),e},TrifleBoardPoint.gate=function(){var e=new TrifleBoardPoint;return e.addType(GATE),e},TrifleBoardPoint.red=function(){var e=new TrifleBoardPoint;return e.addType(RED),e},TrifleBoardPoint.white=function(){var e=new TrifleBoardPoint;return e.addType(WHITE),e},TrifleBoardPoint.redWhite=function(){var e=new TrifleBoardPoint;return e.addType(RED),e.addType(WHITE),e},TrifleBoardPoint.redWhiteNeutral=function(){var e=new TrifleBoardPoint;return e.addType(RED),e.addType(WHITE),e.addType(NEUTRAL),e},TrifleBoardPoint.redNeutral=function(){var e=new TrifleBoardPoint;return e.addType(RED),e.addType(NEUTRAL),e},TrifleBoardPoint.whiteNeutral=function(){var e=new TrifleBoardPoint;return e.addType(WHITE),e.addType(NEUTRAL),e},TrifleController.userIsTrifleDeveloper=function(){return usernameIsOneOf(["SkudPaiSho","abacadaren","Korron","vescucci","geebung02"])},TrifleController.prototype.getGameTypeId=function(){return GameType.Trifle.id},TrifleController.prototype.resetGameManager=function(){this.theGame=new TrifleGameManager(this.actuator)},TrifleController.prototype.resetNotationBuilder=function(){var e=!1;this.notationBuilder&&(e=this.notationBuilder.offerDraw),this.notationBuilder=new TrifleNotationBuilder,e&&(this.notationBuilder.offerDraw=!0),this.checkingOutOpponentTileOrNotMyTurn=!1},TrifleController.prototype.resetGameNotation=function(){this.gameNotation=this.getNewGameNotation()},TrifleController.prototype.getNewGameNotation=function(){return new TrifleGameNotation},TrifleController.getHostTilesContainerDivs=function(){return""},TrifleController.getGuestTilesContainerDivs=function(){return""},TrifleController.prototype.callActuate=function(){this.theGame.actuate()},TrifleController.prototype.resetMove=function(){this.notationBuilder.offerDraw=!1,this.notationBuilder.status===BRAND_NEW?this.gameNotation.removeLastMove():this.notationBuilder.status,rerunAll()},TrifleController.prototype.getDefaultHelpMessageText=function(){return"<h4>Trifle</h4> <p> <p>Trifle is inspired by Vagabond Pai Sho, the Pai Sho variant seen in the fanfiction story <a href='https://skudpaisho.com/site/more/fanfiction-recommendations/' target='_blank'>Gambler and Trifle (download here)</a>.</p> <p><strong>You win</strong> if you capture your opponent's Banner tile.</p> <p><strong>On a turn</strong>, you may either deploy a tile or move a tile.</p> <p><strong>You can't capture Flower/Banner tiles</strong> until your Banner has been deployed.<br /> <strong>You can't capture Non-Flower/Banner tiles</strong> until both players' Banner tiles have been deployed.</p> <p><strong>Hover</strong> over any tile to see how it works.</p> </p> <p>Select tiles to learn more or <a href='https://skudpaisho.com/site/games/trifle-pai-sho/' target='_blank'>view the rules</a>.</p>"},TrifleController.prototype.getAdditionalMessage=function(){var e="";return 0===this.gameNotation.moves.length?(onlinePlayEnabled&&gameId<0&&userIsLoggedIn()?e+="Click <em>Join Game</em> above to join another player's game. Or, you can start a game that other players can join by choosing your team. <br />":e+="Sign in to enable online gameplay. Or, start playing a local game by choosing your team.",e+=getGameOptionsMessageHtml(GameType.Trifle.gameOptions)):!this.theGame.hasEnded()&&myTurn()?this.gameNotation.lastMoveHasDrawOffer()&&this.promptToAcceptDraw?(e+="<br />Are you sure you want to accept the draw offer and end the game?<br />",e+="<span class='skipBonus' onclick='gameController.confirmAcceptDraw();'>Yes, accept draw and end the game</span>",e+="<br /><br />"):this.gameNotation.lastMoveHasDrawOffer()?e+="<br />Your opponent is offering a draw. You may <span class='skipBonus' onclick='gameController.acceptDraw();'>Accept Draw</span> or make a move to refuse the draw offer.<br />":this.notationBuilder.offerDraw?e+="<br />Your opponent will be able to accept or reject your draw offer once you make your move. Or, you may <span class='skipBonus' onclick='gameController.removeDrawOffer();'>remove your draw offer</span> from this move.":e+="<br /><span class='skipBonus' onclick='gameController.offerDraw();'>Offer Draw</span><br />":myTurn()||this.gameNotation.lastMoveHasDrawOffer()&&(e+="<br />A draw has been offered.<br />"),e},TrifleController.prototype.gameHasEndedInDraw=function(){return this.theGame.gameHasEndedInDraw},TrifleController.prototype.acceptDraw=function(){myTurn()&&(this.promptToAcceptDraw=!0,refreshMessage())},TrifleController.prototype.confirmAcceptDraw=function(){if(myTurn()){this.resetNotationBuilder(),this.notationBuilder.moveType=DRAW_ACCEPT;var e=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.theGame.runNotationMove(e),this.gameNotation.addMove(e),playingOnlineGame()?callSubmitMove():finalizeMove()}},TrifleController.prototype.offerDraw=function(){myTurn()&&(this.notationBuilder.offerDraw=!0,refreshMessage())},TrifleController.prototype.removeDrawOffer=function(){myTurn()&&(this.notationBuilder.offerDraw=!1,refreshMessage())},TrifleController.prototype.unplayedTileClicked=function(e){if(this.promptToAcceptDraw=!1,!this.theGame.hasEnded()||this.notationBuilder.status===READY_FOR_BONUS){var t=e.getAttribute("name"),o=parseInt(e.getAttribute("id")),i=t.charAt(0),n=t.substring(1),a=GUEST;"H"===i&&(a=HOST);var r=this.theGame.tileManager.peekTile(a,n,o);if((r&&r.ownerName!==getCurrentPlayer()||!myTurn())&&(this.checkingOutOpponentTileOrNotMyTurn=!0),this.theGame.playersAreSelectingTeams()){var l=new TrifleTile(n,i);if(e.classList.contains("selectedFromPile"))debug("You picked one for the team!"),this.theGame.addTileToTeam(l)&&(debug("Gotta build notation"),this.notationBuilder.moveType=TEAM_SELECTION,this.notationBuilder.teamSelection=this.theGame.getPlayerTeamSelectionTileCodeList(a),this.completeMove());else debug("You are removing one from your team :("),this.theGame.removeTileFromTeam(l)}else this.notationBuilder.status===BRAND_NEW?(debug("Yes, begin deploying!"),r.selectedFromPile=!0,this.notationBuilder.moveType=DEPLOY,this.notationBuilder.tileType=n,this.notationBuilder.status=WAITING_FOR_ENDPOINT,this.theGame.revealDeployPoints(r.ownerName,n)):(this.theGame.hidePossibleMovePoints(),this.resetNotationBuilder())}},TrifleController.prototype.pointClicked=function(e){if(this.promptToAcceptDraw=!1,!this.theGame.hasEnded()){var t=new NotationPoint(e.getAttribute("name")).rowAndColumn,o=this.theGame.board.cells[t.row][t.col];this.notationBuilder.status===BRAND_NEW?o.hasTile()&&(o.tile.ownerName===getCurrentPlayer()&&myTurn()||(debug("That's not your tile!"),this.checkingOutOpponentTileOrNotMyTurn=!0),this.notationBuilder.status=WAITING_FOR_ENDPOINT,this.notationBuilder.moveType=MOVE,this.notationBuilder.startPoint=new NotationPoint(e.getAttribute("name")),this.theGame.revealPossibleMovePoints(o)):this.notationBuilder.status===WAITING_FOR_ENDPOINT&&(o.isType(POSSIBLE_MOVE)?(this.theGame.hidePossibleMovePoints(),this.checkingOutOpponentTileOrNotMyTurn||isInReplay?this.resetNotationBuilder():(this.notationBuilder.endPoint=new NotationPoint(e.getAttribute("name")),this.completeMove())):(this.theGame.hidePossibleMovePoints(),this.resetNotationBuilder()))}},TrifleController.prototype.completeMove=function(){var e=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.theGame.runNotationMove(e),this.gameNotation.addMove(e),onlinePlayEnabled&&1===this.gameNotation.moves.length?createGameIfThatIsOk(this.getGameTypeId()):playingOnlineGame()?callSubmitMove():finalizeMove()},TrifleController.prototype.skipHarmonyBonus=function(){var e=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.gameNotation.addMove(e),playingOnlineGame()?callSubmitMove():finalizeMove()},TrifleController.prototype.getTheMessage=function(e,t){var o=[],i=e.code,n=TrifleTile.getTileName(i);return"L"===i?(n="White Lotus",o.push("Flower Tile"),o.push("Can move 1 space")):"S"===i?(n="Sky Bison",o.push("Deployed on the Temples - the points inside of the small red triangles in the corners of the board"),o.push("Can move up to six spaces, turning any number of times, but cannot move into an opponent's Sky Bison's territorial zone"),o.push("Cannot move through or off of a space that is adjacent to an opponent's Chrysanthemum tile"),o.push("Can capture other tiles"),o.push("After the Sky Bison has moved out of its temple and is not trapped by a Chrysanthemum, it creates a territorial zone 6 spaces around it")):"B"===i?(n="Badgermole",o.push('Can move only one space in any direction OR move directly adjacent to a Flower Tile if that Flower Tile is in the Badgermole\'s "line of sight" (meaning, the tiles lie on the same line with no other tiles in between)'),o.push("Flower Tiles adjacent to a Badgermole are protected from capture")):"W"===i?(n="Wheel",o.push("Can move any number of spaces forwards, backwards, left, or right across the spaces of the board as opposed to diagonally on the lines"),o.push("Can capture other tiles")):"C"===i?(n="Chrysanthemum",o.push("Flower Tile"),o.push("Cannot move"),o.push("Freezes opponent's Sky Bison tiles in place when adjacent")):"F"===i?(n="Fire Lily",o.push("Flower Tile"),o.push("Cannot move"),o.push("Enables deployment of White Dragon")):"D"===i&&(n="White Dragon",o.push("Can be deployed in a 5-space area around the Fire Lily"),o.push("Can move anywhere inside that 5-space Fire Lily zone"),o.push("Can capture other tiles")),{heading:n,message:o}},TrifleController.prototype.getTileMessage=function(e){var t=e.getAttribute("name"),o=(parseInt(e.getAttribute("id")),new TrifleTile(t.substring(1),t.charAt(0))),i=HOST;return t.startsWith("G")&&(i=GUEST),this.getTheMessage(o,i)},TrifleController.prototype.getPointMessage=function(e){var t=new NotationPoint(e.getAttribute("name")).rowAndColumn,o=this.theGame.board.cells[t.row][t.col];return o.hasTile()?this.getTheMessage(o.tile,o.tile.ownerName):null},TrifleController.prototype.playAiTurn=function(e){},TrifleController.prototype.startAiGame=function(e){},TrifleController.prototype.getAiList=function(){return[]},TrifleController.prototype.getCurrentPlayer=function(){return currentMoveIndex%2==0?HOST:GUEST},TrifleController.prototype.cleanup=function(){},TrifleController.prototype.isSolitaire=function(){return!1},TrifleController.prototype.setGameNotation=function(e){this.gameNotation.setNotationText(e)},TrifleGameManager.prototype.setup=function(e){this.board=new TrifleBoard,e||this.actuate()},TrifleGameManager.prototype.actuate=function(){this.isCopy||(this.actuator.actuate(this.board,this.tileManager),setGameLogText(this.gameLogText))},TrifleGameManager.prototype.runNotationMove=function(e,t){if(debug("Running Move: "+e.fullMoveText),this.board.tickDurationAbilities(),e.moveType===TEAM_SELECTION){var o=this;e.teamTileCodes.forEach((function(t){var i=new TrifleTile(t,e.playerCode);o.tileManager.addToTeamIfOk(i)})),this.buildTeamSelectionGameLogText(e)}else if(e.moveType===DEPLOY){var i=this.tileManager.grabTile(e.player,e.tileType);this.board.placeTile(i,e.endPoint),this.buildDeployGameLogText(e,i)}else if(e.moveType===MOVE){var n=this.board.moveTile(e.player,e.startPoint,e.endPoint);this.buildMoveGameLogText(e,n)}else e.moveType===DRAW_ACCEPT&&(this.gameHasEndedInDraw=!0);t&&this.actuate()},TrifleGameManager.prototype.buildTeamSelectionGameLogText=function(e){this.gameLogText=e.player+"'s team: "+e.teamTileCodes},TrifleGameManager.prototype.buildDeployGameLogText=function(e,t){this.gameLogText=e.player+" placed "+TrifleTile.getTileName(t.code)+" at "+e.endPoint.pointText},TrifleGameManager.prototype.buildMoveGameLogText=function(e,t){if(this.gameLogText=e.player+" moved "+TrifleTile.getTileName(t.movedTile.code)+" from "+e.startPoint.pointText+" to "+e.endPoint.pointText,t.capturedTiles&&t.capturedTiles.length>0){this.gameLogText+=" and captured "+getOpponentName(e.player)+"'s ";var o=!0;t.capturedTiles.forEach((function(e){o?o=!1:this.gameLogText+=",",this.gameLogText+=TrifleTile.getTileName(e.code)}))}},TrifleGameManager.prototype.playersAreSelectingTeams=function(){return!this.tileManager.hostTeamIsFull()||!this.tileManager.guestTeamIsFull()},TrifleGameManager.prototype.getPlayerTeamSelectionTileCodeList=function(e){var t=this.tileManager.getPlayerTeam(e),o=[];return t.forEach((function(e){o.push(e.code)})),o.toString()},TrifleGameManager.prototype.addTileToTeam=function(e){return this.tileManager.addToTeamIfOk(e)&&this.actuate(),this.tileManager.playerTeamIsFull(e.ownerName)},TrifleGameManager.prototype.removeTileFromTeam=function(e){this.tileManager.removeTileFromTeam(e),this.actuate()},TrifleGameManager.prototype.hasEnded=function(){return this.getWinResultTypeCode()>0},TrifleGameManager.prototype.revealPossibleMovePoints=function(e,t){e.hasTile()&&(this.board.setPossibleMovePoints(e),t||this.actuate())},TrifleGameManager.prototype.hidePossibleMovePoints=function(e){this.board.removePossibleMovePoints(),this.tileManager.removeSelectedTileFlags(),e||this.actuate()},TrifleGameManager.prototype.revealDeployPoints=function(e,t,o){this.board.setDeployPointsPossibleMoves(e,t),o||this.actuate()},TrifleGameManager.prototype.getWinner=function(){if(1===this.board.winners.length)return this.board.winners[0]},TrifleGameManager.prototype.getWinReason=function(){return" has captured the opponent's Banner Tile and won the game!"},TrifleGameManager.prototype.getWinResultTypeCode=function(){return 1===this.board.winners.length?1:this.gameHasEndedInDraw?4:void 0},TrifleGameManager.prototype.getCopy=function(){var e=new TrifleGameManager(this.actuator,!0,!0);return e.board=this.board.getCopy(),e.tileManager=this.tileManager.getCopy(),e},TrifleNotationMove.prototype.analyzeMove=function(){this.valid=!0,debug(i=this.fullMoveText.split("."));var e=i[0];this.moveNum=parseInt(e.slice(0,-1)),this.playerCode=e.charAt(e.length-1),"G"===this.playerCode?this.player=GUEST:"H"===this.playerCode&&(this.player=HOST);var t=i[1];if(t){if("("===t.charAt(0)?this.moveType=MOVE:t.startsWith(DRAW_ACCEPT)?this.moveType=DRAW_ACCEPT:this.moveNum<1?(this.moveType=TEAM_SELECTION,debug("they done selected a teeeem")):this.moveType=DEPLOY,this.moveType===TEAM_SELECTION)this.teamTileCodes=t.split(",");else if(this.moveType===DEPLOY){var o=t.indexOf("(");o>0||(debug("Failure to plant"),this.valid=!1),this.tileType=t.substring(0,o),t.endsWith(")")||t.endsWith(")"+DRAW_OFFER)?this.endPoint=new NotationPoint(t.substring(t.indexOf("(")+1,t.indexOf(")"))):this.valid=!1}else if(this.moveType===MOVE){var i=t.substring(t.indexOf("(")+1).split(")-(");this.startPoint=new NotationPoint(i[0]),this.endPoint=new NotationPoint(i[1].substring(0,i[1].indexOf(")")))}this.offerDraw=t.endsWith(DRAW_OFFER)}},TrifleNotationMove.prototype.isValidNotation=function(){return this.valid},TrifleNotationMove.prototype.equals=function(e){return this.fullMoveText===e.fullMoveText},TrifleNotationBuilder.prototype.getNotationMove=function(e,t){var o=e+t.charAt(0)+".";return this.moveType===TEAM_SELECTION?o+=this.teamSelection:this.moveType===MOVE?o+="("+this.startPoint.pointText+")-("+this.endPoint.pointText+")":this.moveType===DEPLOY?o+=this.tileType+"("+this.endPoint.pointText+")":this.moveType===DRAW_ACCEPT&&(o+=DRAW_ACCEPT),this.offerDraw&&(o+=DRAW_OFFER),new TrifleNotationMove(o)},TrifleGameNotation.prototype.setNotationText=function(e){this.notationText=e,this.loadMoves()},TrifleGameNotation.prototype.addNotationLine=function(e){this.notationText+=";"+e.trim(),this.loadMoves()},TrifleGameNotation.prototype.addMove=function(e){this.notationText?this.notationText+=";"+e.fullMoveText:this.notationText=e.fullMoveText,this.loadMoves()},TrifleGameNotation.prototype.removeLastMove=function(){this.notationText=this.notationText.substring(0,this.notationText.lastIndexOf(";")),this.loadMoves()},TrifleGameNotation.prototype.getPlayerMoveNum=function(){var e=0,t=this.moves[this.moves.length-1];return t&&(e=t.moveNum,t.player===GUEST&&e++),e},TrifleGameNotation.prototype.getNotationMoveFromBuilder=function(e){var t=0,o=HOST,i=this.moves[this.moves.length-1];return i&&(t=i.moveNum,i.player===GUEST?t++:o=GUEST),e.getNotationMove(t,o)},TrifleGameNotation.prototype.loadMoves=function(){this.moves=[];var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t=this,o=GUEST;e.forEach((function(e){var i=new TrifleNotationMove(e);i.isValidNotation()&&i.player!==o?(t.moves.push(i),o=i.player):debug("the player check is broken?")}))},TrifleGameNotation.prototype.getNotationHtml=function(){var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t="";return e.forEach((function(e){t+=e+"<br />"})),t},TrifleGameNotation.prototype.notationTextForUrl=function(){return this.notationText},TrifleGameNotation.prototype.getNotationForEmail=function(){var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t="";return e.forEach((function(e){t+=e+"[BR]"})),t},TrifleGameNotation.prototype.getLastMoveText=function(){return this.moves[this.moves.length-1].fullMoveText},TrifleGameNotation.prototype.getLastMoveNumber=function(){return this.moves[this.moves.length-1].moveNum},TrifleGameNotation.prototype.lastMoveHasDrawOffer=function(){return this.moves[this.moves.length-1]&&this.moves[this.moves.length-1].offerDraw},TrifleTile.prototype.getImageName=function(){return this.ownerCode+""+this.code},TrifleTile.prototype.canMove=function(e){return!("C"===this.code||"F"===this.code)},TrifleTile.prototype.getMoveDistance=function(){return"L"===this.code||"B"===this.code?1:"S"===this.code?6:0},TrifleTile.prototype.isFlowerTile=function(){return"L"===this.code||"C"===this.code||"F"===this.code},TrifleTile.prototype.hasCaptureAbility=function(){return"D"===this.code||"W"===this.code||"S"===this.code},TrifleTile.prototype.getName=function(){return TrifleTile.getTileName(this.code)},TrifleTile.prototype.getCopy=function(){return new TrifleTile(this.code,this.ownerCode)},TrifleTile.getTileName=function(e){var t="";return"L"===e?t="White Lotus":"S"===e?t="Sky Bison":"B"===e?t="Badgermole":"W"===e?t="Wheel":"C"===e?t="Chrysanthemum":"F"===e?t="Fire Lily":"D"===e?t="White Dragon":Object.keys(TrifleTileCodes).forEach((function(o,i){TrifleTileCodes[o]===e&&(t=o)})),t},TrifleTile.getTeamLimitForTile=function(e){var t=TrifleTiles[e];if(t){if(t.teamLimit)return t.teamLimit;if(t.isBanner)return 1}return 2};var STANDARD="Standard",RESTRICTED_BY_OPPONENT_TILE_ZONE="Restricted by opponent tile zone";function TrifleTileManager(){TrifleTileInfo.initializeTrifleData(),this.hostTeam=[],this.guestTeam=[],this.hostTiles=[],this.guestTiles=[]}TrifleTileManager.prototype.grabTile=function(e,t){var o,i=this.hostTiles;e===GUEST&&(i=this.guestTiles);for(var n=0;n<i.length;n++)if(i[n].code===t){newTileArr=i.splice(n,1),o=newTileArr[0];break}return o||debug("NONE OF THAT TILE FOUND"),o},TrifleTileManager.prototype.peekTile=function(e,t,o){var i,n=this.hostTiles;if(e===GUEST&&(n=this.guestTiles),o)for(var a=0;a<n.length;a++)if(n[a].id===o)return n[a];for(a=0;a<n.length;a++)if(n[a].code===t){i=n[a];break}return i||debug("NONE OF THAT TILE FOUND"),i},TrifleTileManager.prototype.removeSelectedTileFlags=function(){this.hostTiles.forEach((function(e){e.selectedFromPile=!1})),this.guestTiles.forEach((function(e){e.selectedFromPile=!1}))},TrifleTileManager.prototype.unselectTiles=function(e){this.getPlayerTilePile(e).forEach((function(e){e.selectedFromPile=!1}))},TrifleTileManager.prototype.putTileBack=function(e){var t=e.ownerName;this.getPlayerTilePile(t).push(e)},TrifleTileManager.prototype.getTeamSize=function(){return 11},TrifleTileManager.prototype.hostTeamIsFull=function(){return this.playerTeamIsFull(HOST)},TrifleTileManager.prototype.guestTeamIsFull=function(){return this.playerTeamIsFull(GUEST)},TrifleTileManager.prototype.playerTeamIsFull=function(e){return this.getPlayerTeam(e).length>=this.getTeamSize()},TrifleTileManager.prototype.playerTeamHasBanner=function(e){for(var t=this.getPlayerTeam(e),o=0;o<t.length;o++){var i=TrifleTiles[t[o].code];if(i&&this.tileInfoIsBanner(i))return!0}return!1},TrifleTileManager.prototype.tileInfoIsBanner=function(e){return e&&e.types.includes(TileType.banner)},TrifleTileManager.prototype.addToTeamIfOk=function(e){var t=!1,o=e.ownerName;if(!this.playerTeamIsFull(o)){t=!0;var i=TrifleTiles[e.code];t=this.tileInfoIsBanner(i)?t&&!this.playerTeamHasBanner(o):t&&(this.playerTeamHasBanner(o)||this.getPlayerTeam(o).length<this.getTeamSize()-1);var n=this.countOfThisTileInTeam(e.code,e.ownerName);(t=t&&n<TrifleTile.getTeamLimitForTile(e.code))&&(this.getPlayerTeam(e.ownerName).push(e),this.getPlayerTilePile(e.ownerName).push(e))}return t},TrifleTileManager.prototype.removeTileFromTeam=function(e){if(this.countOfThisTileInTeam(e.code,e.ownerName)>0){var t=this.getPlayerTeam(e.ownerName);t.splice(t.indexOf(e),1),this.grabTile(e.ownerName,e.code)}},TrifleTileManager.prototype.countOfThisTileInTeam=function(e,t){for(var o=0,i=this.getPlayerTeam(t),n=0;n<i.length;n++)i[n].code===e&&o++;return o},TrifleTileManager.prototype.getPlayerTeam=function(e){var t=this.hostTeam;return e===GUEST&&(t=this.guestTeam),t},TrifleTileManager.prototype.getPlayerTilePile=function(e){var t=this.hostTiles;return e===GUEST&&(t=this.guestTiles),t},TrifleTileManager.prototype.getCopy=function(){return new TrifleTileManager};var TrifleTileCodes={SkyBison:"SkyBison",Badgermole:"Badgermole",Wheel:"Wheel",Chrysanthemum:"Chrysanthemum",FireLily:"FireLily",Dragon:"Dragon",Lotus:"Lotus",MessengerHawk:"MessengerHawk",AirBanner:"AirBanner",RingTailedLemur:"RingTailedLemur",HermitCrab:"HermitCrab",Firefly:"Firefly",Dandelion:"Dandelion",Edelweiss:"Edelweiss",WaterBanner:"WaterBanner",SnowLeopard:"SnowLeopard",PolarBearDog:"PolarBearDog",BuffaloYak:"BuffaloYak",TitanArum:"TitanArum",LilyPad:"LilyPad",Lupine:"Lupine",EarthBanner:"EarthBanner",SaberToothMooseLion:"SaberToothMooseLion",AirGlider:"AirGlider",Shirshu:"Shirshu",BoarQPine:"BoarQPine"},TileType={banner:"banner",animal:"animal",flower:"flower",fruit:"fruit",other:"other",traveler:"traveler"},TileCategory={allTileTypes:"allTileTypes",landingTile:"landingTile"},DeployType={anywhere:"anywhere",temple:"temple",adjacentToTemple:"adjacentToTemple"},SpecialDeployType={withinFriendlyTileZone:"withinFriendlyTileZone"},MovementType={standard:"standard",diagonal:"diagonal",jumpAlongLineOfSight:"jumpAlongLineOfSight",withinFriendlyTileZone:"withinFriendlyTileZone",anywhere:"anywhere",jumpShape:"jumpShape",travelShape:"travelShape"},MovementRestriction={restrictedByOpponentTileZones:"restrictedByOpponentTileZones",immobilizedByOpponentTileZones:"immobilizedByOpponentTileZones",mustPreserveDirection:"mustPreserveDirection"},MovementAbility={jumpOver:"jumpOver",chargeCapture:"chargeCapture"},MoveDirection={any:"any",straight:"straight",turn:"turn",left:"left",right:"right"},CaptureType={none:"none",all:"all"},ZoneAbility={canceledWhenInTemple:"canceledWhenInTemple",protectFriendlyTilesFromCapture:"protectFriendlyTilesFromCapture",immobilizesOpponentTiles:"immobilizesOpponentTiles",immobilizesTiles:"immobilizesTiles",removesTileAbilities:"removesTileAbilities",restrictMovementWithinZone:"restrictMovementWithinZone",captureLandingTiles:"captureLandingTiles"},BoardPresenceAbility={increaseFriendlyTileMovementDistance:"increaseFriendlyTileMovementDistance",canBeCapturedByFriendlyTiles:"canBeCapturedByFriendlyTiles",drawOpponentTilesInLineOfSight:"drawOpponentTilesInLineOfSight",captureProtection:"captureProtection"},SpawnLocation={adjacent:"adjacent"},Ability={captureTiles:"captureTiles",removeEffects:"removeEffects"},AbilityType={protection:"protection"},AbilityTrigger={whenCaptured:"whenCaptured",whenCapturing:"whenCapturing",whenTileLandsInZone:"whenTileLandsInZone",whileTileInLineOfSight:"whileTileInLineOfSight"},TileTeam={friendly:"friendly",enemy:"enemy"},AbilitiesForType={},AbilityTypes={},TrifleTiles={},TrifleTileInfo={};function VagabondActuator(e,t,o){this.gameContainer=e,this.mobile=t,this.animationOn=o;var i=setupPaiShoBoard(this.gameContainer,VagabondController.getHostTilesContainerDivs(),VagabondController.getGuestTilesContainerDivs(),!0);this.boardContainer=i.boardContainer,this.boardContainer.style.position="relative",this.hostTilesContainer=i.hostTilesContainer,this.guestTilesContainer=i.guestTilesContainer}function VagabondBoard(){this.size=new RowAndColumn(17,17),this.cells=this.brandNew(),this.winners=[],this.hlPlayed=!1,this.glPlayed=!1}function VagabondBoardPoint(){this.types=[],this.row=-1,this.col=-1}function VagabondController(e,t){localStorage.getItem(vagabondTileDesignTypeKey)&&VagabondController.tileDesignTypeValues[localStorage.getItem(vagabondTileDesignTypeKey)]||localStorage.setItem(vagabondTileDesignTypeKey,"delion"),this.actuator=new VagabondActuator(e,t,this.isAnimationsEnabled()),this.resetGameManager(),this.resetNotationBuilder(),this.resetGameNotation(),this.hostAccentTiles=[],this.guestAccentTiles=[],this.isPaiShoGame=!0}function VagabondGameManager(e,t,o){this.gameLogText="",this.isCopy=o,this.actuator=e,this.tileManager=new VagabondTileManager,this.setup(t)}function VagabondNotationMove(e){this.fullMoveText=e,this.analyzeMove()}function VagabondNotationBuilder(){this.moveType,this.tileType,this.endPoint,this.startPoint,this.status=BRAND_NEW}function VagabondGameNotation(){this.notationText="",this.moves=[]}TrifleTileInfo.tileIsBanner=function(e){return e&&e.types.includes(TileType.banner)},TrifleTileInfo.tileIsOneOfTheseTypes=function(e,t){var o=!1;return e&&t.forEach((function(t){e.types.includes(t)&&(o=!0)})),o},TrifleTileInfo.getTerritorialZone=function(e){if(e.territorialZone)return e.territorialZone},TrifleTileInfo.movementMustPreserveDirection=function(e){var t=!1;return e&&e.restrictions&&e.restrictions.length>0&&e.restrictions.forEach((function(e){e.type!==MovementRestriction.mustPreserveDirection||(t=!0)})),t},TrifleTileInfo.tileHasBoardPresenceAbility=function(e,t){var o=!1;return e&&e.abilities&&e.abilities.forEach((function(e){e.type!==t||(o=!0)})),o},TrifleTileInfo.tileHasDrawOpponentTilesInLineOfSightAbility=function(e){return TrifleTileInfo.tileHasBoardPresenceAbility(e,BoardPresenceAbility.drawOpponentTilesInLineOfSight)},TrifleTileInfo.tileCanBeCapturedByFriendlyTiles=function(e){return TrifleTileInfo.tileHasBoardPresenceAbility(e,BoardPresenceAbility.canBeCapturedByFriendlyTiles)},TrifleTileInfo.tileHasOnlyOneMovement=function(e){return e&&e.movements&&1===e.movements.length},TrifleTileInfo.tileHasMovementAbility=function(e,t){var o=!1;return e&&e.movements&&e.movements.forEach((function(e){e.abilities&&e.abilities.forEach((function(e){e.type!==t||(o=!0)}))})),o},TrifleTileInfo.tileHasAbilityTrigger=function(e,t){var o=!1;return e&&e.abilities&&e.abilities.forEach((function(e){e.triggeringAction!==t||(o=!0)})),o},TrifleTileInfo.getAbilitiesWithAbilityTrigger=function(e,t){var o=[];return e&&e.abilities&&e.abilities.forEach((function(e){e.triggeringAction===t&&o.push(e)})),o},TrifleTileInfo.getZoneAbilitiesWithAbilityTrigger=function(e,t){var o=[];return e&&e.territorialZone&&e.territorialZone.abilities&&e.territorialZone.abilities.forEach((function(e){e.triggeringAction===t&&o.push(e)})),o},TrifleTileInfo.initializeTrifleData=function(){TrifleTileInfo.defineAbilitiesForAbilityTypes(),TrifleTileInfo.defineAbilityTypes(),TrifleTileInfo.defineTrifleTiles()},TrifleTileInfo.defineAbilitiesForAbilityTypes=function(){(AbilitiesForType={})[AbilityType.protection]=[ZoneAbility.protectFriendlyTilesFromCapture,BoardPresenceAbility.captureProtection]},TrifleTileInfo.defineAbilityTypes=function(){(AbilityTypes={})[ZoneAbility.protectFriendlyTilesFromCapture]=[AbilityType.protection],AbilityTypes[BoardPresenceAbility.captureProtection]=[AbilityType.protection]},TrifleTileInfo.defineTrifleTiles=function(){(TrifleTiles={})[TrifleTileCodes.Lotus]={types:[TileType.banner,TileType.flower],deployTypes:[DeployType.anywhere],movements:[{type:MovementType.standard,distance:1}]},TrifleTiles[TrifleTileCodes.SkyBison]={types:[TileType.animal],deployTypes:[DeployType.temple],movements:[{type:MovementType.standard,distance:6,captureTypes:[CaptureType.all]}],territorialZone:{size:6,abilities:[{type:ZoneAbility.canceledWhenInTemple},{type:ZoneAbility.restrictMovementWithinZone,targetTeams:[TileTeam.enemy],targetTileCodes:[TrifleTileCodes.SkyBison]}]}},TrifleTiles[TrifleTileCodes.Chrysanthemum]={types:[TileType.flower],deployTypes:[DeployType.anywhere],territorialZone:{size:1,abilities:[{type:ZoneAbility.immobilizesOpponentTiles,targetTileCodes:[TrifleTileCodes.SkyBison]},{type:ZoneAbility.removesTileAbilities,targetTeams:[TileTeam.enemy],targetTileCodes:[TrifleTileCodes.SkyBison]}]}},TrifleTiles[TrifleTileCodes.Wheel]={types:[TileType.traveler],deployTypes:[DeployType.anywhere],movements:[{type:MovementType.diagonal,distance:15,captureTypes:[CaptureType.all],restrictions:[{type:MovementRestriction.mustPreserveDirection}]}]},TrifleTiles[TrifleTileCodes.Badgermole]={types:[TileType.animal],deployTypes:[DeployType.anywhere],movements:[{type:MovementType.standard,distance:1},{type:MovementType.jumpAlongLineOfSight,targetTileTypes:[TileType.flower,TileType.banner]}],territorialZone:{size:1,abilities:[{type:ZoneAbility.protectFriendlyTilesFromCapture,targetTileTypes:[TileType.flower,TileType.banner]}]}},TrifleTiles[TrifleTileCodes.FireLily]={types:[TileType.flower],deployTypes:[DeployType.anywhere],territorialZone:{size:5}},TrifleTiles[TrifleTileCodes.Dragon]={types:[TileType.animal],specialDeployTypes:[{type:SpecialDeployType.withinFriendlyTileZone,targetTileCodes:[TrifleTileCodes.FireLily]}],movements:[{type:MovementType.withinFriendlyTileZone,targetTileCodes:[TrifleTileCodes.FireLily],captureTypes:[CaptureType.all]}]},TrifleTiles[TrifleTileCodes.AirBanner]={types:[TileType.banner],deployTypes:[DeployType.anywhere],movements:[{type:MovementType.standard,distance:1}],abilities:[{type:ZoneAbility.grantBonusTileMovement}]},TrifleTiles[TrifleTileCodes.RingTailedLemur]={types:[TileType.animal],deployTypes:[DeployType.temple],movements:[{type:MovementType.standard,distance:5,captureTypes:[CaptureType.all],abilities:[{type:MovementAbility.jumpOver}]}]},TrifleTiles[TrifleTileCodes.HermitCrab]={types:[TileType.animal],deployTypes:[DeployType.anywhere],movements:[{type:MovementType.jumpShape,shape:[1,2],distance:99,captureTypes:[CaptureType.all],abilities:[{type:MovementAbility.jumpOver}],restrictions:[{type:MovementRestriction.mustPreserveDirection}]}]},TrifleTiles[TrifleTileCodes.Firefly]={types:[TileType.animal],deployTypes:[DeployType.anywhere],movements:[{type:MovementType.standard,distance:2}],abilities:[{type:BoardPresenceAbility.drawOpponentTilesInLineOfSight}]},TrifleTiles[TrifleTileCodes.Edelweiss]={types:[TileType.flower],deployTypes:[DeployType.anywhere],territorialZone:{size:4,abilities:[{type:ZoneAbility.removesTileAbilities,targetTeams:[TileTeam.friendly,TileTeam.enemy],targetTileTypes:[TileCategory.allTileTypes]}]}},TrifleTiles[TrifleTileCodes.WaterBanner]={types:[TileType.banner],deployTypes:[DeployType.anywhere],movements:[{type:MovementType.standard,distance:2}]},TrifleTiles[TrifleTileCodes.SnowLeopard]={types:[TileType.animal],deployTypes:[DeployType.anywhere],movements:[{type:MovementType.standard,distance:3,captureTypes:[CaptureType.all]}],abilities:[{type:Ability.removeEffects,triggeringBoardState:AbilityTrigger.whileTileInLineOfSight,targetEffectTypes:[AbilityType.protection],targetTileTypes:[TileCategory.allTileTypes]}]},TrifleTiles[TrifleTileCodes.PolarBearDog]={types:[TileType.animal],deployTypes:[DeployType.anywhere],movements:[{type:MovementType.standard,distance:4,captureTypes:[CaptureType.all]}],abilities:[{type:BoardPresenceAbility.captureProtection,triggeringAction:AbilityTrigger.whenCapturing,duration:1,tileTypesProtectedFrom:[TileCategory.allTileTypes]}]},TrifleTiles[TrifleTileCodes.BuffaloYak]={types:[TileType.animal],deployTypes:[DeployType.anywhere],movements:[{type:MovementType.standard,distance:2,captureTypes:[CaptureType.all]}],territorialZone:{size:2,abilities:[{type:ZoneAbility.removesTileAbilities,targetTeams:[TileTeam.friendly,TileTeam.enemy],targetTileTypes:[TileType.flower]}]}},TrifleTiles[TrifleTileCodes.TitanArum]={types:[TileType.flower],deployTypes:[DeployType.anywhere],territorialZone:{size:2,abilities:[{type:ZoneAbility.restrictMovementWithinZone,targetTeams:[TileTeam.friendly,TileTeam.enemy],targetTileTypes:[TileType.animal,TileType.traveler,TileType.banner]}]}},TrifleTiles[TrifleTileCodes.LilyPad]={types:[TileType.flower],deployTypes:[DeployType.anywhere],territorialZone:{size:1,abilities:[{type:ZoneAbility.restrictMovementWithinZone,targetTeams:[TileTeam.enemy],targetTileTypes:[TileCategory.allTileTypes]}]}},TrifleTiles[TrifleTileCodes.Lupine]={types:[TileType.flower],deployTypes:[DeployType.anywhere],territorialZone:{size:3,abilities:[{type:BoardPresenceAbility.increaseFriendlyTileMovementDistance}]}},TrifleTiles[TrifleTileCodes.EarthBanner]={type:[TileType.banner],deployTypes:[DeployType.anywhere],territorialZone:{size:1,abilities:[{type:ZoneAbility.protectFriendlyTilesFromCapture,targetTileTypes:[TileType.flower]}]}},TrifleTiles[TrifleTileCodes.SaberToothMooseLion]={types:[TileType.animal],deployTypes:[DeployType.anywhere],movements:[{type:MovementType.travelShape,shape:[MoveDirection.any,MoveDirection.straight,MoveDirection.straight],captureTypes:[CaptureType.all],restrictions:[{type:MovementRestriction.mustPreserveDirection}],abilities:[{type:MovementAbility.chargeCapture}]}]},TrifleTiles[TrifleTileCodes.Shirshu]={types:[TileType.animal],deployTypes:[DeployType.anywhere],movements:[{type:MovementType.standard,distance:2},{type:MovementType.jumpAlongLineOfSight,targetTileTypes:[TileType.animal,TileType.traveler]}],territorialZone:{size:1,abilities:[{type:ZoneAbility.immobilizesTiles,targetTeams:[TileTeam.enemy]}]}},TrifleTiles[TrifleTileCodes.BoarQPine]={types:[TileType.animal],deployTypes:[DeployType.anywhere],movements:[{type:MovementType.standard,distance:1}],territorialZone:{size:1,abilities:[{type:Ability.captureTiles,triggeringAction:AbilityTrigger.whenTileLandsInZone,targetTileTypes:[TileCategory.landingTile]}]}},TrifleTiles[TrifleTileCodes.MessengerHawk]={types:[TileType.animal],deployTypes:[DeployType.anywhere,DeployType.temple],movements:[{type:MovementType.anywhere}]},TrifleTiles[TrifleTileCodes.AirGlider]={types:[TileType.traveler],deployTypes:[DeployType.temple],movements:[{type:MovementType.travelShape,shape:[MoveDirection.any,MoveDirection.turn,MoveDirection.straight,MoveDirection.straight,MoveDirection.straight],captureTypes:[CaptureType.all]}]}},VagabondActuator.prototype.setAnimationOn=function(e){this.animationOn=e},VagabondActuator.prototype.actuate=function(e,t,o){var i=this;debug(o),window.requestAnimationFrame((function(){i.htmlify(e,t,o)}))},VagabondActuator.prototype.htmlify=function(e,t,o){this.clearContainer(this.boardContainer);var i=this;e.cells.forEach((function(e){e.forEach((function(e){e&&i.addBoardPoint(e,o)}))}));var n=new VagabondTileManager;n.hostTiles.forEach((function(e){i.clearTileContainer(e)})),n.guestTiles.forEach((function(e){i.clearTileContainer(e)})),t.hostTiles.forEach((function(e){i.addTile(e,this.hostTilesContainer)})),t.guestTiles.forEach((function(e){i.addTile(e,this.guestTilesContainer)}))},VagabondActuator.prototype.clearContainer=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},VagabondActuator.prototype.clearTileContainer=function(e){for(var t=document.querySelector("."+e.getImageName());t.firstChild;)t.removeChild(t.firstChild)},VagabondActuator.prototype.addTile=function(e,t){var o=document.querySelector("."+e.getImageName()),i=document.createElement("div");i.classList.add("point"),i.classList.add("hasTile"),e.selectedFromPile&&(i.classList.add("selectedFromPile"),i.classList.add("drained"));var n=document.createElement("img"),a=this.getTileImageSourceDir();n.src=a+e.getImageName()+".png",i.appendChild(n),i.setAttribute("name",e.getImageName()),i.setAttribute("id",e.id),this.mobile?i.setAttribute("onclick","unplayedTileClicked(this); showTileMessage(this);"):(i.setAttribute("onclick","unplayedTileClicked(this);"),i.setAttribute("onmouseover","showTileMessage(this);"),i.setAttribute("onmouseout","clearMessage();")),o.appendChild(i)},VagabondActuator.prototype.addBoardPoint=function(e,t){var o=createBoardPointDiv(e);if(e.isType(NON_PLAYABLE)||(o.classList.add("activePoint"),o.classList.add("vagabondPointRotate"),e.isType(POSSIBLE_MOVE)&&o.classList.add("possibleMove"),this.mobile?o.setAttribute("onclick","pointClicked(this); showPointMessage(this);"):(o.setAttribute("onclick","pointClicked(this);"),o.setAttribute("onmouseover","showPointMessage(this);"),o.setAttribute("onmouseout","clearMessage();"))),e.hasTile()){o.classList.add("hasTile");var i=document.createElement("img");t&&this.doAnimateBoardPoint(e,t,i,o);var n=this.getTileImageSourceDir();if(i.src=n+e.tile.getImageName()+".png",o.appendChild(i),this.animationOn&&t&&t.capturedTile&&isSamePoint(t.endPoint,e.col,e.row)){debug("Captured "+t.capturedTile.code);var a=document.createElement("img");a.src=n+t.capturedTile.getImageName()+".png",a.classList.add("underneath"),o.appendChild(a),setTimeout((function(){requestAnimationFrame((function(){a.style.visibility="hidden"}))}),pieceAnimationLength)}}if(this.boardContainer.appendChild(o),e.betweenHarmony&&16===e.col){var r=document.createElement("div");r.classList.add("clear"),this.boardContainer.appendChild(r)}},VagabondActuator.prototype.doAnimateBoardPoint=function(e,t,o,i){if(debug("Animating? "+this.animationOn),this.animationOn){var n=e.col,a=e.row,r=n,l=a;t.moveType===MOVE&&e.tile?isSamePoint(t.endPoint,n,a)&&(n=t.startPoint.rowAndColumn.col,a=t.startPoint.rowAndColumn.row,o.style.transform="scale(1.2)",i.style.zIndex=99):t.moveType===DEPLOY&&isSamePoint(t.endPoint,r,l)&&1===piecePlaceAnimation&&(o.style.transform="scale(2)",i.style.zIndex=99,requestAnimationFrame((function(){o.style.transform="scale(1)"})));var s=34,h=s,d="px";window.innerWidth<=612&&(s=5.5555,h=5.611,d="vw");var u=n-r,p=a-l;o.style.left=(u*cos45-p*sin45)*s+d,o.style.top=(p*cos45+u*sin45)*h+d,requestAnimationFrame((function(){o.style.left="0px",o.style.top="0px"})),setTimeout((function(){requestAnimationFrame((function(){o.style.transform="scale(1)"}))}),pieceAnimationLength)}},VagabondActuator.prototype.getTileImageSourceDir=function(){return"images/Vagabond/"+localStorage.getItem("vagabondTileDesignTypeKey")+"/"},VagabondActuator.prototype.printBoard=function(e){debug("");var t=0;e.cells.forEach((function(e){var o=t+"\t: ";e.forEach((function(e){var t=e.getConsoleDisplay();t.length<3&&(o+=" "),o+=t,t.length<2&&(o+=" ")})),debug(o),t++})),debug("")},VagabondBoard.prototype.brandNew=function(){var e=[];e[0]=this.newRow(9,[VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.gate(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral()]),e[1]=this.newRow(11,[VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.redWhiteNeutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral()]),e[2]=this.newRow(13,[VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.whiteNeutral(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.redNeutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral()]),e[3]=this.newRow(15,[VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.whiteNeutral(),VagabondBoardPoint.white(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.red(),VagabondBoardPoint.redNeutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral()]),e[4]=this.newRow(17,[VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.whiteNeutral(),VagabondBoardPoint.white(),VagabondBoardPoint.white(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.red(),VagabondBoardPoint.red(),VagabondBoardPoint.redNeutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral()]),e[5]=this.newRow(17,[VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.whiteNeutral(),VagabondBoardPoint.white(),VagabondBoardPoint.white(),VagabondBoardPoint.white(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.red(),VagabondBoardPoint.red(),VagabondBoardPoint.red(),VagabondBoardPoint.redNeutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral()]),e[6]=this.newRow(17,[VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.whiteNeutral(),VagabondBoardPoint.white(),VagabondBoardPoint.white(),VagabondBoardPoint.white(),VagabondBoardPoint.white(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.red(),VagabondBoardPoint.red(),VagabondBoardPoint.red(),VagabondBoardPoint.red(),VagabondBoardPoint.redNeutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral()]),e[7]=this.newRow(17,[VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.whiteNeutral(),VagabondBoardPoint.white(),VagabondBoardPoint.white(),VagabondBoardPoint.white(),VagabondBoardPoint.white(),VagabondBoardPoint.white(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.red(),VagabondBoardPoint.red(),VagabondBoardPoint.red(),VagabondBoardPoint.red(),VagabondBoardPoint.red(),VagabondBoardPoint.redNeutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral()]),e[8]=this.newRow(17,[VagabondBoardPoint.gate(),VagabondBoardPoint.redWhiteNeutral(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.redWhiteNeutral(),VagabondBoardPoint.gate()]),e[9]=this.newRow(17,[VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.redNeutral(),VagabondBoardPoint.red(),VagabondBoardPoint.red(),VagabondBoardPoint.red(),VagabondBoardPoint.red(),VagabondBoardPoint.red(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.white(),VagabondBoardPoint.white(),VagabondBoardPoint.white(),VagabondBoardPoint.white(),VagabondBoardPoint.white(),VagabondBoardPoint.whiteNeutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral()]),e[10]=this.newRow(17,[VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.redNeutral(),VagabondBoardPoint.red(),VagabondBoardPoint.red(),VagabondBoardPoint.red(),VagabondBoardPoint.red(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.white(),VagabondBoardPoint.white(),VagabondBoardPoint.white(),VagabondBoardPoint.white(),VagabondBoardPoint.whiteNeutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral()]),e[11]=this.newRow(17,[VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.redNeutral(),VagabondBoardPoint.red(),VagabondBoardPoint.red(),VagabondBoardPoint.red(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.white(),VagabondBoardPoint.white(),VagabondBoardPoint.white(),VagabondBoardPoint.whiteNeutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral()]),e[12]=this.newRow(17,[VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.redNeutral(),VagabondBoardPoint.red(),VagabondBoardPoint.red(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.white(),VagabondBoardPoint.white(),VagabondBoardPoint.whiteNeutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral()]),e[13]=this.newRow(15,[VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.redNeutral(),VagabondBoardPoint.red(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.white(),VagabondBoardPoint.whiteNeutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral()]),e[14]=this.newRow(13,[VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.redNeutral(),VagabondBoardPoint.redWhite(),VagabondBoardPoint.whiteNeutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral()]),e[15]=this.newRow(11,[VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.redWhiteNeutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral()]),e[16]=this.newRow(9,[VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.gate(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral(),VagabondBoardPoint.neutral()]);for(var t=0;t<e.length;t++)for(var o=0;o<e[t].length;o++)e[t][o].row=t,e[t][o].col=o;return e},VagabondBoard.prototype.newRow=function(e,t){var o=[],i=(this.size.row-e)/2,n=new VagabondBoardPoint;n.addType(NON_PLAYABLE);for(var a=0;a<this.size.row;a++)o[a]=a<i?n:a<i+e&&t?t[a-i]:n;return o},VagabondBoard.prototype.placeTile=function(e,t){this.putTileOnPoint(e,t),"L"===e.code&&(e.ownerName===HOST?this.hlPlayed=!0:this.glPlayed=!0),this.setPointFlags()},VagabondBoard.prototype.putTileOnPoint=function(e,t){var o=t.rowAndColumn;(o=this.cells[o.row][o.col]).putTile(e)},VagabondBoard.prototype.getSurroundingRowAndCols=function(e){for(var t=[],o=e.row-1;o<=e.row+1;o++)for(var i=e.col-1;i<=e.col+1;i++){if((o!==e.row||i!==e.col)&&o>=0&&i>=0&&o<17&&i<17)this.cells[o][i].isType(NON_PLAYABLE)||t.push(new RowAndColumn(o,i))}return t},VagabondBoard.prototype.getSurroundingBoardPoints=function(e){for(var t=[],o=e.row-1;o<=e.row+1;o++)for(var i=e.col-1;i<=e.col+1;i++)if((o!==e.row||i!==e.col)&&o>=0&&i>=0&&o<17&&i<17){var n=this.cells[o][i];n.isType(NON_PLAYABLE)||t.push(n)}return t},VagabondBoard.prototype.getAdjacentRowAndCols=function(e){var t=[];return e.row>0&&t.push(this.cells[e.row-1][e.col]),e.row<16&&t.push(this.cells[e.row+1][e.col]),e.col>0&&t.push(this.cells[e.row][e.col-1]),e.col<16&&t.push(this.cells[e.row][e.col+1]),t},VagabondBoard.prototype.pointIsOpenGate=function(e){var t=e.rowAndColumn;return(t=this.cells[t.row][t.col]).isOpenGate()},VagabondBoard.prototype.moveTile=function(e,t,o){var i=t.rowAndColumn,n=o.rowAndColumn;if(i.row<0||i.row>16||n.row<0||n.row>16)return debug("That point does not exist. So it's not gonna happen."),!1;var a=this.cells[i.row][i.col],r=this.cells[n.row][n.col];if(!this.canMoveTileToPoint(e,a,r))return debug("Bad move bears"),showBadMoveModal(),!1;var l=a.removeTile();l||debug("Error: No tile to move!"),r.hasTile()&&"L"===r.tile.code&&l.ownerName!==r.tile.ownerName&&this.winners.push(l.ownerName);var s=r.tile;return r.putTile(l),this.setPointFlags(),{movedTile:l,startPoint:a,endPoint:r,capturedTile:s}},VagabondBoard.prototype.setPointFlags=function(){for(var e=0;e<this.cells.length;e++)for(var t=0;t<this.cells[e].length;t++){(o=this.cells[e][t]).hasTile()&&(o.tile.blocked=!1,o.tile.protected=!1)}for(e=0;e<this.cells.length;e++)for(t=0;t<this.cells[e].length;t++){var o=this.cells[e][t];this.blockTilesAdjacentToPointIfNeeded(o),this.protectTilesAdjacentToPointIfNeeded(o)}},VagabondBoard.prototype.blockTilesAdjacentToPointIfNeeded=function(e){if(e.hasTile()&&"C"===e.tile.code)for(var t=e.tile.ownerName,o=this.getAdjacentRowAndCols(e),i=0;i<o.length;i++){var n=this.cells[o[i].row][o[i].col];n.hasTile()&&"S"===n.tile.code&&n.tile.ownerName!==t&&(n.tile.blocked=!0)}},VagabondBoard.prototype.protectTilesAdjacentToPointIfNeeded=function(e){if(e.hasTile()&&"B"===e.tile.code)for(var t=e.tile.ownerName,o=this.getAdjacentRowAndCols(e),i=0;i<o.length;i++){var n=this.cells[o[i].row][o[i].col];n.hasTile()&&n.tile.isFlowerTile()&&n.tile.ownerName===t&&(n.tile.protected=!0)}},VagabondBoard.prototype.canCapture=function(e,t){var o=e.tile,i=t.tile;if(o.ownerName===i.ownerName)return!1;if(i.protected)return!1;if(!o.hasCaptureAbility())return debug(o.getName()+" cannot capture anything."),!1;var n=this.hlPlayed,a=this.glPlayed;return o.ownerName===GUEST&&(n=this.glPlayed,a=this.hlPlayed),i.isFlowerTile()?n:n&&a},VagabondBoard.prototype.canMoveTileToPoint=function(e,t,o){if(!t.hasTile())return!1;if(t.tile.ownerName!==e)return!1;if(t.tile.blocked)return!1;var i=!1;if(o.hasTile()&&(i=this.canCapture(t,o)),!o.hasTile()&&o.isType(GATE))return!1;if(o.hasTile()&&!i)return!1;if("S"===t.tile.code){for(var n=[],a=0;a<this.cells.length;a++)for(var r=0;r<this.cells[a].length;r++){!(p=this.cells[a][r]).hasTile()||"S"!==p.tile.code||p.tile.id===t.tile.id||p.isType(GATE)||p.tile.blocked||p.tile.ownerCode==t.tile.ownerCode||n.push(p)}for(var l=0;l<n.length;l++)if(Math.abs(n[l].row-o.row)+Math.abs(n[l].col-o.col)<=6)return!1}if("D"===t.tile.code){var s=this.getFireLilyPoints(t.tile.ownerName);if(!s||0===s.length)return debug("No Fire Lily"),!1;var h=[];for(l=0;l<s.length;l++){var d=s[l];Math.abs(d.row-t.row)+Math.abs(d.col-t.col)<=5&&h.push(d)}for(l=0;l<h.length;l++){var u=h[l];if(Math.abs(u.row-o.row)+Math.abs(u.col-o.col)<=5)return!0}return!1}if("W"===t.tile.code){var p,c=o;if((p=t).row-p.col==c.row-c.col){var g=p.row+1,m=c.row;p.row>c.row&&(g=c.row+1,m=p.row);for(a=g;a<m;a++){r=a-(p.row-p.col);if(this.cells[a][r].hasTile())return!1}return!0}if(p.row+p.col===c.row+c.col){g=p.row+1,m=c.row;p.row>c.row&&(g=c.row+1,m=p.row),5===c.row&&5===c.col&&debug("hi");for(a=g;a<m;a++){r=p.row+p.col-a;if(this.cells[a][r].hasTile())return!1}return!0}return!1}if("B"===t.tile.code&&this.inLineWithAdjacentFlowerTileWithNothingBetween(t,o))return!0;var T=t.tile.getMoveDistance();return!(Math.abs(t.row-o.row)+Math.abs(t.col-o.col)>T)&&!!this.verifyAbleToReach(t,o,T,t.tile)},VagabondBoard.prototype.inLineWithAdjacentFlowerTileWithNothingBetween=function(e,t){var o;if(e.row===t.row){var i=t.col+1,n=e.col;e.col>t.col&&t.col>0?o=this.cells[t.row][t.col-1]:e.col<t.col&&t.col<16&&(o=this.cells[t.row][t.col+1],i=e.col+1,n=t.col);for(var a=i;a<n;a++)if(this.cells[e.row][a].hasTile())return!1}else if(e.col===t.col){var r=t.row+1,l=e.row;e.row>t.row&&t.row>0?o=this.cells[t.row-1][t.col]:e.row<t.row&&t.row<16&&(o=this.cells[t.row+1][t.col],r=e.row+1,l=t.row);for(var s=r;s<l;s++)if(this.cells[s][e.col].hasTile())return!1}return!(!o||!o.hasTile())&&o.tile.isFlowerTile()},VagabondBoard.prototype.verifyAbleToReach=function(e,t,o,i){return this.pathFound(e,t,o,i)},VagabondBoard.prototype.pathFound=function(e,t,o,i){if(!e||!t)return!1;if(e.isType(NON_PLAYABLE)||t.isType(NON_PLAYABLE))return!1;if(e.row===t.row&&e.col===t.col)return!0;if(o<=0)return!1;if("S"===i.code&&this.pointIsNextToOpponentTile(e,i.ownerCode,"C"))return!1;if(1===Math.abs(e.row-t.row)+Math.abs(e.col-t.col))return!0;var n=e.row-1;if(n>=0&&(!(a=this.cells[n][e.col]).hasTile()&&this.pathFound(a,t,o-1,i)))return!0;if((n=e.row+1)<17&&(!(a=this.cells[n][e.col]).hasTile()&&this.pathFound(a,t,o-1,i)))return!0;var a,r=e.col-1;if(r>=0&&(!(a=this.cells[e.row][r]).hasTile()&&this.pathFound(a,t,o-1,i)))return!0;if((r=e.col+1)<17&&(!(a=this.cells[e.row][r]).hasTile()&&this.pathFound(a,t,o-1,i)))return!0},VagabondBoard.prototype.pointIsNextToOpponentTile=function(e,t,o){for(var i=this.getAdjacentRowAndCols(e),n=0;n<i.length;n++)if(i[n].hasTile()&&i[n].tile.code===o&&i[n].tile.ownerCode!==t)return!0;return!1},VagabondBoard.prototype.setPossibleMovePoints=function(e){if(e.hasTile())for(var t=e.tile.ownerName,o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++)this.canMoveTileToPoint(t,e,this.cells[o][i])&&this.cells[o][i].addType(POSSIBLE_MOVE)},VagabondBoard.prototype.removePossibleMovePoints=function(){this.cells.forEach((function(e){e.forEach((function(e){e.removeType(POSSIBLE_MOVE)}))}))},VagabondBoard.prototype.getFireLilyPoint=function(e){for(var t=0;t<this.cells.length;t++)for(var o=0;o<this.cells[t].length;o++){var i=this.cells[t][o];if(i.hasTile()&&i.tile.ownerName===e&&"F"===i.tile.code)return i}},VagabondBoard.prototype.getFireLilyPoints=function(e){for(var t=[],o=0;o<this.cells.length;o++)for(var i=0;i<this.cells[o].length;i++){var n=this.cells[o][i];n.hasTile()&&n.tile.ownerName===e&&"F"===n.tile.code&&t.push(n)}return t},VagabondBoard.prototype.setDeployPointsPossibleMoves=function(e,t){if("D"!==t)for(a=0;a<this.cells.length;a++)for(r=0;r<this.cells[a].length;r++){(l=this.cells[a][r]).hasTile()||l.isType(NON_PLAYABLE)||("S"===t?l.isType(GATE)&&l.addType(POSSIBLE_MOVE):l.isType(GATE)||l.addType(POSSIBLE_MOVE))}else{var o=this.getFireLilyPoints(e);if(!o||0===o.length)return void debug("No Fire Lily");for(var i=0;i<o.length;i++)for(var n=o[i],a=0;a<this.cells.length;a++)for(var r=0;r<this.cells[a].length;r++){var l;(l=this.cells[a][r]).isType(GATE)||l.isType(NON_PLAYABLE)||l.hasTile()||Math.abs(n.row-l.row)+Math.abs(n.col-l.col)<=5&&l.addType(POSSIBLE_MOVE)}}},VagabondBoard.prototype.setGuestGateOpen=function(){this.cells[16][8].isOpenGate()&&this.cells[16][8].addType(POSSIBLE_MOVE)},VagabondBoard.prototype.getCopy=function(){var e=new VagabondBoard;return e.cells=copyArray(this.cells),e.winners=copyArray(this.winners),e.hlPlayed=this.hlPlayed,e.glPlayed=this.glPlayed,e},VagabondBoardPoint.prototype.addType=function(e){this.types.includes(e)||this.types.push(e)},VagabondBoardPoint.prototype.removeType=function(e){for(var t=0;t<this.types.length;t++)this.types[t]===e&&this.types.splice(t,1)},VagabondBoardPoint.prototype.putTile=function(e){this.tile=e},VagabondBoardPoint.prototype.hasTile=function(){return!!this.tile},VagabondBoardPoint.prototype.isType=function(e){return this.types.includes(e)},VagabondBoardPoint.prototype.isOpenGate=function(){return!this.hasTile()&&this.types.includes(GATE)},VagabondBoardPoint.prototype.removeTile=function(){var e=this.tile;return this.tile=null,e},VagabondBoardPoint.prototype.drainTile=function(){this.tile&&this.tile.drain()},VagabondBoardPoint.prototype.restoreTile=function(){this.tile&&this.tile.restore()},VagabondBoardPoint.prototype.canHoldTile=function(e,t){return!this.isType(NON_PLAYABLE)&&(!(!t&&this.hasTile())&&(e.type===BASIC_FLOWER?!(!this.isType(NEUTRAL)&&!this.isType(e.basicColorName))&&!this.isType(GATE):e.type===SPECIAL_FLOWER||e.type===ACCENT_TILE))},VagabondBoardPoint.prototype.getCopy=function(){var e=new VagabondBoardPoint;return e.types=copyArray(this.types),e.row=this.row,e.col=this.col,this.hasTile()&&(e.tile=this.tile.getCopy()),e},VagabondBoardPoint.neutral=function(){var e=new VagabondBoardPoint;return e.addType(NEUTRAL),e},VagabondBoardPoint.gate=function(){var e=new VagabondBoardPoint;return e.addType(GATE),e},VagabondBoardPoint.red=function(){var e=new VagabondBoardPoint;return e.addType(RED),e},VagabondBoardPoint.white=function(){var e=new VagabondBoardPoint;return e.addType(WHITE),e},VagabondBoardPoint.redWhite=function(){var e=new VagabondBoardPoint;return e.addType(RED),e.addType(WHITE),e},VagabondBoardPoint.redWhiteNeutral=function(){var e=new VagabondBoardPoint;return e.addType(RED),e.addType(WHITE),e.addType(NEUTRAL),e},VagabondBoardPoint.redNeutral=function(){var e=new VagabondBoardPoint;return e.addType(RED),e.addType(NEUTRAL),e},VagabondBoardPoint.whiteNeutral=function(){var e=new VagabondBoardPoint;return e.addType(WHITE),e.addType(NEUTRAL),e},VagabondController.animationsEnabledKey="AnimationsEnabled",VagabondController.prototype.getGameTypeId=function(){return GameType.VagabondPaiSho.id},VagabondController.prototype.completeSetup=function(){this.peekAtOpponentMovesPrefKey="PeekAtOpponentMoves",this.peekAtOpponentMoves="true"===getUserGamePreference(this.peekAtOpponentMovesPrefKey),debug("Peeky?: "+this.peekAtOpponentMoves),debug("!this.peek...: "+!this.peekAtOpponentMoves)},VagabondController.prototype.resetGameManager=function(){this.theGame=new VagabondGameManager(this.actuator)},VagabondController.prototype.resetNotationBuilder=function(){var e=!1;this.notationBuilder&&(e=this.notationBuilder.offerDraw),this.notationBuilder=new VagabondNotationBuilder,e&&(this.notationBuilder.offerDraw=!0),this.checkingOutOpponentTileOrNotMyTurn=!1},VagabondController.prototype.resetGameNotation=function(){this.gameNotation=this.getNewGameNotation()},VagabondController.prototype.getNewGameNotation=function(){return new VagabondGameNotation},VagabondController.getHostTilesContainerDivs=function(){return'<div class="HC"></div> <div class="HS"></div> <div class="HB"></div> <div class="HW"></div> <br class="clear" /> <div class="HF"></div> <div class="HD"></div> <div class="H_empty"></div> <div class="HL"></div>'},VagabondController.getGuestTilesContainerDivs=function(){return'<div class="GC"></div> <div class="GS"></div> <div class="GB"></div> <div class="GW"></div> <br class="clear" /> <div class="GF"></div> <div class="GD"></div> <div class="G_empty"></div> <div class="GL"></div>'},VagabondController.prototype.callActuate=function(){this.theGame.actuate()},VagabondController.prototype.resetMove=function(){this.notationBuilder.offerDraw=!1,this.notationBuilder.status===BRAND_NEW?this.gameNotation.removeLastMove():this.notationBuilder.status,rerunAll()},VagabondController.prototype.getDefaultHelpMessageText=function(){return"<h4>Vagabond Pai Sho</h4> <p> <p>Vagabond Pai Sho is the Pai Sho variant seen in the fanfiction story <a href='https://skudpaisho.com/site/more/fanfiction-recommendations/' target='_blank'>Gambler and Vagabond (download here)</a>.</p> <p><strong>You win</strong> if you capture your opponent's White Lotus tile.</p> <p><strong>On a turn</strong>, you may either deploy a tile or move a tile.</p> <p><strong>You can't capture Flower tiles</strong> until your White Lotus has been deployed.<br /> <strong>You can't capture Non-Flower tiles</strong> until both players' White Lotus tiles have been deployed.</p> <p><strong>Hover</strong> over any tile to see how it works.</p> </p> <p>Select tiles to learn more or <a href='https://skudpaisho.com/site/games/vagabond-pai-sho/' target='_blank'>view the rules</a>.</p>"},VagabondController.prototype.togglePeekAtOpponentMoves=function(){this.peekAtOpponentMoves=!this.peekAtOpponentMoves,setUserGamePreference(this.peekAtOpponentMovesPrefKey,this.peekAtOpponentMoves),clearMessage()},VagabondController.prototype.getAdditionalMessage=function(){var e="";return 0===this.gameNotation.moves.length?(onlinePlayEnabled&&gameId<0&&userIsLoggedIn()?e+="Click <em>Join Game</em> above to join another player's game. Or, you can start a game that other players can join by making a move. <br />":e+="Sign in to enable online gameplay. Or, start playing a local game by making a move.",e+=getGameOptionsMessageHtml(GameType.VagabondPaiSho.gameOptions)):!this.theGame.hasEnded()&&myTurn()?this.gameNotation.lastMoveHasDrawOffer()&&this.promptToAcceptDraw?(e+="<br />Are you sure you want to accept the draw offer and end the game?<br />",e+="<span class='skipBonus' onclick='gameController.confirmAcceptDraw();'>Yes, accept draw and end the game</span>",e+="<br /><br />"):this.gameNotation.lastMoveHasDrawOffer()?e+="<br />Your opponent is offering a draw. You may <span class='skipBonus' onclick='gameController.acceptDraw();'>Accept Draw</span> or make a move to refuse the draw offer.<br />":this.notationBuilder.offerDraw?e+="<br />Your opponent will be able to accept or reject your draw offer once you make your move. Or, you may <span class='skipBonus' onclick='gameController.removeDrawOffer();'>remove your draw offer</span> from this move.":e+="<br /><span class='skipBonus' onclick='gameController.offerDraw();'>Offer Draw</span><br />":myTurn()||this.gameNotation.lastMoveHasDrawOffer()&&(e+="<br />A draw has been offered.<br />"),e},VagabondController.prototype.gameHasEndedInDraw=function(){return this.theGame.gameHasEndedInDraw},VagabondController.prototype.acceptDraw=function(){myTurn()&&(this.promptToAcceptDraw=!0,refreshMessage())},VagabondController.prototype.confirmAcceptDraw=function(){if(myTurn()){this.resetNotationBuilder(),this.notationBuilder.moveType=DRAW_ACCEPT;var e=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.theGame.runNotationMove(e),this.gameNotation.addMove(e),playingOnlineGame()?callSubmitMove():finalizeMove()}},VagabondController.prototype.offerDraw=function(){myTurn()&&(this.notationBuilder.offerDraw=!0,refreshMessage())},VagabondController.prototype.removeDrawOffer=function(){myTurn()&&(this.notationBuilder.offerDraw=!1,refreshMessage())},VagabondController.prototype.unplayedTileClicked=function(e){if(this.promptToAcceptDraw=!1,(!this.theGame.hasEnded()||this.notationBuilder.status===READY_FOR_BONUS)&&(myTurn()||this.peekAtOpponentMoves))if(currentMoveIndex===this.gameNotation.moves.length||this.peekAtOpponentMoves){var t=e.getAttribute("name"),o=parseInt(e.getAttribute("id")),i=t.charAt(0),n=t.substring(1),a=GUEST;"H"===i&&(a=HOST);var r=this.theGame.tileManager.peekTile(a,n,o);(r.ownerName===getCurrentPlayer()&&myTurn()||(this.checkingOutOpponentTileOrNotMyTurn=!0,this.peekAtOpponentMoves))&&(this.notationBuilder.status===BRAND_NEW?(r.selectedFromPile=!0,this.notationBuilder.moveType=DEPLOY,this.notationBuilder.tileType=n,this.notationBuilder.status=WAITING_FOR_ENDPOINT,this.theGame.revealDeployPoints(r.ownerName,n)):(this.theGame.hidePossibleMovePoints(),this.resetNotationBuilder()))}else debug("Can only interact if all moves are played.")},VagabondController.prototype.pointClicked=function(e){if(this.promptToAcceptDraw=!1,!this.theGame.hasEnded()&&(myTurn()||this.peekAtOpponentMoves))if(currentMoveIndex===this.gameNotation.moves.length||this.peekAtOpponentMoves){var t=new NotationPoint(e.getAttribute("name")).rowAndColumn,o=this.theGame.board.cells[t.row][t.col];if(this.notationBuilder.status===BRAND_NEW){if(o.hasTile()){if(!(o.tile.ownerName===getCurrentPlayer()&&myTurn()||(debug("That's not your tile!"),this.checkingOutOpponentTileOrNotMyTurn=!0,this.peekAtOpponentMoves)))return;if(!o.tile.canMove())return;this.notationBuilder.status=WAITING_FOR_ENDPOINT,this.notationBuilder.moveType=MOVE,this.notationBuilder.startPoint=new NotationPoint(e.getAttribute("name")),this.theGame.revealPossibleMovePoints(o)}}else if(this.notationBuilder.status===WAITING_FOR_ENDPOINT)if(o.isType(POSSIBLE_MOVE)&&myTurn())if(this.theGame.hidePossibleMovePoints(),this.checkingOutOpponentTileOrNotMyTurn||isInReplay)this.resetNotationBuilder();else{this.notationBuilder.endPoint=new NotationPoint(e.getAttribute("name"));var i=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.theGame.runNotationMove(i),this.gameNotation.addMove(i),onlinePlayEnabled&&1===this.gameNotation.moves.length?createGameIfThatIsOk(GameType.VagabondPaiSho.id):playingOnlineGame()?callSubmitMove():finalizeMove()}else this.theGame.hidePossibleMovePoints(),this.resetNotationBuilder()}else debug("Can only interact if all moves are played.")},VagabondController.prototype.skipHarmonyBonus=function(){var e=this.gameNotation.getNotationMoveFromBuilder(this.notationBuilder);this.gameNotation.addMove(e),playingOnlineGame()?callSubmitMove():finalizeMove()},VagabondController.prototype.getTheMessage=function(e,t){var o=[],i=e.code,n=VagabondTile.getTileName(i);return"L"===i?(n="White Lotus",o.push("Flower Tile"),o.push("Can move 1 space")):"S"===i?(n="Sky Bison",o.push("Deployed on the Temples - the points inside of the small red triangles in the corners of the board"),o.push("Can move up to six spaces, turning any number of times, but cannot move into an opponent's Sky Bison's territorial zone"),o.push("Cannot move through or off of a space that is adjacent to an opponent's Chrysanthemum tile"),o.push("Can capture other tiles"),o.push("After the Sky Bison has moved out of its temple and is not trapped by a Chrysanthemum, it creates a territorial zone 6 spaces around it")):"B"===i?(n="Badgermole",o.push('Can move only one space in any direction OR move directly adjacent to a Flower Tile if that Flower Tile is in the Badgermole\'s "line of sight" (meaning, the tiles lie on the same line with no other tiles in between)'),o.push("Flower Tiles adjacent to a friendly Badgermole are protected from capture")):"W"===i?(n="Wheel",o.push("Can move any number of spaces forwards, backwards, left, or right across the spaces of the board as opposed to diagonally on the lines"),o.push("Can capture other tiles")):"C"===i?(n="Chrysanthemum",o.push("Flower Tile"),o.push("Cannot move"),o.push("Freezes opponent's Sky Bison tiles in place when adjacent")):"F"===i?(n="Fire Lily",o.push("Flower Tile"),o.push("Cannot move"),o.push("Enables deployment of White Dragon")):"D"===i&&(n="White Dragon",o.push("Can be deployed in a 5-space area around the Fire Lily"),o.push("Can move anywhere inside that 5-space Fire Lily zone"),o.push("Can capture other tiles")),{heading:n,message:o}},VagabondController.prototype.getTileMessage=function(e){var t=e.getAttribute("name"),o=(parseInt(e.getAttribute("id")),new VagabondTile(t.substring(1),t.charAt(0))),i=HOST;return t.startsWith("G")&&(i=GUEST),this.getTheMessage(o,i)},VagabondController.prototype.getPointMessage=function(e){var t=new NotationPoint(e.getAttribute("name")).rowAndColumn,o=this.theGame.board.cells[t.row][t.col];return o.hasTile()?this.getTheMessage(o.tile,o.tile.ownerName):null},VagabondController.prototype.playAiTurn=function(e){if(!this.theGame.getWinner()){var t=activeAi;activeAi2&&activeAi2.player===getCurrentPlayer()&&(t=activeAi2);var o=this.gameNotation.getPlayerMoveNum(),i=this;setTimeout((function(){var n=t.getMove(i.theGame.getCopy(),o);n?(i.gameNotation.addMove(n),e()):debug("No move given...")}),10)}},VagabondController.prototype.startAiGame=function(e){this.playAiTurn(e)},VagabondController.prototype.getAiList=function(){return[new VagabondRandomAIv1]},VagabondController.prototype.getCurrentPlayer=function(){return currentMoveIndex%2==0?HOST:GUEST},VagabondController.prototype.cleanup=function(){},VagabondController.prototype.isSolitaire=function(){return!1},VagabondController.prototype.setGameNotation=function(e){this.gameNotation.setNotationText(e)},VagabondController.prototype.getAdditionalHelpTabDiv=function(){var e=document.createElement("div"),t=document.createElement("h4");t.innerText="Vagabond Pai Sho Preferences:";var o=document.createElement("div"),i="Opponent move and replay peeking is ";this.peekAtOpponentMoves?i+="enabled":i+="disabled",i+=". ",o.innerText=i;var n=document.createElement("span");return n.innerText="Toggle",n.classList.add("skipBonus"),n.onclick=function(){gameController.togglePeekAtOpponentMoves()},o.appendChild(n),e.appendChild(t),e.appendChild(this.buildTileDesignDropdownDiv()),e.appendChild(o),e.appendChild(document.createElement("br")),e.appendChild(this.buildToggleAnimationsDiv()),e.appendChild(document.createElement("br")),e},VagabondController.tileDesignTypeValues={delion:"The Garden Gate Designs",classic:"Classic",water:"Water themed Garden Gate Designs",fire:"Fire themed Garden Gate Designs",canon:"Canon colors Garden Gate Designs",owl:"Order of the White Lotus Garden Gate Designs"},VagabondController.prototype.buildTileDesignDropdownDiv=function(){return buildDropdownDiv("vagabondPaiShoTileDesignDropdown","Tile Designs:",VagabondController.tileDesignTypeValues,localStorage.getItem(vagabondTileDesignTypeKey),(function(){gameController.setTileDesignsPreference(this.value)}))},VagabondController.prototype.setTileDesignsPreference=function(e){localStorage.setItem(vagabondTileDesignTypeKey,e),this.callActuate()},VagabondController.prototype.buildToggleAnimationsDiv=function(){var e=document.createElement("div"),t=this.isAnimationsEnabled()?"on":"off";return e.innerHTML="Move animations are "+t+": <span class='skipBonus' onclick='gameController.toggleAnimations();'>toggle</span>",e},VagabondController.prototype.toggleAnimations=function(){this.isAnimationsEnabled()?(setUserGamePreference(VagabondController.animationsEnabledKey,"false"),this.actuator.setAnimationOn(!1)):(setUserGamePreference(VagabondController.animationsEnabledKey,"true"),this.actuator.setAnimationOn(!0)),clearMessage()},VagabondController.prototype.isAnimationsEnabled=function(){return"false"!==getUserGamePreference(VagabondController.animationsEnabledKey)},VagabondGameManager.prototype.setup=function(e){this.board=new VagabondBoard,e||this.actuate()},VagabondGameManager.prototype.actuate=function(e){this.isCopy||(this.actuator.actuate(this.board,this.tileManager,e),setGameLogText(this.gameLogText))},VagabondGameManager.prototype.runNotationMove=function(e,t){if(debug("Running Move: "+e.fullMoveText),e.moveType===DEPLOY){var o=this.tileManager.grabTile(e.player,e.tileType);this.board.placeTile(o,e.endPoint),this.buildDeployGameLogText(e,o)}else if(e.moveType===MOVE){var i=this.board.moveTile(e.player,e.startPoint,e.endPoint);e.capturedTile=i.capturedTile,this.buildMoveGameLogText(e,i)}e.moveType===DRAW_ACCEPT&&(this.gameHasEndedInDraw=!0),t&&this.actuate(e)},VagabondGameManager.prototype.buildDeployGameLogText=function(e,t){this.gameLogText=e.player+" placed "+VagabondTile.getTileName(t.code)+" at "+e.endPoint.pointText},VagabondGameManager.prototype.buildMoveGameLogText=function(e,t){this.gameLogText=e.player+" moved "+VagabondTile.getTileName(t.movedTile.code)+" from "+e.startPoint.pointText+" to "+e.endPoint.pointText,t.capturedTile&&(this.gameLogText+=" and captured "+getOpponentName(e.player)+"'s "+VagabondTile.getTileName(t.capturedTile.code))},VagabondGameManager.prototype.hasEnded=function(){return this.getWinResultTypeCode()>0},VagabondGameManager.prototype.revealPossibleMovePoints=function(e,t){e.hasTile()&&(this.board.setPossibleMovePoints(e),t||this.actuate())},VagabondGameManager.prototype.hidePossibleMovePoints=function(e){this.board.removePossibleMovePoints(),this.tileManager.removeSelectedTileFlags(),e||this.actuate()},VagabondGameManager.prototype.revealDeployPoints=function(e,t,o){this.board.setDeployPointsPossibleMoves(e,t),o||this.actuate()},VagabondGameManager.prototype.getWinner=function(){if(1===this.board.winners.length)return this.board.winners[0]},VagabondGameManager.prototype.getWinReason=function(){return" has captured the White Lotus and won the game!"},VagabondGameManager.prototype.getWinResultTypeCode=function(){return 1===this.board.winners.length?1:this.gameHasEndedInDraw?4:void 0},VagabondGameManager.prototype.getCopy=function(){var e=new VagabondGameManager(this.actuator,!0,!0);return e.board=this.board.getCopy(),e.tileManager=this.tileManager.getCopy(),e},VagabondNotationMove.prototype.analyzeMove=function(){this.valid=!0;var e=(i=this.fullMoveText.split("."))[0];this.moveNum=parseInt(e.slice(0,-1)),this.playerCode=e.charAt(e.length-1),"G"===this.playerCode?this.player=GUEST:"H"===this.playerCode&&(this.player=HOST);var t=i[1];if(t){var o=t.charAt(0);if("("===o?this.moveType=MOVE:t.startsWith(DRAW_ACCEPT)?this.moveType=DRAW_ACCEPT:this.moveType=DEPLOY,this.moveType===DEPLOY)this.tileType=o,"("===t.charAt(1)||(debug("Failure to plant"),this.valid=!1),t.endsWith(")")||t.endsWith(")"+DRAW_OFFER)?this.endPoint=new NotationPoint(t.substring(t.indexOf("(")+1,t.indexOf(")"))):this.valid=!1;else if(this.moveType===MOVE){var i=t.substring(t.indexOf("(")+1).split(")-(");this.startPoint=new NotationPoint(i[0]),this.endPoint=new NotationPoint(i[1].substring(0,i[1].indexOf(")")))}this.offerDraw=t.endsWith(DRAW_OFFER)}},VagabondNotationMove.prototype.isValidNotation=function(){return this.valid},VagabondNotationMove.prototype.equals=function(e){return this.fullMoveText===e.fullMoveText},VagabondNotationBuilder.prototype.getNotationMove=function(e,t){var o=e+t.charAt(0)+".";return this.moveType===MOVE?o+="("+this.startPoint.pointText+")-("+this.endPoint.pointText+")":this.moveType===DEPLOY?o+=this.tileType+"("+this.endPoint.pointText+")":this.moveType===DRAW_ACCEPT&&(o+=DRAW_ACCEPT),this.offerDraw&&(o+=DRAW_OFFER),new VagabondNotationMove(o)},VagabondGameNotation.prototype.setNotationText=function(e){this.notationText=e,this.loadMoves()},VagabondGameNotation.prototype.addNotationLine=function(e){this.notationText+=";"+e.trim(),this.loadMoves()},VagabondGameNotation.prototype.addMove=function(e){this.notationText?this.notationText+=";"+e.fullMoveText:this.notationText=e.fullMoveText,this.loadMoves()},VagabondGameNotation.prototype.removeLastMove=function(){this.notationText=this.notationText.substring(0,this.notationText.lastIndexOf(";")),this.loadMoves()},VagabondGameNotation.prototype.getPlayerMoveNum=function(){var e=0,t=this.moves[this.moves.length-1];return t&&(e=t.moveNum,t.player===GUEST&&e++),e},VagabondGameNotation.prototype.getNotationMoveFromBuilder=function(e){var t=0,o=HOST,i=this.moves[this.moves.length-1];return i&&(t=i.moveNum,i.player===GUEST?t++:o=GUEST),e.getNotationMove(t,o)},VagabondGameNotation.prototype.loadMoves=function(){this.moves=[];var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t=this,o=GUEST;e.forEach((function(e){var i=new VagabondNotationMove(e);i.isValidNotation()&&i.player!==o?(t.moves.push(i),o=i.player):debug("the player check is broken?")}))},VagabondGameNotation.prototype.getNotationHtml=function(){var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t="";return e.forEach((function(e){t+=e+"<br />"})),t},VagabondGameNotation.prototype.notationTextForUrl=function(){return this.notationText},VagabondGameNotation.prototype.getNotationForEmail=function(){var e=[];this.notationText&&(e=this.notationText.includes(";")?this.notationText.split(";"):[this.notationText]);var t="";return e.forEach((function(e){t+=e+"[BR]"})),t},VagabondGameNotation.prototype.getLastMoveText=function(){return this.moves[this.moves.length-1].fullMoveText},VagabondGameNotation.prototype.getLastMoveNumber=function(){return this.moves[this.moves.length-1].moveNum},VagabondGameNotation.prototype.lastMoveHasDrawOffer=function(){return this.moves[this.moves.length-1]&&this.moves[this.moves.length-1].offerDraw};var VagabondTileCodes={SkyBison:"S",Badgermole:"B",Wheel:"W",Chrysanthemum:"C",FireLily:"F",Dragon:"D",Lotus:"L"};function VagabondTile(e,t){this.code=e,this.ownerCode=t,"G"===this.ownerCode?this.ownerName=GUEST:"H"===this.ownerCode?this.ownerName=HOST:debug("INCORRECT OWNER CODE"),this.id=tileId++,this.selectedFromPile=!1}function VagabondTileManager(){this.hostTiles=this.loadTileSet("H"),this.guestTiles=this.loadTileSet("G")}function BloomsRandomAIv1(){}function VagabondAiHelp(){this.moveNum=0}function VagabondRandomAIv1(){this.aiHelp=new VagabondAiHelp}VagabondTile.prototype.getImageName=function(){return this.ownerCode+""+this.code},VagabondTile.prototype.canMove=function(e){return!("C"===this.code||"F"===this.code)},VagabondTile.prototype.getMoveDistance=function(){return"L"===this.code||"B"===this.code?1:"S"===this.code?6:0},VagabondTile.prototype.isFlowerTile=function(){return"L"===this.code||"C"===this.code||"F"===this.code},VagabondTile.prototype.hasCaptureAbility=function(){return"D"===this.code||"W"===this.code||"S"===this.code},VagabondTile.prototype.getName=function(){return VagabondTile.getTileName(this.code)},VagabondTile.prototype.getCopy=function(){return new VagabondTile(this.code,this.ownerCode)},VagabondTile.getTileName=function(e){var t="";return"L"===e?t="White Lotus":"S"===e?t="Sky Bison":"B"===e?t="Badgermole":"W"===e?t="Wheel":"C"===e?t="Chrysanthemum":"F"===e?t="Fire Lily":"D"===e&&(t="White Dragon"),t},VagabondTileManager.prototype.loadTileSet=function(e){var t=[];return this.addTiles(t,e),gameOptionEnabled(OPTION_DOUBLE_TILES)&&this.addTiles(t,e),t.push(new VagabondTile("L",e)),t},VagabondTileManager.prototype.addTiles=function(e,t){for(var o=0;o<2;o++)e.push(new VagabondTile("S",t)),e.push(new VagabondTile("B",t)),e.push(new VagabondTile("W",t)),e.push(new VagabondTile("C",t));e.push(new VagabondTile("F",t)),e.push(new VagabondTile("D",t))},VagabondTileManager.prototype.grabTile=function(e,t){var o,i=this.hostTiles;e===GUEST&&(i=this.guestTiles);for(var n=0;n<i.length;n++)if(i[n].code===t){newTileArr=i.splice(n,1),o=newTileArr[0];break}return o||debug("NONE OF THAT TILE FOUND"),o},VagabondTileManager.prototype.peekTile=function(e,t,o){var i,n=this.hostTiles;if(e===GUEST&&(n=this.guestTiles),o)for(var a=0;a<n.length;a++)if(n[a].id===o)return n[a];for(a=0;a<n.length;a++)if(n[a].code===t){i=n[a];break}return i||debug("NONE OF THAT TILE FOUND"),i},VagabondTileManager.prototype.removeSelectedTileFlags=function(){this.hostTiles.forEach((function(e){e.selectedFromPile=!1})),this.guestTiles.forEach((function(e){e.selectedFromPile=!1}))},VagabondTileManager.prototype.unselectTiles=function(e){var t=this.hostTiles;e===GUEST&&(t=this.guestTiles),t.forEach((function(e){e.selectedFromPile=!1}))},VagabondTileManager.prototype.getCopy=function(){var e=new VagabondTileManager;return e.hostTiles=copyArray(this.hostTiles),e.guestTiles=copyArray(this.guestTiles),e},BloomsRandomAIv1.prototype.getName=function(){return"Blooms Random AI"},BloomsRandomAIv1.prototype.setPlayer=function(e){this.player=e},BloomsRandomAIv1.prototype.getMove=function(e,t){},BloomsRandomAIv1.prototype.getPossibleMoves=function(e,t){},VagabondAiHelp.prototype.getAllPossibleMoves=function(e,t){var o=this.getPossibleDeploymentMoves(e,t),i=this.getPossibleMovementMoves(e,t);return o.concat(i)},VagabondAiHelp.prototype.getPossibleDeploymentMoves=function(e,t){for(var o=[],i=this.getTilePile(e,t),n=0;n<i.length;n++){var a=i[n];e.revealDeployPoints(t,a.code,!0);for(var r=this.getPossibleMovePoints(e),l=0;l<r.length;l++){var s=new VagabondNotationBuilder;s.moveType=DEPLOY,s.tileType=a.code,s.status=WAITING_FOR_ENDPOINT;var h=r[l];s.endPoint=new NotationPoint(this.getNotation(h));var d=s.getNotationMove(this.moveNum,t);e.hidePossibleMovePoints(!0);for(var u=!1,p=0;p<o.length;p++)o[p].equals(d)&&(u=!0);u||o.push(d)}}return o},VagabondAiHelp.prototype.getPossibleMovementMoves=function(e,t){for(var o=[],i=this.getMovementStartPoints(e,t),n=0;n<i.length;n++){var a=i[n];e.revealPossibleMovePoints(a,!0);for(var r=this.getPossibleMovePoints(e),l=0;l<r.length;l++){var s=new VagabondNotationBuilder;s.moveType=MOVE,s.startPoint=new NotationPoint(this.getNotation(a)),s.status=WAITING_FOR_ENDPOINT;var h=r[l];s.endPoint=new NotationPoint(this.getNotation(h));var d=s.getNotationMove(this.moveNum,t);e.hidePossibleMovePoints(!0);for(var u=!1,p=0;p<o.length;p++)o[p].equals(d)&&(u=!0);u||o.push(d)}}return o},VagabondAiHelp.prototype.getTilePile=function(e,t){var o=e.tileManager.hostTiles;return t===GUEST&&(o=e.tileManager.guestTiles),o},VagabondAiHelp.prototype.getPossibleMovePoints=function(e){for(var t=[],o=0;o<e.board.cells.length;o++)for(var i=0;i<e.board.cells[o].length;i++)e.board.cells[o][i].isType(POSSIBLE_MOVE)&&t.push(e.board.cells[o][i]);return t},VagabondAiHelp.prototype.getNotation=function(e){return new RowAndColumn(e.row,e.col).notationPointString},VagabondAiHelp.prototype.getMovementStartPoints=function(e,t){for(var o=[],i=0;i<e.board.cells.length;i++)for(var n=0;n<e.board.cells[i].length;n++){var a=e.board.cells[i][n];a.hasTile()&&a.tile.ownerName===t&&o.push(e.board.cells[i][n])}return o},VagabondRandomAIv1.prototype.getName=function(){return"Vagabond Random AI"},VagabondRandomAIv1.prototype.getMessage=function(){return"This AI makes moves completely randomly, so you should be able to beat it easily if it even manages to play its Lotus. "},VagabondRandomAIv1.prototype.setPlayer=function(e){this.player=e},VagabondRandomAIv1.prototype.getMove=function(e,t){return this.aiHelp.moveNum=t,removeRandomFromArray(this.aiHelp.getAllPossibleMoves(e,this.player))};
//=> local testing windows

</script>
  <script src="psmin_999.js"></script>

</body>

</html>
